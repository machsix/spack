

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Package Settings (packages.yaml) &mdash; Spack 0.23.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5f00b823" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=832b3b9f"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Concretization Settings (concretizer.yaml)" href="build_settings.html" />
    <link rel="prev" title="Spack Settings (config.yaml)" href="config_yaml.html" /> 
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S0PQ7WV75K"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S0PQ7WV75K');
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/spack-logo-white-text.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="features.html">Feature Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="replace_conda_homebrew.html">Spack for Homebrew/Conda Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="frequently_asked_questions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://spack-tutorial.readthedocs.io">Tutorial (spack-tutorial.rtfd.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://packages.spack.io">Packages (packages.spack.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cache.spack.io">Binaries (binaries.spack.io)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="config_yaml.html">Spack Settings (config.yaml)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Package Settings (packages.yaml)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#external-packages">External Packages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#extra-attributes-for-external-packages">Extra attributes for external packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prevent-packages-from-being-built-from-sources">Prevent packages from being built from sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="#non-buildable-virtual-packages">Non-buildable virtual packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#automatically-find-external-packages">Automatically Find External Packages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#package-requirements">Package Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#requirements-syntax">Requirements syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-default-requirements">Setting default requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-requirements-on-virtual-specs">Setting requirements on virtual specs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conflicts-and-strong-preferences">Conflicts and strong preferences</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#package-preferences">Package Preferences</a></li>
<li class="toctree-l2"><a class="reference internal" href="#package-permissions">Package Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#assigning-package-attributes">Assigning Package Attributes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="build_settings.html">Concretization Settings (concretizer.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="environments.html">Environments (spack.yaml, spack.lock)</a></li>
<li class="toctree-l1"><a class="reference internal" href="containers.html">Container Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="mirrors.html">Mirrors (mirrors.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_file_support.html">Modules (modules.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="repositories.html">Package Repositories (repos.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="binary_caches.html">Build Caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootstrapping.html">Bootstrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html">Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="chain.html">Chaining Spack Installations (upstreams.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="extensions.html">Custom Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipelines.html">CI Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="signing.html">Spack Package Signing</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu_configuration.html">Using External GPU Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contribution_guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="packaging_guide.html">Packaging Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_systems.html">Build Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer_guide.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="spack.html">Spack API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="llnl.html">LLNL API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Spack</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Package Settings (packages.yaml)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/packages_yaml.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="package-settings-packages-yaml">
<span id="packages-config"></span><h1>Package Settings (packages.yaml)<a class="headerlink" href="#package-settings-packages-yaml" title="Link to this heading"></a></h1>
<p>Spack allows you to customize how your software is built through the
<code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> file.  Using it, you can make Spack prefer particular
implementations of virtual dependencies (e.g., MPI or BLAS/LAPACK),
or you can make it prefer to build with particular compilers.  You can
also tell Spack to use <em>external</em> software installations already
present on your system.</p>
<p>At a high level, the <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> file is structured like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">package1</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># settings for package1</span>
<span class="w">  </span><span class="nt">package2</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># settings for package2</span>
<span class="w">  </span><span class="c1"># ...</span>
<span class="w">  </span><span class="nt">all</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># settings that apply to all packages.</span>
</pre></div>
</div>
<p>So you can either set build preferences specifically for <em>one</em> package,
or you can specify that certain settings should apply to <em>all</em> packages.
The types of settings you can customize are described in detail below.</p>
<p>Spack’s build defaults are in the default
<code class="docutils literal notranslate"><span class="pre">etc/spack/defaults/packages.yaml</span></code> file.  You can override them in
<code class="docutils literal notranslate"><span class="pre">~/.spack/packages.yaml</span></code> or <code class="docutils literal notranslate"><span class="pre">etc/spack/packages.yaml</span></code>. For more
details on how this works, see <a class="reference internal" href="configuration.html#configuration-scopes"><span class="std std-ref">Configuration Scopes</span></a>.</p>
<section id="external-packages">
<span id="sec-external-packages"></span><h2>External Packages<a class="headerlink" href="#external-packages" title="Link to this heading"></a></h2>
<p>Spack can be configured to use externally-installed
packages rather than building its own packages. This may be desirable
if machines ship with system packages, such as a customized MPI
that should be used instead of Spack building its own MPI.</p>
<p>External packages are configured through the <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> file.
Here’s an example of an external configuration:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">openmpi</span><span class="p">:</span>
<span class="w">    </span><span class="nt">externals</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;openmpi@1.4.3%gcc@4.4.7</span><span class="nv"> </span><span class="s">arch=linux-debian7-x86_64&quot;</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/openmpi-1.4.3</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;openmpi@1.4.3%gcc@4.4.7</span><span class="nv"> </span><span class="s">arch=linux-debian7-x86_64+debug&quot;</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/openmpi-1.4.3-debug</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;openmpi@1.6.5%intel@10.1</span><span class="nv"> </span><span class="s">arch=linux-debian7-x86_64&quot;</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/openmpi-1.6.5-intel</span>
</pre></div>
</div>
<p>This example lists three installations of OpenMPI, one built with GCC,
one built with GCC and debug information, and another built with Intel.
If Spack is asked to build a package that uses one of these MPIs as a
dependency, it will use the pre-installed OpenMPI in
the given directory. Note that the specified path is the top-level
install prefix, not the <code class="docutils literal notranslate"><span class="pre">bin</span></code> subdirectory.</p>
<p><code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> can also be used to specify modules to load instead
of the installation prefixes.  The following example says that module
<code class="docutils literal notranslate"><span class="pre">CMake/3.7.2</span></code> provides cmake version 3.7.2.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">cmake</span><span class="p">:</span>
<span class="w">  </span><span class="nt">externals</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake@3.7.2</span>
<span class="w">    </span><span class="nt">modules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CMake/3.7.2</span>
</pre></div>
</div>
<p>Each <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> begins with a <code class="docutils literal notranslate"><span class="pre">packages:</span></code> attribute, followed
by a list of package names.  To specify externals, add an <code class="docutils literal notranslate"><span class="pre">externals:</span></code>
attribute under the package name, which lists externals.
Each external should specify a <code class="docutils literal notranslate"><span class="pre">spec:</span></code> string that should be as
well-defined as reasonably possible.  If a
package lacks a spec component, such as missing a compiler or
package version, then Spack will guess the missing component based
on its most-favored packages, and it may guess incorrectly.</p>
<p>Each package version and compiler listed in an external should
have entries in Spack’s packages and compiler configuration, even
though the package and compiler may not ever be built.</p>
<section id="extra-attributes-for-external-packages">
<h3>Extra attributes for external packages<a class="headerlink" href="#extra-attributes-for-external-packages" title="Link to this heading"></a></h3>
<p>Sometimes external packages require additional attributes to be used
effectively. This information can be defined on a per-package basis
and stored in the <code class="docutils literal notranslate"><span class="pre">extra_attributes</span></code> section of the external package
configuration. In addition to per-package information, this section
can be used to define environment modifications to be performed
whenever the package is used. For example, if an external package is
built without <code class="docutils literal notranslate"><span class="pre">rpath</span></code> support, it may require <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code>
settings to find its dependencies. This could be configured as
follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mpich</span><span class="p">:</span>
<span class="w">    </span><span class="nt">externals</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mpich@3.3 %clang@12.0.0 +hwloc</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/mpich</span>
<span class="w">      </span><span class="nt">extra_attributes</span><span class="p">:</span>
<span class="w">        </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">          </span><span class="nt">prepend_path</span><span class="p">:</span>
<span class="w">            </span><span class="nt">LD_LIBRARY_PATH</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/hwloc/lib64</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="configuration.html#configuration-environment-variables"><span class="std std-ref">Environment Modifications</span></a> for more information on
how to configure environment modifications in Spack config files.</p>
</section>
<section id="prevent-packages-from-being-built-from-sources">
<h3>Prevent packages from being built from sources<a class="headerlink" href="#prevent-packages-from-being-built-from-sources" title="Link to this heading"></a></h3>
<p>Adding an external spec in <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> allows Spack to use an external location,
but it does not prevent Spack from building packages from sources. In the above example,
Spack might choose for many valid reasons to start building and linking with the
latest version of OpenMPI rather than continue using the pre-installed OpenMPI versions.</p>
<p>To prevent this, the <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> configuration also allows packages
to be flagged as non-buildable.  The previous example could be modified to
be:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">openmpi</span><span class="p">:</span>
<span class="w">    </span><span class="nt">externals</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;openmpi@1.4.3%gcc@4.4.7</span><span class="nv"> </span><span class="s">arch=linux-debian7-x86_64&quot;</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/openmpi-1.4.3</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;openmpi@1.4.3%gcc@4.4.7</span><span class="nv"> </span><span class="s">arch=linux-debian7-x86_64+debug&quot;</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/openmpi-1.4.3-debug</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;openmpi@1.6.5%intel@10.1</span><span class="nv"> </span><span class="s">arch=linux-debian7-x86_64&quot;</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/openmpi-1.6.5-intel</span>
<span class="w">    </span><span class="nt">buildable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</pre></div>
</div>
<p>The addition of the <code class="docutils literal notranslate"><span class="pre">buildable</span></code> flag tells Spack that it should never build
its own version of OpenMPI from sources, and it will instead always rely on a pre-built
OpenMPI.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If <code class="docutils literal notranslate"><span class="pre">concretizer:reuse</span></code> is on (see <a class="reference internal" href="build_settings.html#concretizer-options"><span class="std std-ref">Concretization Settings (concretizer.yaml)</span></a> for more information on that flag)
pre-built specs include specs already available from a local store, an upstream store, a registered
buildcache or specs marked as externals in <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code>. If <code class="docutils literal notranslate"><span class="pre">concretizer:reuse</span></code> is off, only
external specs in <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> are included in the list of pre-built specs.</p>
</div>
<p>If an external module is specified as not buildable, then Spack will load the
external module into the build environment which can be used for linking.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">buildable</span></code> does not need to be paired with external packages.
It could also be used alone to forbid packages that may be
buggy or otherwise undesirable.</p>
</section>
<section id="non-buildable-virtual-packages">
<h3>Non-buildable virtual packages<a class="headerlink" href="#non-buildable-virtual-packages" title="Link to this heading"></a></h3>
<p>Virtual packages in Spack can also be specified as not buildable, and
external implementations can be provided. In the example above,
OpenMPI is configured as not buildable, but Spack will often prefer
other MPI implementations over the externally available OpenMPI. Spack
can be configured with every MPI provider not buildable individually,
but more conveniently:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mpi</span><span class="p">:</span>
<span class="w">    </span><span class="nt">buildable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">  </span><span class="nt">openmpi</span><span class="p">:</span>
<span class="w">    </span><span class="nt">externals</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;openmpi@1.4.3%gcc@4.4.7</span><span class="nv"> </span><span class="s">arch=linux-debian7-x86_64&quot;</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/openmpi-1.4.3</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;openmpi@1.4.3%gcc@4.4.7</span><span class="nv"> </span><span class="s">arch=linux-debian7-x86_64+debug&quot;</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/openmpi-1.4.3-debug</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;openmpi@1.6.5%intel@10.1</span><span class="nv"> </span><span class="s">arch=linux-debian7-x86_64&quot;</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/openmpi-1.6.5-intel</span>
</pre></div>
</div>
<p>Spack can then use any of the listed external implementations of MPI
to satisfy a dependency, and will choose depending on the compiler and
architecture.</p>
<p>In cases where the concretizer is configured to reuse specs, and other <code class="docutils literal notranslate"><span class="pre">mpi</span></code> providers
(available via stores or buildcaches) are not wanted, Spack can be configured to require
specs matching only the available externals:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mpi</span><span class="p">:</span>
<span class="w">    </span><span class="nt">buildable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">    </span><span class="nt">require</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">one_of</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">        </span><span class="s">&quot;openmpi@1.4.3%gcc@4.4.7</span><span class="nv"> </span><span class="s">arch=linux-debian7-x86_64&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;openmpi@1.4.3%gcc@4.4.7</span><span class="nv"> </span><span class="s">arch=linux-debian7-x86_64+debug&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;openmpi@1.6.5%intel@10.1</span><span class="nv"> </span><span class="s">arch=linux-debian7-x86_64&quot;</span>
<span class="w">      </span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">openmpi</span><span class="p">:</span>
<span class="w">    </span><span class="nt">externals</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;openmpi@1.4.3%gcc@4.4.7</span><span class="nv"> </span><span class="s">arch=linux-debian7-x86_64&quot;</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/openmpi-1.4.3</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;openmpi@1.4.3%gcc@4.4.7</span><span class="nv"> </span><span class="s">arch=linux-debian7-x86_64+debug&quot;</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/openmpi-1.4.3-debug</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;openmpi@1.6.5%intel@10.1</span><span class="nv"> </span><span class="s">arch=linux-debian7-x86_64&quot;</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/openmpi-1.6.5-intel</span>
</pre></div>
</div>
<p>This configuration prevents any spec using MPI and originating from stores or buildcaches to be reused,
unless it matches the requirements under <code class="docutils literal notranslate"><span class="pre">packages:mpi:require</span></code>. For more information on requirements see
<a class="reference internal" href="#package-requirements"><span class="std std-ref">Package Requirements</span></a>.</p>
</section>
<section id="automatically-find-external-packages">
<span id="cmd-spack-external-find"></span><h3>Automatically Find External Packages<a class="headerlink" href="#automatically-find-external-packages" title="Link to this heading"></a></h3>
<p>You can run the <a class="reference internal" href="command_index.html#spack-external-find"><span class="std std-ref">spack external find</span></a> command
to search for system-provided packages and add them to <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code>.
After running this command your <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> may include new entries:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">cmake</span><span class="p">:</span>
<span class="w">    </span><span class="nt">externals</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake@3.17.2</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr</span>
</pre></div>
</div>
<p>Generally this is useful for detecting a small set of commonly-used packages;
for now this is generally limited to finding build-only dependencies.
Specific limitations include:</p>
<ul class="simple">
<li><p>Packages are not discoverable by default: For a package to be
discoverable with <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">external</span> <span class="pre">find</span></code>, it needs to add special
logic. See <a class="reference internal" href="packaging_guide.html#make-package-findable"><span class="std std-ref">here</span></a> for more details.</p></li>
<li><p>The logic does not search through module files, it can only detect
packages with executables defined in <code class="docutils literal notranslate"><span class="pre">PATH</span></code>; you can help Spack locate
externals which use module files by loading any associated modules for
packages that you want Spack to know about before running
<code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">external</span> <span class="pre">find</span></code>.</p></li>
<li><p>Spack does not overwrite existing entries in the package configuration:
If there is an external defined for a spec at any configuration scope,
then Spack will not add a new external entry (<code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">config</span> <span class="pre">blame</span> <span class="pre">packages</span></code>
can help locate all external entries).</p></li>
</ul>
</section>
</section>
<section id="package-requirements">
<span id="id1"></span><h2>Package Requirements<a class="headerlink" href="#package-requirements" title="Link to this heading"></a></h2>
<p>Spack can be configured to always use certain compilers, package
versions, and variants during concretization through package
requirements.</p>
<p>Package requirements are useful when you find yourself repeatedly
specifying the same constraints on the command line, and wish that
Spack respects these constraints whether you mention them explicitly
or not. Another use case is specifying constraints that should apply
to all root specs in an environment, without having to repeat the
constraint everywhere.</p>
<p>Apart from that, requirements config is more flexible than constraints
on the command line, because it can specify constraints on packages
<em>when they occur</em> as a dependency. In contrast, on the command line it
is not possible to specify constraints on dependencies while also keeping
those dependencies optional.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>FAQ: <a class="reference internal" href="frequently_asked_questions.html#faq-concretizer-precedence"><span class="std std-ref">Why does Spack pick particular versions and variants?</span></a></p>
</div>
<section id="requirements-syntax">
<h3>Requirements syntax<a class="headerlink" href="#requirements-syntax" title="Link to this heading"></a></h3>
<p>The package requirements configuration is specified in <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code>,
keyed by package name and expressed using the Spec syntax. In the simplest
case you can specify attributes that you always want the package to have
by providing a single spec string to <code class="docutils literal notranslate"><span class="pre">require</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">libfabric</span><span class="p">:</span>
<span class="w">    </span><span class="nt">require</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;@1.13.2&quot;</span>
</pre></div>
</div>
<p>In the above example, <code class="docutils literal notranslate"><span class="pre">libfabric</span></code> will always build with version 1.13.2. If you
need to compose multiple configuration scopes <code class="docutils literal notranslate"><span class="pre">require</span></code> accepts a list of
strings:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">libfabric</span><span class="p">:</span>
<span class="w">    </span><span class="nt">require</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;@1.13.2&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;%gcc&quot;</span>
</pre></div>
</div>
<p>In this case <code class="docutils literal notranslate"><span class="pre">libfabric</span></code> will always build with version 1.13.2 <strong>and</strong> using GCC
as a compiler.</p>
<p>For more complex use cases, require accepts also a list of objects. These objects
must have either a <code class="docutils literal notranslate"><span class="pre">any_of</span></code> or a <code class="docutils literal notranslate"><span class="pre">one_of</span></code> field, containing a list of spec strings,
and they can optionally have a <code class="docutils literal notranslate"><span class="pre">when</span></code> and a <code class="docutils literal notranslate"><span class="pre">message</span></code> attribute:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">openmpi</span><span class="p">:</span>
<span class="w">    </span><span class="nt">require</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">any_of</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;@4.1.5&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;%gcc&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;in</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">example</span><span class="nv"> </span><span class="s">only</span><span class="nv"> </span><span class="s">4.1.5</span><span class="nv"> </span><span class="s">can</span><span class="nv"> </span><span class="s">build</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">compilers&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">any_of</span></code> is a list of specs. One of those specs must be satisfied
and it is also allowed for the concretized spec to match more than one.
In the above example, that means you could build <code class="docutils literal notranslate"><span class="pre">openmpi&#64;4.1.5%gcc</span></code>,
<code class="docutils literal notranslate"><span class="pre">openmpi&#64;4.1.5%clang</span></code> or <code class="docutils literal notranslate"><span class="pre">openmpi&#64;3.9%gcc</span></code>, but
not <code class="docutils literal notranslate"><span class="pre">openmpi&#64;3.9%clang</span></code>.</p>
<p>If a custom message is provided, and the requirement is not satisfiable,
Spack will print the custom error message:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>spec<span class="w"> </span>openmpi@3.9%clang
<span class="go">==&gt; Error: in this example only 4.1.5 can build with other compilers</span>
</pre></div>
</div>
<p>We could express a similar requirement using the <code class="docutils literal notranslate"><span class="pre">when</span></code> attribute:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">openmpi</span><span class="p">:</span>
<span class="w">    </span><span class="nt">require</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">any_of</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;%gcc&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;@:4.1.4&quot;</span>
<span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;in</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">example</span><span class="nv"> </span><span class="s">only</span><span class="nv"> </span><span class="s">4.1.5</span><span class="nv"> </span><span class="s">can</span><span class="nv"> </span><span class="s">build</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">compilers&quot;</span>
</pre></div>
</div>
<p>In the example above, if the version turns out to be 4.1.4 or less, we require the compiler to be GCC.
For readability, Spack also allows a <code class="docutils literal notranslate"><span class="pre">spec</span></code> key accepting a string when there is only a single
constraint:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">openmpi</span><span class="p">:</span>
<span class="w">    </span><span class="nt">require</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%gcc&quot;</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;@:4.1.4&quot;</span>
<span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;in</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">example</span><span class="nv"> </span><span class="s">only</span><span class="nv"> </span><span class="s">4.1.5</span><span class="nv"> </span><span class="s">can</span><span class="nv"> </span><span class="s">build</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">compilers&quot;</span>
</pre></div>
</div>
<p>This code snippet and the one before it are semantically equivalent.</p>
<p>Finally, instead of <code class="docutils literal notranslate"><span class="pre">any_of</span></code> you can use <code class="docutils literal notranslate"><span class="pre">one_of</span></code> which also takes a list of specs. The final
concretized spec must match one and only one of them:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mpich</span><span class="p">:</span>
<span class="w">    </span><span class="nt">require</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">one_of</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;+cuda&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;+rocm&quot;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>In the example above, that means you could build <code class="docutils literal notranslate"><span class="pre">mpich+cuda</span></code> or <code class="docutils literal notranslate"><span class="pre">mpich+rocm</span></code> but not <code class="docutils literal notranslate"><span class="pre">mpich+cuda+rocm</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For <code class="docutils literal notranslate"><span class="pre">any_of</span></code> and <code class="docutils literal notranslate"><span class="pre">one_of</span></code>, the order of specs indicates a
preference: items that appear earlier in the list are preferred
(note that these preferences can be ignored in favor of others).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using a conditional requirement, Spack is allowed to actively avoid the triggering
condition (the <code class="docutils literal notranslate"><span class="pre">when=...</span></code> spec) if that leads to a concrete spec with better scores in
the optimization criteria. To check the current optimization criteria and their
priorities you can run <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">solve</span> <span class="pre">zlib</span></code>.</p>
</div>
</section>
<section id="setting-default-requirements">
<h3>Setting default requirements<a class="headerlink" href="#setting-default-requirements" title="Link to this heading"></a></h3>
<p>You can also set default requirements for all packages under <code class="docutils literal notranslate"><span class="pre">all</span></code>
like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">all</span><span class="p">:</span>
<span class="w">    </span><span class="nt">require</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;%clang&#39;</span>
</pre></div>
</div>
<p>which means every spec will be required to use <code class="docutils literal notranslate"><span class="pre">clang</span></code> as a compiler.</p>
<p>Requirements on variants for all packages are possible too, but note that they
are only enforced for those packages that define these variants, otherwise they
are disregarded. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">all</span><span class="p">:</span>
<span class="w">    </span><span class="nt">require</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;+shared&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;+cuda&quot;</span>
</pre></div>
</div>
<p>will just enforce <code class="docutils literal notranslate"><span class="pre">+shared</span></code> on <code class="docutils literal notranslate"><span class="pre">zlib</span></code>, which has a boolean <code class="docutils literal notranslate"><span class="pre">shared</span></code> variant but
no <code class="docutils literal notranslate"><span class="pre">cuda</span></code> variant.</p>
<p>Constraints in a single spec literal are always considered as a whole, so in a case like:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">all</span><span class="p">:</span>
<span class="w">    </span><span class="nt">require</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;+shared</span><span class="nv"> </span><span class="s">+cuda&quot;</span>
</pre></div>
</div>
<p>the default requirement will be enforced only if a package has both a <code class="docutils literal notranslate"><span class="pre">cuda</span></code> and
a <code class="docutils literal notranslate"><span class="pre">shared</span></code> variant, and will never be partially enforced.</p>
<p>Finally, <code class="docutils literal notranslate"><span class="pre">all</span></code> represents a <em>default set of requirements</em> -
if there are specific package requirements, then the default requirements
under <code class="docutils literal notranslate"><span class="pre">all</span></code> are disregarded. For example, with a configuration like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">all</span><span class="p">:</span>
<span class="w">    </span><span class="nt">require</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;build_type=Debug&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;%clang&#39;</span>
<span class="w">  </span><span class="nt">cmake</span><span class="p">:</span>
<span class="w">    </span><span class="nt">require</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;build_type=Debug&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;%gcc&#39;</span>
</pre></div>
</div>
<p>Spack requires <code class="docutils literal notranslate"><span class="pre">cmake</span></code> to use <code class="docutils literal notranslate"><span class="pre">gcc</span></code> and all other nodes (including <code class="docutils literal notranslate"><span class="pre">cmake</span></code>
dependencies) to use <code class="docutils literal notranslate"><span class="pre">clang</span></code>. If enforcing <code class="docutils literal notranslate"><span class="pre">build_type=Debug</span></code> is needed also
on <code class="docutils literal notranslate"><span class="pre">cmake</span></code>, it must be repeated in the specific <code class="docutils literal notranslate"><span class="pre">cmake</span></code> requirements.</p>
</section>
<section id="setting-requirements-on-virtual-specs">
<h3>Setting requirements on virtual specs<a class="headerlink" href="#setting-requirements-on-virtual-specs" title="Link to this heading"></a></h3>
<p>A requirement on a virtual spec applies whenever that virtual is present in the DAG.
This can be useful for fixing which virtual provider you want to use:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mpi</span><span class="p">:</span>
<span class="w">    </span><span class="nt">require</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;mvapich2</span><span class="nv"> </span><span class="s">%gcc&#39;</span>
</pre></div>
</div>
<p>With the configuration above the only allowed <code class="docutils literal notranslate"><span class="pre">mpi</span></code> provider is <code class="docutils literal notranslate"><span class="pre">mvapich2</span> <span class="pre">%gcc</span></code>.</p>
<p>Requirements on the virtual spec and on the specific provider are both applied, if
present. For instance with a configuration like:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mpi</span><span class="p">:</span>
<span class="w">    </span><span class="nt">require</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;mvapich2</span><span class="nv"> </span><span class="s">%gcc&#39;</span>
<span class="w">  </span><span class="nt">mvapich2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">require</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;~cuda&#39;</span>
</pre></div>
</div>
<p>you will use <code class="docutils literal notranslate"><span class="pre">mvapich2~cuda</span> <span class="pre">%gcc</span></code> as an <code class="docutils literal notranslate"><span class="pre">mpi</span></code> provider.</p>
</section>
<section id="conflicts-and-strong-preferences">
<h3>Conflicts and strong preferences<a class="headerlink" href="#conflicts-and-strong-preferences" title="Link to this heading"></a></h3>
<p>If the semantic of requirements is too strong, you can also express “strong preferences” and “conflicts”
from configuration files:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">all</span><span class="p">:</span>
<span class="w">    </span><span class="nt">prefer</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;%clang&#39;</span>
<span class="w">    </span><span class="nt">conflict</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;+shared&#39;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">prefer</span></code> and <code class="docutils literal notranslate"><span class="pre">conflict</span></code> sections can be used whenever a <code class="docutils literal notranslate"><span class="pre">require</span></code> section is allowed.
The argument is always a list of constraints, and each constraint can be either a simple string,
or a more complex object:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">all</span><span class="p">:</span>
<span class="w">    </span><span class="nt">conflict</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;%clang&#39;</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;target=x86_64_v3&#39;</span>
<span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;reason</span><span class="nv"> </span><span class="s">why</span><span class="nv"> </span><span class="s">clang</span><span class="nv"> </span><span class="s">cannot</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">used&#39;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">spec</span></code> attribute is mandatory, while both <code class="docutils literal notranslate"><span class="pre">when</span></code> and <code class="docutils literal notranslate"><span class="pre">message</span></code> are optional.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Requirements allow for expressing both “strong preferences” and “conflicts”.
The syntax for doing so, though, may not be immediately clear. For
instance, if we want to prevent any package from using <code class="docutils literal notranslate"><span class="pre">%clang</span></code>, we can set:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">all</span><span class="p">:</span>
<span class="w">    </span><span class="nt">require</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">one_of</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;%clang&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;@:&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>Since only one of the requirements must hold, and <code class="docutils literal notranslate"><span class="pre">&#64;:</span></code> is always true, the rule above is
equivalent to a conflict. For “strong preferences” we need to substitute the <code class="docutils literal notranslate"><span class="pre">one_of</span></code> policy
with <code class="docutils literal notranslate"><span class="pre">any_of</span></code>.</p>
</div>
</section>
</section>
<section id="package-preferences">
<span id="id2"></span><h2>Package Preferences<a class="headerlink" href="#package-preferences" title="Link to this heading"></a></h2>
<p>In some cases package requirements can be too strong, and package
preferences are the better option. Package preferences do not impose
constraints on packages for particular versions or variants values,
they rather only set defaults. The concretizer is free to change
them if it must, due to other constraints, and also prefers reusing
installed packages over building new ones that are a better match for
preferences.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>FAQ: <a class="reference internal" href="frequently_asked_questions.html#faq-concretizer-precedence"><span class="std std-ref">Why does Spack pick particular versions and variants?</span></a></p>
</div>
<p>Most package preferences (<code class="docutils literal notranslate"><span class="pre">compilers</span></code>, <code class="docutils literal notranslate"><span class="pre">target</span></code> and <code class="docutils literal notranslate"><span class="pre">providers</span></code>)
can only be set globally under the <code class="docutils literal notranslate"><span class="pre">all</span></code> section of <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">all</span><span class="p">:</span>
<span class="w">    </span><span class="nt">compiler</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">gcc@12.2.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">clang@12</span><span class="p p-Indicator">:,</span><span class="w"> </span><span class="nv">oneapi@2023</span><span class="p p-Indicator">:]</span>
<span class="w">    </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">x86_64_v3</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">providers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">mpi</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">mvapich2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">mpich</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">openmpi</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>These preferences override Spack’s default and effectively reorder priorities
when looking for the best compiler, target or virtual package provider. Each
preference takes an ordered list of spec constraints, with earlier entries in
the list being preferred over later entries.</p>
<p>In the example above all packages prefer to be compiled with <code class="docutils literal notranslate"><span class="pre">gcc&#64;12.2.0</span></code>,
to target the <code class="docutils literal notranslate"><span class="pre">x86_64_v3</span></code> microarchitecture and to use <code class="docutils literal notranslate"><span class="pre">mvapich2</span></code> if they
depend on <code class="docutils literal notranslate"><span class="pre">mpi</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">variants</span></code> and <code class="docutils literal notranslate"><span class="pre">version</span></code> preferences can be set under
package specific sections of the <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">opencv</span><span class="p">:</span>
<span class="w">    </span><span class="nt">variants</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">+debug</span>
<span class="w">  </span><span class="nt">gperftools</span><span class="p">:</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">2.2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2.4</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2.3</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>In this case, the preference for <code class="docutils literal notranslate"><span class="pre">opencv</span></code> is to build with debug options, while
<code class="docutils literal notranslate"><span class="pre">gperftools</span></code> prefers version 2.2 over 2.4.</p>
<p>Any preference can be overwritten on the command line if explicitly requested.</p>
<p>Preferences cannot overcome explicit constraints, as they only set a preferred
ordering among homogeneous attribute values. Going back to the example, if
<code class="docutils literal notranslate"><span class="pre">gperftools&#64;2.3:</span></code> was requested, then Spack will install version 2.4
since the most preferred version 2.2 is prohibited by the version constraint.</p>
</section>
<section id="package-permissions">
<span id="id3"></span><h2>Package Permissions<a class="headerlink" href="#package-permissions" title="Link to this heading"></a></h2>
<p>Spack can be configured to assign permissions to the files installed
by a package.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> file under <code class="docutils literal notranslate"><span class="pre">permissions</span></code>, the attributes
<code class="docutils literal notranslate"><span class="pre">read</span></code>, <code class="docutils literal notranslate"><span class="pre">write</span></code>, and <code class="docutils literal notranslate"><span class="pre">group</span></code> control the package
permissions. These attributes can be set per-package, or for all
packages under <code class="docutils literal notranslate"><span class="pre">all</span></code>. If permissions are set under <code class="docutils literal notranslate"><span class="pre">all</span></code> and for a
specific package, the package-specific settings take precedence.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">read</span></code> and <code class="docutils literal notranslate"><span class="pre">write</span></code> attributes take one of <code class="docutils literal notranslate"><span class="pre">user</span></code>, <code class="docutils literal notranslate"><span class="pre">group</span></code>,
and <code class="docutils literal notranslate"><span class="pre">world</span></code>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">all</span><span class="p">:</span>
<span class="w">    </span><span class="nt">permissions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">write</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">group</span>
<span class="w">      </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spack</span>
<span class="w">  </span><span class="nt">my_app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">permissions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">read</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">group</span>
<span class="w">      </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_team</span>
</pre></div>
</div>
<p>The permissions settings describe the broadest level of access to
installations of the specified packages. The execute permissions of
the file are set to the same level as read permissions for those files
that are executable. The default setting for <code class="docutils literal notranslate"><span class="pre">read</span></code> is <code class="docutils literal notranslate"><span class="pre">world</span></code>,
and for <code class="docutils literal notranslate"><span class="pre">write</span></code> is <code class="docutils literal notranslate"><span class="pre">user</span></code>. In the example above, installations of
<code class="docutils literal notranslate"><span class="pre">my_app</span></code> will be installed with user and group permissions but no
world permissions, and owned by the group <code class="docutils literal notranslate"><span class="pre">my_team</span></code>. All other
packages will be installed with user and group write privileges, and
world read privileges. Those packages will be owned by the group
<code class="docutils literal notranslate"><span class="pre">spack</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">group</span></code> attribute assigns a Unix-style group to a package. All
files installed by the package will be owned by the assigned group,
and the sticky group bit will be set on the install prefix and all
directories inside the install prefix. This will ensure that even
manually placed files within the install prefix are owned by the
assigned group. If no group is assigned, Spack will allow the OS
default behavior to go as expected.</p>
</section>
<section id="assigning-package-attributes">
<span id="id4"></span><h2>Assigning Package Attributes<a class="headerlink" href="#assigning-package-attributes" title="Link to this heading"></a></h2>
<p>You can assign class-level attributes in the configuration:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mpileaks</span><span class="p">:</span>
<span class="w">    </span><span class="nt">package_attributes</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Override existing attributes</span>
<span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://www.somewhereelse.com/mpileaks-1.0.tar.gz</span>
<span class="w">      </span><span class="c1"># ... or add new ones</span>
<span class="w">      </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</pre></div>
</div>
<p>Attributes set this way will be accessible to any method executed
in the package.py file (e.g. the <code class="docutils literal notranslate"><span class="pre">install()</span></code> method). Values for these
attributes may be any value parseable by yaml.</p>
<p>These can only be applied to specific packages, not “all” or
virtual packages.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="config_yaml.html" class="btn btn-neutral float-left" title="Spack Settings (config.yaml)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="build_settings.html" class="btn btn-neutral float-right" title="Concretization Settings (concretizer.yaml)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2023, Lawrence Livermore National Laboratory..
      <span class="lastupdated">Last updated on Sep 20, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>