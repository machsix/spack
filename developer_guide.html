

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Developer Guide &mdash; Spack 0.23.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5f00b823" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=832b3b9f"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="spack package" href="spack.html" />
    <link rel="prev" title="Sourceforge" href="build_systems/sourceforgepackage.html" /> 
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S0PQ7WV75K"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S0PQ7WV75K');
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/spack-logo-white-text.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="features.html">Feature Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="replace_conda_homebrew.html">Spack for Homebrew/Conda Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="frequently_asked_questions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://spack-tutorial.readthedocs.io">Tutorial (spack-tutorial.rtfd.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://packages.spack.io">Packages (packages.spack.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cache.spack.io">Binaries (binaries.spack.io)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="config_yaml.html">Spack Settings (config.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="packages_yaml.html">Package Settings (packages.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_settings.html">Concretization Settings (concretizer.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="environments.html">Environments (spack.yaml, spack.lock)</a></li>
<li class="toctree-l1"><a class="reference internal" href="containers.html">Container Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="mirrors.html">Mirrors (mirrors.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_file_support.html">Modules (modules.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="repositories.html">Package Repositories (repos.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="binary_caches.html">Build Caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootstrapping.html">Bootstrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html">Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="chain.html">Chaining Spack Installations (upstreams.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="extensions.html">Custom Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipelines.html">CI Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="signing.html">Spack Package Signing</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu_configuration.html">Using External GPU Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="contribution_guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="packaging_guide.html">Packaging Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_systems.html">Build Systems</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developer Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#directory-structure">Directory Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#code-structure">Code Structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#package-related-modules">Package-related modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spec-related-modules">Spec-related modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-environment">Build environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spack-subcommands">Spack Subcommands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#unit-tests">Unit tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-modules">Other Modules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#spec-objects">Spec objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#package-objects">Package objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-commands">Writing commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup-parser"><code class="docutils literal notranslate"><span class="pre">setup_parser()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#name"><code class="docutils literal notranslate"><span class="pre">&lt;name&gt;()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#writing-hooks">Writing Hooks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#types-of-hooks">Types of Hooks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pre-install-spec"><code class="docutils literal notranslate"><span class="pre">pre_install(spec)</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#post-install-spec-explicit-none"><code class="docutils literal notranslate"><span class="pre">post_install(spec,</span> <span class="pre">explicit=None)</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#pre-uninstall-spec-and-post-uninstall-spec"><code class="docutils literal notranslate"><span class="pre">pre_uninstall(spec)</span></code> and <code class="docutils literal notranslate"><span class="pre">post_uninstall(spec)</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#adding-a-new-hook-type">Adding a New Hook Type</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id3">Unit tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unit-testing">Unit testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#developer-environment">Developer environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#developer-commands">Developer commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#spack-doc"><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">doc</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#spack-style"><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">style</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#spack-unit-test"><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">unit-test</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#spack-python"><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">python</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#spack-blame"><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">blame</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#spack-url"><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">url</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#spack-url-parse"><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">url</span> <span class="pre">parse</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#spack-url-list"><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">url</span> <span class="pre">list</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#spack-url-summary"><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">url</span> <span class="pre">summary</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#profiling">Profiling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#spack-profile"><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">--profile</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#releases">Releases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#release-branches">Release branches</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scheduling-work-for-releases">Scheduling work for releases</a></li>
<li class="toctree-l3"><a class="reference internal" href="#backporting-bug-fixes">Backporting bug fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#making-major-releases">Making major releases</a></li>
<li class="toctree-l3"><a class="reference internal" href="#making-patch-releases">Making patch releases</a></li>
<li class="toctree-l3"><a class="reference internal" href="#publishing-a-release-on-github">Publishing a release on GitHub</a></li>
<li class="toctree-l3"><a class="reference internal" href="#updating-releases-latest">Updating <cite>releases/latest</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="#announcing-a-release">Announcing a release</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="spack.html">Spack API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="llnl.html">LLNL API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Spack</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Developer Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/developer_guide.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="developer-guide">
<span id="id1"></span><h1>Developer Guide<a class="headerlink" href="#developer-guide" title="Link to this heading"></a></h1>
<p>This guide is intended for people who want to work on Spack itself.
If you just want to develop packages, see the <a class="reference internal" href="packaging_guide.html#packaging-guide"><span class="std std-ref">Packaging Guide</span></a>.</p>
<p>It is assumed that you’ve read the <a class="reference internal" href="basic_usage.html#basic-usage"><span class="std std-ref">Basic Usage</span></a> and
<a class="reference internal" href="packaging_guide.html#packaging-guide"><span class="std std-ref">Packaging Guide</span></a> sections, and that you’re familiar with the
concepts discussed there.  If you’re not, we recommend reading those
first.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>Spack is designed with three separate roles in mind:</p>
<ol class="arabic simple">
<li><p><strong>Users</strong>, who need to install software <em>without</em> knowing all the
details about how it is built.</p></li>
<li><p><strong>Packagers</strong> who know how a particular software package is
built and encode this information in package files.</p></li>
<li><p><strong>Developers</strong> who work on Spack, add new features, and try to
make the jobs of packagers and users easier.</p></li>
</ol>
<p>Users could be end users installing software in their home directory,
or administrators installing software to a shared directory on a
shared machine.  Packagers could be administrators who want to
automate software builds, or application developers who want to make
their software more accessible to users.</p>
<p>As you might expect, there are many types of users with different
levels of sophistication, and Spack is designed to accommodate both
simple and complex use cases for packages.  A user who only knows that
he needs a certain package should be able to type something simple,
like <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">install</span> <span class="pre">&lt;package</span> <span class="pre">name&gt;</span></code>, and get the package that he
wants.  If a user wants to ask for a specific version, use particular
compilers, or build several versions with different configurations,
then that should be possible with a minimal amount of additional
specification.</p>
<p>This gets us to the two key concepts in Spack’s software design:</p>
<ol class="arabic simple">
<li><p><strong>Specs</strong>: expressions for describing builds of software, and</p></li>
<li><p><strong>Packages</strong>: Python modules that build software according to a
spec.</p></li>
</ol>
<p>A package is a template for building particular software, and a spec
as a descriptor for one or more instances of that template.  Users
express the configuration they want using a spec, and a package turns
the spec into a complete build.</p>
<p>The obvious difficulty with this design is that users under-specify
what they want.  To build a software package, the package object needs
a <em>complete</em> specification.  In Spack, if a spec describes only one
instance of a package, then we say it is <strong>concrete</strong>.  If a spec
could describes many instances, (i.e. it is under-specified in one way
or another), then we say it is <strong>abstract</strong>.</p>
<p>Spack’s job is to take an <em>abstract</em> spec from the user, find a
<em>concrete</em> spec that satisfies the constraints, and hand the task of
building the software off to the package object.  The rest of this
document describes all the pieces that come together to make that
happen.</p>
</section>
<section id="directory-structure">
<h2>Directory Structure<a class="headerlink" href="#directory-structure" title="Link to this heading"></a></h2>
<p>So that you can familiarize yourself with the project, we’ll start
with a high level view of Spack’s directory structure:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>spack/                  &lt;- installation root
   bin/
      spack             &lt;- main spack executable

   etc/
      spack/            &lt;- Spack config files.
                           Can be overridden by files in ~/.spack.

   var/
      spack/            &lt;- build &amp; stage directories
          repos/            &lt;- contains package repositories
             builtin/       &lt;- pkg repository that comes with Spack
                repo.yaml   &lt;- descriptor for the builtin repository
                packages/   &lt;- directories under here contain packages
          cache/        &lt;- saves resources downloaded during installs

   opt/
      spack/            &lt;- packages are installed here

   lib/
      spack/
         docs/          &lt;- source for this documentation
         env/           &lt;- compiler wrappers for build environment

         external/      &lt;- external libs included in Spack distro
         llnl/          &lt;- some general-use libraries

         spack/                &lt;- spack module; contains Python code
            build_systems/     &lt;- modules for different build systems
            cmd/               &lt;- each file in here is a spack subcommand
            compilers/         &lt;- compiler description files
            container/         &lt;- module for spack containerize
            hooks/             &lt;- hook modules to run at different points
            modules/           &lt;- modules for lmod, tcl, etc.
            operating_systems/ &lt;- operating system modules
            platforms/         &lt;- different spack platforms
            reporters/         &lt;- reporters like cdash, junit
            schema/            &lt;- schemas to validate data structures
            solver/            &lt;- the spack solver
            test/              &lt;- unit test modules
            util/              &lt;- common code
</pre></div>
</div>
<p>Spack is designed so that it could live within a <a class="reference external" href="http://linux.die.net/man/7/hier">standard UNIX
directory hierarchy</a>, so <code class="docutils literal notranslate"><span class="pre">lib</span></code>,
<code class="docutils literal notranslate"><span class="pre">var</span></code>, and <code class="docutils literal notranslate"><span class="pre">opt</span></code> all contain a <code class="docutils literal notranslate"><span class="pre">spack</span></code> subdirectory in case
Spack is installed alongside other software.  Most of the interesting
parts of Spack live in <code class="docutils literal notranslate"><span class="pre">lib/spack</span></code>.</p>
<p>Spack has <em>one</em> directory layout and there is no install process.
Most Python programs don’t look like this (they use distutils, <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>,
etc.) but we wanted to make Spack <em>very</em> easy to use.  The simple layout
spares users from the need to install Spack into a Python environment.
Many users don’t have write access to a Python installation, and installing
an entire new instance of Python to bootstrap Spack would be very complicated.
Users should not have to install a big, complicated package to
use the thing that’s supposed to spare them from the details of big,
complicated packages.  The end result is that Spack works out of the
box: clone it and add <code class="docutils literal notranslate"><span class="pre">bin</span></code> to your PATH and you’re ready to go.</p>
</section>
<section id="code-structure">
<h2>Code Structure<a class="headerlink" href="#code-structure" title="Link to this heading"></a></h2>
<p>This section gives an overview of the various Python modules in Spack,
grouped by functionality.</p>
<section id="package-related-modules">
<h3>Package-related modules<a class="headerlink" href="#package-related-modules" title="Link to this heading"></a></h3>
<dl class="simple">
<dt><a class="reference internal" href="spack.html#module-spack.package_base" title="spack.package_base"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spack.package_base</span></code></a></dt><dd><p>Contains the <a class="reference internal" href="spack.html#spack.package_base.PackageBase" title="spack.package_base.PackageBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageBase</span></code></a> class, which
is the superclass for all packages in Spack.</p>
</dd>
<dt><a class="reference internal" href="spack.util.html#module-spack.util.naming" title="spack.util.naming"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spack.util.naming</span></code></a></dt><dd><p>Contains functions for mapping between Spack package names,
Python module names, and Python class names. Functions like
<a class="reference internal" href="spack.util.html#spack.util.naming.mod_to_class" title="spack.util.naming.mod_to_class"><code class="xref py py-func docutils literal notranslate"><span class="pre">mod_to_class()</span></code></a> handle mapping package
module names to class names.</p>
</dd>
<dt><a class="reference internal" href="spack.html#module-spack.directives" title="spack.directives"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spack.directives</span></code></a></dt><dd><p><em>Directives</em> are functions that can be called inside a package definition
to modify the package, like <a class="reference internal" href="spack.html#spack.directives.depends_on" title="spack.directives.depends_on"><code class="xref py py-func docutils literal notranslate"><span class="pre">depends_on()</span></code></a>
and <a class="reference internal" href="spack.html#spack.directives.provides" title="spack.directives.provides"><code class="xref py py-func docutils literal notranslate"><span class="pre">provides()</span></code></a>.  See <a class="reference internal" href="packaging_guide.html#dependencies"><span class="std std-ref">Dependencies</span></a>
and <a class="reference internal" href="packaging_guide.html#virtual-dependencies"><span class="std std-ref">Virtual dependencies</span></a>.</p>
</dd>
<dt><a class="reference internal" href="spack.html#module-spack.multimethod" title="spack.multimethod"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spack.multimethod</span></code></a></dt><dd><p>Implementation of the <a class="reference internal" href="spack.html#spack.multimethod.when" title="spack.multimethod.when"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;when</span></code></a>
decorator, which allows <a class="reference internal" href="packaging_guide.html#multimethods"><span class="std std-ref">multimethods</span></a> in
packages.</p>
</dd>
</dl>
</section>
<section id="spec-related-modules">
<h3>Spec-related modules<a class="headerlink" href="#spec-related-modules" title="Link to this heading"></a></h3>
<dl>
<dt><a class="reference internal" href="spack.html#module-spack.spec" title="spack.spec"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spack.spec</span></code></a></dt><dd><p>Contains <a class="reference internal" href="spack.html#spack.spec.Spec" title="spack.spec.Spec"><code class="xref py py-class docutils literal notranslate"><span class="pre">Spec</span></code></a>. Also implements most of the logic for concretization
of specs.</p>
</dd>
<dt><a class="reference internal" href="spack.html#module-spack.parser" title="spack.parser"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spack.parser</span></code></a></dt><dd><p>Contains <a class="reference internal" href="spack.html#spack.parser.SpecParser" title="spack.parser.SpecParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpecParser</span></code></a> and functions related to parsing specs.</p>
</dd>
<dt><a class="reference internal" href="spack.version.html#module-spack.version" title="spack.version"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spack.version</span></code></a></dt><dd><p>Implements a simple <a class="reference internal" href="spack.version.html#spack.version.Version" title="spack.version.Version"><code class="xref py py-class docutils literal notranslate"><span class="pre">Version</span></code></a> class with simple
comparison semantics.  Also implements <a class="reference internal" href="spack.version.html#spack.version.VersionRange" title="spack.version.VersionRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">VersionRange</span></code></a>
and <a class="reference internal" href="spack.version.html#spack.version.VersionList" title="spack.version.VersionList"><code class="xref py py-class docutils literal notranslate"><span class="pre">VersionList</span></code></a>. All three are comparable with each
other and offer union and intersection operations. Spack uses these classes
to compare versions and to manage version constraints on specs. Comparison
semantics are similar to the <code class="docutils literal notranslate"><span class="pre">LooseVersion</span></code> class in <code class="docutils literal notranslate"><span class="pre">distutils</span></code> and to
the way RPM compares version strings.</p>
</dd>
<dt><a class="reference internal" href="spack.compilers.html#module-spack.compilers" title="spack.compilers"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spack.compilers</span></code></a></dt><dd><p>Submodules contains descriptors for all valid compilers in Spack.
This is used by the build system to set up the build environment.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Not yet implemented.  Currently has two compiler descriptions,
but compilers aren’t fully integrated with the build process
yet.</p>
</div>
</dd>
</dl>
</section>
<section id="build-environment">
<h3>Build environment<a class="headerlink" href="#build-environment" title="Link to this heading"></a></h3>
<dl class="simple">
<dt><a class="reference internal" href="spack.html#module-spack.stage" title="spack.stage"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spack.stage</span></code></a></dt><dd><p>Handles creating temporary directories for builds.</p>
</dd>
<dt><a class="reference internal" href="spack.html#module-spack.build_environment" title="spack.build_environment"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spack.build_environment</span></code></a></dt><dd><p>This contains utility functions used by the compiler wrapper script,
<code class="docutils literal notranslate"><span class="pre">cc</span></code>.</p>
</dd>
<dt><a class="reference internal" href="spack.html#module-spack.directory_layout" title="spack.directory_layout"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spack.directory_layout</span></code></a></dt><dd><p>Classes that control the way an installation directory is laid out.
Create more implementations of this to change the hierarchy and
naming scheme in <code class="docutils literal notranslate"><span class="pre">$spack_prefix/opt</span></code></p>
</dd>
</dl>
</section>
<section id="spack-subcommands">
<h3>Spack Subcommands<a class="headerlink" href="#spack-subcommands" title="Link to this heading"></a></h3>
<dl class="simple">
<dt><a class="reference internal" href="spack.cmd.html#module-spack.cmd" title="spack.cmd"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spack.cmd</span></code></a></dt><dd><p>Each module in this package implements a Spack subcommand.  See
<a class="reference internal" href="#writing-commands"><span class="std std-ref">writing commands</span></a> for details.</p>
</dd>
</dl>
</section>
<section id="unit-tests">
<h3>Unit tests<a class="headerlink" href="#unit-tests" title="Link to this heading"></a></h3>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">spack.test</span></code></dt><dd><p>Implements Spack’s test suite.  Add a module and put its name in
the test suite in <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> to add more unit tests.</p>
</dd>
</dl>
</section>
<section id="other-modules">
<h3>Other Modules<a class="headerlink" href="#other-modules" title="Link to this heading"></a></h3>
<dl class="simple">
<dt><a class="reference internal" href="spack.html#module-spack.url" title="spack.url"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spack.url</span></code></a></dt><dd><p>URL parsing, for deducing names and versions of packages from
tarball URLs.</p>
</dd>
<dt><a class="reference internal" href="spack.html#module-spack.error" title="spack.error"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spack.error</span></code></a></dt><dd><p><a class="reference internal" href="spack.html#spack.error.SpackError" title="spack.error.SpackError"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpackError</span></code></a>, the base class for
Spack’s exception hierarchy.</p>
</dd>
<dt><a class="reference internal" href="llnl.util.tty.html#module-llnl.util.tty" title="llnl.util.tty"><code class="xref py py-mod docutils literal notranslate"><span class="pre">llnl.util.tty</span></code></a></dt><dd><p>Basic output functions for all of the messages Spack writes to the
terminal.</p>
</dd>
<dt><a class="reference internal" href="llnl.util.tty.html#module-llnl.util.tty.color" title="llnl.util.tty.color"><code class="xref py py-mod docutils literal notranslate"><span class="pre">llnl.util.tty.color</span></code></a></dt><dd><p>Implements a color formatting syntax used by <code class="docutils literal notranslate"><span class="pre">spack.tty</span></code>.</p>
</dd>
<dt><a class="reference internal" href="llnl.util.html#module-llnl.util" title="llnl.util"><code class="xref py py-mod docutils literal notranslate"><span class="pre">llnl.util</span></code></a></dt><dd><p>In this package are a number of utility modules for the rest of
Spack.</p>
</dd>
</dl>
</section>
</section>
<section id="spec-objects">
<h2>Spec objects<a class="headerlink" href="#spec-objects" title="Link to this heading"></a></h2>
</section>
<section id="package-objects">
<h2>Package objects<a class="headerlink" href="#package-objects" title="Link to this heading"></a></h2>
<p>Most spack commands look something like this:</p>
<ol class="arabic simple">
<li><p>Parse an abstract spec (or specs) from the command line,</p></li>
<li><p><em>Normalize</em> the spec based on information in package files,</p></li>
<li><p><em>Concretize</em> the spec according to some customizable policies,</p></li>
<li><p>Instantiate a package based on the spec, and</p></li>
<li><p>Call methods (e.g., <code class="docutils literal notranslate"><span class="pre">install()</span></code>) on the package object.</p></li>
</ol>
<p>The information in Package files is used at all stages in this
process.</p>
</section>
<section id="writing-commands">
<span id="id2"></span><h2>Writing commands<a class="headerlink" href="#writing-commands" title="Link to this heading"></a></h2>
<p>Adding a new command to Spack is easy. Simply add a <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;.py</span></code> file to
<code class="docutils literal notranslate"><span class="pre">lib/spack/spack/cmd/</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code> is the name of the subcommand.
At the bare minimum, two functions are required in this file:</p>
<section id="setup-parser">
<h3><code class="docutils literal notranslate"><span class="pre">setup_parser()</span></code><a class="headerlink" href="#setup-parser" title="Link to this heading"></a></h3>
<p>Unless your command doesn’t accept any arguments, a <code class="docutils literal notranslate"><span class="pre">setup_parser()</span></code>
function is required to define what arguments and flags your command takes.
See the <a class="reference external" href="https://docs.python.org/2.7/library/argparse.html">Argparse documentation</a>
for more details on how to add arguments.</p>
<p>Some commands have a set of subcommands, like <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">compiler</span> <span class="pre">find</span></code> or
<code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">module</span> <span class="pre">lmod</span> <span class="pre">refresh</span></code>. You can add subparsers to your parser to handle
this. Check out <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">edit</span> <span class="pre">--command</span> <span class="pre">compiler</span></code> for an example of this.</p>
<p>A lot of commands take the same arguments and flags. These arguments should
be defined in <code class="docutils literal notranslate"><span class="pre">lib/spack/spack/cmd/common/arguments.py</span></code> so that they don’t
need to be redefined in multiple commands.</p>
</section>
<section id="name">
<h3><code class="docutils literal notranslate"><span class="pre">&lt;name&gt;()</span></code><a class="headerlink" href="#name" title="Link to this heading"></a></h3>
<p>In order to run your command, Spack searches for a function with the same
name as your command in <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;.py</span></code>. This is the main method for your
command, and can call other helper methods to handle common tasks.</p>
<p>Remember, before adding a new command, think to yourself whether or not this
new command is actually necessary. Sometimes, the functionality you desire
can be added to an existing command. Also remember to add unit tests for
your command. If it isn’t used very frequently, changes to the rest of
Spack can cause your command to break without sufficient unit tests to
prevent this from happening.</p>
<p>Whenever you add/remove/rename a command or flags for an existing command,
make sure to update Spack’s <a class="reference external" href="https://github.com/adamjstewart/spack/blob/develop/share/spack/spack-completion.bash">Bash tab completion script</a>.</p>
</section>
</section>
<section id="writing-hooks">
<h2>Writing Hooks<a class="headerlink" href="#writing-hooks" title="Link to this heading"></a></h2>
<p>A hook is a callback that makes it easy to design functions that run
for different events. We do this by way of defining hook types, and then
inserting them at different places in the spack code base. Whenever a hook
type triggers by way of a function call, we find all the hooks of that type,
and run them.</p>
<p>Spack defines hooks by way of a module in the <code class="docutils literal notranslate"><span class="pre">lib/spack/spack/hooks</span></code> directory.
This module has to be registered in <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> so that Spack is aware of it.
This section will cover the basic kind of hooks, and how to write them.</p>
<section id="types-of-hooks">
<h3>Types of Hooks<a class="headerlink" href="#types-of-hooks" title="Link to this heading"></a></h3>
<p>The following hooks are currently implemented to make it easy for you,
the developer, to add hooks at different stages of a spack install or similar.
If there is a hook that you would like and is missing, you can propose to add a new one.</p>
<section id="pre-install-spec">
<h4><code class="docutils literal notranslate"><span class="pre">pre_install(spec)</span></code><a class="headerlink" href="#pre-install-spec" title="Link to this heading"></a></h4>
<p>A <code class="docutils literal notranslate"><span class="pre">pre_install</span></code> hook is run within the install subprocess, directly before the install starts.
It expects a single argument of a spec.</p>
</section>
<section id="post-install-spec-explicit-none">
<h4><code class="docutils literal notranslate"><span class="pre">post_install(spec,</span> <span class="pre">explicit=None)</span></code><a class="headerlink" href="#post-install-spec-explicit-none" title="Link to this heading"></a></h4>
<p>A <code class="docutils literal notranslate"><span class="pre">post_install</span></code> hook is run within the install subprocess, directly after the install finishes,
but before the build stage is removed and the spec is registered in the database. It expects two
arguments: spec and an optional boolean indicating whether this spec is being installed explicitly.</p>
</section>
<section id="pre-uninstall-spec-and-post-uninstall-spec">
<h4><code class="docutils literal notranslate"><span class="pre">pre_uninstall(spec)</span></code> and <code class="docutils literal notranslate"><span class="pre">post_uninstall(spec)</span></code><a class="headerlink" href="#pre-uninstall-spec-and-post-uninstall-spec" title="Link to this heading"></a></h4>
<p>These hooks are currently used for cleaning up module files after uninstall.</p>
</section>
</section>
<section id="adding-a-new-hook-type">
<h3>Adding a New Hook Type<a class="headerlink" href="#adding-a-new-hook-type" title="Link to this heading"></a></h3>
<p>Adding a new hook type is very simple!  In <code class="docutils literal notranslate"><span class="pre">lib/spack/spack/hooks/__init__.py</span></code>
you can simply create a new <code class="docutils literal notranslate"><span class="pre">HookRunner</span></code> that is named to match your new hook.
For example, let’s say you want to add a new hook called <code class="docutils literal notranslate"><span class="pre">post_log_write</span></code>
to trigger after anything is written to a logger. You would add it as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pre/post install and run by the install subprocess</span>
<span class="n">pre_install</span> <span class="o">=</span> <span class="n">HookRunner</span><span class="p">(</span><span class="s1">&#39;pre_install&#39;</span><span class="p">)</span>
<span class="n">post_install</span> <span class="o">=</span> <span class="n">HookRunner</span><span class="p">(</span><span class="s1">&#39;post_install&#39;</span><span class="p">)</span>

<span class="c1"># hooks related to logging</span>
<span class="n">post_log_write</span> <span class="o">=</span> <span class="n">HookRunner</span><span class="p">(</span><span class="s1">&#39;post_log_write&#39;</span><span class="p">)</span> <span class="c1"># &lt;- here is my new hook!</span>
</pre></div>
</div>
<p>You then need to decide what arguments my hook would expect. Since this is
related to logging, let’s say that you want a message and level. That means
that when you add a python file to the <code class="docutils literal notranslate"><span class="pre">lib/spack/spack/hooks</span></code>
folder with one or more callbacks intended to be triggered by this hook. You might
use my new hook as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">post_log_write</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Do something custom with the message and level every time we write</span>
<span class="sd">    to the log</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running post_log_write!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To use the hook, we would call it as follows somewhere in the logic to do logging.
In this example, we use it outside of a logger that is already defined:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">spack.hooks</span>

<span class="c1"># We do something here to generate a logger and message</span>
<span class="n">spack</span><span class="o">.</span><span class="n">hooks</span><span class="o">.</span><span class="n">post_log_write</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">logger</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
</pre></div>
</div>
<p>This is not to say that this would be the best way to implement an integration
with the logger (you’d probably want to write a custom logger, or you could
have the hook defined within the logger) but serves as an example of writing a hook.</p>
</section>
</section>
<section id="id3">
<h2>Unit tests<a class="headerlink" href="#id3" title="Link to this heading"></a></h2>
</section>
<section id="unit-testing">
<h2>Unit testing<a class="headerlink" href="#unit-testing" title="Link to this heading"></a></h2>
</section>
<section id="developer-environment">
<h2>Developer environment<a class="headerlink" href="#developer-environment" title="Link to this heading"></a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is an experimental feature. It is expected to change and you should
not use it in a production environment.</p>
</div>
<p>When installing a package, we currently have support to export environment
variables to specify adding debug flags to the build. By default, a package
install will build without any debug flag. However, if you want to add them,
you can export:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export SPACK_ADD_DEBUG_FLAGS=true</span>
<span class="go">spack install zlib</span>
</pre></div>
</div>
<p>If you want to add custom flags, you should export an additional variable:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export SPACK_ADD_DEBUG_FLAGS=true</span>
<span class="go">export SPACK_DEBUG_FLAGS=&quot;-g&quot;</span>
<span class="go">spack install zlib</span>
</pre></div>
</div>
<p>These environment variables will eventually be integrated into spack so
they are set from the command line.</p>
</section>
<section id="developer-commands">
<h2>Developer commands<a class="headerlink" href="#developer-commands" title="Link to this heading"></a></h2>
<section id="spack-doc">
<span id="cmd-spack-doc"></span><h3><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">doc</span></code><a class="headerlink" href="#spack-doc" title="Link to this heading"></a></h3>
</section>
<section id="spack-style">
<span id="cmd-spack-style"></span><h3><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">style</span></code><a class="headerlink" href="#spack-style" title="Link to this heading"></a></h3>
<p>spack style exists to help the developer user to check imports and style with
mypy, flake8, isort, and (soon) black. To run all style checks, simply do:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>style
</pre></div>
</div>
<p>To run automatic fixes for isort you can do:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>style<span class="w"> </span>--fix
</pre></div>
</div>
<p>You do not need any of these Python packages installed on your system for
the checks to work! Spack will bootstrap install them from packages for
your use.</p>
</section>
<section id="spack-unit-test">
<h3><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">unit-test</span></code><a class="headerlink" href="#spack-unit-test" title="Link to this heading"></a></h3>
<p>See the <a class="reference internal" href="contribution_guide.html#cmd-spack-unit-test"><span class="std std-ref">contributor guide section</span></a> on
<code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">unit-test</span></code>.</p>
</section>
<section id="spack-python">
<span id="cmd-spack-python"></span><h3><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">python</span></code><a class="headerlink" href="#spack-python" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">python</span></code> is a command that lets you import and debug things as if
you were in a Spack interactive shell. Without any arguments, it is similar
to a normal interactive Python shell, except you can import spack and any
other Spack modules:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>python
<span class="go">Spack version 0.10.0</span>
<span class="go">Python 2.7.13, Linux x86_64</span>
<span class="go">&gt;&gt;&gt; from spack.version import Version</span>
<span class="go">&gt;&gt;&gt; a = Version(&#39;1.2.3&#39;)</span>
<span class="go">&gt;&gt;&gt; b = Version(&#39;1_2_3&#39;)</span>
<span class="go">&gt;&gt;&gt; a == b</span>
<span class="go">True</span>
<span class="go">&gt;&gt;&gt; c = Version(&#39;1.2.3b&#39;)</span>
<span class="go">&gt;&gt;&gt; c &gt; a</span>
<span class="go">True</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>If you prefer using an IPython interpreter, given that IPython is installed
you can specify the interpreter with <code class="docutils literal notranslate"><span class="pre">-i</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>python<span class="w"> </span>-i<span class="w"> </span>ipython
<span class="go">Python 3.8.3 (default, May 19 2020, 18:47:26)</span>
<span class="go">Type &#39;copyright&#39;, &#39;credits&#39; or &#39;license&#39; for more information</span>
<span class="go">IPython 7.17.0 -- An enhanced Interactive Python. Type &#39;?&#39; for help.</span>


<span class="go">Spack version 0.16.0</span>
<span class="go">Python 3.8.3, Linux x86_64</span>

<span class="go">In [1]:</span>
</pre></div>
</div>
<p>With either interpreter you can run a single command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;from spack.spec import Spec; Spec(&quot;python&quot;).concretized()&#39;</span>
<span class="go">...</span>

<span class="gp">$ </span>spack<span class="w"> </span>python<span class="w"> </span>-i<span class="w"> </span>ipython<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;from spack.spec import Spec; Spec(&quot;python&quot;).concretized()&#39;</span>
<span class="go">Out[1]: ...</span>
</pre></div>
</div>
<p>or a file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>python<span class="w"> </span>~/test_fetching.py
<span class="gp">$ </span>spack<span class="w"> </span>python<span class="w"> </span>-i<span class="w"> </span>ipython<span class="w"> </span>~/test_fetching.py
</pre></div>
</div>
<p>just like you would with the normal <code class="docutils literal notranslate"><span class="pre">python</span></code> command.</p>
</section>
<section id="spack-blame">
<span id="cmd-spack-url"></span><h3><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">blame</span></code><a class="headerlink" href="#spack-blame" title="Link to this heading"></a></h3>
<p>Spack blame is a way to quickly see contributors to packages or files
in the spack repository. You should provide a target package name or
file name to the command. Here is an example asking to see contributions
for the package “python”:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>blame<span class="w"> </span>python
<span class="go">LAST_COMMIT  LINES  %      AUTHOR            EMAIL</span>
<span class="go">2 weeks ago  3      0.3    Mickey Mouse   &lt;cheddar@gmouse.org&gt;</span>
<span class="go">a month ago  927    99.7   Minnie Mouse   &lt;swiss@mouse.org&gt;</span>

<span class="go">2 weeks ago  930    100.0</span>
</pre></div>
</div>
<p>By default, you will get a table view (shown above) sorted by date of contribution,
with the most recent contribution at the top.  If you want to sort instead
by percentage of code contribution, then add <code class="docutils literal notranslate"><span class="pre">-p</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>blame<span class="w"> </span>-p<span class="w"> </span>python
</pre></div>
</div>
<p>And to see the git blame view, add <code class="docutils literal notranslate"><span class="pre">-g</span></code> instead:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>blame<span class="w"> </span>-g<span class="w"> </span>python
</pre></div>
</div>
<p>Finally, to get a json export of the data, add <code class="docutils literal notranslate"><span class="pre">--json</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>blame<span class="w"> </span>--json<span class="w"> </span>python
</pre></div>
</div>
</section>
<section id="spack-url">
<h3><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">url</span></code><a class="headerlink" href="#spack-url" title="Link to this heading"></a></h3>
<p>A package containing a single URL can be used to download several different
versions of the package. If you’ve ever wondered how this works, all of the
magic is in <a class="reference internal" href="spack.html#module-spack.url" title="spack.url"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spack.url</span></code></a>. This module contains methods for extracting
the name and version of a package from its URL. The name is used by
<code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">create</span></code> to guess the name of the package. By determining the version
from the URL, Spack can replace it with other versions to determine where to
download them from.</p>
<p>The regular expressions in <code class="docutils literal notranslate"><span class="pre">parse_name_offset</span></code> and <code class="docutils literal notranslate"><span class="pre">parse_version_offset</span></code>
are used to extract the name and version, but they aren’t perfect. In order
to debug Spack’s URL parsing support, the <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">url</span></code> command can be used.</p>
<section id="spack-url-parse">
<h4><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">url</span> <span class="pre">parse</span></code><a class="headerlink" href="#spack-url-parse" title="Link to this heading"></a></h4>
<p>If you need to debug a single URL, you can use the following command:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ spack url parse http://cache.ruby-lang.org/pub/ruby/2.2/ruby-2.2.0.tar.gz
==&gt; Parsing URL: http://cache.ruby-lang.org/pub/ruby/2.2/ruby-2.2.0.tar.gz

==&gt; Matched version regex  0: r&#39;^[a-zA-Z+._-]+[._-]v?(\\d[\\d._-]*)$&#39;
==&gt; Matched  name   regex 10: r&#39;^([A-Za-z\\d+\\._-]+)$&#39;

==&gt; Detected:
    http://cache.ruby-lang.org/pub/ruby/2.2/ruby-2.2.0.tar.gz
                                            ---- ~~~~~
    name:    ruby
    version: 2.2.0

==&gt; Substituting version 9.9.9b:
    http://cache.ruby-lang.org/pub/ruby/2.2/ruby-9.9.9b.tar.gz
                                            ---- ~~~~~~
</pre></div>
</div>
<p>You’ll notice that the name and version of this URL are correctly detected,
and you can even see which regular expressions it was matched to. However,
you’ll notice that when it substitutes the version number in, it doesn’t
replace the <code class="docutils literal notranslate"><span class="pre">2.2</span></code> with <code class="docutils literal notranslate"><span class="pre">9.9</span></code> where we would expect <code class="docutils literal notranslate"><span class="pre">9.9.9b</span></code> to live.
This particular package may require a <code class="docutils literal notranslate"><span class="pre">list_url</span></code> or <code class="docutils literal notranslate"><span class="pre">url_for_version</span></code>
function.</p>
<p>This command also accepts a <code class="docutils literal notranslate"><span class="pre">--spider</span></code> flag. If provided, Spack searches
for other versions of the package and prints the matching URLs.</p>
</section>
<section id="spack-url-list">
<h4><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">url</span> <span class="pre">list</span></code><a class="headerlink" href="#spack-url-list" title="Link to this heading"></a></h4>
<p>This command lists every URL in every package in Spack. If given the
<code class="docutils literal notranslate"><span class="pre">--color</span></code> and <code class="docutils literal notranslate"><span class="pre">--extrapolation</span></code> flags, it also colors the part of
the string that it detected to be the name and version. The
<code class="docutils literal notranslate"><span class="pre">--incorrect-name</span></code> and <code class="docutils literal notranslate"><span class="pre">--incorrect-version</span></code> flags can be used to
print URLs that were not being parsed correctly.</p>
</section>
<section id="spack-url-summary">
<h4><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">url</span> <span class="pre">summary</span></code><a class="headerlink" href="#spack-url-summary" title="Link to this heading"></a></h4>
<p>This command attempts to parse every URL for every package in Spack
and prints a summary of how many of them are being correctly parsed.
It also prints a histogram showing which regular expressions are being
matched and how frequently:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ spack url summary
==&gt; Generating a summary of URL parsing in Spack...

    Total URLs found:          8321
    Names correctly parsed:    7190/8321 (86.41%)
    Versions correctly parsed: 7250/8321 (87.13%)

==&gt; Statistics on name regular expressions:

    Index   Right   Wrong   Total   Regular Expression
        0    1991     385    2376   r&#39;github\\.com/[^/]+/([^/]+)&#39;
        1       6       0       6   r&#39;gitlab[^/]+/api/v4/projects/[^/]+%2F([^/]+)&#39;
        2      94      33     127   r&#39;gitlab[^/]+/(?!api/v4/projects)[^/]+/([^/]+)&#39;
        3      11       6      17   r&#39;bitbucket\\.org/[^/]+/([^/]+)&#39;
        4       4       0       4   r&#39;pypi\\.(?:python\\.org|io)/packages/source/[A-Za-z\\d]/([^/]+)&#39;
        6      13       1      14   r&#39;\\?f=([A-Za-z\\d+-]+)$&#39;
        7      23       0      23   r&#39;\\?package=([A-Za-z\\d+-]+)&#39;
        9       2       1       3   r&#39;([^/]+)/download.php$&#39;
       10    5046     668    5714   r&#39;^([A-Za-z\\d+\\._-]+)$&#39;

==&gt; Statistics on version regular expressions:

    Index   Right   Wrong   Total   Regular Expression
        0    5092     222    5314   r&#39;^[a-zA-Z+._-]+[._-]v?(\\d[\\d._-]*)$&#39;
        1    1547      82    1629   r&#39;^v?(\\d[\\d._-]*)$&#39;
        2      14      42      56   r&#39;^[a-zA-Z+]*(\\d[\\da-zA-Z]*)$&#39;
        3      10      17      27   r&#39;^[a-zA-Z+-]*(\\d[\\da-zA-Z-]*)$&#39;
        4       7     132     139   r&#39;^[a-zA-Z+_]*(\\d[\\da-zA-Z_]*)$&#39;
        5      62      32      94   r&#39;^[a-zA-Z+.]*(\\d[\\da-zA-Z.]*)$&#39;
        6     292      11     303   r&#39;^[a-zA-Z\\d+-]+-v?(\\d[\\da-zA-Z.]*)$&#39;
        7       1       0       1   r&#39;^[a-zA-Z\\d+-]+-v?(\\d[\\da-zA-Z_]*)$&#39;
        8      40       0      40   r&#39;^[a-zA-Z\\d+_]+_v?(\\d[\\da-zA-Z.]*)$&#39;
        9       0       2       2   r&#39;^[a-zA-Z\\d+_]+\\.v?(\\d[\\da-zA-Z.]*)$&#39;
       10       0       1       1   r&#39;^[a-zA-Z\\d+]+_r?(\\d[\\da-zA-Z-]*)$&#39;
       11      33      88     121   r&#39;^(?:[a-zA-Z\\d+-]+-)?v?(\\d[\\da-zA-Z.-]*)$&#39;
       12       3       0       3   r&#39;^[a-zA-Z+]+v?(\\d[\\da-zA-Z.-]*)$&#39;
       13      12       4      16   r&#39;^[a-zA-Z\\d+_]+-v?(\\d[\\da-zA-Z.]*)$&#39;
       14      28       7      35   r&#39;^[a-zA-Z\\d+.]+_v?(\\d[\\da-zA-Z.-]*)$&#39;
       15       1      13      14   r&#39;^[a-zA-Z\\d+-]+-v?(\\d[\\da-zA-Z._]*)$&#39;
       16       3       1       4   r&#39;^[a-zA-Z\\d+._]+-v?(\\d[\\da-zA-Z.]*)$&#39;
       17       5       1       6   r&#39;^[a-zA-Z+-]+(\\d[\\da-zA-Z._]*)$&#39;
       18       1       2       3   r&#39;^[a-zA-Z\\d+_-]+-v?(\\d[\\da-zA-Z.]*)$&#39;
       20      10       0      10   r&#39;[?&amp;](?:sha|ref|version)=[a-zA-Z\\d+-]*[_-]?v?(\\d[\\da-zA-Z._-]*)$&#39;
       21      37       0      37   r&#39;[?&amp;](?:filename|f|get)=[a-zA-Z\\d+-]+[_-]v?(\\d[\\da-zA-Z.]*)&#39;
       22      15       1      16   r&#39;github\\.com/[^/]+/[^/]+/releases/download/[a-zA-Z+._-]*v?(\\d[\\da-zA-Z._-]*)/&#39;
       23      20       0      20   r&#39;gitlab\\.com/[^/]+/.+/-/releases/[a-zA-Z+._-]*v?(\\d[\\da-zA-Z._-]*)/downloads/&#39;
       24      17     294     311   r&#39;(\\d[\\da-zA-Z._-]*)/[^/]+$&#39;
</pre></div>
</div>
<p>This command is essential for anyone adding or changing the regular
expressions that parse names and versions. By running this command
before and after the change, you can make sure that your regular
expression fixes more packages than it breaks.</p>
</section>
</section>
</section>
<section id="profiling">
<h2>Profiling<a class="headerlink" href="#profiling" title="Link to this heading"></a></h2>
<p>Spack has some limited built-in support for profiling, and can report
statistics using standard Python timing tools.  To use this feature,
supply <code class="docutils literal notranslate"><span class="pre">--profile</span></code> to Spack on the command line, before any subcommands.</p>
<section id="spack-profile">
<span id="spack-p"></span><h3><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">--profile</span></code><a class="headerlink" href="#spack-profile" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">--profile</span></code> output looks like this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ spack --profile graph hdf5
o hdf5@1.14.5/3xa4j2n
|\
| |\
| | |\
| | | |\
| | | | |\
| | | | | |\
| | o | | | | openmpi@5.0.5/y6e4nso
| |/| | | | | 
|/|/| | | | | 
| | |\| | | | 
| | |\ \ \ \ \
| | | |\ \ \ \ \
| | | | |\ \ \ \ \
| | | | | |\ \ \ \ \
| | | | | | |\ \ \ \ \
| | | | | | | |\ \ \ \ \
| | | | | | | | |\ \ \ \ \
| | | | | | | | | |\ \ \ \ \
| | | | | | | | | | |_|/ / /
| | | | | | | | | |/| | | | 
| | | | | | | | | | |\ \ \ \
| | | | | | | | | | | |_|/ /
| | | | | | | | | | |/| | | 
| | | | | | | | | | | |\ \ \
...
</pre></div>
</div>
<p>The bottom of the output shows the top most time consuming functions,
slowest on top.  The profiling support is from Python’s built-in tool,
<a class="reference external" href="https://docs.python.org/2/library/profile.html#module-cProfile">cProfile</a>.</p>
</section>
</section>
<section id="releases">
<span id="id4"></span><h2>Releases<a class="headerlink" href="#releases" title="Link to this heading"></a></h2>
<p>This section documents Spack’s release process. It is intended for
project maintainers, as the tasks described here require maintainer
privileges on the Spack repository. For others, we hope this section at
least provides some insight into how the Spack project works.</p>
<section id="release-branches">
<span id="id5"></span><h3>Release branches<a class="headerlink" href="#release-branches" title="Link to this heading"></a></h3>
<p>There are currently two types of Spack releases: <a class="reference internal" href="#major-releases"><span class="std std-ref">major releases</span></a> (<code class="docutils literal notranslate"><span class="pre">0.21.0</span></code>, <code class="docutils literal notranslate"><span class="pre">0.22.0</span></code>, etc.) and <a class="reference internal" href="#patch-releases"><span class="std std-ref">patch releases</span></a> (<code class="docutils literal notranslate"><span class="pre">0.22.1</span></code>, <code class="docutils literal notranslate"><span class="pre">0.22.2</span></code>, <code class="docutils literal notranslate"><span class="pre">0.22.3</span></code>, etc.). Here is a
diagram of how Spack release branches work:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">o</span>    <span class="n">branch</span><span class="p">:</span> <span class="n">develop</span>  <span class="p">(</span><span class="n">latest</span> <span class="n">version</span><span class="p">,</span> <span class="n">v0</span><span class="mf">.23.0</span><span class="o">.</span><span class="n">dev0</span><span class="p">)</span>
<span class="o">|</span>
<span class="n">o</span>
<span class="o">|</span> <span class="n">o</span>  <span class="n">branch</span><span class="p">:</span> <span class="n">releases</span><span class="o">/</span><span class="n">v0</span><span class="mf">.22</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="n">v0</span><span class="mf">.22.1</span>
<span class="n">o</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span>  <span class="n">tag</span><span class="p">:</span> <span class="n">v0</span><span class="mf">.22.0</span>
<span class="n">o</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span>
<span class="o">|/</span>
<span class="n">o</span>
<span class="o">|</span>
<span class="n">o</span>
<span class="o">|</span> <span class="n">o</span>  <span class="n">branch</span><span class="p">:</span> <span class="n">releases</span><span class="o">/</span><span class="n">v0</span><span class="mf">.21</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="n">v0</span><span class="mf">.21.2</span>
<span class="n">o</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span>  <span class="n">tag</span><span class="p">:</span> <span class="n">v0</span><span class="mf">.21.1</span>
<span class="n">o</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span>  <span class="n">tag</span><span class="p">:</span> <span class="n">v0</span><span class="mf">.21.0</span>
<span class="n">o</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span>
<span class="o">|/</span>
<span class="n">o</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">develop</span></code> branch has the latest contributions, and nearly all pull
requests target <code class="docutils literal notranslate"><span class="pre">develop</span></code>. The <code class="docutils literal notranslate"><span class="pre">develop</span></code> branch will report that its
version is that of the next <strong>major</strong> release with a <code class="docutils literal notranslate"><span class="pre">.dev0</span></code> suffix.</p>
<p>Each Spack release series also has a corresponding branch, e.g.
<code class="docutils literal notranslate"><span class="pre">releases/v0.22</span></code> has <code class="docutils literal notranslate"><span class="pre">v0.22.x</span></code> versions of Spack, and
<code class="docutils literal notranslate"><span class="pre">releases/v0.21</span></code> has <code class="docutils literal notranslate"><span class="pre">v0.21.x</span></code> versions. A major release is the first
tagged version on a release branch. Minor releases are back-ported from
develop onto release branches. This is typically done by cherry-picking
bugfix commits off of <code class="docutils literal notranslate"><span class="pre">develop</span></code>.</p>
<p>To avoid version churn for users of a release series, minor releases
<strong>should not</strong> make changes that would change the concretization of
packages. They should generally only contain fixes to the Spack core.
However, sometimes priorities are such that new functionality needs to
be added to a minor release.</p>
<p>Both major and minor releases are tagged. As a convenience, we also tag
the latest release as <code class="docutils literal notranslate"><span class="pre">releases/latest</span></code>, so that users can easily check
it out to get the latest stable version. See <a class="reference internal" href="#updating-latest-release"><span class="std std-ref">Updating releases/latest</span></a>
for more details.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Older spack releases were merged <strong>back</strong> into develop so that we could
do fancy things with tags, but since tarballs and many git checkouts do
not have tags, this proved overly complex and confusing.</p>
<p>We have since converted to using <a class="reference external" href="https://peps.python.org/pep-0440/">PEP 440</a>
compliant versions.  <a class="reference external" href="https://github.com/spack/spack/pull/25267">See here</a> for
details.</p>
</div>
</section>
<section id="scheduling-work-for-releases">
<h3>Scheduling work for releases<a class="headerlink" href="#scheduling-work-for-releases" title="Link to this heading"></a></h3>
<p>We schedule work for <strong>major releases</strong> through <a class="reference external" href="https://github.com/spack/spack/milestones">milestones</a> and <a class="reference external" href="https://github.com/spack/spack/projects">GitHub Projects</a>, while <strong>patch releases</strong> use <a class="reference external" href="https://github.com/spack/spack/labels">labels</a>.</p>
<p>There is only one milestone open at a time. Its name corresponds to the next major version, for
example <code class="docutils literal notranslate"><span class="pre">v0.23</span></code>. Important issues and pull requests should be assigned to this milestone by
core developers, so that they are not forgotten at the time of release. The milestone is closed
when the release is made, and a new milestone is created for the next major release.</p>
<p>Bug reports in GitHub issues are automatically labelled <code class="docutils literal notranslate"><span class="pre">bug</span></code> and <code class="docutils literal notranslate"><span class="pre">triage</span></code>. Spack developers
assign one of the labels <code class="docutils literal notranslate"><span class="pre">impact-low</span></code>, <code class="docutils literal notranslate"><span class="pre">impact-medium</span></code> or <code class="docutils literal notranslate"><span class="pre">impact-high</span></code>. This will make the
issue appear in the <a class="reference external" href="https://github.com/orgs/spack/projects/6">Triaged bugs</a> project board.
Important issues should be assigned to the next milestone as well, so they appear at the top of
the project board.</p>
<p>Spack’s milestones are not firm commitments so we move work between releases frequently. If we
need to make a release and some tasks are not yet done, we will simply move them to the next major
release milestone, rather than delaying the release to complete them.</p>
</section>
<section id="backporting-bug-fixes">
<h3>Backporting bug fixes<a class="headerlink" href="#backporting-bug-fixes" title="Link to this heading"></a></h3>
<p>When a bug is fixed in the <code class="docutils literal notranslate"><span class="pre">develop</span></code> branch, it is often necessary to backport the fix to one
(or more) of the <code class="docutils literal notranslate"><span class="pre">release/vX.Y</span></code> branches. Only the release manager is responsible for doing
backports, but Spack maintainers are responsible for labelling pull requests (and issues if no bug
fix is available yet) with <code class="docutils literal notranslate"><span class="pre">vX.Y.Z</span></code> labels. The label should correspond to the next patch version
that the bug fix should be backported to.</p>
<p>Backports are done publicly by the release manager using a pull request named <code class="docutils literal notranslate"><span class="pre">Backports</span> <span class="pre">vX.Y.Z</span></code>.
This pull request is opened from the <code class="docutils literal notranslate"><span class="pre">backports/vX.Y.Z</span></code> branch, targets the <code class="docutils literal notranslate"><span class="pre">releases/vX.Y</span></code>
branch and contains a (growing) list of cherry-picked commits from the <code class="docutils literal notranslate"><span class="pre">develop</span></code> branch.
Typically there are one or two backport pull requests open at any given time.</p>
</section>
<section id="making-major-releases">
<span id="major-releases"></span><h3>Making major releases<a class="headerlink" href="#making-major-releases" title="Link to this heading"></a></h3>
<p>Assuming all required work from the milestone is completed, the steps to make the major release
are:</p>
<ol class="arabic">
<li><p><a class="reference external" href="https://github.com/spack/spack/milestones">Create a new milestone</a> for the next major
release.</p></li>
<li><p><a class="reference external" href="https://github.com/spack/spack/labels">Create a new label</a> for the next patch release.</p></li>
<li><p>Move any optional tasks that are not done to the next milestone.</p></li>
<li><p>Create a branch for the release, based on <code class="docutils literal notranslate"><span class="pre">develop</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span>releases/v0.23<span class="w"> </span>develop
</pre></div>
</div>
<p>For a version <code class="docutils literal notranslate"><span class="pre">vX.Y.Z</span></code>, the branch’s name should be
<code class="docutils literal notranslate"><span class="pre">releases/vX.Y</span></code>. That is, you should create a <code class="docutils literal notranslate"><span class="pre">releases/vX.Y</span></code>
branch if you are preparing the <code class="docutils literal notranslate"><span class="pre">X.Y.0</span></code> release.</p>
</li>
<li><p>Remove the <code class="docutils literal notranslate"><span class="pre">dev0</span></code> development release segment from the version tuple in
<code class="docutils literal notranslate"><span class="pre">lib/spack/spack/__init__.py</span></code>.</p>
<p>The version number itself should already be correct and should not be
modified.</p>
</li>
<li><p>Update <code class="docutils literal notranslate"><span class="pre">CHANGELOG.md</span></code> with major highlights in bullet form.</p>
<p>Use proper markdown formatting, like <a class="reference external" href="https://github.com/spack/spack/commit/d4bf70d9882fcfe88507e9cb444331d7dd7ba71c">this example from 0.15.0</a>.</p>
</li>
<li><p>Push the release branch to GitHub.</p></li>
<li><p>Make sure CI passes on the release branch, including:</p>
<ul class="simple">
<li><p>Regular unit tests</p></li>
<li><p>Build tests</p></li>
<li><p>The E4S pipeline at <a class="reference external" href="https://gitlab.spack.io">gitlab.spack.io</a></p></li>
</ul>
<p>If CI is not passing, submit pull requests to <code class="docutils literal notranslate"><span class="pre">develop</span></code> as normal
and keep rebasing the release branch on <code class="docutils literal notranslate"><span class="pre">develop</span></code> until CI passes.</p>
</li>
<li><p>Make sure the entire documentation is up to date. If documentation
is outdated submit pull requests to <code class="docutils literal notranslate"><span class="pre">develop</span></code> as normal
and keep rebasing the release branch on <code class="docutils literal notranslate"><span class="pre">develop</span></code>.</p></li>
<li><p>Bump the major version in the <code class="docutils literal notranslate"><span class="pre">develop</span></code> branch.</p>
<p>Create a pull request targeting the <code class="docutils literal notranslate"><span class="pre">develop</span></code> branch, bumping the major
version in <code class="docutils literal notranslate"><span class="pre">lib/spack/spack/__init__.py</span></code> with a <code class="docutils literal notranslate"><span class="pre">dev0</span></code> release segment.
For instance when you have just released <code class="docutils literal notranslate"><span class="pre">v0.23.0</span></code>, set the version
to <code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">24,</span> <span class="pre">0,</span> <span class="pre">'dev0')</span></code> on <code class="docutils literal notranslate"><span class="pre">develop</span></code>.</p>
</li>
<li><p>Follow the steps in <a class="reference internal" href="#publishing-releases"><span class="std std-ref">Publishing a release on GitHub</span></a>.</p></li>
<li><p>Follow the steps in <a class="reference internal" href="#updating-latest-release"><span class="std std-ref">Updating releases/latest</span></a>.</p></li>
<li><p>Follow the steps in <a class="reference internal" href="#announcing-releases"><span class="std std-ref">Announcing a release</span></a>.</p></li>
</ol>
</section>
<section id="making-patch-releases">
<span id="patch-releases"></span><h3>Making patch releases<a class="headerlink" href="#making-patch-releases" title="Link to this heading"></a></h3>
<p>To make the patch release process both efficient and transparent, we use a <em>backports pull request</em>
which contains cherry-picked commits from the <code class="docutils literal notranslate"><span class="pre">develop</span></code> branch. The majority of the work is to
cherry-pick the bug fixes, which ideally should be done as soon as they land on <code class="docutils literal notranslate"><span class="pre">develop</span></code>:
this ensures cherry-picking happens in order, and makes conflicts easier to resolve since the
changes are fresh in the mind of the developer.</p>
<p>The backports pull request is always titled <code class="docutils literal notranslate"><span class="pre">Backports</span> <span class="pre">vX.Y.Z</span></code> and is labelled <code class="docutils literal notranslate"><span class="pre">backports</span></code>. It
is opened from a branch named <code class="docutils literal notranslate"><span class="pre">backports/vX.Y.Z</span></code> and targets the <code class="docutils literal notranslate"><span class="pre">releases/vX.Y</span></code> branch.</p>
<p>Whenever a pull request labelled <code class="docutils literal notranslate"><span class="pre">vX.Y.Z</span></code> is merged, cherry-pick the associated squashed commit
on <code class="docutils literal notranslate"><span class="pre">develop</span></code> to the <code class="docutils literal notranslate"><span class="pre">backports/vX.Y.Z</span></code> branch. For pull requests that were rebased (or not
squashed), cherry-pick each associated commit individually. Never force push to the
<code class="docutils literal notranslate"><span class="pre">backports/vX.Y.Z</span></code> branch.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Sometimes you may <strong>still</strong> get merge conflicts even if you have
cherry-picked all the commits in order. This generally means there
is some other intervening pull request that the one you’re trying
to pick depends on. In these cases, you’ll need to make a judgment
call regarding those pull requests.  Consider the number of affected
files and/or the resulting differences.</p>
<ol class="arabic simple">
<li><p>If the changes are small, you might just cherry-pick it.</p></li>
<li><p>If the changes are large, then you may decide that this fix is not
worth including in a patch release, in which case you should remove
the label from the pull request. Remember that large, manual backports
are seldom the right choice for a patch release.</p></li>
</ol>
</div>
<p>When all commits are cherry-picked in the <code class="docutils literal notranslate"><span class="pre">backports/vX.Y.Z</span></code> branch, make the patch
release as follows:</p>
<ol class="arabic">
<li><p><a class="reference external" href="https://github.com/spack/spack/labels">Create a new label</a> <code class="docutils literal notranslate"><span class="pre">vX.Y.{Z+1}</span></code> for the next patch
release.</p></li>
<li><p>Replace the label <code class="docutils literal notranslate"><span class="pre">vX.Y.Z</span></code> with <code class="docutils literal notranslate"><span class="pre">vX.Y.{Z+1}</span></code> for all PRs and issues that are not done.</p></li>
<li><p>Manually push a single commit with commit message <code class="docutils literal notranslate"><span class="pre">Set</span> <span class="pre">version</span> <span class="pre">to</span> <span class="pre">vX.Y.Z</span></code> to the
<code class="docutils literal notranslate"><span class="pre">backports/vX.Y.Z</span></code> branch, that both bumps the Spack version number and updates the changelog:</p>
<ol class="arabic simple">
<li><p>Bump the version in <code class="docutils literal notranslate"><span class="pre">lib/spack/spack/__init__.py</span></code>.</p></li>
<li><p>Update <code class="docutils literal notranslate"><span class="pre">CHANGELOG.md</span></code> with a list of the changes.</p></li>
</ol>
<p>This is typically a summary of the commits you cherry-picked onto the
release branch. See <a class="reference external" href="https://github.com/spack/spack/commit/ff0abb9838121522321df2a054d18e54b566b44a">the changelog from 0.14.1</a>.</p>
</li>
<li><p>Make sure CI passes on the <strong>backports pull request</strong>, including:</p>
<ul class="simple">
<li><p>Regular unit tests</p></li>
<li><p>Build tests</p></li>
<li><p>The E4S pipeline at <a class="reference external" href="https://gitlab.spack.io">gitlab.spack.io</a></p></li>
</ul>
</li>
<li><p>Merge the <code class="docutils literal notranslate"><span class="pre">Backports</span> <span class="pre">vX.Y.Z</span></code> PR with the <strong>Rebase and merge</strong> strategy. This
is needed to keep track in the release branch of all the commits that were
cherry-picked.</p></li>
<li><p>Make sure CI passes on the last commit of the <strong>release branch</strong>.</p></li>
<li><p>In the rare case you need to include additional commits in the patch release after the backports
PR is merged, it is best to delete the last commit <code class="docutils literal notranslate"><span class="pre">Set</span> <span class="pre">version</span> <span class="pre">to</span> <span class="pre">vX.Y.Z</span></code> from the release
branch with a single force push, open a new backports PR named <code class="docutils literal notranslate"><span class="pre">Backports</span> <span class="pre">vX.Y.Z</span> <span class="pre">(2)</span></code>, and
repeat the process. Avoid repeated force pushes to the release branch.</p></li>
<li><p>Follow the steps in <a class="reference internal" href="#publishing-releases"><span class="std std-ref">Publishing a release on GitHub</span></a>.</p></li>
<li><p>Follow the steps in <a class="reference internal" href="#updating-latest-release"><span class="std std-ref">Updating releases/latest</span></a>.</p></li>
<li><p>Follow the steps in <a class="reference internal" href="#announcing-releases"><span class="std std-ref">Announcing a release</span></a>.</p></li>
<li><p>Submit a PR to update the CHANGELOG in the <cite>develop</cite> branch
with the addition of this point release.</p></li>
</ol>
</section>
<section id="publishing-a-release-on-github">
<span id="publishing-releases"></span><h3>Publishing a release on GitHub<a class="headerlink" href="#publishing-a-release-on-github" title="Link to this heading"></a></h3>
<ol class="arabic">
<li><p>Create the release in GitHub.</p>
<ul>
<li><p>Go to
<a class="reference external" href="https://github.com/spack/spack/releases">github.com/spack/spack/releases</a>
and click <code class="docutils literal notranslate"><span class="pre">Draft</span> <span class="pre">a</span> <span class="pre">new</span> <span class="pre">release</span></code>.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">Tag</span> <span class="pre">version</span></code> to the name of the tag that will be created.</p>
<p>The name should start with <code class="docutils literal notranslate"><span class="pre">v</span></code> and contain <em>all three</em>
parts of the version (e.g. <code class="docutils literal notranslate"><span class="pre">v0.15.0</span></code> or <code class="docutils literal notranslate"><span class="pre">v0.15.1</span></code>).</p>
</li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">Target</span></code> to the <code class="docutils literal notranslate"><span class="pre">releases/vX.Y</span></code> branch (e.g., <code class="docutils literal notranslate"><span class="pre">releases/v0.15</span></code>).</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">Release</span> <span class="pre">title</span></code> to <code class="docutils literal notranslate"><span class="pre">vX.Y.Z</span></code> to match the tag (e.g., <code class="docutils literal notranslate"><span class="pre">v0.15.1</span></code>).</p></li>
<li><p>Paste the latest release markdown from your <code class="docutils literal notranslate"><span class="pre">CHANGELOG.md</span></code> file as the text.</p></li>
<li><p>Save the draft so you can keep coming back to it as you prepare the release.</p></li>
</ul>
</li>
<li><p>When you are ready to finalize the release, click <code class="docutils literal notranslate"><span class="pre">Publish</span> <span class="pre">release</span></code>.</p></li>
<li><p>Immediately after publishing, go back to
<a class="reference external" href="https://github.com/spack/spack/releases">github.com/spack/spack/releases</a> and download the
auto-generated <code class="docutils literal notranslate"><span class="pre">.tar.gz</span></code> file for the release. It’s the <code class="docutils literal notranslate"><span class="pre">Source</span>
<span class="pre">code</span> <span class="pre">(tar.gz)</span></code> link.</p></li>
<li><p>Click <code class="docutils literal notranslate"><span class="pre">Edit</span></code> on the release you just made and attach the downloaded
release tarball as a binary. This does two things:</p>
<ol class="arabic">
<li><p>Makes sure that the hash of our releases does not change over time.</p>
<p>GitHub sometimes annoyingly changes the way they generate tarballs
that can result in the hashes changing if you rely on the
auto-generated tarball links.</p>
</li>
<li><p>Gets download counts on releases visible through the GitHub API.</p>
<p>GitHub tracks downloads of artifacts, but <em>not</em> the source
links. See the <a class="reference external" href="https://api.github.com/repos/spack/spack/releases">releases
page</a> and search
for <code class="docutils literal notranslate"><span class="pre">download_count</span></code> to see this.</p>
</li>
</ol>
</li>
<li><p>Go to <a class="reference external" href="https://readthedocs.org/projects/spack">readthedocs.org</a> and
activate the release tag.</p>
<p>This builds the documentation and makes the released version
selectable in the versions menu.</p>
</li>
</ol>
</section>
<section id="updating-releases-latest">
<span id="updating-latest-release"></span><h3>Updating <cite>releases/latest</cite><a class="headerlink" href="#updating-releases-latest" title="Link to this heading"></a></h3>
<p>If the new release is the <strong>highest</strong> Spack release yet, you should
also tag it as <code class="docutils literal notranslate"><span class="pre">releases/latest</span></code>. For example, suppose the highest
release is currently <code class="docutils literal notranslate"><span class="pre">0.22.3</span></code>:</p>
<ul class="simple">
<li><p>If you are releasing <code class="docutils literal notranslate"><span class="pre">0.22.4</span></code> or <code class="docutils literal notranslate"><span class="pre">0.23.0</span></code>, then you should tag
it with <code class="docutils literal notranslate"><span class="pre">releases/latest</span></code>, as these are higher than <code class="docutils literal notranslate"><span class="pre">0.22.3</span></code>.</p></li>
<li><p>If you are making a new release of an <strong>older</strong> major version of
Spack, e.g. <code class="docutils literal notranslate"><span class="pre">0.21.4</span></code>, then you should not tag it as
<code class="docutils literal notranslate"><span class="pre">releases/latest</span></code> (as there are newer major versions).</p></li>
</ul>
<p>To do so, first fetch the latest tag created on GitHub, since you may not have it locally:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>fetch<span class="w"> </span>--force<span class="w"> </span>git@github.com:spack/spack<span class="w"> </span>vX.Y.Z
</pre></div>
</div>
<p>Then tag <code class="docutils literal notranslate"><span class="pre">vX.Y.Z</span></code> as <code class="docutils literal notranslate"><span class="pre">releases/latest</span></code> and push the individual tag to GitHub.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>tag<span class="w"> </span>--force<span class="w"> </span>releases/latest<span class="w"> </span>vX.Y.Z
<span class="gp">$ </span>git<span class="w"> </span>push<span class="w"> </span>--force<span class="w"> </span>git@github.com:spack/spack<span class="w"> </span>releases/latest
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--force</span></code> argument to <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">tag</span></code> makes <code class="docutils literal notranslate"><span class="pre">git</span></code> overwrite the existing <code class="docutils literal notranslate"><span class="pre">releases/latest</span></code>
tag with the new one. Do <strong>not</strong> use the <code class="docutils literal notranslate"><span class="pre">--tags</span></code> flag when pushing, since this will push <em>all</em>
local tags.</p>
</section>
<section id="announcing-a-release">
<span id="announcing-releases"></span><h3>Announcing a release<a class="headerlink" href="#announcing-a-release" title="Link to this heading"></a></h3>
<p>We announce releases in all of the major Spack communication channels.
Publishing the release takes care of GitHub. The remaining channels are
X, Slack, and the mailing list. Here are the steps:</p>
<ol class="arabic">
<li><p>Announce the release on X.</p>
<ul>
<li><p>Compose the tweet on the <code class="docutils literal notranslate"><span class="pre">&#64;spackpm</span></code> account per the
<code class="docutils literal notranslate"><span class="pre">spack-twitter</span></code> slack channel.</p></li>
<li><p>Be sure to include a link to the release’s page on GitHub.</p>
<p>You can base the tweet on <a class="reference external" href="https://twitter.com/spackpm/status/1231761858182307840">this
example</a>.</p>
</li>
</ul>
</li>
<li><p>Announce the release on Slack.</p>
<ul class="simple">
<li><p>Compose a message in the <code class="docutils literal notranslate"><span class="pre">#general</span></code> Slack channel
(<a class="reference external" href="https://spackpm.slack.com">spackpm.slack.com</a>).</p></li>
<li><p>Preface the message with <code class="docutils literal notranslate"><span class="pre">&#64;channel</span></code> to notify even those
people not currently logged in.</p></li>
<li><p>Be sure to include a link to the tweet above.</p></li>
</ul>
<p>The tweet will be shown inline so that you do not have to retype
your release announcement.</p>
</li>
<li><p>Announce the release on the Spack mailing list.</p>
<ul class="simple">
<li><p>Compose an email to the Spack mailing list.</p></li>
<li><p>Be sure to include a link to the release’s page on GitHub.</p></li>
<li><p>It is also helpful to include some information directly in the
email.</p></li>
</ul>
<p>You can base your announcement on this <a class="reference external" href="https://groups.google.com/forum/#!topic/spack/WT4CT9i_X4s">example
email</a>.</p>
</li>
</ol>
<p>Once you’ve completed the above steps, congratulations, you’re done!
You’ve finished making the release!</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="build_systems/sourceforgepackage.html" class="btn btn-neutral float-left" title="Sourceforge" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="spack.html" class="btn btn-neutral float-right" title="spack package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2023, Lawrence Livermore National Laboratory..
      <span class="lastupdated">Last updated on Sep 20, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>