

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Concretization Settings (concretizer.yaml) &mdash; Spack 0.23.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5f00b823" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=832b3b9f"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Environments (spack.yaml, spack.lock)" href="environments.html" />
    <link rel="prev" title="Package Settings (packages.yaml)" href="packages_yaml.html" /> 
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S0PQ7WV75K"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S0PQ7WV75K');
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/spack-logo-white-text.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="features.html">Feature Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="replace_conda_homebrew.html">Spack for Homebrew/Conda Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="frequently_asked_questions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://spack-tutorial.readthedocs.io">Tutorial (spack-tutorial.rtfd.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://packages.spack.io">Packages (packages.spack.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cache.spack.io">Binaries (binaries.spack.io)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="config_yaml.html">Spack Settings (config.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="packages_yaml.html">Package Settings (packages.yaml)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Concretization Settings (concretizer.yaml)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#reuse-already-installed-packages">Reuse already installed packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#selection-of-the-target-microarchitectures">Selection of the target microarchitectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="#duplicate-nodes">Duplicate nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#splicing">Splicing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#automatic-splicing">Automatic Splicing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="environments.html">Environments (spack.yaml, spack.lock)</a></li>
<li class="toctree-l1"><a class="reference internal" href="containers.html">Container Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="mirrors.html">Mirrors (mirrors.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_file_support.html">Modules (modules.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="repositories.html">Package Repositories (repos.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="binary_caches.html">Build Caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootstrapping.html">Bootstrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html">Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="chain.html">Chaining Spack Installations (upstreams.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="extensions.html">Custom Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipelines.html">CI Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="signing.html">Spack Package Signing</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu_configuration.html">Using External GPU Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contribution_guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="packaging_guide.html">Packaging Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_systems.html">Build Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer_guide.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="spack.html">Spack API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="llnl.html">LLNL API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Spack</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Concretization Settings (concretizer.yaml)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/build_settings.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="concretization-settings-concretizer-yaml">
<span id="concretizer-options"></span><h1>Concretization Settings (concretizer.yaml)<a class="headerlink" href="#concretization-settings-concretizer-yaml" title="Link to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">concretizer.yaml</span></code> configuration file allows to customize aspects of the
algorithm used to select the dependencies you install. The default configuration
is the following:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># This is the default spack configuration file.</span>
<span class="c1">#</span>
<span class="c1"># Settings here are versioned with Spack and are intended to provide</span>
<span class="c1"># sensible defaults out of the box. Spack maintainers should edit this</span>
<span class="c1"># file to keep it current.</span>
<span class="c1">#</span>
<span class="c1"># Users can override these settings by editing</span>
<span class="c1"># `$SPACK_ROOT/etc/spack/concretizer.yaml`, `~/.spack/concretizer.yaml`,</span>
<span class="c1"># or by adding a `concretizer:` section to an environment.</span>
<span class="c1"># -------------------------------------------------------------------------</span>
<span class="nt">concretizer</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Whether to consider installed packages or packages from buildcaches when</span>
<span class="w">  </span><span class="c1"># concretizing specs. If `true`, we&#39;ll try to use as many installs/binaries</span>
<span class="w">  </span><span class="c1"># as possible, rather than building. If `false`, we&#39;ll always give you a fresh</span>
<span class="w">  </span><span class="c1"># concretization. If `dependencies`, we&#39;ll only reuse dependencies but</span>
<span class="w">  </span><span class="c1"># give you a fresh concretization for your root specs.</span>
<span class="w">  </span><span class="nt">reuse</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="c1"># Options that tune which targets are considered for concretization. The</span>
<span class="w">  </span><span class="c1"># concretization process is very sensitive to the number targets, and the time</span>
<span class="w">  </span><span class="c1"># needed to reach a solution increases noticeably with the number of targets</span>
<span class="w">  </span><span class="c1"># considered.</span>
<span class="w">  </span><span class="nt">targets</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Determine whether we want to target specific or generic</span>
<span class="w">    </span><span class="c1"># microarchitectures. Valid values are: &quot;microarchitectures&quot; or &quot;generic&quot;.</span>
<span class="w">    </span><span class="c1"># An example of &quot;microarchitectures&quot; would be &quot;skylake&quot; or &quot;bulldozer&quot;,</span>
<span class="w">    </span><span class="c1"># while an example of &quot;generic&quot; would be &quot;aarch64&quot; or &quot;x86_64_v4&quot;.</span>
<span class="w">    </span><span class="nt">granularity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">microarchitectures</span>
<span class="w">    </span><span class="c1"># If &quot;false&quot; allow targets that are incompatible with the current host (for</span>
<span class="w">    </span><span class="c1"># instance concretize with target &quot;icelake&quot; while running on &quot;haswell&quot;).</span>
<span class="w">    </span><span class="c1"># If &quot;true&quot; only allow targets that are compatible with the host.</span>
<span class="w">    </span><span class="nt">host_compatible</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="c1"># When &quot;true&quot; concretize root specs of environments together, so that each unique</span>
<span class="w">  </span><span class="c1"># package in an environment corresponds to one concrete spec. This ensures</span>
<span class="w">  </span><span class="c1"># environments can always be activated. When &quot;false&quot; perform concretization separately</span>
<span class="w">  </span><span class="c1"># on each root spec, allowing different versions and variants of the same package in</span>
<span class="w">  </span><span class="c1"># an environment.</span>
<span class="w">  </span><span class="nt">unify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="c1"># Option to deal with possible duplicate nodes (i.e. different nodes from the same package) in the DAG.</span>
<span class="w">  </span><span class="nt">duplicates</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># &quot;none&quot;: allows a single node for any package in the DAG.</span>
<span class="w">    </span><span class="c1"># &quot;minimal&quot;: allows the duplication of &#39;build-tools&#39; nodes only</span>
<span class="w">    </span><span class="c1"># (e.g. py-setuptools, cmake etc.)</span>
<span class="w">    </span><span class="c1"># &quot;full&quot; (experimental): allows separation of the entire build-tool stack (e.g. the entire &quot;cmake&quot; subDAG)</span>
<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">minimal</span>
<span class="w">  </span><span class="c1"># Option to specify compatibility between operating systems for reuse of compilers and packages</span>
<span class="w">  </span><span class="c1"># Specified as a key: [list] where the key is the os that is being targeted, and the list contains the OS&#39;s</span>
<span class="w">  </span><span class="c1"># it can reuse. Note this is a directional compatibility so mutual compatibility between two OS&#39;s</span>
<span class="w">  </span><span class="c1"># requires two entries i.e. os_compatible: {sonoma: [monterey], monterey: [sonoma]}</span>
<span class="w">  </span><span class="nt">os_compatible</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>

<span class="w">  </span><span class="c1"># Option to specify whether to support splicing. Splicing allows for</span>
<span class="w">  </span><span class="c1"># the relinking of concrete package dependencies in order to better</span>
<span class="w">  </span><span class="c1"># reuse already built packages with ABI compatible dependencies</span>
<span class="w">  </span><span class="nt">splice</span><span class="p">:</span>
<span class="w">    </span><span class="nt">explicit</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="w">    </span><span class="nt">automatic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
<section id="reuse-already-installed-packages">
<h2>Reuse already installed packages<a class="headerlink" href="#reuse-already-installed-packages" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">reuse</span></code> attribute controls how aggressively Spack reuses binary packages during concretization. The
attribute can either be a single value, or an object for more complex configurations.</p>
<p>In the former case (“single value”) it allows Spack to:</p>
<ol class="arabic simple">
<li><p>Reuse installed packages and buildcaches for all the specs to be concretized, when <code class="docutils literal notranslate"><span class="pre">true</span></code></p></li>
<li><p>Reuse installed packages and buildcaches only for the dependencies of the root specs, when <code class="docutils literal notranslate"><span class="pre">dependencies</span></code></p></li>
<li><p>Disregard reusing installed packages and buildcaches, when <code class="docutils literal notranslate"><span class="pre">false</span></code></p></li>
</ol>
<p>In case a finer control over which specs are reused is needed, then the value of this attribute can be
an object, with the following keys:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">roots</span></code>: if <code class="docutils literal notranslate"><span class="pre">true</span></code> root specs are reused, if <code class="docutils literal notranslate"><span class="pre">false</span></code> only dependencies of root specs are reused</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">from</span></code>: list of sources from which reused specs are taken</p></li>
</ol>
<p>Each source in <code class="docutils literal notranslate"><span class="pre">from</span></code> is itself an object:</p>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">Attributes for a source or reusable specs</span><a class="headerlink" href="#id2" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Attribute name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>type (mandatory, string)</p></td>
<td><p>Can be <code class="docutils literal notranslate"><span class="pre">local</span></code>, <code class="docutils literal notranslate"><span class="pre">buildcache</span></code>, or <code class="docutils literal notranslate"><span class="pre">external</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>include (optional, list of specs)</p></td>
<td><p>If present, reusable specs must match at least one of the constraint in the list</p></td>
</tr>
<tr class="row-even"><td><p>exclude (optional, list of specs)</p></td>
<td><p>If present, reusable specs must not match any of the constraint in the list.</p></td>
</tr>
</tbody>
</table>
<p>For instance, the following configuration:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">concretizer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">reuse</span><span class="p">:</span>
<span class="w">    </span><span class="nt">roots</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">from</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<span class="w">      </span><span class="nt">include</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;%gcc&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;%clang&quot;</span>
</pre></div>
</div>
<p>tells the concretizer to reuse all specs compiled with either <code class="docutils literal notranslate"><span class="pre">gcc</span></code> or <code class="docutils literal notranslate"><span class="pre">clang</span></code>, that are installed
in the local store. Any spec from remote buildcaches is disregarded.</p>
<p>To reduce the boilerplate in configuration files, default values for the <code class="docutils literal notranslate"><span class="pre">include</span></code> and
<code class="docutils literal notranslate"><span class="pre">exclude</span></code> options can be pushed up one level:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">concretizer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">reuse</span><span class="p">:</span>
<span class="w">    </span><span class="nt">roots</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">include</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;%gcc&quot;</span>
<span class="w">    </span><span class="nt">from</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">buildcache</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<span class="w">      </span><span class="nt">include</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;foo</span><span class="nv"> </span><span class="s">%oneapi&quot;</span>
</pre></div>
</div>
<p>In the example above we reuse all specs compiled with <code class="docutils literal notranslate"><span class="pre">gcc</span></code> from the local store
and remote buildcaches, and we also reuse <code class="docutils literal notranslate"><span class="pre">foo</span> <span class="pre">%oneapi</span></code>. Note that the last source of
specs override the default <code class="docutils literal notranslate"><span class="pre">include</span></code> attribute.</p>
<p>For one-off concretizations, the are command line arguments for each of the simple “single value”
configurations. This means a user can:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">% </span>spack<span class="w"> </span>install<span class="w"> </span>--reuse<span class="w"> </span>&lt;spec&gt;
</pre></div>
</div>
<p>to enable reuse for a single installation, or:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">spack install --fresh &lt;spec&gt;</span>
</pre></div>
</div>
<p>to do a fresh install if <code class="docutils literal notranslate"><span class="pre">reuse</span></code> is enabled by default.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>FAQ: <a class="reference internal" href="frequently_asked_questions.html#faq-concretizer-precedence"><span class="std std-ref">Why does Spack pick particular versions and variants?</span></a></p>
</div>
</section>
<section id="selection-of-the-target-microarchitectures">
<h2>Selection of the target microarchitectures<a class="headerlink" href="#selection-of-the-target-microarchitectures" title="Link to this heading"></a></h2>
<p>The options under the <code class="docutils literal notranslate"><span class="pre">targets</span></code> attribute control which targets are considered during a solve.
Currently the options in this section are only configurable from the <code class="docutils literal notranslate"><span class="pre">concretizer.yaml</span></code> file
and there are no corresponding command line arguments to enable them for a single solve.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">granularity</span></code> option can take two possible values: <code class="docutils literal notranslate"><span class="pre">microarchitectures</span></code> and <code class="docutils literal notranslate"><span class="pre">generic</span></code>.
If set to:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">concretizer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">targets</span><span class="p">:</span>
<span class="w">    </span><span class="nt">granularity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">microarchitectures</span>
</pre></div>
</div>
<p>Spack will consider all the microarchitectures known to <code class="docutils literal notranslate"><span class="pre">archspec</span></code> to label nodes for
compatibility. If instead the option is set to:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">concretizer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">targets</span><span class="p">:</span>
<span class="w">    </span><span class="nt">granularity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">generic</span>
</pre></div>
</div>
<p>Spack will consider only generic microarchitectures. For instance, when running on an
Haswell node, Spack will consider <code class="docutils literal notranslate"><span class="pre">haswell</span></code> as the best target in the former case and
<code class="docutils literal notranslate"><span class="pre">x86_64_v3</span></code> as the best target in the latter case.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">host_compatible</span></code> option is a Boolean option that determines whether or not the
microarchitectures considered during the solve are constrained to be compatible with the
host Spack is currently running on. For instance, if this option is set to <code class="docutils literal notranslate"><span class="pre">true</span></code>, a
user cannot concretize for <code class="docutils literal notranslate"><span class="pre">target=icelake</span></code> while running on an Haswell node.</p>
</section>
<section id="duplicate-nodes">
<h2>Duplicate nodes<a class="headerlink" href="#duplicate-nodes" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">duplicates</span></code> attribute controls whether the DAG can contain multiple configurations of
the same package. This is mainly relevant for build dependencies, which may have their version
pinned by some nodes, and thus be required at different versions by different nodes in the same
DAG.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">strategy</span></code> option controls how the solver deals with duplicates. If the value is <code class="docutils literal notranslate"><span class="pre">none</span></code>,
then a single configuration per package is allowed in the DAG. This means, for instance, that only
a single <code class="docutils literal notranslate"><span class="pre">cmake</span></code> or a single <code class="docutils literal notranslate"><span class="pre">py-setuptools</span></code> version is allowed. The result would be a slightly
faster concretization, at the expense of making a few specs unsolvable.</p>
<p>If the value is <code class="docutils literal notranslate"><span class="pre">minimal</span></code> Spack will allow packages tagged as <code class="docutils literal notranslate"><span class="pre">build-tools</span></code> to have duplicates.
This allows, for instance, to concretize specs whose nodes require different, and incompatible, ranges
of some build tool. For instance, in the figure below the latest <cite>py-shapely</cite> requires a newer <cite>py-setuptools</cite>,
while <cite>py-numpy</cite> still needs an older version:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/shapely_duplicates.svg"><img alt="_images/shapely_duplicates.svg" src="_images/shapely_duplicates.svg" style="width: 62495.99999999999px; height: 20630.399999999998px;" />
</a>
</figure>
<p>Up to Spack v0.20 <code class="docutils literal notranslate"><span class="pre">duplicates:strategy:none</span></code> was the default (and only) behavior. From Spack v0.21 the
default behavior is <code class="docutils literal notranslate"><span class="pre">duplicates:strategy:minimal</span></code>.</p>
</section>
<section id="splicing">
<h2>Splicing<a class="headerlink" href="#splicing" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">splice</span></code> key covers config attributes for splicing specs in the solver.</p>
<p>“Splicing” is a method for replacing a dependency with another spec
that provides the same package or virtual. There are two types of
splices, referring to different behaviors for shared dependencies
between the root spec and the new spec replacing a dependency:
“transitive” and “intransitive”. A “transitive” splice is one that
resolves all conflicts by taking the dependency from the new node. An
“intransitive” splice is one that resolves all conflicts by taking the
dependency from the original root. From a theory perspective, hybrid
splices are possible but are not modeled by Spack.</p>
<p>All spliced specs retain a <code class="docutils literal notranslate"><span class="pre">build_spec</span></code> attribute that points to the
original Spec before any splice occurred. The <code class="docutils literal notranslate"><span class="pre">build_spec</span></code> for a
non-spliced spec is itself.</p>
<p>The figure below shows examples of transitive and intransitive splices:</p>
<figure class="align-center">
<img alt="_images/splices.png" src="_images/splices.png" />
</figure>
<p>The concretizer can be configured to explicitly splice particular
replacements for a target spec. Splicing will allow the user to make
use of generically built public binary caches, while swapping in
highly optimized local builds for performance critical components
and/or components that interact closely with the specific hardware
details of the system. The most prominent candidate for splicing is
MPI providers. MPI packages have relatively well-understood ABI
characteristics, and most High Performance Computing facilities deploy
highly optimized MPI packages tailored to their particular
hardware. The following config block configures Spack to replace
whatever MPI provider each spec was concretized to use with the
particular package of <code class="docutils literal notranslate"><span class="pre">mpich</span></code> with the hash that begins <code class="docutils literal notranslate"><span class="pre">abcdef</span></code>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">concretizer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">splice</span><span class="p">:</span>
<span class="w">    </span><span class="nt">explicit</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mpi</span>
<span class="w">      </span><span class="nt">replacement</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mpich/abcdef</span>
<span class="w">      </span><span class="nt">transitive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When configuring an explicit splice, you as the user take on the
responsibility for ensuring ABI compatibility between the specs
matched by the target and the replacement you provide. If they are
not compatible, Spack will not warn you and your application will
fail to run.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">target</span></code> field of an explicit splice can be any abstract
spec. The <code class="docutils literal notranslate"><span class="pre">replacement</span></code> field must be a spec that includes the hash
of a concrete spec, and the replacement must either be the same
package as the target, provide the virtual that is the target, or
provide a virtual that the target provides. The <code class="docutils literal notranslate"><span class="pre">transitive</span></code> field
is optional – by default, splices will be transitive.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>With explicit splices configured, it is possible for Spack to
concretize to a spec that does not satisfy the input. For example,
with the config above <code class="docutils literal notranslate"><span class="pre">hdf5</span> <span class="pre">^mvapich2</span></code> will concretize to user
<code class="docutils literal notranslate"><span class="pre">mpich/abcdef</span></code> instead of <code class="docutils literal notranslate"><span class="pre">mvapich2</span></code> as the MPI provider. Spack
will warn the user in this case, but will not fail the
concretization.</p>
</div>
<section id="automatic-splicing">
<span id="id1"></span><h3>Automatic Splicing<a class="headerlink" href="#automatic-splicing" title="Link to this heading"></a></h3>
<p>The Spack solver can be configured to do automatic splicing for
ABI-compatible packages. Automatic splices are enabled in the concretizer
config section</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">concretizer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">splice</span><span class="p">:</span>
<span class="w">    </span><span class="nt">automatic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
<p>Packages can include ABI-compatibility information using the
<code class="docutils literal notranslate"><span class="pre">can_splice</span></code> directive. See <a class="reference internal" href="packaging_guide.html#abi-compatibility"><span class="std std-ref">the packaging
guide</span></a> for instructions on specifying ABI
compatibility using the <code class="docutils literal notranslate"><span class="pre">can_splice</span></code> directive.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">can_splice</span></code> directive is experimental and may be changed in
future versions.</p>
</div>
<p>When automatic splicing is enabled, the concretizer will combine any
number of ABI-compatible specs if possible to reuse installed packages
and packages available from binary caches. The end result of these
specs is equivalent to a series of transitive/intransitive splices,
but the series may be non-obvious.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="packages_yaml.html" class="btn btn-neutral float-left" title="Package Settings (packages.yaml)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="environments.html" class="btn btn-neutral float-right" title="Environments (spack.yaml, spack.lock)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2023, Lawrence Livermore National Laboratory..
      <span class="lastupdated">Last updated on Sep 20, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>