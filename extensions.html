

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Custom Extensions &mdash; Spack 0.23.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5f00b823" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=832b3b9f"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="CI Pipelines" href="pipelines.html" />
    <link rel="prev" title="Chaining Spack Installations (upstreams.yaml)" href="chain.html" /> 
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S0PQ7WV75K"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S0PQ7WV75K');
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/spack-logo-white-text.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="features.html">Feature Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="replace_conda_homebrew.html">Spack for Homebrew/Conda Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="frequently_asked_questions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://spack-tutorial.readthedocs.io">Tutorial (spack-tutorial.rtfd.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://packages.spack.io">Packages (packages.spack.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cache.spack.io">Binaries (binaries.spack.io)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="config_yaml.html">Spack Settings (config.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="packages_yaml.html">Package Settings (packages.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_settings.html">Concretization Settings (concretizer.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="environments.html">Environments (spack.yaml, spack.lock)</a></li>
<li class="toctree-l1"><a class="reference internal" href="containers.html">Container Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="mirrors.html">Mirrors (mirrors.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_file_support.html">Modules (modules.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="repositories.html">Package Repositories (repos.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="binary_caches.html">Build Caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootstrapping.html">Bootstrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html">Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="chain.html">Chaining Spack Installations (upstreams.yaml)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Custom Extensions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configure-spack-to-use-extensions">Configure Spack to Use Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#registering-extensions-via-entry-points">Registering Extensions via Entry Points</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pipelines.html">CI Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="signing.html">Spack Package Signing</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu_configuration.html">Using External GPU Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contribution_guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="packaging_guide.html">Packaging Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_systems.html">Build Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer_guide.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="spack.html">Spack API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="llnl.html">LLNL API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Spack</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Custom Extensions</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/extensions.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="custom-extensions">
<h1>Custom Extensions<a class="headerlink" href="#custom-extensions" title="Link to this heading"></a></h1>
<p><em>Spack extensions</em> allow you to extend Spack capabilities by deploying your
own custom commands or logic in an arbitrary location on your filesystem.
This might be extremely useful e.g. to develop and maintain a command whose purpose is
too specific to be considered for reintegration into the mainline or to
evolve a command through its early stages before starting a discussion to merge
it upstream.</p>
<p>From Spack’s point of view an extension is any path in your filesystem which
respects the following naming and layout for files:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">spack-scripting/ # The top level directory must match the format &#39;spack-{extension_name}&#39;</span>
<span class="go">├── pytest.ini # Optional file if the extension ships its own tests</span>
<span class="go">├── scripting # Folder that may contain modules that are needed for the extension commands</span>
<span class="go">│   ├── cmd # Folder containing extension commands</span>
<span class="go">│   │   └── filter.py # A new command that will be available</span>
<span class="go">│   └── functions.py # Module with internal details</span>
<span class="go">└── tests # Tests for this extension</span>
<span class="go">│   ├── conftest.py</span>
<span class="go">│   └── test_filter.py</span>
<span class="go">└── templates # Templates that may be needed by the extension</span>
</pre></div>
</div>
<p>In the example above, the extension is named <em>scripting</em>. It adds an additional command
(<code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">filter</span></code>) and unit tests to verify its behavior.</p>
<p>The extension can import any core Spack module in its implementation. When loaded by
the <code class="docutils literal notranslate"><span class="pre">spack</span></code> command, the extension itself is imported as a Python package in the
<code class="docutils literal notranslate"><span class="pre">spack.extensions</span></code> namespace. In the example above, since the extension is named
“scripting”, the corresponding Python module is <code class="docutils literal notranslate"><span class="pre">spack.extensions.scripting</span></code>.</p>
<p>The code for this example extension can be obtained by cloning the corresponding git repository:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>-C<span class="w"> </span>/tmp<span class="w"> </span>clone<span class="w"> </span>https://github.com/spack/spack-scripting.git
</pre></div>
</div>
<section id="configure-spack-to-use-extensions">
<h2>Configure Spack to Use Extensions<a class="headerlink" href="#configure-spack-to-use-extensions" title="Link to this heading"></a></h2>
<p>To make your current Spack instance aware of extensions you should add their root
paths to <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>. In the case of our example this means ensuring that:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">config</span><span class="p">:</span>
<span class="w">  </span><span class="nt">extensions</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/spack-scripting</span>
</pre></div>
</div>
<p>is part of your configuration file. Once this is setup any command that the extension provides
will be available from the command line:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>filter<span class="w"> </span>--help
<span class="go">usage: spack filter [-h] [--installed | --not-installed]</span>
<span class="go">                    [--explicit | --implicit] [--output OUTPUT]</span>
<span class="go">                    ...</span>

<span class="go">filter specs based on their properties</span>

<span class="go">positional arguments:</span>
<span class="go">  specs            specs to be filtered</span>

<span class="go">optional arguments:</span>
<span class="go">  -h, --help       show this help message and exit</span>
<span class="go">  --installed      select installed specs</span>
<span class="go">  --not-installed  select specs that are not yet installed</span>
<span class="go">  --explicit       select specs that were installed explicitly</span>
<span class="go">  --implicit       select specs that are not installed or were installed implicitly</span>
<span class="go">  --output OUTPUT  where to dump the result</span>
</pre></div>
</div>
<p>The corresponding unit tests can be run giving the appropriate options to <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">unit-test</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>unit-test<span class="w"> </span>--extension<span class="o">=</span>scripting
<span class="go">========================================== test session starts ===========================================</span>
<span class="go">platform linux -- Python 3.11.5, pytest-7.4.3, pluggy-1.3.0</span>
<span class="go">rootdir: /home/culpo/github/spack-scripting</span>
<span class="go">configfile: pytest.ini</span>
<span class="go">testpaths: tests</span>
<span class="go">plugins: xdist-3.5.0</span>
<span class="go">collected 5 items</span>

<span class="go">tests/test_filter.py .....                                                                         [100%]</span>

<span class="go">========================================== slowest 30 durations ==========================================</span>
<span class="go">2.31s setup    tests/test_filter.py::test_filtering_specs[kwargs0-specs0-expected0]</span>
<span class="go">0.57s call     tests/test_filter.py::test_filtering_specs[kwargs2-specs2-expected2]</span>
<span class="go">0.56s call     tests/test_filter.py::test_filtering_specs[kwargs4-specs4-expected4]</span>
<span class="go">0.54s call     tests/test_filter.py::test_filtering_specs[kwargs3-specs3-expected3]</span>
<span class="go">0.54s call     tests/test_filter.py::test_filtering_specs[kwargs1-specs1-expected1]</span>
<span class="go">0.48s call     tests/test_filter.py::test_filtering_specs[kwargs0-specs0-expected0]</span>
<span class="go">0.01s setup    tests/test_filter.py::test_filtering_specs[kwargs4-specs4-expected4]</span>
<span class="go">0.01s setup    tests/test_filter.py::test_filtering_specs[kwargs2-specs2-expected2]</span>
<span class="go">0.01s setup    tests/test_filter.py::test_filtering_specs[kwargs1-specs1-expected1]</span>
<span class="go">0.01s setup    tests/test_filter.py::test_filtering_specs[kwargs3-specs3-expected3]</span>

<span class="gp gp-VirtualEnv">(5 durations &lt; 0.005s hidden.  Use -vv to show these durations.)</span>
<span class="go">=========================================== 5 passed in 5.06s ============================================</span>
</pre></div>
</div>
</section>
<section id="registering-extensions-via-entry-points">
<h2>Registering Extensions via Entry Points<a class="headerlink" href="#registering-extensions-via-entry-points" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Python version &gt;= 3.8 is required to register extensions via entry points.</p>
</div>
<p>Spack can be made aware of extensions that are installed as part of a python package.  To do so, register a function that returns the extension path, or paths, to the <code class="docutils literal notranslate"><span class="pre">&quot;spack.extensions&quot;</span></code> entry point.  Consider the Python package <code class="docutils literal notranslate"><span class="pre">my_package</span></code> that includes a Spack extension:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">my-package/</span>
<span class="go">├── src</span>
<span class="go">│   ├── my_package</span>
<span class="go">│   │   └── __init__.py</span>
<span class="go">│   └── spack-scripting/  # the spack extensions</span>
<span class="go">└── pyproject.toml</span>
</pre></div>
</div>
<p>adding the following to <code class="docutils literal notranslate"><span class="pre">my_package</span></code>’s <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> will make the <code class="docutils literal notranslate"><span class="pre">spack-scripting</span></code> extension visible to Spack when <code class="docutils literal notranslate"><span class="pre">my_package</span></code> is installed:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[project.entry_points.</span><span class="s2">&quot;spack.extenions&quot;</span><span class="k">]</span>
<span class="n">my_package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;my_package:get_extension_path&quot;</span>
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">my_package.get_extension_path</span></code> in <code class="docutils literal notranslate"><span class="pre">my_package/__init__.py</span></code> might look like</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">importlib.resources</span>

<span class="k">def</span> <span class="nf">get_extension_path</span><span class="p">():</span>
    <span class="n">dirname</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">files</span><span class="p">(</span><span class="s2">&quot;my_package&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;spack-scripting&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dirname</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="chain.html" class="btn btn-neutral float-left" title="Chaining Spack Installations (upstreams.yaml)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="pipelines.html" class="btn btn-neutral float-right" title="CI Pipelines" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2023, Lawrence Livermore National Laboratory..
      <span class="lastupdated">Last updated on Sep 20, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>