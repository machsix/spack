

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>spack.variant &mdash; Spack 0.23.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=5f00b823" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=832b3b9f"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S0PQ7WV75K"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S0PQ7WV75K');
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/spack-logo-white-text.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Feature Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../basic_usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../replace_conda_homebrew.html">Spack for Homebrew/Conda Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../frequently_asked_questions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://spack-tutorial.readthedocs.io">Tutorial (spack-tutorial.rtfd.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://packages.spack.io">Packages (packages.spack.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cache.spack.io">Binaries (binaries.spack.io)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../configuration.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../config_yaml.html">Spack Settings (config.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../packages_yaml.html">Package Settings (packages.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build_settings.html">Concretization Settings (concretizer.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../environments.html">Environments (spack.yaml, spack.lock)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../containers.html">Container Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mirrors.html">Mirrors (mirrors.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_file_support.html">Modules (modules.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../repositories.html">Package Repositories (repos.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../binary_caches.html">Build Caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bootstrapping.html">Bootstrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../command_index.html">Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chain.html">Chaining Spack Installations (upstreams.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extensions.html">Custom Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pipelines.html">CI Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../signing.html">Spack Package Signing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu_configuration.html">Using External GPU Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contribution_guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../packaging_guide.html">Packaging Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build_systems.html">Build Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../spack.html">Spack API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../llnl.html">LLNL API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Spack</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../spack.html">spack</a></li>
      <li class="breadcrumb-item active">spack.variant</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for spack.variant</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2013-2024 Lawrence Livermore National Security, LLC and other</span>
<span class="c1"># Spack Project Developers. See the top-level COPYRIGHT file for details.</span>
<span class="c1">#</span>
<span class="c1"># SPDX-License-Identifier: (Apache-2.0 OR MIT)</span>

<span class="sd">&quot;&quot;&quot;The variant module contains data structures that are needed to manage</span>
<span class="sd">variants both in packages and in specs.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">collections.abc</span>
<span class="kn">import</span> <span class="nn">enum</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Collection</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">llnl.util.lang</span> <span class="k">as</span> <span class="nn">lang</span>
<span class="kn">import</span> <span class="nn">llnl.util.tty.color</span>

<span class="kn">import</span> <span class="nn">spack.error</span> <span class="k">as</span> <span class="nn">error</span>
<span class="kn">import</span> <span class="nn">spack.parser</span>
<span class="kn">import</span> <span class="nn">spack.spec</span>

<span class="c1">#: These are variant names used by Spack internally; packages can&#39;t use them</span>
<span class="n">reserved_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;arch&quot;</span><span class="p">,</span>
    <span class="s2">&quot;architecture&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dev_path&quot;</span><span class="p">,</span>
    <span class="s2">&quot;namespace&quot;</span><span class="p">,</span>
    <span class="s2">&quot;operating_system&quot;</span><span class="p">,</span>
    <span class="s2">&quot;os&quot;</span><span class="p">,</span>
    <span class="s2">&quot;patches&quot;</span><span class="p">,</span>
    <span class="s2">&quot;platform&quot;</span><span class="p">,</span>
    <span class="s2">&quot;target&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">special_variant_values</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="VariantType">
<a class="viewcode-back" href="../../spack.html#spack.variant.VariantType">[docs]</a>
<span class="k">class</span> <span class="nc">VariantType</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enum representing the three concrete variant types.&quot;&quot;&quot;</span>

    <span class="n">MULTI</span> <span class="o">=</span> <span class="s2">&quot;multi&quot;</span>
    <span class="n">BOOL</span> <span class="o">=</span> <span class="s2">&quot;bool&quot;</span>
    <span class="n">SINGLE</span> <span class="o">=</span> <span class="s2">&quot;single&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">variant_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">MULTI</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MultiValuedVariant</span>
        <span class="k">elif</span> <span class="bp">self</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">BOOL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">BoolValuedVariant</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SingleValuedVariant</span></div>



<div class="viewcode-block" id="Variant">
<a class="viewcode-back" href="../../spack.html#spack.variant.Variant">[docs]</a>
<span class="k">class</span> <span class="nc">Variant</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a variant definition, created by the ``variant()`` directive.</span>

<span class="sd">    There can be multiple definitions of the same variant, and they are given precedence</span>
<span class="sd">    by order of appearance in the package. Later definitions have higher precedence.</span>
<span class="sd">    Similarly, definitions in derived classes have higher precedence than those in their</span>
<span class="sd">    superclasses.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">default</span><span class="p">:</span> <span class="n">Any</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Collection</span><span class="p">]</span>  <span class="c1">#: if None, valid values are defined only by validators</span>
    <span class="n">multi</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">single_value_validator</span><span class="p">:</span> <span class="n">Callable</span>
    <span class="n">group_validator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span>
    <span class="n">sticky</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">precedence</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">default</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">values</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Collection</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="n">multi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">validator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sticky</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">precedence</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a package variant.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: name of the variant</span>
<span class="sd">            default: default value for the variant, used when nothing is explicitly specified</span>
<span class="sd">            description: purpose of the variant</span>
<span class="sd">            values: sequence of allowed values or a callable accepting a single value as argument</span>
<span class="sd">                and returning True if the value is good, False otherwise</span>
<span class="sd">            multi: whether multiple values are allowed</span>
<span class="sd">            validator: optional callable that can be used to perform additional validation</span>
<span class="sd">            sticky: if true the variant is set to the default value at concretization time</span>
<span class="sd">            precedence: int indicating precedence of this variant definition in the solve</span>
<span class="sd">                (definition with highest precedence is used when multiple definitions are possible)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">values</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
            <span class="c1"># wildcard is a special case to make it easy to say any value is ok</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">single_value_validator</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
            <span class="c1"># supplying a type means any value *of that type*</span>
            <span class="k">def</span> <span class="nf">isa_type</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">values</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">single_value_validator</span> <span class="o">=</span> <span class="n">isa_type</span>

        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="c1"># If &#39;values&#39; is a callable, assume it is a single value</span>
            <span class="c1"># validator and reset the values to be explicit during debug</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">single_value_validator</span> <span class="o">=</span> <span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Otherwise, assume values is the set of allowed explicit values</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">_flatten</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">single_value_validator</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">multi</span> <span class="o">=</span> <span class="n">multi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_validator</span> <span class="o">=</span> <span class="n">validator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sticky</span> <span class="o">=</span> <span class="n">sticky</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precedence</span> <span class="o">=</span> <span class="n">precedence</span>

<div class="viewcode-block" id="Variant.validate_or_raise">
<a class="viewcode-back" href="../../spack.html#spack.variant.Variant.validate_or_raise">[docs]</a>
    <span class="k">def</span> <span class="nf">validate_or_raise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vspec</span><span class="p">:</span> <span class="s2">&quot;AbstractVariant&quot;</span><span class="p">,</span> <span class="n">pkg_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate a variant spec against this package variant. Raises an</span>
<span class="sd">        exception if any error is found.</span>

<span class="sd">        Args:</span>
<span class="sd">            vspec: variant spec to be validated</span>
<span class="sd">            pkg_name: the name of the package class that required this validation (for errors)</span>

<span class="sd">        Raises:</span>
<span class="sd">            InconsistentValidationError: if ``vspec.name != self.name``</span>

<span class="sd">            MultipleValuesInExclusiveVariantError: if ``vspec`` has</span>
<span class="sd">                multiple values but ``self.multi == False``</span>

<span class="sd">            InvalidVariantValueError: if ``vspec.value`` contains</span>
<span class="sd">                invalid values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check the name of the variant</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">vspec</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InconsistentValidationError</span><span class="p">(</span><span class="n">vspec</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c1"># If the value is exclusive there must be at most one</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">vspec</span><span class="o">.</span><span class="n">value_as_tuple</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">multi</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MultipleValuesInExclusiveVariantError</span><span class="p">(</span><span class="n">vspec</span><span class="p">,</span> <span class="n">pkg_name</span><span class="p">)</span>

        <span class="c1"># Check and record the values that are not allowed</span>
        <span class="n">invalid_vals</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span> <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="s2">&quot;*&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_value_validator</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">invalid_vals</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidVariantValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;invalid values for variant &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; in package </span><span class="si">{</span><span class="n">pkg_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">invalid_vals</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Validate the group of values if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_validator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">!=</span> <span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_validator</span><span class="p">(</span><span class="n">pkg_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">allowed_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a string representation of the allowed values for</span>
<span class="sd">        printing purposes</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: representation of the allowed values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Join an explicit set of allowed values</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="c1"># In case we were given a single-value validator</span>
        <span class="c1"># print the docstring</span>
        <span class="n">docstring</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getdoc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">single_value_validator</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">docstring</span> <span class="k">if</span> <span class="n">docstring</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="n">v</span>

<div class="viewcode-block" id="Variant.make_default">
<a class="viewcode-back" href="../../spack.html#spack.variant.Variant.make_default">[docs]</a>
    <span class="k">def</span> <span class="nf">make_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Factory that creates a variant holding the default value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MultiValuedVariant or SingleValuedVariant or BoolValuedVariant:</span>
<span class="sd">                instance of the proper variant</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_variant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span></div>


<div class="viewcode-block" id="Variant.make_variant">
<a class="viewcode-back" href="../../spack.html#spack.variant.Variant.make_variant">[docs]</a>
    <span class="k">def</span> <span class="nf">make_variant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AbstractVariant&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Factory that creates a variant holding the value passed as</span>
<span class="sd">        a parameter.</span>

<span class="sd">        Args:</span>
<span class="sd">            value: value that will be hold by the variant</span>

<span class="sd">        Returns:</span>
<span class="sd">            MultiValuedVariant or SingleValuedVariant or BoolValuedVariant:</span>
<span class="sd">                instance of the proper variant</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variant_type</span><span class="o">.</span><span class="n">variant_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">variant_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VariantType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;String representation of the type of this variant (single/multi/bool)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multi</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">VariantType</span><span class="o">.</span><span class="n">MULTI</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">VariantType</span><span class="o">.</span><span class="n">BOOL</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">VariantType</span><span class="o">.</span><span class="n">SINGLE</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Variant(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;default=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="si">}</span><span class="s2">&#39;, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;description=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&#39;, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;values=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;multi=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">multi</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;single_value_validator=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">single_value_validator</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;group_validator=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">group_validator</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;sticky=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sticky</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;precedence=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">precedence</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="implicit_variant_conversion">
<a class="viewcode-back" href="../../spack.html#spack.variant.implicit_variant_conversion">[docs]</a>
<span class="k">def</span> <span class="nf">implicit_variant_conversion</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts other to type(self) and calls method(self, other)</span>

<span class="sd">    Args:</span>
<span class="sd">        method: any predicate method that takes another variant as an argument</span>

<span class="sd">    Returns: decorated method</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># We don&#39;t care if types are different as long as I can convert other to type(self)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">other</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">other</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_original_value</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="n">other</span><span class="o">.</span><span class="n">propagate</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">SpecError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">convert</span></div>



<span class="k">def</span> <span class="nf">_flatten</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flatten instances of _ConditionalVariantValues for internal representation&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">DisjointSetsOfValues</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="n">flattened</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ConditionalVariantValues</span><span class="p">):</span>
            <span class="n">flattened</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flattened</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="c1"># There are parts of the variant checking mechanism that expect to find tuples</span>
    <span class="c1"># here, so it is important to convert the type once we flattened the values.</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">flattened</span><span class="p">)</span>


<span class="c1">#: Type for value of a variant</span>
<span class="n">ValueType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="o">...</span><span class="p">]]</span>

<span class="c1">#: Type of variant value when output for JSON, YAML, etc.</span>
<span class="n">SerializedValueType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]]</span>


<div class="viewcode-block" id="AbstractVariant">
<a class="viewcode-back" href="../../spack.html#spack.variant.AbstractVariant">[docs]</a>
<span class="nd">@lang</span><span class="o">.</span><span class="n">lazy_lexicographic_ordering</span>
<span class="k">class</span> <span class="nc">AbstractVariant</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A variant that has not yet decided who it wants to be. It behaves like</span>
<span class="sd">    a multi valued variant which **could** do things.</span>

<span class="sd">    This kind of variant is generated during parsing of expressions like</span>
<span class="sd">    ``foo=bar`` and differs from multi valued variants because it will</span>
<span class="sd">    satisfy any other variant with the same name. This is because it **could**</span>
<span class="sd">    do it if it grows up to be a multi valued variant with the right set of</span>
<span class="sd">    values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">propagate</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">_value</span><span class="p">:</span> <span class="n">ValueType</span>
    <span class="n">_original_value</span><span class="p">:</span> <span class="n">Any</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">propagate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="n">propagate</span>

        <span class="c1"># Invokes property setter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="AbstractVariant.from_node_dict">
<a class="viewcode-back" href="../../spack.html#spack.variant.AbstractVariant.from_node_dict">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_node_dict</span><span class="p">(</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="o">*</span><span class="p">,</span> <span class="n">propagate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AbstractVariant&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reconstruct a variant from a node dict.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># read multi-value variants in and be faithful to the YAML</span>
            <span class="n">mvar</span> <span class="o">=</span> <span class="n">MultiValuedVariant</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(),</span> <span class="n">propagate</span><span class="o">=</span><span class="n">propagate</span><span class="p">)</span>
            <span class="n">mvar</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">mvar</span><span class="o">.</span><span class="n">_original_value</span> <span class="o">=</span> <span class="n">mvar</span><span class="o">.</span><span class="n">_value</span>
            <span class="k">return</span> <span class="n">mvar</span>

        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TRUE&quot;</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;FALSE&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">BoolValuedVariant</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="n">propagate</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">SingleValuedVariant</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="n">propagate</span><span class="p">)</span></div>


<div class="viewcode-block" id="AbstractVariant.yaml_entry">
<a class="viewcode-back" href="../../spack.html#spack.variant.AbstractVariant.yaml_entry">[docs]</a>
    <span class="k">def</span> <span class="nf">yaml_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SerializedValueType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a key, value tuple suitable to be an entry in a yaml dict.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: (name, value_representation)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_as_tuple</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value_as_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter for self.value that always returns a Tuple (even for single valued variants).</span>

<span class="sd">        This makes it easy to iterate over possible values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ValueType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a tuple of strings containing the values stored in</span>
<span class="sd">        the variant.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: values stored in the variant</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value_setter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_value_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Store the original value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_value</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="c1"># Store a tuple of CSV string representations</span>
            <span class="c1"># Tuple is necessary here instead of list because the</span>
            <span class="c1"># values need to be hashed</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*,\s*&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">special_variant_values</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; cannot be combined with other variant&quot;</span> <span class="o">%</span> <span class="n">val</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; values.&quot;</span>
                <span class="k">raise</span> <span class="n">InvalidVariantValueCombinationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># With multi-value variants it is necessary</span>
        <span class="c1"># to remove duplicates and give an order</span>
        <span class="c1"># to a set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_cmp_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">:</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagate</span>
        <span class="k">yield from</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_as_tuple</span><span class="p">)</span>

<div class="viewcode-block" id="AbstractVariant.copy">
<a class="viewcode-back" href="../../spack.html#spack.variant.AbstractVariant.copy">[docs]</a>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AbstractVariant&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an instance of a variant equivalent to self</span>

<span class="sd">        Returns:</span>
<span class="sd">            AbstractVariant: a copy of self</span>

<span class="sd">        &gt;&gt;&gt; a = MultiValuedVariant(&#39;foo&#39;, True)</span>
<span class="sd">        &gt;&gt;&gt; b = a.copy()</span>
<span class="sd">        &gt;&gt;&gt; assert a == b</span>
<span class="sd">        &gt;&gt;&gt; assert a is not b</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagate</span><span class="p">)</span></div>


<div class="viewcode-block" id="AbstractVariant.satisfies">
<a class="viewcode-back" href="../../spack.html#spack.variant.AbstractVariant.satisfies">[docs]</a>
    <span class="nd">@implicit_variant_conversion</span>
    <span class="k">def</span> <span class="nf">satisfies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;AbstractVariant&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns true if ``other.name == self.name``, because any value that</span>
<span class="sd">        other holds and is not in self yet **could** be added.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: constraint to be met for the method to return True</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If names are different then `self` does not satisfy `other`</span>
        <span class="c1"># (`foo=bar` will never satisfy `baz=bar`)</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>


<div class="viewcode-block" id="AbstractVariant.intersects">
<a class="viewcode-back" href="../../spack.html#spack.variant.AbstractVariant.intersects">[docs]</a>
    <span class="k">def</span> <span class="nf">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;AbstractVariant&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if there are variant matching both self and other, False otherwise.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">SingleValuedVariant</span><span class="p">,</span> <span class="n">BoolValuedVariant</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>


<div class="viewcode-block" id="AbstractVariant.compatible">
<a class="viewcode-back" href="../../spack.html#spack.variant.AbstractVariant.compatible">[docs]</a>
    <span class="k">def</span> <span class="nf">compatible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;AbstractVariant&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if self and other are compatible, False otherwise.</span>

<span class="sd">        As there is no semantic check, two VariantSpec are compatible if</span>
<span class="sd">        either they contain the same value or they are both multi-valued.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: instance against which we test compatibility</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If names are different then `self` is not compatible with `other`</span>
        <span class="c1"># (`foo=bar` is incompatible with `baz=bar`)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>


<div class="viewcode-block" id="AbstractVariant.constrain">
<a class="viewcode-back" href="../../spack.html#spack.variant.AbstractVariant.constrain">[docs]</a>
    <span class="nd">@implicit_variant_conversion</span>
    <span class="k">def</span> <span class="nf">constrain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;AbstractVariant&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Modify self to match all the constraints for other if both</span>
<span class="sd">        instances are multi-valued. Returns True if self changed,</span>
<span class="sd">        False otherwise.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: instance against which we constrain self</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;variants must have the same name&quot;</span><span class="p">)</span>

        <span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

        <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_as_tuple</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">value_as_tuple</span><span class="p">)))</span>
        <span class="c1"># If we constraint wildcard by another value, just take value</span>
        <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">values</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_value_setter</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagate</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">propagate</span>
        <span class="k">return</span> <span class="n">old_value</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span></div>


    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_as_tuple</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original_value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">delim</span> <span class="o">=</span> <span class="s2">&quot;==&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagate</span> <span class="k">else</span> <span class="s2">&quot;=&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">spack</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">quote_if_needed</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_as_tuple</span><span class="p">))</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}{</span><span class="n">delim</span><span class="si">}{</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="MultiValuedVariant">
<a class="viewcode-back" href="../../spack.html#spack.variant.MultiValuedVariant">[docs]</a>
<span class="k">class</span> <span class="nc">MultiValuedVariant</span><span class="p">(</span><span class="n">AbstractVariant</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A variant that can hold multiple values at once.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="MultiValuedVariant.satisfies">
<a class="viewcode-back" href="../../spack.html#spack.variant.MultiValuedVariant.satisfies">[docs]</a>
    <span class="nd">@implicit_variant_conversion</span>
    <span class="k">def</span> <span class="nf">satisfies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">AbstractVariant</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns true if ``other.name == self.name`` and ``other.value`` is</span>
<span class="sd">        a strict subset of self. Does not try to validate.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: constraint to be met for the method to return True</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">super_sat</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">super_sat</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">other</span> <span class="ow">or</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># allow prefix find on patches</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;patches&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span>
                <span class="nb">any</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_as_tuple</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">value_as_tuple</span>
            <span class="p">)</span>

        <span class="c1"># Otherwise we want all the values in `other` to be also in `self`</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">value_as_tuple</span><span class="p">)</span></div>


<div class="viewcode-block" id="MultiValuedVariant.append">
<a class="viewcode-back" href="../../spack.html#spack.variant.MultiValuedVariant.append">[docs]</a>
    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add another value to this multi-valued variant.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">((</span><span class="n">value</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_as_tuple</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_value</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Special-case patches to not print the full 64 character sha256</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;patches&quot;</span><span class="p">:</span>
            <span class="n">values_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[:</span><span class="mi">7</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_as_tuple</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">values_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_as_tuple</span><span class="p">)</span>

        <span class="n">delim</span> <span class="o">=</span> <span class="s2">&quot;==&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagate</span> <span class="k">else</span> <span class="s2">&quot;=&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}{</span><span class="n">delim</span><span class="si">}{</span><span class="n">spack</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">quote_if_needed</span><span class="p">(</span><span class="n">values_str</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="SingleValuedVariant">
<a class="viewcode-back" href="../../spack.html#spack.variant.SingleValuedVariant">[docs]</a>
<span class="k">class</span> <span class="nc">SingleValuedVariant</span><span class="p">(</span><span class="n">AbstractVariant</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A variant that can hold multiple values, but one at a time.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_value_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Treat the value as a multi-valued variant</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_value_setter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Then check if there&#39;s only a single value</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_as_tuple</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MultipleValuesInExclusiveVariantError</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<div class="viewcode-block" id="SingleValuedVariant.satisfies">
<a class="viewcode-back" href="../../spack.html#spack.variant.SingleValuedVariant.satisfies">[docs]</a>
    <span class="nd">@implicit_variant_conversion</span>
    <span class="k">def</span> <span class="nf">satisfies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;AbstractVariant&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">abstract_sat</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">abstract_sat</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="SingleValuedVariant.intersects">
<a class="viewcode-back" href="../../spack.html#spack.variant.SingleValuedVariant.intersects">[docs]</a>
    <span class="k">def</span> <span class="nf">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;AbstractVariant&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>


<div class="viewcode-block" id="SingleValuedVariant.compatible">
<a class="viewcode-back" href="../../spack.html#spack.variant.SingleValuedVariant.compatible">[docs]</a>
    <span class="k">def</span> <span class="nf">compatible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;AbstractVariant&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>


<div class="viewcode-block" id="SingleValuedVariant.constrain">
<a class="viewcode-back" href="../../spack.html#spack.variant.SingleValuedVariant.constrain">[docs]</a>
    <span class="nd">@implicit_variant_conversion</span>
    <span class="k">def</span> <span class="nf">constrain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;AbstractVariant&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;variants must have the same name&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnsatisfiableVariantSpecError</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagate</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">propagate</span>
        <span class="k">return</span> <span class="kc">False</span></div>


    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">ValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">item</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

<div class="viewcode-block" id="SingleValuedVariant.yaml_entry">
<a class="viewcode-back" href="../../spack.html#spack.variant.SingleValuedVariant.yaml_entry">[docs]</a>
    <span class="k">def</span> <span class="nf">yaml_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SerializedValueType</span><span class="p">]:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span></div>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">delim</span> <span class="o">=</span> <span class="s2">&quot;==&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagate</span> <span class="k">else</span> <span class="s2">&quot;=&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}{</span><span class="n">delim</span><span class="si">}{</span><span class="n">spack</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">quote_if_needed</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="BoolValuedVariant">
<a class="viewcode-back" href="../../spack.html#spack.variant.BoolValuedVariant">[docs]</a>
<span class="k">class</span> <span class="nc">BoolValuedVariant</span><span class="p">(</span><span class="n">SingleValuedVariant</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A variant that can hold either True or False.</span>

<span class="sd">    BoolValuedVariant can also hold the value &#39;*&#39;, for coerced</span>
<span class="sd">    comparisons between ``foo=*`` and ``+foo`` or ``~foo``.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_value_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Check the string representation of the value and turn</span>
        <span class="c1"># it to a boolean</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TRUE&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_original_value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;FALSE&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_original_value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_original_value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;cannot construct a BoolValuedVariant for &quot;</span><span class="si">{0}</span><span class="s1">&quot; from &#39;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;a value that does not represent a bool&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">ValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">item</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">sigil</span> <span class="o">=</span> <span class="s2">&quot;+&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;~&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagate</span><span class="p">:</span>
            <span class="n">sigil</span> <span class="o">*=</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sigil</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span></div>



<span class="c1"># The class below inherit from Sequence to disguise as a tuple and comply</span>
<span class="c1"># with the semantic expected by the &#39;values&#39; argument of the variant directive</span>
<div class="viewcode-block" id="DisjointSetsOfValues">
<a class="viewcode-back" href="../../spack.html#spack.variant.DisjointSetsOfValues">[docs]</a>
<span class="k">class</span> <span class="nc">DisjointSetsOfValues</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Allows combinations from one of many mutually exclusive sets.</span>

<span class="sd">    The value ``(&#39;none&#39;,)`` is reserved to denote the empty set</span>
<span class="sd">    and therefore no other set can contain the item ``&#39;none&#39;``.</span>

<span class="sd">    Args:</span>
<span class="sd">        *sets (list): mutually exclusive sets of values</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_empty_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;none&quot;</span><span class="p">,))</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">sets</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sets</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">_flatten</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sets</span><span class="p">]</span>

        <span class="c1"># &#39;none&#39; is a special value and can appear only in a set of</span>
        <span class="c1"># a single element</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;none&quot;</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;none&quot;</span><span class="p">,))</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">SpecError</span><span class="p">(</span>
                <span class="s2">&quot;The value &#39;none&#39; represents the empty set,&quot;</span>
                <span class="s2">&quot; and must appear alone in a set. Use the &quot;</span>
                <span class="s2">&quot;method &#39;allow_empty_set&#39; to add it.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Sets should not intersect with each other</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">s1</span> <span class="o">&amp;</span> <span class="n">s2</span> <span class="k">for</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">,</span> <span class="mi">2</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">SpecError</span><span class="p">(</span><span class="s2">&quot;sets in input must be disjoint&quot;</span><span class="p">)</span>

        <span class="c1">#: Attribute used to track values which correspond to</span>
        <span class="c1">#: features which can be enabled or disabled as understood by the</span>
        <span class="c1">#: package&#39;s build system.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multi</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_fmt</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;this variant accepts combinations of values from &quot;</span>
            <span class="s2">&quot;exactly one of the following sets &#39;</span><span class="si">{values}</span><span class="s2">&#39; &quot;</span>
            <span class="s2">&quot;@*r{{[</span><span class="si">{package}</span><span class="s2">, variant &#39;</span><span class="si">{variant}</span><span class="s2">&#39;]}}&quot;</span>
        <span class="p">)</span>

<div class="viewcode-block" id="DisjointSetsOfValues.with_default">
<a class="viewcode-back" href="../../spack.html#spack.variant.DisjointSetsOfValues.with_default">[docs]</a>
    <span class="k">def</span> <span class="nf">with_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the default value and returns self.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="DisjointSetsOfValues.with_error">
<a class="viewcode-back" href="../../spack.html#spack.variant.DisjointSetsOfValues.with_error">[docs]</a>
    <span class="k">def</span> <span class="nf">with_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_fmt</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the error message format and returns self.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_fmt</span> <span class="o">=</span> <span class="n">error_fmt</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="DisjointSetsOfValues.with_non_feature_values">
<a class="viewcode-back" href="../../spack.html#spack.variant.DisjointSetsOfValues.with_non_feature_values">[docs]</a>
    <span class="k">def</span> <span class="nf">with_non_feature_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marks a few values as not being tied to a feature.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="DisjointSetsOfValues.allow_empty_set">
<a class="viewcode-back" href="../../spack.html#spack.variant.DisjointSetsOfValues.allow_empty_set">[docs]</a>
    <span class="k">def</span> <span class="nf">allow_empty_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds the empty set to the current list of disjoint sets.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_empty_set</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="c1"># Create a new object to be returned</span>
        <span class="n">object_with_empty_set</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)((</span><span class="s2">&quot;none&quot;</span><span class="p">,),</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">)</span>
        <span class="n">object_with_empty_set</span><span class="o">.</span><span class="n">error_fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_fmt</span>
        <span class="n">object_with_empty_set</span><span class="o">.</span><span class="n">feature_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">,)</span>
        <span class="k">return</span> <span class="n">object_with_empty_set</span></div>


<div class="viewcode-block" id="DisjointSetsOfValues.prohibit_empty_set">
<a class="viewcode-back" href="../../spack.html#spack.variant.DisjointSetsOfValues.prohibit_empty_set">[docs]</a>
    <span class="k">def</span> <span class="nf">prohibit_empty_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes the empty set from the current list of disjoint sets.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_empty_set</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="c1"># Create a new object to be returned</span>
        <span class="n">sets</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span> <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_empty_set</span><span class="p">]</span>
        <span class="n">object_without_empty_set</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="o">*</span><span class="n">sets</span><span class="p">)</span>
        <span class="n">object_without_empty_set</span><span class="o">.</span><span class="n">error_fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_fmt</span>
        <span class="n">object_without_empty_set</span><span class="o">.</span><span class="n">feature_values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">object_without_empty_set</span></div>


    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">))[</span><span class="n">idx</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_disjoint_set_validator</span><span class="p">(</span><span class="n">pkg_name</span><span class="p">,</span> <span class="n">variant_name</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
            <span class="c1"># If for any of the sets, all the values are in it return True</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">):</span>
                <span class="k">return</span>

            <span class="n">format_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;variant&quot;</span><span class="p">:</span> <span class="n">variant_name</span><span class="p">,</span> <span class="s2">&quot;package&quot;</span><span class="p">:</span> <span class="n">pkg_name</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="n">values</span><span class="p">}</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_fmt</span> <span class="o">+</span> <span class="s2">&quot; @*r{{[</span><span class="si">{package}</span><span class="s2">, variant &#39;</span><span class="si">{variant}</span><span class="s2">&#39;]}}&quot;</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">llnl</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">tty</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">format_args</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">SpecError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_disjoint_set_validator</span></div>



<span class="k">def</span> <span class="nf">_a_single_value_or_a_combination</span><span class="p">(</span><span class="n">single_value</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">):</span>
    <span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;the value &#39;&quot;</span> <span class="o">+</span> <span class="n">single_value</span> <span class="o">+</span> <span class="s2">&quot;&#39; is mutually exclusive with any of the other values&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">DisjointSetsOfValues</span><span class="p">((</span><span class="n">single_value</span><span class="p">,),</span> <span class="n">values</span><span class="p">)</span>
        <span class="o">.</span><span class="n">with_default</span><span class="p">(</span><span class="n">single_value</span><span class="p">)</span>
        <span class="o">.</span><span class="n">with_error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="o">.</span><span class="n">with_non_feature_values</span><span class="p">(</span><span class="n">single_value</span><span class="p">)</span>
    <span class="p">)</span>


<span class="c1"># TODO: The factories below are used by package writers to set values of</span>
<span class="c1"># TODO: multi-valued variants. It could be worthwhile to gather them in</span>
<span class="c1"># TODO: a common namespace (like &#39;multi&#39;) in the future.</span>


<div class="viewcode-block" id="any_combination_of">
<a class="viewcode-back" href="../../spack.html#spack.variant.any_combination_of">[docs]</a>
<span class="k">def</span> <span class="nf">any_combination_of</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multi-valued variant that allows any combination of the specified</span>
<span class="sd">    values, and also allows the user to specify &#39;none&#39; (as a string) to choose</span>
<span class="sd">    none of them.</span>

<span class="sd">    It is up to the package implementation to handle the value &#39;none&#39;</span>
<span class="sd">    specially, if at all.</span>

<span class="sd">    Args:</span>
<span class="sd">        *values: allowed variant values</span>

<span class="sd">    Returns:</span>
<span class="sd">        a properly initialized instance of DisjointSetsOfValues</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_a_single_value_or_a_combination</span><span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">)</span></div>



<div class="viewcode-block" id="auto_or_any_combination_of">
<a class="viewcode-back" href="../../spack.html#spack.variant.auto_or_any_combination_of">[docs]</a>
<span class="k">def</span> <span class="nf">auto_or_any_combination_of</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multi-valued variant that allows any combination of a set of values</span>
<span class="sd">    (but not the empty set) or &#39;auto&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">        *values: allowed variant values</span>

<span class="sd">    Returns:</span>
<span class="sd">        a properly initialized instance of DisjointSetsOfValues</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_a_single_value_or_a_combination</span><span class="p">(</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">)</span></div>



<span class="c1">#: Multi-valued variant that allows any combination picking</span>
<span class="c1">#: from one of multiple disjoint sets</span>
<div class="viewcode-block" id="disjoint_sets">
<a class="viewcode-back" href="../../spack.html#spack.variant.disjoint_sets">[docs]</a>
<span class="k">def</span> <span class="nf">disjoint_sets</span><span class="p">(</span><span class="o">*</span><span class="n">sets</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multi-valued variant that allows any combination picking from one</span>
<span class="sd">    of multiple disjoint sets of values, and also allows the user to specify</span>
<span class="sd">    &#39;none&#39; (as a string) to choose none of them.</span>

<span class="sd">    It is up to the package implementation to handle the value &#39;none&#39;</span>
<span class="sd">    specially, if at all.</span>

<span class="sd">    Args:</span>
<span class="sd">        *sets:</span>

<span class="sd">    Returns:</span>
<span class="sd">        a properly initialized instance of DisjointSetsOfValues</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">DisjointSetsOfValues</span><span class="p">(</span><span class="o">*</span><span class="n">sets</span><span class="p">)</span><span class="o">.</span><span class="n">allow_empty_set</span><span class="p">()</span><span class="o">.</span><span class="n">with_default</span><span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="ConditionalValue">
<a class="viewcode-back" href="../../spack.html#spack.variant.ConditionalValue">[docs]</a>
<span class="nd">@functools</span><span class="o">.</span><span class="n">total_ordering</span>
<span class="k">class</span> <span class="nc">ConditionalValue</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Conditional value for a variant.&quot;&quot;&quot;</span>

    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span>

    <span class="c1"># optional because statically disabled values (when=False) are set to None</span>
    <span class="c1"># when=True results in spack.spec.Spec()</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;spack.spec.Spec&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;spack.spec.Spec&quot;</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">when</span> <span class="o">=</span> <span class="n">when</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ConditionalValue(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">, when=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">when</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Needed to allow testing the presence of a variant in a set by its value</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span></div>



<div class="viewcode-block" id="prevalidate_variant_value">
<a class="viewcode-back" href="../../spack.html#spack.variant.prevalidate_variant_value">[docs]</a>
<span class="k">def</span> <span class="nf">prevalidate_variant_value</span><span class="p">(</span>
    <span class="n">pkg_cls</span><span class="p">:</span> <span class="s2">&quot;Type[spack.package_base.PackageBase]&quot;</span><span class="p">,</span>
    <span class="n">variant</span><span class="p">:</span> <span class="n">AbstractVariant</span><span class="p">,</span>
    <span class="n">spec</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;spack.spec.Spec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Variant</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Do as much validation of a variant value as is possible before concretization.</span>

<span class="sd">    This checks that the variant value is valid for *some* definition of the variant, and</span>
<span class="sd">    it raises if we know *before* concretization that the value cannot occur. On success</span>
<span class="sd">    it returns the variant definitions for which the variant is valid.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        pkg_cls: package in which variant is (potentially multiply) defined</span>
<span class="sd">        variant: variant spec with value to validate</span>
<span class="sd">        spec: optionally restrict validation only to variants defined for this spec</span>
<span class="sd">        strict: if True, raise an exception if no variant definition is valid for any</span>
<span class="sd">            constraint on the spec.</span>

<span class="sd">    Return:</span>
<span class="sd">        list of variant definitions that will accept the given value. List will be empty</span>
<span class="sd">        only if the variant is a reserved variant.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># don&#39;t validate wildcards or variants with reserved names</span>
    <span class="k">if</span> <span class="n">variant</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,)</span> <span class="ow">or</span> <span class="n">variant</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">reserved_names</span> <span class="ow">or</span> <span class="n">variant</span><span class="o">.</span><span class="n">propagate</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># raise if there is no definition at all</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pkg_cls</span><span class="o">.</span><span class="n">has_variant</span><span class="p">(</span><span class="n">variant</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">UnknownVariantError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;No such variant &#39;</span><span class="si">{</span><span class="n">variant</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; in package </span><span class="si">{</span><span class="n">pkg_cls</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">variant</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># do as much prevalidation as we can -- check only those</span>
    <span class="c1"># variants whose when constraint intersects this spec</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">possible_definitions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">valid_definitions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">when</span><span class="p">,</span> <span class="n">pkg_variant_def</span> <span class="ow">in</span> <span class="n">pkg_cls</span><span class="o">.</span><span class="n">variant_definitions</span><span class="p">(</span><span class="n">variant</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">spec</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">spec</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">when</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">possible_definitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pkg_variant_def</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">pkg_variant_def</span><span class="o">.</span><span class="n">validate_or_raise</span><span class="p">(</span><span class="n">variant</span><span class="p">,</span> <span class="n">pkg_cls</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">valid_definitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pkg_variant_def</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">spack</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">SpecError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="c1"># value is valid for at least one definition -- return them all</span>
    <span class="k">if</span> <span class="n">valid_definitions</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">valid_definitions</span>

    <span class="c1"># no when spec intersected, so no possible definition for the variant in this configuration</span>
    <span class="k">if</span> <span class="n">strict</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">possible_definitions</span><span class="p">:</span>
        <span class="n">when_clause</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; when </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">spec</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">InvalidVariantValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;variant &#39;</span><span class="si">{</span><span class="n">variant</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; does not exist for &#39;</span><span class="si">{</span><span class="n">pkg_cls</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">when_clause</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># There are only no errors if we&#39;re not strict and there are no possible_definitions.</span>
    <span class="c1"># We are strict for audits but not for specs on the CLI or elsewhere. Being strict</span>
    <span class="c1"># in these cases would violate our rule of being able to *talk* about any configuration,</span>
    <span class="c1"># regardless of what the package.py currently says.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">errors</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># if there is just one error, raise the specific error</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># otherwise combine all the errors and raise them together</span>
    <span class="k">raise</span> <span class="n">InvalidVariantValueError</span><span class="p">(</span>
        <span class="s2">&quot;multiple variant issues:&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">message</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">)</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="ConditionalVariantValues">
<a class="viewcode-back" href="../../spack.html#spack.variant.ConditionalVariantValues">[docs]</a>
<span class="k">class</span> <span class="nc">ConditionalVariantValues</span><span class="p">(</span><span class="n">lang</span><span class="o">.</span><span class="n">TypedMutableSequence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A list, just with a different type&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="DuplicateVariantError">
<a class="viewcode-back" href="../../spack.html#spack.variant.DuplicateVariantError">[docs]</a>
<span class="k">class</span> <span class="nc">DuplicateVariantError</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">SpecError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when the same variant occurs in a spec twice.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="UnknownVariantError">
<a class="viewcode-back" href="../../spack.html#spack.variant.UnknownVariantError">[docs]</a>
<span class="k">class</span> <span class="nc">UnknownVariantError</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">SpecError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when an unknown variant occurs in a spec.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unknown_variants</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown_variants</span> <span class="o">=</span> <span class="n">unknown_variants</span></div>



<div class="viewcode-block" id="InconsistentValidationError">
<a class="viewcode-back" href="../../spack.html#spack.variant.InconsistentValidationError">[docs]</a>
<span class="k">class</span> <span class="nc">InconsistentValidationError</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">SpecError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised if the wrong validator is used to validate a variant.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vspec</span><span class="p">,</span> <span class="n">variant</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;trying to validate variant &quot;</span><span class="si">{0.name}</span><span class="s1">&quot; &#39;</span> <span class="s1">&#39;with the validator of &quot;</span><span class="si">{1.name}</span><span class="s1">&quot;&#39;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vspec</span><span class="p">,</span> <span class="n">variant</span><span class="p">))</span></div>



<div class="viewcode-block" id="MultipleValuesInExclusiveVariantError">
<a class="viewcode-back" href="../../spack.html#spack.variant.MultipleValuesInExclusiveVariantError">[docs]</a>
<span class="k">class</span> <span class="nc">MultipleValuesInExclusiveVariantError</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">SpecError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when multiple values are present in a variant that wants</span>
<span class="sd">    only one.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variant</span><span class="p">:</span> <span class="n">AbstractVariant</span><span class="p">,</span> <span class="n">pkg_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">pkg_info</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">pkg_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot; in package &#39;</span><span class="si">{</span><span class="n">pkg_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;multiple values are not allowed for variant &#39;</span><span class="si">{</span><span class="n">variant</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">pkg_info</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variant</span><span class="p">,</span> <span class="n">pkg_info</span><span class="p">))</span></div>



<div class="viewcode-block" id="InvalidVariantValueCombinationError">
<a class="viewcode-back" href="../../spack.html#spack.variant.InvalidVariantValueCombinationError">[docs]</a>
<span class="k">class</span> <span class="nc">InvalidVariantValueCombinationError</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">SpecError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when a variant has values &#39;*&#39; or &#39;none&#39; with other values.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="InvalidVariantValueError">
<a class="viewcode-back" href="../../spack.html#spack.variant.InvalidVariantValueError">[docs]</a>
<span class="k">class</span> <span class="nc">InvalidVariantValueError</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">SpecError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when variants have invalid values.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="UnsatisfiableVariantSpecError">
<a class="viewcode-back" href="../../spack.html#spack.variant.UnsatisfiableVariantSpecError">[docs]</a>
<span class="k">class</span> <span class="nc">UnsatisfiableVariantSpecError</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">UnsatisfiableSpecError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when a spec variant conflicts with package constraints.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provided</span><span class="p">,</span> <span class="n">required</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">provided</span><span class="p">,</span> <span class="n">required</span><span class="p">,</span> <span class="s2">&quot;variant&quot;</span><span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2023, Lawrence Livermore National Laboratory..
      <span class="lastupdated">Last updated on Sep 20, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>