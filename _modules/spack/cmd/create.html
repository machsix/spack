

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>spack.cmd.create &mdash; Spack 0.23.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=5f00b823" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=832b3b9f"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S0PQ7WV75K"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S0PQ7WV75K');
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/spack-logo-white-text.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Feature Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../basic_usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../replace_conda_homebrew.html">Spack for Homebrew/Conda Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../frequently_asked_questions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://spack-tutorial.readthedocs.io">Tutorial (spack-tutorial.rtfd.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://packages.spack.io">Packages (packages.spack.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cache.spack.io">Binaries (binaries.spack.io)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../config_yaml.html">Spack Settings (config.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../packages_yaml.html">Package Settings (packages.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build_settings.html">Concretization Settings (concretizer.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../environments.html">Environments (spack.yaml, spack.lock)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../containers.html">Container Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mirrors.html">Mirrors (mirrors.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_file_support.html">Modules (modules.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../repositories.html">Package Repositories (repos.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../binary_caches.html">Build Caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bootstrapping.html">Bootstrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../command_index.html">Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../chain.html">Chaining Spack Installations (upstreams.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extensions.html">Custom Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pipelines.html">CI Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../signing.html">Spack Package Signing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu_configuration.html">Using External GPU Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contribution_guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../packaging_guide.html">Packaging Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build_systems.html">Build Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../spack.html">Spack API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../llnl.html">LLNL API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Spack</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../spack.html">spack</a></li>
          <li class="breadcrumb-item"><a href="../cmd.html">spack.cmd</a></li>
      <li class="breadcrumb-item active">spack.cmd.create</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for spack.cmd.create</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2013-2024 Lawrence Livermore National Security, LLC and other</span>
<span class="c1"># Spack Project Developers. See the top-level COPYRIGHT file for details.</span>
<span class="c1">#</span>
<span class="c1"># SPDX-License-Identifier: (Apache-2.0 OR MIT)</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">llnl.util.tty</span> <span class="k">as</span> <span class="nn">tty</span>
<span class="kn">from</span> <span class="nn">llnl.util.filesystem</span> <span class="kn">import</span> <span class="n">mkdirp</span>

<span class="kn">import</span> <span class="nn">spack.repo</span>
<span class="kn">import</span> <span class="nn">spack.stage</span>
<span class="kn">from</span> <span class="nn">spack.spec</span> <span class="kn">import</span> <span class="n">Spec</span>
<span class="kn">from</span> <span class="nn">spack.url</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">UndetectableNameError</span><span class="p">,</span>
    <span class="n">UndetectableVersionError</span><span class="p">,</span>
    <span class="n">find_versions_of_archive</span><span class="p">,</span>
    <span class="n">parse_name</span><span class="p">,</span>
    <span class="n">parse_version</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">spack.util.editor</span> <span class="kn">import</span> <span class="n">editor</span>
<span class="kn">from</span> <span class="nn">spack.util.executable</span> <span class="kn">import</span> <span class="n">which</span>
<span class="kn">from</span> <span class="nn">spack.util.format</span> <span class="kn">import</span> <span class="n">get_version_lines</span>
<span class="kn">from</span> <span class="nn">spack.util.naming</span> <span class="kn">import</span> <span class="n">mod_to_class</span><span class="p">,</span> <span class="n">simplify_name</span><span class="p">,</span> <span class="n">valid_fully_qualified_module_name</span>

<span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;create a new package file&quot;</span>
<span class="n">section</span> <span class="o">=</span> <span class="s2">&quot;packaging&quot;</span>
<span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;short&quot;</span>


<span class="n">package_template</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s1"># Copyright 2013-2024 Lawrence Livermore National Security, LLC and other</span>
<span class="s1"># Spack Project Developers. See the top-level COPYRIGHT file for details.</span>
<span class="s1">#</span>
<span class="s1"># SPDX-License-Identifier: (Apache-2.0 OR MIT)</span>

<span class="s1"># ----------------------------------------------------------------------------</span>
<span class="s1"># If you submit this package back to Spack as a pull request,</span>
<span class="s1"># please first remove this boilerplate and all FIXME comments.</span>
<span class="s1">#</span>
<span class="s1"># This is a template package file for Spack.  We&#39;ve put &quot;FIXME&quot;</span>
<span class="s1"># next to all the things you&#39;ll want to change. Once you&#39;ve handled</span>
<span class="s1"># them, you can save this file and test your package like this:</span>
<span class="s1">#</span>
<span class="s1">#     spack install </span><span class="si">{name}</span>
<span class="s1">#</span>
<span class="s1"># You can edit this file again by typing:</span>
<span class="s1">#</span>
<span class="s1">#     spack edit </span><span class="si">{name}</span>
<span class="s1">#</span>
<span class="s1"># See the Spack documentation for more information on packaging.</span>
<span class="s1"># ----------------------------------------------------------------------------</span>

<span class="s1">from spack.package import *</span>


<span class="s1">class </span><span class="si">{class_name}</span><span class="s1">(</span><span class="si">{base_class_name}</span><span class="s1">):</span>
<span class="s1">    &quot;&quot;&quot;FIXME: Put a proper description of your package here.&quot;&quot;&quot;</span>

<span class="s1">    # FIXME: Add a proper url for your package&#39;s homepage here.</span>
<span class="s1">    homepage = &quot;https://www.example.com&quot;</span>
<span class="si">{url_def}</span>

<span class="s1">    # FIXME: Add a list of GitHub accounts to</span>
<span class="s1">    # notify when the package is updated.</span>
<span class="s1">    # maintainers(&quot;github_user1&quot;, &quot;github_user2&quot;)</span>

<span class="s1">    # FIXME: Add the SPDX identifier of the project&#39;s license below.</span>
<span class="s1">    # See https://spdx.org/licenses/ for a list. Upon manually verifying</span>
<span class="s1">    # the license, set checked_by to your Github username.</span>
<span class="s1">    license(&quot;UNKNOWN&quot;, checked_by=&quot;github_user1&quot;)</span>

<span class="si">{versions}</span>

<span class="si">{dependencies}</span>

<span class="si">{body_def}</span>
<span class="s1">&#39;&#39;&#39;</span>


<div class="viewcode-block" id="BundlePackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.BundlePackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">BundlePackageTemplate</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides the default values to be used for a bundle package file template.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;BundlePackage&quot;</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    # FIXME: Add dependencies if required.</span>
<span class="s2">    # depends_on(&quot;foo&quot;)&quot;&quot;&quot;</span>

    <span class="n">url_def</span> <span class="o">=</span> <span class="s2">&quot;    # There is no URL since there is no code to download.&quot;</span>
    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;    # There is no need for install() since there is no code.&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_name</span> <span class="o">=</span> <span class="n">mod_to_class</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">=</span> <span class="n">versions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">languages</span> <span class="o">=</span> <span class="n">languages</span>

<div class="viewcode-block" id="BundlePackageTemplate.write">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.BundlePackageTemplate.write">[docs]</a>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pkg_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Writes the new package file.&quot;&quot;&quot;</span>

        <span class="n">all_deps</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;    depends_on(&quot;</span><span class="si">{</span><span class="n">lang</span><span class="si">}</span><span class="s1">&quot;, type=&quot;build&quot;)&#39;</span> <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">languages</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">all_deps</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="p">:</span>
            <span class="n">all_deps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">all_deps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="p">)</span>

        <span class="c1"># Write out a template for the file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pkg_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pkg_file</span><span class="p">:</span>
            <span class="n">pkg_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">package_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">class_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_name</span><span class="p">,</span>
                    <span class="n">base_class_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_class_name</span><span class="p">,</span>
                    <span class="n">url_def</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url_def</span><span class="p">,</span>
                    <span class="n">versions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">,</span>
                    <span class="n">dependencies</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">all_deps</span><span class="p">),</span>
                    <span class="n">body_def</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">body_def</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="PackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.PackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">PackageTemplate</span><span class="p">(</span><span class="n">BundlePackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides the default values to be used for the package file template&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;Package&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    def install(self, spec, prefix):</span>
<span class="s2">        # FIXME: Unknown build system</span>
<span class="s2">        make()</span>
<span class="s2">        make(&quot;install&quot;)&quot;&quot;&quot;</span>

    <span class="n">url_line</span> <span class="o">=</span> <span class="s1">&#39;    url = &quot;</span><span class="si">{url}</span><span class="s1">&quot;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">url_def</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_line</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span></div>



<div class="viewcode-block" id="AutotoolsPackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.AutotoolsPackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">AutotoolsPackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for Autotools-based packages</span>
<span class="sd">    that *do* come with a ``configure`` script&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;AutotoolsPackage&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    def configure_args(self):</span>
<span class="s2">        # FIXME: Add arguments other than --prefix</span>
<span class="s2">        # FIXME: If not needed delete this function</span>
<span class="s2">        args = []</span>
<span class="s2">        return args&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="AutoreconfPackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.AutoreconfPackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">AutoreconfPackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for Autotools-based packages</span>
<span class="sd">    that *do not* come with a ``configure`` script&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;AutotoolsPackage&quot;</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    depends_on(&quot;autoconf&quot;, type=&quot;build&quot;)</span>
<span class="s2">    depends_on(&quot;automake&quot;, type=&quot;build&quot;)</span>
<span class="s2">    depends_on(&quot;libtool&quot;, type=&quot;build&quot;)</span>
<span class="s2">    depends_on(&quot;m4&quot;, type=&quot;build&quot;)</span>

<span class="s2">    # FIXME: Add additional dependencies if required.</span>
<span class="s2">    # depends_on(&quot;foo&quot;)&quot;&quot;&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    def autoreconf(self, spec, prefix):</span>
<span class="s2">        # FIXME: Modify the autoreconf method as necessary</span>
<span class="s2">        autoreconf(&quot;--install&quot;, &quot;--verbose&quot;, &quot;--force&quot;)</span>

<span class="s2">    def configure_args(self):</span>
<span class="s2">        # FIXME: Add arguments other than --prefix</span>
<span class="s2">        # FIXME: If not needed delete this function</span>
<span class="s2">        args = []</span>
<span class="s2">        return args&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="CargoPackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.CargoPackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">CargoPackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for cargo-based packages&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;CargoPackage&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span></div>



<div class="viewcode-block" id="CMakePackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.CMakePackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">CMakePackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for CMake-based packages&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;CMakePackage&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    def cmake_args(self):</span>
<span class="s2">        # FIXME: Add arguments other than</span>
<span class="s2">        # FIXME: CMAKE_INSTALL_PREFIX and CMAKE_BUILD_TYPE</span>
<span class="s2">        # FIXME: If not needed delete this function</span>
<span class="s2">        args = []</span>
<span class="s2">        return args&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="GoPackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.GoPackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">GoPackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for Go-module-based packages&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;GoPackage&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span></div>



<div class="viewcode-block" id="LuaPackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.LuaPackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">LuaPackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for LuaRocks-based packages&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;LuaPackage&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    def luarocks_args(self):</span>
<span class="s2">        # FIXME: Add arguments to `luarocks make` other than rockspec path</span>
<span class="s2">        # FIXME: If not needed delete this function</span>
<span class="s2">        args = []</span>
<span class="s2">        return args&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="c1"># If the user provided `--name lua-lpeg`, don&#39;t rename it lua-lua-lpeg</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;lua-&quot;</span><span class="p">):</span>
            <span class="c1"># Make it more obvious that we are renaming the package</span>
            <span class="n">tty</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Changing package name from </span><span class="si">{0}</span><span class="s2"> to lua-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;lua-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">)</span></div>



<div class="viewcode-block" id="MesonPackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.MesonPackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">MesonPackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for meson-based packages&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;MesonPackage&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    def meson_args(self):</span>
<span class="s2">        # FIXME: If not needed delete this function</span>
<span class="s2">        args = []</span>
<span class="s2">        return args&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="QMakePackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.QMakePackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">QMakePackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for QMake-based packages&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;QMakePackage&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    def qmake_args(self):</span>
<span class="s2">        # FIXME: If not needed delete this function</span>
<span class="s2">        args = []</span>
<span class="s2">        return args&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="MavenPackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.MavenPackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">MavenPackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for Maven-based packages&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;MavenPackage&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    def build(self, spec, prefix):</span>
<span class="s2">        # FIXME: If not needed delete this function</span>
<span class="s2">        pass&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="SconsPackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.SconsPackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">SconsPackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for SCons-based packages&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;SConsPackage&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    def build_args(self, spec, prefix):</span>
<span class="s2">        # FIXME: Add arguments to pass to build.</span>
<span class="s2">        # FIXME: If not needed delete this function</span>
<span class="s2">        args = []</span>
<span class="s2">        return args&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="WafPackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.WafPackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">WafPackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate override for Waf-based packages&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;WafPackage&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span></div>

<span class="s2">    # FIXME: Override configure_args(), build_args(),</span>
<span class="s2">    # or install_args() if necessary.&quot;&quot;&quot;</span>


<div class="viewcode-block" id="BazelPackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.BazelPackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">BazelPackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for Bazel-based packages&quot;&quot;&quot;</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    # FIXME: Add additional dependencies if required.</span>
<span class="s2">    depends_on(&quot;bazel&quot;, type=&quot;build&quot;)&quot;&quot;&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    def install(self, spec, prefix):</span>
<span class="s2">        # FIXME: Add logic to build and install here.</span>
<span class="s2">        bazel()&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="RacketPackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.RacketPackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">RacketPackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides approriate overrides for Racket extensions&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;RacketPackage&quot;</span>

    <span class="n">url_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    # FIXME: set the proper location from which to fetch your package</span>
<span class="s2">    git = &quot;git@github.com:example/example.git&quot;</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    # FIXME: Add dependencies if required. Only add the racket dependency</span>
<span class="s2">    # if you need specific versions. A generic racket dependency is</span>
<span class="s2">    # added implicity by the RacketPackage class.</span>
<span class="s2">    # depends_on(&quot;racket@8.3:&quot;, type=(&quot;build&quot;, &quot;run&quot;))&quot;&quot;&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    # FIXME: specify the name of the package,</span>
<span class="s2">    # as it should appear to ``raco pkg install``</span>
<span class="s2">    name = &quot;</span><span class="si">{0}</span><span class="s2">&quot;</span>
<span class="s2">    # FIXME: set to true if published on pkgs.racket-lang.org</span>
<span class="s2">    # pkgs = False</span>
<span class="s2">    # FIXME: specify path to the root directory of the</span>
<span class="s2">    # package, if not the base directory</span>
<span class="s2">    # subdirectory = None</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="c1"># If the user provided `--name rkt-scribble`, don&#39;t rename it rkt-rkt-scribble</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;rkt-&quot;</span><span class="p">):</span>
            <span class="c1"># Make it more obvious that we are renaming the package</span>
            <span class="n">tty</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Changing package name from </span><span class="si">{0}</span><span class="s2"> to rkt-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;rkt-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_def</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_def</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">)</span></div>



<div class="viewcode-block" id="PythonPackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.PythonPackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">PythonPackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for python extensions&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;PythonPackage&quot;</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    # FIXME: Only add the python/pip/wheel dependencies if you need specific versions</span>
<span class="s2">    # or need to change the dependency type. Generic python/pip/wheel dependencies are</span>
<span class="s2">    # added implicity by the PythonPackage base class.</span>
<span class="s2">    # depends_on(&quot;python@2.X:2.Y,3.Z:&quot;, type=(&quot;build&quot;, &quot;run&quot;))</span>
<span class="s2">    # depends_on(&quot;py-pip@X.Y:&quot;, type=&quot;build&quot;)</span>
<span class="s2">    # depends_on(&quot;py-wheel@X.Y:&quot;, type=&quot;build&quot;)</span>

<span class="s2">    # FIXME: Add a build backend, usually defined in pyproject.toml. If no such file</span>
<span class="s2">    # exists, use setuptools.</span>
<span class="s2">    # depends_on(&quot;py-setuptools&quot;, type=&quot;build&quot;)</span>
<span class="s2">    # depends_on(&quot;py-hatchling&quot;, type=&quot;build&quot;)</span>
<span class="s2">    # depends_on(&quot;py-flit-core&quot;, type=&quot;build&quot;)</span>
<span class="s2">    # depends_on(&quot;py-poetry-core&quot;, type=&quot;build&quot;)</span>

<span class="s2">    # FIXME: Add additional dependencies if required.</span>
<span class="s2">    # depends_on(&quot;py-foo&quot;, type=(&quot;build&quot;, &quot;run&quot;))&quot;&quot;&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    def config_settings(self, spec, prefix):</span>
<span class="s2">        # FIXME: Add configuration settings to be passed to the build backend</span>
<span class="s2">        # FIXME: If not needed, delete this function</span>
<span class="s2">        settings = </span><span class="si">{}</span>
<span class="s2">        return settings&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="c1"># If the user provided `--name py-numpy`, don&#39;t rename it py-py-numpy</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;py-&quot;</span><span class="p">):</span>
            <span class="c1"># Make it more obvious that we are renaming the package</span>
            <span class="n">tty</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Changing package name from </span><span class="si">{0}</span><span class="s2"> to py-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;py-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Simple PyPI URLs:</span>
        <span class="c1"># https://&lt;hostname&gt;/packages/&lt;type&gt;/&lt;first character of project&gt;/&lt;project&gt;/&lt;download file&gt;</span>
        <span class="c1"># e.g. https://pypi.io/packages/source/n/numpy/numpy-1.19.4.zip</span>
        <span class="c1"># e.g. https://www.pypi.io/packages/source/n/numpy/numpy-1.19.4.zip</span>
        <span class="c1"># e.g. https://pypi.org/packages/source/n/numpy/numpy-1.19.4.zip</span>
        <span class="c1"># e.g. https://pypi.python.org/packages/source/n/numpy/numpy-1.19.4.zip</span>
        <span class="c1"># e.g. https://files.pythonhosted.org/packages/source/n/numpy/numpy-1.19.4.zip</span>

        <span class="c1"># PyPI URLs containing hash:</span>
        <span class="c1"># https://&lt;hostname&gt;/packages/&lt;two character hash&gt;/&lt;two character hash&gt;/&lt;longer hash&gt;/&lt;download file&gt;</span>
        <span class="c1"># e.g. https://pypi.io/packages/c5/63/a48648ebc57711348420670bb074998f79828291f68aebfff1642be212ec/numpy-1.19.4.zip</span>
        <span class="c1"># e.g. https://files.pythonhosted.org/packages/c5/63/a48648ebc57711348420670bb074998f79828291f68aebfff1642be212ec/numpy-1.19.4.zip</span>
        <span class="c1"># e.g. https://files.pythonhosted.org/packages/c5/63/a48648ebc57711348420670bb074998f79828291f68aebfff1642be212ec/numpy-1.19.4.zip#sha256=141ec3a3300ab89c7f2b0775289954d193cc8edb621ea05f99db9cb181530512</span>

        <span class="c1"># PyPI URLs for wheels:</span>
        <span class="c1"># https://pypi.io/packages/py3/a/azureml_core/azureml_core-1.11.0-py3-none-any.whl</span>
        <span class="c1"># https://pypi.io/packages/py3/d/dotnetcore2/dotnetcore2-2.1.14-py3-none-macosx_10_9_x86_64.whl</span>
        <span class="c1"># https://pypi.io/packages/py3/d/dotnetcore2/dotnetcore2-2.1.14-py3-none-manylinux1_x86_64.whl</span>
        <span class="c1"># https://files.pythonhosted.org/packages/cp35.cp36.cp37.cp38.cp39/s/shiboken2/shiboken2-5.15.2-5.15.2-cp35.cp36.cp37.cp38.cp39-abi3-manylinux1_x86_64.whl</span>
        <span class="c1"># https://files.pythonhosted.org/packages/f4/99/ad2ef1aeeb395ee2319bb981ea08dbbae878d30dd28ebf27e401430ae77a/azureml_core-1.36.0.post2-py3-none-any.whl#sha256=60bcad10b4380d78a8280deb7365de2c2cd66527aacdcb4a173f613876cbe739</span>

        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?:pypi|pythonhosted)[^/]+/packages&quot;</span> <span class="o">+</span> <span class="s2">&quot;/([^/#]+)&quot;</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="c1"># PyPI URLs for wheels are too complicated, ignore them for now</span>
            <span class="c1"># https://www.python.org/dev/peps/pep-0427/#file-name-convention</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.whl&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># Simple PyPI URL</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># PyPI URL containing hash</span>
                    <span class="c1"># Project name doesn&#39;t necessarily match download name, but it</span>
                    <span class="c1"># usually does, so this is the best we can do</span>
                    <span class="n">project</span> <span class="o">=</span> <span class="n">parse_name</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">project</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">url_line</span> <span class="o">=</span> <span class="s1">&#39;    pypi = &quot;</span><span class="si">{url}</span><span class="s1">&quot;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Add a reminder about spack preferring PyPI URLs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url_line</span> <span class="o">=</span> <span class="p">(</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    # FIXME: ensure the package is not available through PyPI. If it is,</span>
<span class="sd">    # re-run `spack create --force` with the PyPI URL.</span>
<span class="sd">&quot;&quot;&quot;</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_line</span>
            <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">)</span></div>



<div class="viewcode-block" id="RPackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.RPackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">RPackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for R extensions&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;RPackage&quot;</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    # FIXME: Add dependencies if required.</span>
<span class="s2">    # depends_on(&quot;r-foo&quot;, type=(&quot;build&quot;, &quot;run&quot;))&quot;&quot;&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    def configure_args(self):</span>
<span class="s2">        # FIXME: Add arguments to pass to install via --configure-args</span>
<span class="s2">        # FIXME: If not needed delete this function</span>
<span class="s2">        args = []</span>
<span class="s2">        return args&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="c1"># If the user provided `--name r-rcpp`, don&#39;t rename it r-r-rcpp</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;r-&quot;</span><span class="p">):</span>
            <span class="c1"># Make it more obvious that we are renaming the package</span>
            <span class="n">tty</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Changing package name from </span><span class="si">{0}</span><span class="s2"> to r-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;r-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="n">r_name</span> <span class="o">=</span> <span class="n">parse_name</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="n">cran</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?:r-project|rstudio)[^/]+/src&quot;</span> <span class="o">+</span> <span class="s2">&quot;/([^/]+)&quot;</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cran</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">r_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url_line</span> <span class="o">=</span> <span class="s1">&#39;    cran = &quot;</span><span class="si">{url}</span><span class="s1">&quot;&#39;</span>

        <span class="n">bioc</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?:bioconductor)[^/]+/packages&quot;</span> <span class="o">+</span> <span class="s2">&quot;/([^/]+)&quot;</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bioc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url_line</span> <span class="o">=</span> <span class="s1">&#39;    url = &quot;</span><span class="si">{0}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="s1">&#39;    bioc = &quot;</span><span class="si">{1}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">r_name</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">)</span></div>



<div class="viewcode-block" id="PerlmakePackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.PerlmakePackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">PerlmakePackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for Perl extensions</span>
<span class="sd">    that come with a Makefile.PL&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;PerlPackage&quot;</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    # FIXME: Add dependencies if required:</span>
<span class="s2">    # depends_on(&quot;perl-foo&quot;, type=(&quot;build&quot;, &quot;run&quot;))&quot;&quot;&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    def configure_args(self):</span>
<span class="s2">        # FIXME: Add non-standard arguments</span>
<span class="s2">        # FIXME: If not needed delete this function</span>
<span class="s2">        args = []</span>
<span class="s2">        return args&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="c1"># If the user provided `--name perl-cpp`, don&#39;t rename it perl-perl-cpp</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;perl-&quot;</span><span class="p">):</span>
            <span class="c1"># Make it more obvious that we are renaming the package</span>
            <span class="n">tty</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Changing package name from </span><span class="si">{0}</span><span class="s2"> to perl-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;perl-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">)</span></div>



<div class="viewcode-block" id="PerlbuildPackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.PerlbuildPackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">PerlbuildPackageTemplate</span><span class="p">(</span><span class="n">PerlmakePackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for Perl extensions</span>
<span class="sd">    that come with a Build.PL instead of a Makefile.PL&quot;&quot;&quot;</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    depends_on(&quot;perl-module-build&quot;, type=&quot;build&quot;)</span></div>


<span class="s2">    # FIXME: Add additional dependencies if required:</span>
<span class="s2">    # depends_on(&quot;perl-foo&quot;, type=(&quot;build&quot;, &quot;run&quot;))&quot;&quot;&quot;</span>


<div class="viewcode-block" id="OctavePackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.OctavePackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">OctavePackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for octave packages&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;OctavePackage&quot;</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    extends(&quot;octave&quot;)</span>

<span class="s2">    # FIXME: Add additional dependencies if required.</span>
<span class="s2">    # depends_on(&quot;octave-foo&quot;, type=(&quot;build&quot;, &quot;run&quot;))&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="c1"># If the user provided `--name octave-splines`, don&#39;t rename it</span>
        <span class="c1"># octave-octave-splines</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;octave-&quot;</span><span class="p">):</span>
            <span class="c1"># Make it more obvious that we are renaming the package</span>
            <span class="n">tty</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Changing package name from </span><span class="si">{0}</span><span class="s2"> to octave-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;octave-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">)</span></div>



<div class="viewcode-block" id="RubyPackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.RubyPackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">RubyPackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for Ruby packages&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;RubyPackage&quot;</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    # FIXME: Add dependencies if required. Only add the ruby dependency</span>
<span class="s2">    # if you need specific versions. A generic ruby dependency is</span>
<span class="s2">    # added implicity by the RubyPackage class.</span>
<span class="s2">    # depends_on(&quot;ruby@X.Y.Z:&quot;, type=(&quot;build&quot;, &quot;run&quot;))</span>
<span class="s2">    # depends_on(&quot;ruby-foo&quot;, type=(&quot;build&quot;, &quot;run&quot;))&quot;&quot;&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    def build(self, spec, prefix):</span>
<span class="s2">        # FIXME: If not needed delete this function</span>
<span class="s2">        pass&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="c1"># If the user provided `--name ruby-numpy`, don&#39;t rename it</span>
        <span class="c1"># ruby-ruby-numpy</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ruby-&quot;</span><span class="p">):</span>
            <span class="c1"># Make it more obvious that we are renaming the package</span>
            <span class="n">tty</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Changing package name from </span><span class="si">{0}</span><span class="s2"> to ruby-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ruby-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">)</span></div>



<div class="viewcode-block" id="MakefilePackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.MakefilePackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">MakefilePackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for Makefile packages&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;MakefilePackage&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    def edit(self, spec, prefix):</span>
<span class="s2">        # FIXME: Edit the Makefile if necessary</span>
<span class="s2">        # FIXME: If not needed delete this function</span>
<span class="s2">        # makefile = FileFilter(&quot;Makefile&quot;)</span>
<span class="s2">        # makefile.filter(&quot;CC = .*&quot;, &quot;CC = cc&quot;)</span>
<span class="s2">        pass&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="IntelPackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.IntelPackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">IntelPackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for licensed Intel software&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;IntelPackage&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span></div>

<span class="s2">    # FIXME: Override `setup_environment` if necessary.&quot;&quot;&quot;</span>


<div class="viewcode-block" id="SIPPackageTemplate">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.SIPPackageTemplate">[docs]</a>
<span class="k">class</span> <span class="nc">SIPPackageTemplate</span><span class="p">(</span><span class="n">PackageTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides appropriate overrides for SIP packages.&quot;&quot;&quot;</span>

    <span class="n">base_class_name</span> <span class="o">=</span> <span class="s2">&quot;SIPPackage&quot;</span>

    <span class="n">body_def</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    def configure_args(self, spec, prefix):</span>
<span class="s2">        # FIXME: Add arguments other than --bindir and --destdir</span>
<span class="s2">        # FIXME: If not needed delete this function</span>
<span class="s2">        args = []</span>
<span class="s2">        return args&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="c1"># If the user provided `--name py-pyqt4`, don&#39;t rename it py-py-pyqt4</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;py-&quot;</span><span class="p">):</span>
            <span class="c1"># Make it more obvious that we are renaming the package</span>
            <span class="n">tty</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Changing package name from </span><span class="si">{0}</span><span class="s2"> to py-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;py-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">languages</span><span class="p">)</span></div>



<span class="n">templates</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;autoreconf&quot;</span><span class="p">:</span> <span class="n">AutoreconfPackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;autotools&quot;</span><span class="p">:</span> <span class="n">AutotoolsPackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;bazel&quot;</span><span class="p">:</span> <span class="n">BazelPackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;bundle&quot;</span><span class="p">:</span> <span class="n">BundlePackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;cargo&quot;</span><span class="p">:</span> <span class="n">CargoPackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;cmake&quot;</span><span class="p">:</span> <span class="n">CMakePackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;generic&quot;</span><span class="p">:</span> <span class="n">PackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;go&quot;</span><span class="p">:</span> <span class="n">GoPackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;intel&quot;</span><span class="p">:</span> <span class="n">IntelPackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;lua&quot;</span><span class="p">:</span> <span class="n">LuaPackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;makefile&quot;</span><span class="p">:</span> <span class="n">MakefilePackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;maven&quot;</span><span class="p">:</span> <span class="n">MavenPackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;meson&quot;</span><span class="p">:</span> <span class="n">MesonPackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;octave&quot;</span><span class="p">:</span> <span class="n">OctavePackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;perlbuild&quot;</span><span class="p">:</span> <span class="n">PerlbuildPackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;perlmake&quot;</span><span class="p">:</span> <span class="n">PerlmakePackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;python&quot;</span><span class="p">:</span> <span class="n">PythonPackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;qmake&quot;</span><span class="p">:</span> <span class="n">QMakePackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="n">RPackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;racket&quot;</span><span class="p">:</span> <span class="n">RacketPackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;ruby&quot;</span><span class="p">:</span> <span class="n">RubyPackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;scons&quot;</span><span class="p">:</span> <span class="n">SconsPackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;sip&quot;</span><span class="p">:</span> <span class="n">SIPPackageTemplate</span><span class="p">,</span>
    <span class="s2">&quot;waf&quot;</span><span class="p">:</span> <span class="n">WafPackageTemplate</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="setup_parser">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.setup_parser">[docs]</a>
<span class="k">def</span> <span class="nf">setup_parser</span><span class="p">(</span><span class="n">subparser</span><span class="p">):</span>
    <span class="n">subparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;url of package archive&quot;</span><span class="p">)</span>
    <span class="n">subparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--keep-stage&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;don&#39;t clean up staging area when command completes&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">subparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="s2">&quot;--name&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;name of the package to create&quot;</span><span class="p">)</span>
    <span class="n">subparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-t&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--template&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TEMPLATE&quot;</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">templates</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;build system template to use</span><span class="se">\n\n</span><span class="s2">options: </span><span class="si">%(choices)s</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">subparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-r&quot;</span><span class="p">,</span> <span class="s2">&quot;--repo&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;path to a repository where the package should be created&quot;</span>
    <span class="p">)</span>
    <span class="n">subparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-N&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--namespace&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;specify a namespace for the package</span><span class="se">\n\n</span><span class="s2">must be the namespace of &quot;</span>
        <span class="s2">&quot;a repository registered with Spack&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">subparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-f&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--force&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;overwrite any existing package file with the same name&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">subparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--skip-editor&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;skip the edit session for the package (e.g., automation)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">subparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="s2">&quot;--batch&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;don&#39;t ask which versions to checksum&quot;</span>
    <span class="p">)</span></div>



<span class="c1">#: C file extensions</span>
<span class="n">C_EXT</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;.c&quot;</span><span class="p">}</span>

<span class="c1">#: C++ file extensions</span>
<span class="n">CXX_EXT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;.C&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.c++&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.cc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.ccm&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.cpp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.CPP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.cxx&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.h++&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.hh&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.hpp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.hxx&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.inl&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.ipp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.ixx&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.tcc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.tpp&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">#: Fortran file extensions</span>
<span class="n">FORTRAN_EXT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;.f77&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.F77&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.f90&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.F90&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.f95&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.F95&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.F&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.for&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.FOR&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.ftn&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.FTN&quot;</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="BuildSystemAndLanguageGuesser">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.BuildSystemAndLanguageGuesser">[docs]</a>
<span class="k">class</span> <span class="nc">BuildSystemAndLanguageGuesser</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An instance of BuildSystemAndLanguageGuesser provides a callable object to be used</span>
<span class="sd">    during ``spack create``. By passing this object to ``spack checksum``, we</span>
<span class="sd">    can take a peek at the fetched tarball and discern the build system it uses</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the default build system.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_system</span> <span class="o">=</span> <span class="s2">&quot;generic&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cxx</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fortran</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># List of files in the archive ordered by their depth in the directory tree.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_entries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Try to guess the type of build system used by a project based on</span>
<span class="sd">        the contents of its archive or the URL it was downloaded from.&quot;&quot;&quot;</span>

        <span class="c1"># Peek inside the compressed file.</span>
        <span class="k">if</span> <span class="n">archive</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;.zip#&quot;</span> <span class="ow">in</span> <span class="n">archive</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">unzip</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="s2">&quot;unzip&quot;</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">unzip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">unzip</span><span class="p">(</span><span class="s2">&quot;-lq&quot;</span><span class="p">,</span> <span class="n">archive</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tar</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="s2">&quot;tar&quot;</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">tar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">tar</span><span class="p">(</span><span class="s2">&quot;tf&quot;</span><span class="p">,</span> <span class="n">archive</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_entries</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

        <span class="c1"># Files closest to the root should be considered first when determining build system.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_entries</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_determine_build_system</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_determine_language</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_determine_build_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Most octave extensions are hosted on Octave-Forge:</span>
        <span class="c1">#     https://octave.sourceforge.net/index.html</span>
        <span class="c1"># They all have the same base URL.</span>
        <span class="k">if</span> <span class="s2">&quot;downloads.sourceforge.net/octave/&quot;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_system</span> <span class="o">=</span> <span class="s2">&quot;octave&quot;</span>
        <span class="k">elif</span> <span class="n">url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gem&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_system</span> <span class="o">=</span> <span class="s2">&quot;ruby&quot;</span>
        <span class="k">elif</span> <span class="n">url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.whl&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;.whl#&quot;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_system</span> <span class="o">=</span> <span class="s2">&quot;python&quot;</span>
        <span class="k">elif</span> <span class="n">url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.rock&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_system</span> <span class="o">=</span> <span class="s2">&quot;lua&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_entries</span><span class="p">:</span>
            <span class="c1"># A list of clues that give us an idea of the build system a package</span>
            <span class="c1"># uses. If the regular expression matches a file contained in the</span>
            <span class="c1"># archive, the corresponding build system is assumed.</span>
            <span class="c1"># NOTE: Order is important here. If a package supports multiple</span>
            <span class="c1"># build systems, we choose the first match in this list.</span>
            <span class="n">clues</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">),</span> <span class="n">build_system</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">build_system</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/CMakeLists\.txt$&quot;</span><span class="p">,</span> <span class="s2">&quot;cmake&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/NAMESPACE$&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Cargo\.toml$&quot;</span><span class="p">,</span> <span class="s2">&quot;cargo&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/go\.mod$&quot;</span><span class="p">,</span> <span class="s2">&quot;go&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/configure$&quot;</span><span class="p">,</span> <span class="s2">&quot;autotools&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/configure\.(in|ac)$&quot;</span><span class="p">,</span> <span class="s2">&quot;autoreconf&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Makefile\.am$&quot;</span><span class="p">,</span> <span class="s2">&quot;autoreconf&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/pom\.xml$&quot;</span><span class="p">,</span> <span class="s2">&quot;maven&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/SConstruct$&quot;</span><span class="p">,</span> <span class="s2">&quot;scons&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/waf$&quot;</span><span class="p">,</span> <span class="s2">&quot;waf&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/pyproject.toml&quot;</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/setup\.(py|cfg)$&quot;</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/WORKSPACE$&quot;</span><span class="p">,</span> <span class="s2">&quot;bazel&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Build\.PL$&quot;</span><span class="p">,</span> <span class="s2">&quot;perlbuild&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Makefile\.PL$&quot;</span><span class="p">,</span> <span class="s2">&quot;perlmake&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/.*\.gemspec$&quot;</span><span class="p">,</span> <span class="s2">&quot;ruby&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Rakefile$&quot;</span><span class="p">,</span> <span class="s2">&quot;ruby&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/setup\.rb$&quot;</span><span class="p">,</span> <span class="s2">&quot;ruby&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/.*\.pro$&quot;</span><span class="p">,</span> <span class="s2">&quot;qmake&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/.*\.rockspec$&quot;</span><span class="p">,</span> <span class="s2">&quot;lua&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/(GNU)?[Mm]akefile$&quot;</span><span class="p">,</span> <span class="s2">&quot;makefile&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/DESCRIPTION$&quot;</span><span class="p">,</span> <span class="s2">&quot;octave&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/meson\.build$&quot;</span><span class="p">,</span> <span class="s2">&quot;meson&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/configure\.py$&quot;</span><span class="p">,</span> <span class="s2">&quot;sip&quot;</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">]</span>

            <span class="c1"># Determine the build system based on the files contained in the archive.</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_entries</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">build_system</span> <span class="ow">in</span> <span class="n">clues</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">build_system</span> <span class="o">=</span> <span class="n">build_system</span>
                        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_determine_language</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_entries</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="ow">and</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">C_EXT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cxx</span> <span class="ow">and</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">CXX_EXT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cxx</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fortran</span> <span class="ow">and</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">FORTRAN_EXT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fortran</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cxx</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fortran</span><span class="p">:</span>
                <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">languages</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">langs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c</span><span class="p">:</span>
            <span class="n">langs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cxx</span><span class="p">:</span>
            <span class="n">langs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;cxx&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fortran</span><span class="p">:</span>
            <span class="n">langs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;fortran&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">langs</span></div>



<div class="viewcode-block" id="get_name">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.get_name">[docs]</a>
<span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the name of the package based on the supplied arguments.</span>

<span class="sd">    If a name was provided, always use that. Otherwise, if a URL was</span>
<span class="sd">    provided, extract the name from that. Otherwise, use a default.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): explicit ``--name`` argument given to ``spack create``</span>
<span class="sd">        url (str): ``url`` argument given to ``spack create``</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The name of the package</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Default package name</span>
    <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;example&quot;</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Use a user-supplied name if one is present</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tty</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Using specified package name: &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tty</span><span class="o">.</span><span class="n">die</span><span class="p">(</span><span class="s2">&quot;A package name must be provided when using the option.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Try to guess the package name based on the URL</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">parse_name</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="n">url</span><span class="p">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;URL&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;package name&quot;</span>
            <span class="n">tty</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;This looks like a </span><span class="si">{0}</span><span class="s2"> for </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">UndetectableNameError</span><span class="p">:</span>
            <span class="n">tty</span><span class="o">.</span><span class="n">die</span><span class="p">(</span>
                <span class="s2">&quot;Couldn&#39;t guess a name for this package.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;  Please report this bug. In the meantime, try running:&quot;</span><span class="p">,</span>
                <span class="s2">&quot;  `spack create --name &lt;name&gt; &lt;url&gt;`&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">simplify_name</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_fully_qualified_module_name</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
        <span class="n">tty</span><span class="o">.</span><span class="n">die</span><span class="p">(</span><span class="s2">&quot;Package name can only contain a-z, 0-9, and &#39;-&#39;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="get_url">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.get_url">[docs]</a>
<span class="k">def</span> <span class="nf">get_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the URL to use.</span>

<span class="sd">    Use a default URL if none is provided.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str): ``url`` argument to ``spack create``</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The URL of the package</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Use the user-supplied URL or a default URL if none is present.</span>
    <span class="k">return</span> <span class="n">url</span> <span class="ow">or</span> <span class="s2">&quot;https://www.example.com/example-1.2.3.tar.gz&quot;</span></div>



<div class="viewcode-block" id="get_versions">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.get_versions">[docs]</a>
<span class="k">def</span> <span class="nf">get_versions</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a list of versions and hashes for a package.</span>

<span class="sd">    Also returns a BuildSystemAndLanguageGuesser object.</span>

<span class="sd">    Returns default values if no URL is provided.</span>

<span class="sd">    Args:</span>
<span class="sd">        args (argparse.Namespace): The arguments given to ``spack create``</span>
<span class="sd">        name (str): The name of the package</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: versions and hashes, and a BuildSystemAndLanguageGuesser object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Default version with hash</span>
    <span class="n">hashed_versions</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    # FIXME: Add proper versions and checksums here.</span>
<span class="s2">    # version(&quot;1.2.3&quot;, md5=&quot;0123456789abcdef0123456789abcdef&quot;)&quot;&quot;&quot;</span>

    <span class="c1"># Default version without hash</span>
    <span class="n">unhashed_versions</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    # FIXME: Add proper versions here.</span>
<span class="s2">    # version(&quot;1.2.4&quot;)&quot;&quot;&quot;</span>

    <span class="c1"># Default guesser</span>
    <span class="n">guesser</span> <span class="o">=</span> <span class="n">BuildSystemAndLanguageGuesser</span><span class="p">()</span>

    <span class="n">valid_url</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">parsed</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parsed</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">or</span> <span class="n">parsed</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
            <span class="n">valid_url</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># No point in spidering these</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">valid_url</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">template</span> <span class="o">!=</span> <span class="s2">&quot;bundle&quot;</span> <span class="ow">and</span> <span class="n">valid_url</span><span class="p">:</span>
        <span class="c1"># Find available versions</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">url_dict</span> <span class="o">=</span> <span class="n">find_versions_of_archive</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">url_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">batch</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">isatty</span><span class="p">():</span>
                <span class="n">url_dict_filtered</span> <span class="o">=</span> <span class="n">spack</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">interactive_version_filter</span><span class="p">(</span><span class="n">url_dict</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">url_dict_filtered</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">url_dict</span> <span class="o">=</span> <span class="n">url_dict_filtered</span>
        <span class="k">except</span> <span class="n">UndetectableVersionError</span><span class="p">:</span>
            <span class="c1"># Use fake versions</span>
            <span class="n">tty</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t detect version in: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">url</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">hashed_versions</span><span class="p">,</span> <span class="n">guesser</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">url_dict</span><span class="p">:</span>
            <span class="c1"># If no versions were found, revert to what the user provided</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">parse_version</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
            <span class="n">url_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">version</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">url</span><span class="p">}</span>

        <span class="n">version_hashes</span> <span class="o">=</span> <span class="n">spack</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">get_checksums_for_versions</span><span class="p">(</span>
            <span class="n">url_dict</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">first_stage_function</span><span class="o">=</span><span class="n">guesser</span><span class="p">,</span> <span class="n">keep_stage</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">keep_stage</span>
        <span class="p">)</span>

        <span class="n">versions</span> <span class="o">=</span> <span class="n">get_version_lines</span><span class="p">(</span><span class="n">version_hashes</span><span class="p">,</span> <span class="n">url_dict</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">versions</span> <span class="o">=</span> <span class="n">unhashed_versions</span>

    <span class="k">return</span> <span class="n">versions</span><span class="p">,</span> <span class="n">guesser</span></div>



<div class="viewcode-block" id="get_build_system">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.get_build_system">[docs]</a>
<span class="k">def</span> <span class="nf">get_build_system</span><span class="p">(</span><span class="n">template</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">guesser</span><span class="p">:</span> <span class="n">BuildSystemAndLanguageGuesser</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine the build system template.</span>

<span class="sd">    If a template is specified, always use that. Otherwise, if a URL</span>
<span class="sd">    is provided, download the tarball and peek inside to guess what</span>
<span class="sd">    build system it uses. Otherwise, use a generic template by default.</span>

<span class="sd">    Args:</span>
<span class="sd">        template: ``--template`` argument given to ``spack create``</span>
<span class="sd">        url: ``url`` argument given to ``spack create``</span>
<span class="sd">        guesser: The first_stage_function given to ``spack checksum`` which records the build</span>
<span class="sd">            system it detects</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The name of the build system template to use</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Default template</span>
    <span class="n">selected_template</span> <span class="o">=</span> <span class="s2">&quot;generic&quot;</span>

    <span class="k">if</span> <span class="n">template</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">selected_template</span> <span class="o">=</span> <span class="n">template</span>
        <span class="c1"># Use a user-supplied template if one is present</span>
        <span class="n">tty</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Using specified package template: &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">selected_template</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Use whatever build system the guesser detected</span>
        <span class="n">selected_template</span> <span class="o">=</span> <span class="n">guesser</span><span class="o">.</span><span class="n">build_system</span>
        <span class="k">if</span> <span class="n">selected_template</span> <span class="o">==</span> <span class="s2">&quot;generic&quot;</span><span class="p">:</span>
            <span class="n">tty</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Unable to detect a build system. Using a generic package template.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;This package looks like it uses the </span><span class="si">{0}</span><span class="s2"> build system&quot;</span>
            <span class="n">tty</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">selected_template</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">selected_template</span></div>



<div class="viewcode-block" id="get_repository">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.get_repository">[docs]</a>
<span class="k">def</span> <span class="nf">get_repository</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a Repo object that will allow us to determine the path where</span>
<span class="sd">    the new package file should be created.</span>

<span class="sd">    Args:</span>
<span class="sd">        args (argparse.Namespace): The arguments given to ``spack create``</span>
<span class="sd">        name (str): The name of the package to create</span>

<span class="sd">    Returns:</span>
<span class="sd">        spack.repo.Repo: A Repo object capable of determining the path to the</span>
<span class="sd">            package file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">Spec</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="c1"># Figure out namespace for spec</span>
    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">namespace</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">namespace</span> <span class="ow">and</span> <span class="n">spec</span><span class="o">.</span><span class="n">namespace</span> <span class="o">!=</span> <span class="n">args</span><span class="o">.</span><span class="n">namespace</span><span class="p">:</span>
        <span class="n">tty</span><span class="o">.</span><span class="n">die</span><span class="p">(</span><span class="s2">&quot;Namespaces &#39;</span><span class="si">{0}</span><span class="s2">&#39; and &#39;</span><span class="si">{1}</span><span class="s2">&#39; do not match.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">namespace</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="o">.</span><span class="n">namespace</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">namespace</span><span class="p">:</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">namespace</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">namespace</span>

    <span class="c1"># Figure out where the new package should live</span>
    <span class="n">repo_path</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">repo</span>
    <span class="k">if</span> <span class="n">repo_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">repo</span> <span class="o">=</span> <span class="n">spack</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">from_path</span><span class="p">(</span><span class="n">repo_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">namespace</span> <span class="ow">and</span> <span class="n">spec</span><span class="o">.</span><span class="n">namespace</span> <span class="o">!=</span> <span class="n">repo</span><span class="o">.</span><span class="n">namespace</span><span class="p">:</span>
            <span class="n">tty</span><span class="o">.</span><span class="n">die</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t create package with namespace </span><span class="si">{0}</span><span class="s2"> in repo with &quot;</span>
                <span class="s2">&quot;namespace </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="n">repo</span><span class="o">.</span><span class="n">namespace</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">namespace</span><span class="p">:</span>
            <span class="n">repo</span> <span class="o">=</span> <span class="n">spack</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">PATH</span><span class="o">.</span><span class="n">get_repo</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">namespace</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">repo</span> <span class="o">=</span> <span class="n">spack</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">PATH</span><span class="o">.</span><span class="n">first_repo</span><span class="p">()</span>

    <span class="c1"># Set the namespace on the spec if it&#39;s not there already</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="o">.</span><span class="n">namespace</span><span class="p">:</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">namespace</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">namespace</span>

    <span class="k">return</span> <span class="n">repo</span></div>



<div class="viewcode-block" id="create">
<a class="viewcode-back" href="../../../spack.cmd.html#spack.cmd.create.create">[docs]</a>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="c1"># Gather information about the package to be created</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">get_name</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">get_url</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
    <span class="n">versions</span><span class="p">,</span> <span class="n">guesser</span> <span class="o">=</span> <span class="n">get_versions</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">build_system</span> <span class="o">=</span> <span class="n">get_build_system</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">guesser</span><span class="p">)</span>

    <span class="c1"># Create the package template object</span>
    <span class="n">constr_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;versions&quot;</span><span class="p">:</span> <span class="n">versions</span><span class="p">,</span> <span class="s2">&quot;languages&quot;</span><span class="p">:</span> <span class="n">guesser</span><span class="o">.</span><span class="n">languages</span><span class="p">}</span>
    <span class="n">package_class</span> <span class="o">=</span> <span class="n">templates</span><span class="p">[</span><span class="n">build_system</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">package_class</span> <span class="o">!=</span> <span class="n">BundlePackageTemplate</span><span class="p">:</span>
        <span class="n">constr_args</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url</span>
    <span class="n">package</span> <span class="o">=</span> <span class="n">package_class</span><span class="p">(</span><span class="o">**</span><span class="n">constr_args</span><span class="p">)</span>
    <span class="n">tty</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Created template for </span><span class="si">{0}</span><span class="s2"> package&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="c1"># Create a directory for the new package</span>
    <span class="n">repo</span> <span class="o">=</span> <span class="n">get_repository</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">pkg_path</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">filename_for_package_name</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pkg_path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">force</span><span class="p">:</span>
        <span class="n">tty</span><span class="o">.</span><span class="n">die</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> already exists.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pkg_path</span><span class="p">),</span>
            <span class="s2">&quot;  Try running `spack create --force` to overwrite it.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mkdirp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">pkg_path</span><span class="p">))</span>

    <span class="c1"># Write the new package file</span>
    <span class="n">package</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pkg_path</span><span class="p">)</span>
    <span class="n">tty</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Created package file: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pkg_path</span><span class="p">))</span>

    <span class="c1"># Optionally open up the new package file in your $EDITOR</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">skip_editor</span><span class="p">:</span>
        <span class="n">editor</span><span class="p">(</span><span class="n">pkg_path</span><span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2023, Lawrence Livermore National Laboratory..
      <span class="lastupdated">Last updated on Sep 20, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>