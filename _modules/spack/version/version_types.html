

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>spack.version.version_types &mdash; Spack 0.23.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=5f00b823" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=832b3b9f"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S0PQ7WV75K"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S0PQ7WV75K');
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/spack-logo-white-text.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Feature Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../basic_usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../replace_conda_homebrew.html">Spack for Homebrew/Conda Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../frequently_asked_questions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://spack-tutorial.readthedocs.io">Tutorial (spack-tutorial.rtfd.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://packages.spack.io">Packages (packages.spack.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cache.spack.io">Binaries (binaries.spack.io)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../config_yaml.html">Spack Settings (config.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../packages_yaml.html">Package Settings (packages.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build_settings.html">Concretization Settings (concretizer.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../environments.html">Environments (spack.yaml, spack.lock)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../containers.html">Container Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mirrors.html">Mirrors (mirrors.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_file_support.html">Modules (modules.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../repositories.html">Package Repositories (repos.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../binary_caches.html">Build Caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bootstrapping.html">Bootstrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../command_index.html">Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../chain.html">Chaining Spack Installations (upstreams.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extensions.html">Custom Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pipelines.html">CI Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../signing.html">Spack Package Signing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu_configuration.html">Using External GPU Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contribution_guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../packaging_guide.html">Packaging Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build_systems.html">Build Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../spack.html">Spack API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../llnl.html">LLNL API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Spack</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../spack.html">spack</a></li>
      <li class="breadcrumb-item active">spack.version.version_types</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for spack.version.version_types</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2013-2024 Lawrence Livermore National Security, LLC and other</span>
<span class="c1"># Spack Project Developers. See the top-level COPYRIGHT file for details.</span>
<span class="c1">#</span>
<span class="c1"># SPDX-License-Identifier: (Apache-2.0 OR MIT)</span>

<span class="kn">import</span> <span class="nn">numbers</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">bisect</span> <span class="kn">import</span> <span class="n">bisect_left</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">spack.util.spack_yaml</span> <span class="kn">import</span> <span class="n">syaml_dict</span>

<span class="kn">from</span> <span class="nn">.common</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ALPHA</span><span class="p">,</span>
    <span class="n">COMMIT_VERSION</span><span class="p">,</span>
    <span class="n">FINAL</span><span class="p">,</span>
    <span class="n">PRERELEASE_TO_STRING</span><span class="p">,</span>
    <span class="n">STRING_TO_PRERELEASE</span><span class="p">,</span>
    <span class="n">EmptyRangeError</span><span class="p">,</span>
    <span class="n">VersionLookupError</span><span class="p">,</span>
    <span class="n">infinity_versions</span><span class="p">,</span>
    <span class="n">is_git_version</span><span class="p">,</span>
    <span class="n">iv_min_len</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.lookup</span> <span class="kn">import</span> <span class="n">AbstractRefLookup</span>

<span class="c1"># Valid version characters</span>
<span class="n">VALID_VERSION</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[A-Za-z0-9_.-][=A-Za-z0-9_.-]*$&quot;</span><span class="p">)</span>

<span class="c1"># regex for version segments</span>
<span class="n">SEGMENT_REGEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?:(?P&lt;num&gt;[0-9]+)|(?P&lt;str&gt;[a-zA-Z]+))(?P&lt;sep&gt;[_.-]*)&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="VersionStrComponent">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionStrComponent">[docs]</a>
<span class="k">class</span> <span class="nc">VersionStrComponent</span><span class="p">:</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># int for infinity index, str for literal.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

<div class="viewcode-block" id="VersionStrComponent.from_string">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionStrComponent.from_string">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">iv_min_len</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">string</span> <span class="o">=</span> <span class="n">infinity_versions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="n">VersionStrComponent</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;infinity&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">infinity_versions</span><span class="p">)</span> <span class="k">else</span> <span class="n">infinity_versions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;VersionStrComponent(&quot;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s1">&quot;)&#39;</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VersionStrComponent</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">lhs_inf</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">lhs_inf</span>
        <span class="n">rhs_inf</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="ow">not</span> <span class="n">lhs_inf</span> <span class="ow">and</span> <span class="n">rhs_inf</span><span class="p">)</span> <span class="k">if</span> <span class="n">lhs_inf</span> <span class="o">^</span> <span class="n">rhs_inf</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">&lt;</span> <span class="n">other</span> <span class="ow">or</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">lhs_inf</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">lhs_inf</span>
        <span class="n">rhs_inf</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">lhs_inf</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rhs_inf</span><span class="p">)</span> <span class="k">if</span> <span class="n">lhs_inf</span> <span class="o">^</span> <span class="n">rhs_inf</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">&gt;</span> <span class="n">other</span> <span class="ow">or</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span></div>



<div class="viewcode-block" id="parse_string_components">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.parse_string_components">[docs]</a>
<span class="k">def</span> <span class="nf">parse_string_components</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]:</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">string</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">VALID_VERSION</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Bad characters in version string: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">string</span><span class="p">)</span>

    <span class="n">segments</span> <span class="o">=</span> <span class="n">SEGMENT_REGEX</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="n">separators</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">)</span>
    <span class="n">prerelease</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>

    <span class="c1"># &lt;version&gt;(alpha|beta|rc)&lt;number&gt;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">segments</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">STRING_TO_PRERELEASE</span> <span class="ow">and</span> <span class="n">segments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">prerelease</span> <span class="o">=</span> <span class="p">(</span><span class="n">STRING_TO_PRERELEASE</span><span class="p">[</span><span class="n">segments</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span> <span class="nb">int</span><span class="p">(</span><span class="n">segments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># &lt;version&gt;(alpha|beta|rc)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">segments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">STRING_TO_PRERELEASE</span><span class="p">:</span>
        <span class="n">prerelease</span> <span class="o">=</span> <span class="p">(</span><span class="n">STRING_TO_PRERELEASE</span><span class="p">[</span><span class="n">segments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]],)</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># &lt;version&gt;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prerelease</span> <span class="o">=</span> <span class="p">(</span><span class="n">FINAL</span><span class="p">,)</span>

    <span class="n">release</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="n">VersionStrComponent</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">release</span><span class="p">,</span> <span class="n">prerelease</span><span class="p">),</span> <span class="n">separators</span></div>



<div class="viewcode-block" id="ConcreteVersion">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.ConcreteVersion">[docs]</a>
<span class="k">class</span> <span class="nc">ConcreteVersion</span><span class="p">:</span>
    <span class="k">pass</span></div>



<span class="k">def</span> <span class="nf">_stringify_version</span><span class="p">(</span><span class="n">versions</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span> <span class="n">separators</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">release</span><span class="p">,</span> <span class="n">prerelease</span> <span class="o">=</span> <span class="n">versions</span>
    <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">release</span><span class="p">)):</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">release</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}{</span><span class="n">separators</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">prerelease</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">FINAL</span><span class="p">:</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">PRERELEASE_TO_STRING</span><span class="p">[</span><span class="n">prerelease</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="si">}{</span><span class="n">separators</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">release</span><span class="p">)]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prerelease</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">prerelease</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">string</span>


<div class="viewcode-block" id="StandardVersion">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.StandardVersion">[docs]</a>
<span class="k">class</span> <span class="nc">StandardVersion</span><span class="p">(</span><span class="n">ConcreteVersion</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to represent versions&quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;separators&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">version</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span> <span class="n">separators</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">separators</span> <span class="o">=</span> <span class="n">separators</span>

<div class="viewcode-block" id="StandardVersion.from_string">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.StandardVersion.from_string">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">StandardVersion</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">*</span><span class="n">parse_string_components</span><span class="p">(</span><span class="n">string</span><span class="p">))</span></div>


<div class="viewcode-block" id="StandardVersion.typemin">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.StandardVersion.typemin">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">typemin</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">_STANDARD_VERSION_TYPEMIN</span></div>


<div class="viewcode-block" id="StandardVersion.typemax">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.StandardVersion.typemax">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">typemax</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">_STANDARD_VERSION_TYPEMAX</span></div>


    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">version</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">version</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">version</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="c1"># Use &lt;= here so that Version(x) &lt; ClosedOpenRange(Version(x), ...).</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">lo</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">version</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="c1"># Versions are never equal to ranges, so follow &lt; logic.</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">lo</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">version</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="c1"># Versions are never equal to ranges, so follow &gt; logic.</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">lo</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">version</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">lo</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">release</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">release</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">string_arg</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">pairs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">release</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">separators</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">sep</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
                <span class="n">string_arg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">))</span>
                <span class="n">string_arg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sep</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">string_arg</span><span class="p">:</span>
                <span class="n">string_arg</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>  <span class="c1"># We don&#39;t need the last separator</span>
                <span class="n">string_arg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">string_arg</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">string_arg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">StandardVersion</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{cls.__name__}</span><span class="s2"> indices must be integers&quot;</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span> <span class="ow">or</span> <span class="n">_stringify_version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">separators</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Print indirect repr through Version(...)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Version(&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;)&#39;</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># If this is a final release, do not hash the prerelease part for backward compat.</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_prerelease</span><span class="p">()</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="c1"># We should probably get rid of `x in y` for versions, since</span>
        <span class="c1"># versions still have a dual interpretation as singleton sets</span>
        <span class="c1"># or elements. x in y should be: is the lhs-element in the</span>
        <span class="c1"># rhs-set. Instead this function also does subset checks.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="p">(</span><span class="n">StandardVersion</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span>

<div class="viewcode-block" id="StandardVersion.intersects">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.StandardVersion.intersects">[docs]</a>
    <span class="k">def</span> <span class="nf">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;StandardVersion&quot;</span><span class="p">,</span> <span class="s2">&quot;GitVersion&quot;</span><span class="p">,</span> <span class="s2">&quot;ClosedOpenRange&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="StandardVersion.overlaps">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.StandardVersion.overlaps">[docs]</a>
    <span class="k">def</span> <span class="nf">overlaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>


<div class="viewcode-block" id="StandardVersion.satisfies">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.StandardVersion.satisfies">[docs]</a>
    <span class="k">def</span> <span class="nf">satisfies</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;ClosedOpenRange&quot;</span><span class="p">,</span> <span class="s2">&quot;StandardVersion&quot;</span><span class="p">,</span> <span class="s2">&quot;GitVersion&quot;</span><span class="p">,</span> <span class="s2">&quot;VersionList&quot;</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GitVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">NotImplemented</span></div>


<div class="viewcode-block" id="StandardVersion.union">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.StandardVersion.union">[docs]</a>
    <span class="k">def</span> <span class="nf">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;ClosedOpenRange&quot;</span><span class="p">,</span> <span class="s2">&quot;StandardVersion&quot;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span> <span class="k">else</span> <span class="n">VersionList</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="StandardVersion.intersection">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.StandardVersion.intersection">[docs]</a>
    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;ClosedOpenRange&quot;</span><span class="p">,</span> <span class="s2">&quot;StandardVersion&quot;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span> <span class="k">else</span> <span class="n">VersionList</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="StandardVersion.isdevelop">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.StandardVersion.isdevelop">[docs]</a>
    <span class="k">def</span> <span class="nf">isdevelop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Triggers on the special case of the `@develop-like` version.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">VersionStrComponent</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="StandardVersion.is_prerelease">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.StandardVersion.is_prerelease">[docs]</a>
    <span class="k">def</span> <span class="nf">is_prerelease</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">FINAL</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dotted_numeric_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replaces all non-numeric components of the version with 0.</span>

<span class="sd">        This can be used to pass Spack versions to libraries that have stricter version schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">numeric</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">VersionStrComponent</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_prerelease</span><span class="p">():</span>
            <span class="n">numeric</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">return</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">numeric</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dotted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The dotted representation of the version.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; version = Version(&#39;1-2-3b&#39;)</span>
<span class="sd">        &gt;&gt;&gt; version.dotted</span>
<span class="sd">        Version(&#39;1.2.3b&#39;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Version: The version with separator characters replaced by dots</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">underscored</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The underscored representation of the version.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; version = Version(&#39;1.2.3b&#39;)</span>
<span class="sd">        &gt;&gt;&gt; version.underscored</span>
<span class="sd">        Version(&#39;1_2_3b&#39;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Version: The version with separator characters replaced by</span>
<span class="sd">                underscores</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dashed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The dashed representation of the version.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; version = Version(&#39;1.2.3b&#39;)</span>
<span class="sd">        &gt;&gt;&gt; version.dashed</span>
<span class="sd">        Version(&#39;1-2-3b&#39;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Version: The version with separator characters replaced by dashes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">joined</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The joined representation of the version.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; version = Version(&#39;1.2.3b&#39;)</span>
<span class="sd">        &gt;&gt;&gt; version.joined</span>
<span class="sd">        Version(&#39;123b&#39;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Version: The version with separator characters removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="p">)</span>

<div class="viewcode-block" id="StandardVersion.up_to">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.StandardVersion.up_to">[docs]</a>
    <span class="k">def</span> <span class="nf">up_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The version up to the specified component.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; version = Version(&#39;1.23-4b&#39;)</span>
<span class="sd">        &gt;&gt;&gt; version.up_to(1)</span>
<span class="sd">        Version(&#39;1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; version.up_to(2)</span>
<span class="sd">        Version(&#39;1.23&#39;)</span>
<span class="sd">        &gt;&gt;&gt; version.up_to(3)</span>
<span class="sd">        Version(&#39;1.23-4&#39;)</span>
<span class="sd">        &gt;&gt;&gt; version.up_to(4)</span>
<span class="sd">        Version(&#39;1.23-4b&#39;)</span>
<span class="sd">        &gt;&gt;&gt; version.up_to(-1)</span>
<span class="sd">        Version(&#39;1.23-4&#39;)</span>
<span class="sd">        &gt;&gt;&gt; version.up_to(-2)</span>
<span class="sd">        Version(&#39;1.23&#39;)</span>
<span class="sd">        &gt;&gt;&gt; version.up_to(-3)</span>
<span class="sd">        Version(&#39;1&#39;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Version: The first index components of the version</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[:</span><span class="n">index</span><span class="p">]</span></div>
</div>



<span class="n">_STANDARD_VERSION_TYPEMIN</span> <span class="o">=</span> <span class="n">StandardVersion</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">((),</span> <span class="p">(</span><span class="n">ALPHA</span><span class="p">,)),</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,))</span>

<span class="n">_STANDARD_VERSION_TYPEMAX</span> <span class="o">=</span> <span class="n">StandardVersion</span><span class="p">(</span>
    <span class="s2">&quot;infinity&quot;</span><span class="p">,</span> <span class="p">((</span><span class="n">VersionStrComponent</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">infinity_versions</span><span class="p">)),),</span> <span class="p">(</span><span class="n">FINAL</span><span class="p">,)),</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,)</span>
<span class="p">)</span>


<div class="viewcode-block" id="GitVersion">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.GitVersion">[docs]</a>
<span class="k">class</span> <span class="nc">GitVersion</span><span class="p">(</span><span class="n">ConcreteVersion</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to represent versions interpreted from git refs.</span>

<span class="sd">    There are two distinct categories of git versions:</span>

<span class="sd">    1) GitVersions instantiated with an associated reference version (e.g. &#39;git.foo=1.2&#39;)</span>
<span class="sd">    2) GitVersions requiring commit lookups</span>

<span class="sd">    Git ref versions that are not paired with a known version are handled separately from</span>
<span class="sd">    all other version comparisons. When Spack identifies a git ref version, it associates a</span>
<span class="sd">    ``CommitLookup`` object with the version. This object handles caching of information</span>
<span class="sd">    from the git repo. When executing comparisons with a git ref version, Spack queries the</span>
<span class="sd">    ``CommitLookup`` for the most recent version previous to this git ref, as well as the</span>
<span class="sd">    distance between them expressed as a number of commits. If the previous version is</span>
<span class="sd">    ``X.Y.Z`` and the distance is ``D``, the git commit version is represented by the</span>
<span class="sd">    tuple ``(X, Y, Z, &#39;&#39;, D)``. The component ``&#39;&#39;`` cannot be parsed as part of any valid</span>
<span class="sd">    version, but is a valid component. This allows a git ref version to be less than (older</span>
<span class="sd">    than) every Version newer than its previous version, but still newer than its previous</span>
<span class="sd">    version.</span>

<span class="sd">    To find the previous version from a git ref version, Spack queries the git repo for its</span>
<span class="sd">    tags. Any tag that matches a version known to Spack is associated with that version, as</span>
<span class="sd">    is any tag that is a known version prepended with the character ``v`` (i.e., a tag</span>
<span class="sd">    ``v1.0`` is associated with the known version ``1.0``). Additionally, any tag that</span>
<span class="sd">    represents a semver version (X.Y.Z with X, Y, Z all integers) is associated with the</span>
<span class="sd">    version it represents, even if that version is not known to Spack. Each tag is then</span>
<span class="sd">    queried in git to see whether it is an ancestor of the git ref in question, and if so</span>
<span class="sd">    the distance between the two. The previous version is the version that is an ancestor</span>
<span class="sd">    with the least distance from the git ref in question.</span>

<span class="sd">    This procedure can be circumvented if the user supplies a known version to associate</span>
<span class="sd">    with the GitVersion (e.g. ``[hash]=develop``).  If the user prescribes the version then</span>
<span class="sd">    there is no need to do a lookup and the standard version comparison operations are</span>
<span class="sd">    sufficient.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ref&quot;</span><span class="p">,</span> <span class="s2">&quot;has_git_prefix&quot;</span><span class="p">,</span> <span class="s2">&quot;is_commit&quot;</span><span class="p">,</span> <span class="s2">&quot;_ref_lookup&quot;</span><span class="p">,</span> <span class="s2">&quot;_ref_version&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># An object that can lookup git refs to compare them to versions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ref_lookup</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AbstractRefLookup</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># This is the effective version.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ref_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StandardVersion</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">has_git_prefix</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;git.&quot;</span><span class="p">)</span>

        <span class="c1"># Drop `git.` prefix</span>
        <span class="n">normalized_string</span> <span class="o">=</span> <span class="n">string</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_git_prefix</span> <span class="k">else</span> <span class="n">string</span>

        <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">normalized_string</span><span class="p">:</span>
            <span class="c1"># Store the git reference, and parse the user provided version.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">spack_version</span> <span class="o">=</span> <span class="n">normalized_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ref_version</span> <span class="o">=</span> <span class="n">StandardVersion</span><span class="p">(</span>
                <span class="n">spack_version</span><span class="p">,</span> <span class="o">*</span><span class="n">parse_string_components</span><span class="p">(</span><span class="n">spack_version</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># The ref_version is lazily attached after parsing, since we don&#39;t know what</span>
            <span class="c1"># package it applies to here.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ref_version</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref</span> <span class="o">=</span> <span class="n">normalized_string</span>

        <span class="c1"># Used by fetcher</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span> <span class="o">==</span> <span class="mi">40</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="n">COMMIT_VERSION</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ref_version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StandardVersion</span><span class="p">:</span>
        <span class="c1"># Return cached version if we have it</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ref_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ref_version</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_lookup</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VersionLookupError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;git ref &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="si">}</span><span class="s2">&#39; cannot be looked up: &quot;</span> <span class="s2">&quot;call attach_lookup first&quot;</span>
            <span class="p">)</span>

        <span class="n">version_string</span><span class="p">,</span> <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span>
        <span class="n">version_string</span> <span class="o">=</span> <span class="n">version_string</span> <span class="ow">or</span> <span class="s2">&quot;0&quot;</span>

        <span class="c1"># Add a -git.&lt;distance&gt; suffix when we&#39;re not exactly on a tag</span>
        <span class="k">if</span> <span class="n">distance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">version_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;-git.</span><span class="si">{</span><span class="n">distance</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ref_version</span> <span class="o">=</span> <span class="n">StandardVersion</span><span class="p">(</span>
            <span class="n">version_string</span><span class="p">,</span> <span class="o">*</span><span class="n">parse_string_components</span><span class="p">(</span><span class="n">version_string</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ref_version</span>

<div class="viewcode-block" id="GitVersion.intersects">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.GitVersion.intersects">[docs]</a>
    <span class="k">def</span> <span class="nf">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># For concrete things intersects = satisfies = equality</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GitVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="k">for</span> <span class="n">rhs</span> <span class="ow">in</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GitVersion.intersection">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.GitVersion.intersection">[docs]</a>
    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ConcreteVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span> <span class="k">else</span> <span class="n">VersionList</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="GitVersion.overlaps">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.GitVersion.overlaps">[docs]</a>
    <span class="k">def</span> <span class="nf">overlaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>


<div class="viewcode-block" id="GitVersion.satisfies">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.GitVersion.satisfies">[docs]</a>
    <span class="k">def</span> <span class="nf">satisfies</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;GitVersion&quot;</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">,</span> <span class="s2">&quot;ClosedOpenRange&quot;</span><span class="p">,</span> <span class="s2">&quot;VersionList&quot;</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="c1"># Concrete versions mean we have to do an equality check</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GitVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="k">for</span> <span class="n">rhs</span> <span class="ow">in</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;git.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_git_prefix</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span>
        <span class="c1"># Note: the solver actually depends on str(...) to produce the effective version.</span>
        <span class="c1"># So when a lookup is attached, we require the resolved version to be printed.</span>
        <span class="c1"># But for standalone git versions that don&#39;t have a repo attached, it would still</span>
        <span class="c1"># be nice if we could print @&lt;hash&gt;.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">except</span> <span class="n">VersionLookupError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;GitVersion(&quot;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s1">&quot;)&#39;</span>

    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># GitVersion cannot be equal to StandardVersion, otherwise == is not transitive</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GitVersion</span><span class="p">)</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">ref</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">ref_version</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GitVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">ref_version</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="c1"># GitVersion at equal ref version is larger than StandardVersion</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span> <span class="o">&lt;</span> <span class="n">other</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span> <span class="o">&lt;</span> <span class="n">other</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GitVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">ref_version</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="c1"># Note: GitVersion hash=1.2.3 &gt; StandardVersion 1.2.3, so use &lt; comparsion.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span> <span class="o">&lt;</span> <span class="n">other</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="c1"># Equality is not a thing</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span> <span class="o">&lt;</span> <span class="n">other</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GitVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">ref_version</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="c1"># Note: GitVersion hash=1.2.3 &gt; StandardVersion 1.2.3, so use &gt;= here.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span> <span class="o">&gt;=</span> <span class="n">other</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span> <span class="o">&gt;</span> <span class="n">other</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GitVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">ref_version</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="c1"># Note: GitVersion hash=1.2.3 &gt; StandardVersion 1.2.3, so use &gt;= here.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span> <span class="o">&gt;=</span> <span class="n">other</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span> <span class="o">&gt;</span> <span class="n">other</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># hashing should not cause version lookup</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not implemented yet&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ref_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ref_lookup</span><span class="p">:</span>
            <span class="c1"># Get operation ensures dict is populated</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ref_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ref_lookup</span>

<div class="viewcode-block" id="GitVersion.attach_lookup">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.GitVersion.attach_lookup">[docs]</a>
    <span class="k">def</span> <span class="nf">attach_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lookup</span><span class="p">:</span> <span class="n">AbstractRefLookup</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the git fetcher to look up a version for a commit.</span>

<span class="sd">        Since we want to optimize the clone and lookup, we do the clone once</span>
<span class="sd">        and store it in the user specified git repository cache. We also need</span>
<span class="sd">        context of the package to get known versions, which could be tags if</span>
<span class="sd">        they are linked to Git Releases. If we are unable to determine the</span>
<span class="sd">        context of the version, we cannot continue. This implementation is</span>
<span class="sd">        alongside the GitFetcher because eventually the git repos cache will</span>
<span class="sd">        be one and the same with the source cache.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ref_lookup</span> <span class="o">=</span> <span class="n">lookup</span></div>


    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

<div class="viewcode-block" id="GitVersion.isdevelop">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.GitVersion.isdevelop">[docs]</a>
    <span class="k">def</span> <span class="nf">isdevelop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span><span class="o">.</span><span class="n">isdevelop</span><span class="p">()</span></div>


<div class="viewcode-block" id="GitVersion.is_prerelease">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.GitVersion.is_prerelease">[docs]</a>
    <span class="k">def</span> <span class="nf">is_prerelease</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span><span class="o">.</span><span class="n">is_prerelease</span><span class="p">()</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dotted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StandardVersion</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span><span class="o">.</span><span class="n">dotted</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">underscored</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StandardVersion</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span><span class="o">.</span><span class="n">underscored</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dashed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StandardVersion</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span><span class="o">.</span><span class="n">dashed</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">joined</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StandardVersion</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span><span class="o">.</span><span class="n">joined</span>

<div class="viewcode-block" id="GitVersion.up_to">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.GitVersion.up_to">[docs]</a>
    <span class="k">def</span> <span class="nf">up_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StandardVersion</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_version</span><span class="o">.</span><span class="n">up_to</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ClosedOpenRange">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.ClosedOpenRange">[docs]</a>
<span class="k">class</span> <span class="nc">ClosedOpenRange</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lo</span><span class="p">:</span> <span class="n">StandardVersion</span><span class="p">,</span> <span class="n">hi</span><span class="p">:</span> <span class="n">StandardVersion</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">hi</span> <span class="o">&lt;</span> <span class="n">lo</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">EmptyRangeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lo</span><span class="si">}</span><span class="s2">..</span><span class="si">{</span><span class="n">hi</span><span class="si">}</span><span class="s2"> is an empty range&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">:</span> <span class="n">StandardVersion</span> <span class="o">=</span> <span class="n">lo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="p">:</span> <span class="n">StandardVersion</span> <span class="o">=</span> <span class="n">hi</span>

<div class="viewcode-block" id="ClosedOpenRange.from_version_range">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.ClosedOpenRange.from_version_range">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_version_range</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">lo</span><span class="p">:</span> <span class="n">StandardVersion</span><span class="p">,</span> <span class="n">hi</span><span class="p">:</span> <span class="n">StandardVersion</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct ClosedOpenRange from lo:hi range.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ClosedOpenRange</span><span class="p">(</span><span class="n">lo</span><span class="p">,</span> <span class="n">_next_version</span><span class="p">(</span><span class="n">hi</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">EmptyRangeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">EmptyRangeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lo</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">hi</span><span class="si">}</span><span class="s2"> is an empty range&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span></div>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This simplifies 3.1:&lt;3.2 to 3.1:3.1 to 3.1</span>
        <span class="c1"># 3:3 -&gt; 3</span>
        <span class="n">hi_prev</span> <span class="o">=</span> <span class="n">_prev_version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span> <span class="o">!=</span> <span class="n">StandardVersion</span><span class="o">.</span><span class="n">typemin</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="n">hi_prev</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>
        <span class="n">lhs</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="n">StandardVersion</span><span class="o">.</span><span class="n">typemin</span><span class="p">()</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>
        <span class="n">rhs</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">hi_prev</span> <span class="o">==</span> <span class="n">StandardVersion</span><span class="o">.</span><span class="n">typemax</span><span class="p">()</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">hi_prev</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lhs</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">rhs</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># prev_version for backward compat.</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">_prev_version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="p">)))</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span> <span class="o">&gt;</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span> <span class="o">&gt;=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span> <span class="o">&lt;=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span> <span class="o">&lt;</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="p">(</span><span class="n">ConcreteVersion</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="ClosedOpenRange.intersects">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.ClosedOpenRange.intersects">[docs]</a>
    <span class="k">def</span> <span class="nf">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ConcreteVersion</span><span class="p">,</span> <span class="s2">&quot;ClosedOpenRange&quot;</span><span class="p">,</span> <span class="s2">&quot;VersionList&quot;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span> <span class="o">&lt;=</span> <span class="n">other</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GitVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">ref_version</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">lo</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="k">for</span> <span class="n">rhs</span> <span class="ow">in</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ClosedOpenRange.satisfies">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.ClosedOpenRange.satisfies">[docs]</a>
    <span class="k">def</span> <span class="nf">satisfies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;ClosedOpenRange&quot;</span><span class="p">,</span> <span class="n">ConcreteVersion</span><span class="p">,</span> <span class="s2">&quot;VersionList&quot;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ConcreteVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">lo</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">hi</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="k">for</span> <span class="n">rhs</span> <span class="ow">in</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>


<div class="viewcode-block" id="ClosedOpenRange.overlaps">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.ClosedOpenRange.overlaps">[docs]</a>
    <span class="k">def</span> <span class="nf">overlaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;ClosedOpenRange&quot;</span><span class="p">,</span> <span class="n">ConcreteVersion</span><span class="p">,</span> <span class="s2">&quot;VersionList&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_union_if_not_disjoint</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;ClosedOpenRange&quot;</span><span class="p">,</span> <span class="n">ConcreteVersion</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;ClosedOpenRange&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Same as union, but returns None when the union is not connected. This function is not</span>
<span class="sd">        implemented for version lists as right-hand side, as that makes little sense.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span> <span class="o">&lt;=</span> <span class="n">other</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GitVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">ref_version</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="c1"># Notice &lt;= cause we want union(1:2, 3:4) = 1:4.</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">ClosedOpenRange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">lo</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">hi</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">hi</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">lo</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>

        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="ClosedOpenRange.union">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.ClosedOpenRange.union">[docs]</a>
    <span class="k">def</span> <span class="nf">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;ClosedOpenRange&quot;</span><span class="p">,</span> <span class="n">ConcreteVersion</span><span class="p">,</span> <span class="s2">&quot;VersionList&quot;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">v</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">v</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_union_if_not_disjoint</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">VersionList</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">])</span></div>


<div class="viewcode-block" id="ClosedOpenRange.intersection">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.ClosedOpenRange.intersection">[docs]</a>
    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;ClosedOpenRange&quot;</span><span class="p">,</span> <span class="n">ConcreteVersion</span><span class="p">]):</span>
        <span class="c1"># range - version -&gt; singleton or nothing.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ConcreteVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="k">else</span> <span class="n">VersionList</span><span class="p">()</span>

        <span class="c1"># range - range -&gt; range or nothing.</span>
        <span class="n">max_lo</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>
        <span class="n">min_hi</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ClosedOpenRange</span><span class="p">(</span><span class="n">max_lo</span><span class="p">,</span> <span class="n">min_hi</span><span class="p">)</span> <span class="k">if</span> <span class="n">max_lo</span> <span class="o">&lt;</span> <span class="n">min_hi</span> <span class="k">else</span> <span class="n">VersionList</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="VersionList">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionList">[docs]</a>
<span class="k">class</span> <span class="nc">VersionList</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sorted, non-redundant list of Version and ClosedOpenRange elements.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vlist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">StandardVersion</span><span class="p">,</span> <span class="n">GitVersion</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">vlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vlist</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">vlist</span> <span class="o">=</span> <span class="n">from_string</span><span class="p">(</span><span class="n">vlist</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vlist</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">=</span> <span class="n">vlist</span><span class="o">.</span><span class="n">versions</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="n">vlist</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vlist</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ver</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

<div class="viewcode-block" id="VersionList.add">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionList.add">[docs]</a>
    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">StandardVersion</span><span class="p">,</span> <span class="n">GitVersion</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">,</span> <span class="s2">&quot;VersionList&quot;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="n">StandardVersion</span><span class="p">,</span> <span class="n">GitVersion</span><span class="p">)):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
            <span class="c1"># Only insert when prev and next are not intersected.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

            <span class="c1"># Note: can span multiple concrete versions to the left (as well as to the right).</span>
            <span class="c1"># For instance insert 1.2: into [1.2, hash=1.2, 1.3, 1.4:1.5]</span>
            <span class="c1"># would bisect at i = 1 and merge i = 0 too.</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">union</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">_union_if_not_disjoint</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">union</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># disjoint</span>
                    <span class="k">break</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">union</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">union</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">_union_if_not_disjoint</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">union</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">union</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t add </span><span class="si">%s</span><span class="s2"> to VersionList&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">))</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">concrete</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConcreteVersion</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ConcreteVersion</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">concrete_range_as_version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConcreteVersion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Like concrete, but collapses VersionRange(x, x) to Version(x).</span>
<span class="sd">        This is just for compatibility with old Spack.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">ConcreteVersion</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">v</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_next_version</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span> <span class="o">==</span> <span class="n">v</span><span class="o">.</span><span class="n">hi</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">lo</span>
        <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="VersionList.copy">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionList.copy">[docs]</a>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">VersionList</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="VersionList.lowest">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionList.lowest">[docs]</a>
    <span class="k">def</span> <span class="nf">lowest</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StandardVersion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the lowest version in the list.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">((</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">)),</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="VersionList.highest">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionList.highest">[docs]</a>
    <span class="k">def</span> <span class="nf">highest</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StandardVersion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the highest version in the list.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">((</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">)),</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="VersionList.highest_numeric">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionList.highest_numeric">[docs]</a>
    <span class="k">def</span> <span class="nf">highest_numeric</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StandardVersion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the highest numeric version in the list.&quot;&quot;&quot;</span>
        <span class="n">numeric</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">v</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">isdevelop</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">numeric</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="VersionList.preferred">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionList.preferred">[docs]</a>
    <span class="k">def</span> <span class="nf">preferred</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StandardVersion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the preferred (latest) version in the list.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">highest_numeric</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">highest</span><span class="p">()</span></div>


<div class="viewcode-block" id="VersionList.satisfies">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionList.satisfies">[docs]</a>
    <span class="k">def</span> <span class="nf">satisfies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="c1"># This exploits the fact that version lists are &quot;reduced&quot; and normalized, so we can</span>
        <span class="c1"># never have a list like [1:3, 2:4] since that would be normalized to [1:4]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="k">for</span> <span class="n">rhs</span> <span class="ow">in</span> <span class="n">other</span><span class="p">)</span> <span class="k">for</span> <span class="n">lhs</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">ConcreteVersion</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">)):</span>
            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="k">for</span> <span class="n">lhs</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="VersionList.intersects">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionList.intersects">[docs]</a>
    <span class="k">def</span> <span class="nf">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">o</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="n">o</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">other</span><span class="p">[</span><span class="n">o</span><span class="p">]):</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">[</span><span class="n">o</span><span class="p">]:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">o</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">ClosedOpenRange</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">)):</span>
            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="VersionList.overlaps">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionList.overlaps">[docs]</a>
    <span class="k">def</span> <span class="nf">overlaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>


<div class="viewcode-block" id="VersionList.to_dict">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionList.to_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate human-readable dict for YAML.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">concrete</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">syaml_dict</span><span class="p">([(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]))])</span>
        <span class="k">return</span> <span class="n">syaml_dict</span><span class="p">([(</span><span class="s2">&quot;versions&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])])</span></div>


<div class="viewcode-block" id="VersionList.from_dict">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionList.from_dict">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="n">dictionary</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse dict from to_dict.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;versions&quot;</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">VersionList</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;versions&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="s2">&quot;version&quot;</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">VersionList</span><span class="p">([</span><span class="n">Version</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">])])</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Dict must have &#39;version&#39; or &#39;versions&#39; in it.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="VersionList.update">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionList.update">[docs]</a>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;VersionList&quot;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">versions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>


<div class="viewcode-block" id="VersionList.union">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionList.union">[docs]</a>
    <span class="k">def</span> <span class="nf">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;VersionList&quot;</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="VersionList.intersection">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionList.intersection">[docs]</a>
    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;VersionList&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;VersionList&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">VersionList</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span> <span class="ow">in</span> <span class="p">((</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">),</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lhs</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">bisect_left</span><span class="p">(</span><span class="n">rhs</span><span class="o">.</span><span class="n">versions</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhs</span><span class="p">):</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="VersionList.intersect">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionList.intersect">[docs]</a>
    <span class="k">def</span> <span class="nf">intersect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Intersect this spec&#39;s list with other.</span>

<span class="sd">        Return True if the spec changed as a result; False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">isection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="n">isection</span><span class="o">.</span><span class="n">versions</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">=</span> <span class="n">isection</span><span class="o">.</span><span class="n">versions</span>
        <span class="k">return</span> <span class="n">changed</span></div>


    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">ClosedOpenRange</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">)):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">other</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">other</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__reversed__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">versions</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">versions</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">versions</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">versions</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">versions</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">versions</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="k">return</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">)</span></div>



<span class="k">def</span> <span class="nf">_next_str</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Produce the next string of A-Z and a-z characters&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
        <span class="k">else</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;a&quot;</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span> <span class="k">else</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_prev_str</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Produce the previous string of A-Z and a-z characters&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
        <span class="k">else</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;Z&quot;</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span> <span class="k">else</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_next_version_str_component</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">VersionStrComponent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionStrComponent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produce the next VersionStrComponent, where</span>
<span class="sd">    masteq -&gt; mastes</span>
<span class="sd">    master -&gt; main</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># First deal with the infinity case.</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">data</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">VersionStrComponent</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Find the next non-infinity string.</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_next_str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">infinity_versions</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">VersionStrComponent</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_prev_version_str_component</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">VersionStrComponent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionStrComponent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produce the previous VersionStrComponent, where</span>
<span class="sd">    mastes -&gt; masteq</span>
<span class="sd">    master -&gt; head</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># First deal with the infinity case. Allow underflows</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">data</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">VersionStrComponent</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Find the next string.</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_prev_str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">infinity_versions</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">VersionStrComponent</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_next_version</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">StandardVersion</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StandardVersion</span><span class="p">:</span>
    <span class="n">release</span><span class="p">,</span> <span class="n">prerelease</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">version</span>
    <span class="n">separators</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">separators</span>
    <span class="n">prerelease_type</span> <span class="o">=</span> <span class="n">prerelease</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">prerelease_type</span> <span class="o">!=</span> <span class="n">FINAL</span><span class="p">:</span>
        <span class="n">prerelease</span> <span class="o">=</span> <span class="p">(</span><span class="n">prerelease_type</span><span class="p">,</span> <span class="n">prerelease</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prerelease</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">release</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">release</span> <span class="o">=</span> <span class="p">(</span><span class="n">VersionStrComponent</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">),)</span>
        <span class="n">separators</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">release</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">VersionStrComponent</span><span class="p">):</span>
        <span class="n">release</span> <span class="o">=</span> <span class="n">release</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">_next_version_str_component</span><span class="p">(</span><span class="n">release</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">release</span> <span class="o">=</span> <span class="n">release</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">release</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,)</span>
    <span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">release</span><span class="p">))</span>
    <span class="n">components</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">release</span>
    <span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">separators</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">release</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">prerelease_type</span> <span class="o">!=</span> <span class="n">FINAL</span><span class="p">:</span>
        <span class="n">components</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">PRERELEASE_TO_STRING</span><span class="p">[</span><span class="n">prerelease_type</span><span class="p">],</span> <span class="n">prerelease</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">StandardVersion</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">components</span><span class="p">),</span> <span class="p">(</span><span class="n">release</span><span class="p">,</span> <span class="n">prerelease</span><span class="p">),</span> <span class="n">separators</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_prev_version</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">StandardVersion</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StandardVersion</span><span class="p">:</span>
    <span class="c1"># this function does not deal with underflow, because it&#39;s always called as</span>
    <span class="c1"># _prev_version(_next_version(v)).</span>
    <span class="n">release</span><span class="p">,</span> <span class="n">prerelease</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">version</span>
    <span class="n">separators</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">separators</span>
    <span class="n">prerelease_type</span> <span class="o">=</span> <span class="n">prerelease</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">prerelease_type</span> <span class="o">!=</span> <span class="n">FINAL</span><span class="p">:</span>
        <span class="n">prerelease</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">prerelease_type</span><span class="p">,)</span> <span class="k">if</span> <span class="n">prerelease</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">prerelease_type</span><span class="p">,</span> <span class="n">prerelease</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">release</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">v</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">release</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">VersionStrComponent</span><span class="p">):</span>
        <span class="n">release</span> <span class="o">=</span> <span class="n">release</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">_prev_version_str_component</span><span class="p">(</span><span class="n">release</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">release</span> <span class="o">=</span> <span class="n">release</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">release</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,)</span>
    <span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">release</span><span class="p">))</span>
    <span class="n">components</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">release</span>
    <span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">separators</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">release</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">prerelease_type</span> <span class="o">!=</span> <span class="n">FINAL</span><span class="p">:</span>
        <span class="n">components</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">PRERELEASE_TO_STRING</span><span class="p">[</span><span class="n">prerelease_type</span><span class="p">],</span> <span class="o">*</span><span class="n">prerelease</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>

    <span class="c1"># this is only used for comparison functions, so don&#39;t bother making a string</span>
    <span class="k">return</span> <span class="n">StandardVersion</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="n">release</span><span class="p">,</span> <span class="n">prerelease</span><span class="p">),</span> <span class="n">separators</span><span class="p">)</span>


<div class="viewcode-block" id="Version">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.Version">[docs]</a>
<span class="k">def</span> <span class="nf">Version</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GitVersion</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">]:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot construct a version from </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_git_version</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GitVersion</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">StandardVersion</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">))</span></div>



<div class="viewcode-block" id="VersionRange">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.VersionRange">[docs]</a>
<span class="k">def</span> <span class="nf">VersionRange</span><span class="p">(</span><span class="n">lo</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">],</span> <span class="n">hi</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">]):</span>
    <span class="n">lo</span> <span class="o">=</span> <span class="n">lo</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lo</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">)</span> <span class="k">else</span> <span class="n">StandardVersion</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">lo</span><span class="p">)</span>
    <span class="n">hi</span> <span class="o">=</span> <span class="n">hi</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hi</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">)</span> <span class="k">else</span> <span class="n">StandardVersion</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">hi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ClosedOpenRange</span><span class="o">.</span><span class="n">from_version_range</span><span class="p">(</span><span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">)</span></div>



<div class="viewcode-block" id="from_string">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.from_string">[docs]</a>
<span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">VersionList</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">,</span> <span class="n">GitVersion</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a string to a version object. This is private. Client code should use ver().&quot;&quot;&quot;</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># VersionList</span>
    <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">VersionList</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">from_string</span><span class="p">,</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))))</span>

    <span class="c1"># ClosedOpenRange</span>
    <span class="k">elif</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">lo</span> <span class="o">=</span> <span class="n">StandardVersion</span><span class="o">.</span><span class="n">typemin</span><span class="p">()</span> <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="n">StandardVersion</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">hi</span> <span class="o">=</span> <span class="n">StandardVersion</span><span class="o">.</span><span class="n">typemax</span><span class="p">()</span> <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="n">StandardVersion</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">VersionRange</span><span class="p">(</span><span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">)</span>

    <span class="c1"># StandardVersion</span>
    <span class="k">elif</span> <span class="n">string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">):</span>
        <span class="c1"># @=1.2.3 is an exact version</span>
        <span class="k">return</span> <span class="n">Version</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">elif</span> <span class="n">is_git_version</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GitVersion</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># @1.2.3 is short for 1.2.3:1.2.3</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">StandardVersion</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">VersionRange</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span></div>



<div class="viewcode-block" id="ver">
<a class="viewcode-back" href="../../../spack.version.html#spack.version.ver">[docs]</a>
<span class="k">def</span> <span class="nf">ver</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">VersionList</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">,</span> <span class="n">StandardVersion</span><span class="p">,</span> <span class="n">GitVersion</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a Version, VersionRange, or VersionList from a string</span>
<span class="sd">    or list of strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">VersionList</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">from_string</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">from_string</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">StandardVersion</span><span class="p">,</span> <span class="n">GitVersion</span><span class="p">,</span> <span class="n">ClosedOpenRange</span><span class="p">,</span> <span class="n">VersionList</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;ver() can&#39;t convert </span><span class="si">%s</span><span class="s2"> to version!&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2023, Lawrence Livermore National Laboratory..
      <span class="lastupdated">Last updated on Sep 20, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>