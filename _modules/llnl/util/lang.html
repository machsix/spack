

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>llnl.util.lang &mdash; Spack 0.23.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=5f00b823" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=832b3b9f"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S0PQ7WV75K"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S0PQ7WV75K');
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/spack-logo-white-text.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Feature Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../basic_usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../replace_conda_homebrew.html">Spack for Homebrew/Conda Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../frequently_asked_questions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://spack-tutorial.readthedocs.io">Tutorial (spack-tutorial.rtfd.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://packages.spack.io">Packages (packages.spack.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cache.spack.io">Binaries (binaries.spack.io)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../config_yaml.html">Spack Settings (config.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../packages_yaml.html">Package Settings (packages.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build_settings.html">Concretization Settings (concretizer.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../environments.html">Environments (spack.yaml, spack.lock)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../containers.html">Container Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mirrors.html">Mirrors (mirrors.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_file_support.html">Modules (modules.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../repositories.html">Package Repositories (repos.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../binary_caches.html">Build Caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bootstrapping.html">Bootstrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../command_index.html">Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../chain.html">Chaining Spack Installations (upstreams.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extensions.html">Custom Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pipelines.html">CI Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../signing.html">Spack Package Signing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu_configuration.html">Using External GPU Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contribution_guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../packaging_guide.html">Packaging Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build_systems.html">Build Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../spack.html">Spack API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../llnl.html">LLNL API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Spack</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">llnl.util.lang</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for llnl.util.lang</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2013-2024 Lawrence Livermore National Security, LLC and other</span>
<span class="c1"># Spack Project Developers. See the top-level COPYRIGHT file for details.</span>
<span class="c1">#</span>
<span class="c1"># SPDX-License-Identifier: (Apache-2.0 OR MIT)</span>

<span class="kn">import</span> <span class="nn">collections.abc</span>
<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">fnmatch</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">typing</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="c1"># Ignore emacs backups when listing modules</span>
<span class="n">ignore_modules</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^\.#|~$&quot;</span>


<div class="viewcode-block" id="index_by">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.index_by">[docs]</a>
<span class="k">def</span> <span class="nf">index_by</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="o">*</span><span class="n">funcs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a hierarchy of dictionaries by splitting the supplied</span>
<span class="sd">    set of objects on unique values of the supplied functions.</span>

<span class="sd">    Values are used as keys. For example, suppose you have four</span>
<span class="sd">    objects with attributes that look like this::</span>

<span class="sd">        a = Spec(&quot;boost %gcc target=skylake&quot;)</span>
<span class="sd">        b = Spec(&quot;mrnet %intel target=zen2&quot;)</span>
<span class="sd">        c = Spec(&quot;libelf %xlc target=skylake&quot;)</span>
<span class="sd">        d = Spec(&quot;libdwarf %intel target=zen2&quot;)</span>

<span class="sd">        list_of_specs = [a,b,c,d]</span>
<span class="sd">        index1 = index_by(list_of_specs, lambda s: str(s.target),</span>
<span class="sd">                          lambda s: s.compiler)</span>
<span class="sd">        index2 = index_by(list_of_specs, lambda s: s.compiler)</span>

<span class="sd">    ``index1`` now has two levels of dicts, with lists at the</span>
<span class="sd">    leaves, like this::</span>

<span class="sd">        { &#39;zen2&#39;    : { &#39;gcc&#39; : [a], &#39;xlc&#39; : [c] },</span>
<span class="sd">          &#39;skylake&#39; : { &#39;intel&#39; : [b, d] }</span>
<span class="sd">        }</span>

<span class="sd">    And ``index2`` is a single level dictionary of lists that looks</span>
<span class="sd">    like this::</span>

<span class="sd">        { &#39;gcc&#39;    : [a],</span>
<span class="sd">          &#39;intel&#39;  : [b,d],</span>
<span class="sd">          &#39;xlc&#39;    : [c]</span>
<span class="sd">        }</span>

<span class="sd">    If any elements in funcs is a string, it is treated as the name</span>
<span class="sd">    of an attribute, and acts like getattr(object, name).  So</span>
<span class="sd">    shorthand for the above two indexes would be::</span>

<span class="sd">        index1 = index_by(list_of_specs, &#39;arch&#39;, &#39;compiler&#39;)</span>
<span class="sd">        index2 = index_by(list_of_specs, &#39;compiler&#39;)</span>

<span class="sd">    You can also index by tuples by passing tuples::</span>

<span class="sd">        index1 = index_by(list_of_specs, (&#39;target&#39;, &#39;compiler&#39;))</span>

<span class="sd">    Keys in the resulting dict will look like (&#39;gcc&#39;, &#39;skylake&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">funcs</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">objects</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">funcs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">funcs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">objects</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">index_by</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="o">*</span><span class="n">funcs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="attr_setdefault">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.attr_setdefault">[docs]</a>
<span class="k">def</span> <span class="nf">attr_setdefault</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Like dict.setdefault, but for objects.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>



<div class="viewcode-block" id="union_dicts">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.union_dicts">[docs]</a>
<span class="k">def</span> <span class="nf">union_dicts</span><span class="p">(</span><span class="o">*</span><span class="n">dicts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use update() to combine all dicts into one.</span>

<span class="sd">    This builds a new dictionary, into which we ``update()`` each element</span>
<span class="sd">    of ``dicts`` in order.  Items from later dictionaries will override</span>
<span class="sd">    items from earlier dictionaries.</span>

<span class="sd">    Args:</span>
<span class="sd">        dicts (list): list of dictionaries</span>

<span class="sd">    Return: (dict): a merged dictionary containing combined keys and</span>
<span class="sd">        values from ``dicts``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dicts</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>



<span class="c1"># Used as a sentinel that disambiguates tuples passed in *args from coincidentally</span>
<span class="c1"># matching tuples formed from kwargs item pairs.</span>
<span class="n">_kwargs_separator</span> <span class="o">=</span> <span class="p">(</span><span class="nb">object</span><span class="p">(),)</span>


<div class="viewcode-block" id="stable_args">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.stable_args">[docs]</a>
<span class="k">def</span> <span class="nf">stable_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A key factory that performs a stable sort of the parameters.&quot;&quot;&quot;</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">args</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">+=</span> <span class="n">_kwargs_separator</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">key</span></div>



<div class="viewcode-block" id="memoized">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.memoized">[docs]</a>
<span class="k">def</span> <span class="nf">memoized</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator that caches the results of a function, storing them in</span>
<span class="sd">    an attribute of that function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">func</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_memoized_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">stable_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">func</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret</span>
            <span class="k">return</span> <span class="n">ret</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># TypeError is raised when indexing into a dict if the key is unhashable.</span>
            <span class="k">raise</span> <span class="n">UnhashableArguments</span><span class="p">(</span>
                <span class="s2">&quot;args + kwargs &#39;</span><span class="si">{}</span><span class="s2">&#39; was not hashable for function &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">return</span> <span class="n">_memoized_function</span></div>



<div class="viewcode-block" id="list_modules">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.list_modules">[docs]</a>
<span class="k">def</span> <span class="nf">list_modules</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lists all of the modules, excluding ``__init__.py``, in a</span>
<span class="sd">    particular directory.  Listed packages have no particular</span>
<span class="sd">    order.&quot;&quot;&quot;</span>
    <span class="n">list_directories</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;directories&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="n">ignore</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">ignore_modules</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span> <span class="k">as</span> <span class="n">it</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;__init__.py&quot;</span> <span class="ow">or</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;__pycache__&quot;</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="n">list_directories</span>
                <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
                <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">))</span>
            <span class="p">):</span>
                <span class="k">yield</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span>

            <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ignore</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># strip .py</span></div>



<div class="viewcode-block" id="decorator_with_or_without_args">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.decorator_with_or_without_args">[docs]</a>
<span class="k">def</span> <span class="nf">decorator_with_or_without_args</span><span class="p">(</span><span class="n">decorator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Allows a decorator to be used with or without arguments, e.g.::</span>

<span class="sd">        # Calls the decorator function some args</span>
<span class="sd">        @decorator(with, arguments, and=kwargs)</span>

<span class="sd">    or::</span>

<span class="sd">        # Calls the decorator function with zero arguments</span>
<span class="sd">        @decorator</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># See https://stackoverflow.com/questions/653368 for more on this</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">decorator</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">new_dec</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="c1"># actual decorated function</span>
            <span class="k">return</span> <span class="n">decorator</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># decorator arguments</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">realf</span><span class="p">:</span> <span class="n">decorator</span><span class="p">(</span><span class="n">realf</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_dec</span></div>



<div class="viewcode-block" id="key_ordering">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.key_ordering">[docs]</a>
<span class="k">def</span> <span class="nf">key_ordering</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorates a class with extra methods that implement rich comparison</span>
<span class="sd">    operations and ``__hash__``.  The decorator assumes that the class</span>
<span class="sd">    implements a function called ``_cmp_key()``.  The rich comparison</span>
<span class="sd">    operations will compare objects using this key, and the ``__hash__``</span>
<span class="sd">    function will return the hash of this key.</span>

<span class="sd">    If a class already has ``__eq__``, ``__ne__``, ``__lt__``, ``__le__``,</span>
<span class="sd">    ``__gt__``, or ``__ge__`` defined, this decorator will overwrite them.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: If the class does not have a ``_cmp_key`` method</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">setter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">value</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">name</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;_cmp_key&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; doesn&#39;t define _cmp_key().&quot;</span><span class="p">)</span>

    <span class="n">setter</span><span class="p">(</span><span class="s2">&quot;__eq__&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="p">(</span><span class="n">s</span> <span class="ow">is</span> <span class="n">o</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">s</span><span class="o">.</span><span class="n">_cmp_key</span><span class="p">()</span> <span class="o">==</span> <span class="n">o</span><span class="o">.</span><span class="n">_cmp_key</span><span class="p">()))</span>
    <span class="n">setter</span><span class="p">(</span><span class="s2">&quot;__lt__&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">s</span><span class="o">.</span><span class="n">_cmp_key</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">o</span><span class="o">.</span><span class="n">_cmp_key</span><span class="p">())</span>
    <span class="n">setter</span><span class="p">(</span><span class="s2">&quot;__le__&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">s</span><span class="o">.</span><span class="n">_cmp_key</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">o</span><span class="o">.</span><span class="n">_cmp_key</span><span class="p">())</span>

    <span class="n">setter</span><span class="p">(</span><span class="s2">&quot;__ne__&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="p">(</span><span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">o</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">o</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">_cmp_key</span><span class="p">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="n">_cmp_key</span><span class="p">()))</span>
    <span class="n">setter</span><span class="p">(</span><span class="s2">&quot;__gt__&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">_cmp_key</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">o</span><span class="o">.</span><span class="n">_cmp_key</span><span class="p">())</span>
    <span class="n">setter</span><span class="p">(</span><span class="s2">&quot;__ge__&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">_cmp_key</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">o</span><span class="o">.</span><span class="n">_cmp_key</span><span class="p">())</span>

    <span class="n">setter</span><span class="p">(</span><span class="s2">&quot;__hash__&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmp_key</span><span class="p">()))</span>

    <span class="k">return</span> <span class="bp">cls</span></div>



<span class="c1">#: sentinel for testing that iterators are done in lazy_lexicographic_ordering</span>
<span class="n">done</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>


<div class="viewcode-block" id="tuplify">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.tuplify">[docs]</a>
<span class="k">def</span> <span class="nf">tuplify</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper for lazy_lexicographic_ordering().&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">tuplify</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">())</span></div>



<div class="viewcode-block" id="lazy_eq">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.lazy_eq">[docs]</a>
<span class="k">def</span> <span class="nf">lazy_eq</span><span class="p">(</span><span class="n">lseq</span><span class="p">,</span> <span class="n">rseq</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Equality comparison for two lazily generated sequences.</span>

<span class="sd">    See ``lazy_lexicographic_ordering``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">liter</span> <span class="o">=</span> <span class="n">lseq</span><span class="p">()</span>  <span class="c1"># call generators</span>
    <span class="n">riter</span> <span class="o">=</span> <span class="n">rseq</span><span class="p">()</span>

    <span class="c1"># zip_longest is implemented in native code, so use it for speed.</span>
    <span class="c1"># use zip_longest instead of zip because it allows us to tell</span>
    <span class="c1"># which iterator was longer.</span>
    <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">zip_longest</span><span class="p">(</span><span class="n">liter</span><span class="p">,</span> <span class="n">riter</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="n">done</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">left</span> <span class="ow">is</span> <span class="n">done</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">right</span> <span class="ow">is</span> <span class="n">done</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># recursively enumerate any generators, otherwise compare</span>
        <span class="n">equal</span> <span class="o">=</span> <span class="n">lazy_eq</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span> <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="k">else</span> <span class="n">left</span> <span class="o">==</span> <span class="n">right</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">equal</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="lazy_lt">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.lazy_lt">[docs]</a>
<span class="k">def</span> <span class="nf">lazy_lt</span><span class="p">(</span><span class="n">lseq</span><span class="p">,</span> <span class="n">rseq</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Less-than comparison for two lazily generated sequences.</span>

<span class="sd">    See ``lazy_lexicographic_ordering``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">liter</span> <span class="o">=</span> <span class="n">lseq</span><span class="p">()</span>
    <span class="n">riter</span> <span class="o">=</span> <span class="n">rseq</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">zip_longest</span><span class="p">(</span><span class="n">liter</span><span class="p">,</span> <span class="n">riter</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="n">done</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">left</span> <span class="ow">is</span> <span class="n">done</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">right</span> <span class="ow">is</span> <span class="n">done</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">left</span> <span class="ow">is</span> <span class="n">done</span>  <span class="c1"># left was shorter than right</span>

        <span class="n">sequence</span> <span class="o">=</span> <span class="nb">callable</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
        <span class="n">equal</span> <span class="o">=</span> <span class="n">lazy_eq</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span> <span class="k">if</span> <span class="n">sequence</span> <span class="k">else</span> <span class="n">left</span> <span class="o">==</span> <span class="n">right</span>
        <span class="k">if</span> <span class="n">equal</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">sequence</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lazy_lt</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">left</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span>

    <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># if equal, return False</span></div>



<div class="viewcode-block" id="lazy_lexicographic_ordering">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.lazy_lexicographic_ordering">[docs]</a>
<span class="nd">@decorator_with_or_without_args</span>
<span class="k">def</span> <span class="nf">lazy_lexicographic_ordering</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">set_hash</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorates a class with extra methods that implement rich comparison.</span>

<span class="sd">    This is a lazy version of the tuple comparison used frequently to</span>
<span class="sd">    implement comparison in Python. Given some objects with fields, you</span>
<span class="sd">    might use tuple keys to implement comparison, e.g.::</span>

<span class="sd">        class Widget:</span>
<span class="sd">            def _cmp_key(self):</span>
<span class="sd">                return (</span>
<span class="sd">                    self.a,</span>
<span class="sd">                    self.b,</span>
<span class="sd">                    (self.c, self.d),</span>
<span class="sd">                    self.e</span>
<span class="sd">                )</span>

<span class="sd">            def __eq__(self, other):</span>
<span class="sd">                return self._cmp_key() == other._cmp_key()</span>

<span class="sd">            def __lt__(self):</span>
<span class="sd">                return self._cmp_key() &lt; other._cmp_key()</span>

<span class="sd">            # etc.</span>

<span class="sd">    Python would compare ``Widgets`` lexicographically based on their</span>
<span class="sd">    tuples. The issue there for simple comparators is that we have to</span>
<span class="sd">    bulid the tuples *and* we have to generate all the values in them up</span>
<span class="sd">    front. When implementing comparisons for large data structures, this</span>
<span class="sd">    can be costly.</span>

<span class="sd">    Lazy lexicographic comparison maps the tuple comparison shown above</span>
<span class="sd">    to generator functions. Instead of comparing based on pre-constructed</span>
<span class="sd">    tuple keys, users of this decorator can compare using elements from a</span>
<span class="sd">    generator. So, you&#39;d write::</span>

<span class="sd">        @lazy_lexicographic_ordering</span>
<span class="sd">        class Widget:</span>
<span class="sd">            def _cmp_iter(self):</span>
<span class="sd">                yield a</span>
<span class="sd">                yield b</span>
<span class="sd">                def cd_fun():</span>
<span class="sd">                    yield c</span>
<span class="sd">                    yield d</span>
<span class="sd">                yield cd_fun</span>
<span class="sd">                yield e</span>

<span class="sd">            # operators are added by decorator</span>

<span class="sd">    There are no tuples preconstructed, and the generator does not have</span>
<span class="sd">    to complete. Instead of tuples, we simply make functions that lazily</span>
<span class="sd">    yield what would&#39;ve been in the tuple. The</span>
<span class="sd">    ``@lazy_lexicographic_ordering`` decorator handles the details of</span>
<span class="sd">    implementing comparison operators, and the ``Widget`` implementor</span>
<span class="sd">    only has to worry about writing ``_cmp_iter``, and making sure the</span>
<span class="sd">    elements in it are also comparable.</span>

<span class="sd">    Some things to note:</span>

<span class="sd">      * If a class already has ``__eq__``, ``__ne__``, ``__lt__``,</span>
<span class="sd">        ``__le__``, ``__gt__``, ``__ge__``, or ``__hash__`` defined, this</span>
<span class="sd">        decorator will overwrite them.</span>

<span class="sd">      * If ``set_hash`` is ``False``, this will not overwrite</span>
<span class="sd">        ``__hash__``.</span>

<span class="sd">      * This class uses Python 2 None-comparison semantics. If you yield</span>
<span class="sd">        None and it is compared to a non-None type, None will always be</span>
<span class="sd">        less than the other object.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: If the class does not have a ``_cmp_iter`` method</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;_cmp_iter&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; doesn&#39;t define _cmp_iter().&quot;</span><span class="p">)</span>

    <span class="c1"># comparison operators are implemented in terms of lazy_eq and lazy_lt</span>
    <span class="k">def</span> <span class="nf">eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">other</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">lazy_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmp_iter</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_cmp_iter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">lt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">other</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">lazy_lt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmp_iter</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_cmp_iter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">lazy_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmp_iter</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_cmp_iter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">lazy_lt</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_cmp_iter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmp_iter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">le</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">other</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lazy_lt</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_cmp_iter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmp_iter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">lazy_lt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmp_iter</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_cmp_iter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="n">tuplify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmp_iter</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">add_func_to_class</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a function to a class with a particular name.&quot;&quot;&quot;</span>
        <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">name</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>

    <span class="n">add_func_to_class</span><span class="p">(</span><span class="s2">&quot;__eq__&quot;</span><span class="p">,</span> <span class="n">eq</span><span class="p">)</span>
    <span class="n">add_func_to_class</span><span class="p">(</span><span class="s2">&quot;__ne__&quot;</span><span class="p">,</span> <span class="n">ne</span><span class="p">)</span>
    <span class="n">add_func_to_class</span><span class="p">(</span><span class="s2">&quot;__lt__&quot;</span><span class="p">,</span> <span class="n">lt</span><span class="p">)</span>
    <span class="n">add_func_to_class</span><span class="p">(</span><span class="s2">&quot;__le__&quot;</span><span class="p">,</span> <span class="n">le</span><span class="p">)</span>
    <span class="n">add_func_to_class</span><span class="p">(</span><span class="s2">&quot;__gt__&quot;</span><span class="p">,</span> <span class="n">gt</span><span class="p">)</span>
    <span class="n">add_func_to_class</span><span class="p">(</span><span class="s2">&quot;__ge__&quot;</span><span class="p">,</span> <span class="n">ge</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">set_hash</span><span class="p">:</span>
        <span class="n">add_func_to_class</span><span class="p">(</span><span class="s2">&quot;__hash__&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">cls</span></div>



<div class="viewcode-block" id="HashableMap">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.HashableMap">[docs]</a>
<span class="nd">@lazy_lexicographic_ordering</span>
<span class="k">class</span> <span class="nc">HashableMap</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">MutableMapping</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a hashable, comparable dictionary.  Hash is performed on</span>
<span class="sd">    a tuple of the values in the dictionary.&quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dict&quot;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_cmp_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">yield</span> <span class="n">v</span>

<div class="viewcode-block" id="HashableMap.copy">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.HashableMap.copy">[docs]</a>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Type-agnostic clone method.  Preserves subclass type.&quot;&quot;&quot;</span>
        <span class="c1"># Construct a new dict of my type</span>
        <span class="n">self_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">clone</span> <span class="o">=</span> <span class="n">self_type</span><span class="p">()</span>

        <span class="c1"># Copy everything from this dict into it.</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">clone</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">clone</span></div>
</div>



<div class="viewcode-block" id="match_predicate">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.match_predicate">[docs]</a>
<span class="k">def</span> <span class="nf">match_predicate</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Utility function for making string matching predicates.</span>

<span class="sd">    Each arg can be a:</span>
<span class="sd">    * regex</span>
<span class="sd">    * list or tuple of regexes</span>
<span class="sd">    * predicate that takes a string.</span>

<span class="sd">    This returns a predicate that is true if:</span>
<span class="sd">    * any arg regex matches</span>
<span class="sd">    * any regex in a list or tuple of regexes matches.</span>
<span class="sd">    * any predicate in args matches.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">arg</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;args to match_predicate must be regex, &quot;</span> <span class="s2">&quot;list of regexes, or callable.&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">match</span></div>



<div class="viewcode-block" id="dedupe">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.dedupe">[docs]</a>
<span class="k">def</span> <span class="nf">dedupe</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Yields a stable de-duplication of an hashable sequence by key</span>

<span class="sd">    Args:</span>
<span class="sd">        sequence: hashable sequence to be de-duplicated</span>
<span class="sd">        key: callable applied on values before uniqueness test; identity</span>
<span class="sd">            by default.</span>

<span class="sd">    Returns:</span>
<span class="sd">        stable de-duplication of the sequence</span>

<span class="sd">    Examples:</span>

<span class="sd">        Dedupe a list of integers:</span>

<span class="sd">            [x for x in dedupe([1, 2, 1, 3, 2])] == [1, 2, 3]</span>

<span class="sd">            [x for x in llnl.util.lang.dedupe([1,-2,1,3,2], key=abs)] == [1, -2, 3]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="n">x_key</span> <span class="o">=</span> <span class="n">x</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">key</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">x</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x_key</span><span class="p">)</span></div>



<div class="viewcode-block" id="pretty_date">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.pretty_date">[docs]</a>
<span class="k">def</span> <span class="nf">pretty_date</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">now</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a datetime or timestamp to a pretty, relative date.</span>

<span class="sd">    Args:</span>
<span class="sd">        time (datetime.datetime or int): date to print prettily</span>
<span class="sd">        now (datetime.datetime): datetime for &#39;now&#39;, i.e. the date the pretty date</span>
<span class="sd">            is relative to (default is datetime.now())</span>

<span class="sd">    Returns:</span>
<span class="sd">        (str): pretty string like &#39;an hour ago&#39;, &#39;Yesterday&#39;,</span>
<span class="sd">            &#39;3 months ago&#39;, &#39;just now&#39;, etc.</span>

<span class="sd">    Adapted from https://stackoverflow.com/questions/1551382.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">now</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">time</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;pretty_date requires a timestamp or datetime&quot;</span><span class="p">)</span>

    <span class="n">second_diff</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">seconds</span>
    <span class="n">day_diff</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">days</span>

    <span class="k">if</span> <span class="n">day_diff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">day_diff</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">second_diff</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;just now&quot;</span>
        <span class="k">if</span> <span class="n">second_diff</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">second_diff</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; seconds ago&quot;</span>
        <span class="k">if</span> <span class="n">second_diff</span> <span class="o">&lt;</span> <span class="mi">120</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;a minute ago&quot;</span>
        <span class="k">if</span> <span class="n">second_diff</span> <span class="o">&lt;</span> <span class="mi">3600</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">second_diff</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; minutes ago&quot;</span>
        <span class="k">if</span> <span class="n">second_diff</span> <span class="o">&lt;</span> <span class="mi">7200</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;an hour ago&quot;</span>
        <span class="k">if</span> <span class="n">second_diff</span> <span class="o">&lt;</span> <span class="mi">86400</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">second_diff</span> <span class="o">//</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; hours ago&quot;</span>
    <span class="k">if</span> <span class="n">day_diff</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;yesterday&quot;</span>
    <span class="k">if</span> <span class="n">day_diff</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">day_diff</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; days ago&quot;</span>
    <span class="k">if</span> <span class="n">day_diff</span> <span class="o">&lt;</span> <span class="mi">28</span><span class="p">:</span>
        <span class="n">weeks</span> <span class="o">=</span> <span class="n">day_diff</span> <span class="o">//</span> <span class="mi">7</span>
        <span class="k">if</span> <span class="n">weeks</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;a week ago&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">day_diff</span> <span class="o">//</span> <span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; weeks ago&quot;</span>
    <span class="k">if</span> <span class="n">day_diff</span> <span class="o">&lt;</span> <span class="mi">365</span><span class="p">:</span>
        <span class="n">months</span> <span class="o">=</span> <span class="n">day_diff</span> <span class="o">//</span> <span class="mi">30</span>
        <span class="k">if</span> <span class="n">months</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;a month ago&quot;</span>
        <span class="k">elif</span> <span class="n">months</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="n">months</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">months</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; months ago&quot;</span>

    <span class="n">diff</span> <span class="o">=</span> <span class="n">day_diff</span> <span class="o">//</span> <span class="mi">365</span>
    <span class="k">if</span> <span class="n">diff</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;a year ago&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; years ago&quot;</span></div>



<div class="viewcode-block" id="pretty_string_to_date">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.pretty_string_to_date">[docs]</a>
<span class="k">def</span> <span class="nf">pretty_string_to_date</span><span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="n">now</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a string representing a date and returns a datetime object.</span>

<span class="sd">    Args:</span>
<span class="sd">        date_str (str): string representing a date. This string might be</span>
<span class="sd">            in different format (like ``YYYY``, ``YYYY-MM``, ``YYYY-MM-DD``,</span>
<span class="sd">            ``YYYY-MM-DD HH:MM``, ``YYYY-MM-DD HH:MM:SS``)</span>
<span class="sd">            or be a *pretty date* (like ``yesterday`` or ``two months ago``)</span>

<span class="sd">    Returns:</span>
<span class="sd">        (datetime.datetime): datetime object corresponding to ``date_str``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pattern</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">now</span> <span class="o">=</span> <span class="n">now</span> <span class="ow">or</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="c1"># datetime formats</span>
    <span class="n">pattern</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\d</span><span class="si">{4}</span><span class="s2">$&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;%Y&quot;</span><span class="p">)</span>
    <span class="n">pattern</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\d</span><span class="si">{4}</span><span class="s2">-\d</span><span class="si">{2}</span><span class="s2">$&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;%Y-%m&quot;</span><span class="p">)</span>
    <span class="n">pattern</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\d</span><span class="si">{4}</span><span class="s2">-\d</span><span class="si">{2}</span><span class="s2">-\d</span><span class="si">{2}</span><span class="s2">$&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">pattern</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\d</span><span class="si">{4}</span><span class="s2">-\d</span><span class="si">{2}</span><span class="s2">-\d</span><span class="si">{2}</span><span class="s2"> \d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">$&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span>
    <span class="p">)</span>
    <span class="n">pattern</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\d</span><span class="si">{4}</span><span class="s2">-\d</span><span class="si">{2}</span><span class="s2">-\d</span><span class="si">{2}</span><span class="s2"> \d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">$&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span>
    <span class="p">)</span>

    <span class="n">pretty_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(a|\d+)\s*(year|month|week|day|hour|minute|second)s?\s*ago&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_n_xxx_ago</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">how_many</span><span class="p">,</span> <span class="n">time_period</span> <span class="o">=</span> <span class="n">pretty_regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>

        <span class="n">how_many</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">how_many</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">how_many</span><span class="p">)</span>

        <span class="c1"># timedelta natively supports time periods up to &#39;weeks&#39;.</span>
        <span class="c1"># To apply month or year we convert to 30 and 365 days</span>
        <span class="k">if</span> <span class="n">time_period</span> <span class="o">==</span> <span class="s2">&quot;month&quot;</span><span class="p">:</span>
            <span class="n">how_many</span> <span class="o">*=</span> <span class="mi">30</span>
            <span class="n">time_period</span> <span class="o">=</span> <span class="s2">&quot;day&quot;</span>
        <span class="k">elif</span> <span class="n">time_period</span> <span class="o">==</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span>
            <span class="n">how_many</span> <span class="o">*=</span> <span class="mi">365</span>
            <span class="n">time_period</span> <span class="o">=</span> <span class="s2">&quot;day&quot;</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{(</span><span class="n">time_period</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span><span class="p">):</span> <span class="n">how_many</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">now</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">pattern</span><span class="p">[</span><span class="n">pretty_regex</span><span class="p">]</span> <span class="o">=</span> <span class="n">_n_xxx_ago</span>

    <span class="c1"># yesterday</span>
    <span class="n">callback</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">now</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">pattern</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^yesterday$&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">callback</span>

    <span class="k">for</span> <span class="n">regexp</span><span class="p">,</span> <span class="n">parser</span> <span class="ow">in</span> <span class="n">pattern</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">regexp</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">date_str</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">parser</span><span class="p">(</span><span class="n">date_str</span><span class="p">)</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;date &quot;</span><span class="si">{0}</span><span class="s1">&quot; does not match any valid format&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">date_str</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>



<div class="viewcode-block" id="pretty_seconds_formatter">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.pretty_seconds_formatter">[docs]</a>
<span class="k">def</span> <span class="nf">pretty_seconds_formatter</span><span class="p">(</span><span class="n">seconds</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">seconds</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">multiplier</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span>
    <span class="k">elif</span> <span class="n">seconds</span> <span class="o">&gt;=</span> <span class="mf">1e-3</span><span class="p">:</span>
        <span class="n">multiplier</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="mf">1e3</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span>
    <span class="k">elif</span> <span class="n">seconds</span> <span class="o">&gt;=</span> <span class="mf">1e-6</span><span class="p">:</span>
        <span class="n">multiplier</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="mf">1e6</span><span class="p">,</span> <span class="s2">&quot;us&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">multiplier</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="mf">1e9</span><span class="p">,</span> <span class="s2">&quot;ns&quot;</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%.3f%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">multiplier</span> <span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span></div>



<div class="viewcode-block" id="pretty_seconds">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.pretty_seconds">[docs]</a>
<span class="k">def</span> <span class="nf">pretty_seconds</span><span class="p">(</span><span class="n">seconds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Seconds to string with appropriate units</span>

<span class="sd">    Arguments:</span>
<span class="sd">        seconds (float): Number of seconds</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Time string with units</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pretty_seconds_formatter</span><span class="p">(</span><span class="n">seconds</span><span class="p">)(</span><span class="n">seconds</span><span class="p">)</span></div>



<div class="viewcode-block" id="ObjectWrapper">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.ObjectWrapper">[docs]</a>
<span class="k">class</span> <span class="nc">ObjectWrapper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class that wraps an object. Derived classes can add new behavior</span>
<span class="sd">    while staying undercover.</span>

<span class="sd">    This class is modeled after the stackoverflow answer:</span>
<span class="sd">    * http://stackoverflow.com/a/1445289/771663</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrapped_object</span><span class="p">):</span>
        <span class="n">wrapped_cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">wrapped_object</span><span class="p">)</span>
        <span class="n">wrapped_name</span> <span class="o">=</span> <span class="n">wrapped_cls</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="c1"># If the wrapped object is already an ObjectWrapper, or a derived class</span>
        <span class="c1"># of it, adding type(self) in front of type(wrapped_object)</span>
        <span class="c1"># results in an inconsistent MRO.</span>
        <span class="c1">#</span>
        <span class="c1"># TODO: the implementation below doesn&#39;t account for the case where we</span>
        <span class="c1"># TODO: have different base classes of ObjectWrapper, say A and B, and</span>
        <span class="c1"># TODO: we want to wrap an instance of A with B.</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wrapped_cls</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">wrapped_name</span><span class="p">,</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">wrapped_cls</span><span class="p">),</span> <span class="p">{})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">wrapped_name</span><span class="p">,</span> <span class="p">(</span><span class="n">wrapped_cls</span><span class="p">,),</span> <span class="p">{})</span>

        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">wrapped_object</span><span class="o">.</span><span class="vm">__dict__</span></div>



<div class="viewcode-block" id="Singleton">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.Singleton">[docs]</a>
<span class="k">class</span> <span class="nc">Singleton</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple wrapper for lazily initialized singleton objects.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factory</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new singleton to be inited with the factory function.</span>

<span class="sd">        Args:</span>
<span class="sd">            factory (function): function taking no arguments that</span>
<span class="sd">                creates the singleton instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span> <span class="o">=</span> <span class="n">factory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c1"># When unpickling Singleton objects, the &#39;instance&#39; attribute may be</span>
        <span class="c1"># requested but not yet set. The final &#39;getattr&#39; line here requires</span>
        <span class="c1"># &#39;instance&#39;/&#39;_instance&#39; to be defined or it will enter an infinite</span>
        <span class="c1"># loop, so protect against that here.</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;_instance&quot;</span><span class="p">,</span> <span class="s2">&quot;instance&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot create </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_entry_points">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.get_entry_points">[docs]</a>
<span class="k">def</span> <span class="nf">get_entry_points</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper for ``importlib.metadata.entry_points``</span>

<span class="sd">    Args:</span>
<span class="sd">        group: entry points to select</span>

<span class="sd">    Returns:</span>
<span class="sd">        EntryPoints for ``group`` or empty list if unsupported</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">importlib.metadata</span>  <span class="c1"># type: ignore  # novermin</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">importlib</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">entry_points</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="c1"># Prior to Python 3.10, entry_points accepted no parameters and always</span>
        <span class="c1"># returned a dictionary of entry points, keyed by group.  See</span>
        <span class="c1"># https://docs.python.org/3/library/importlib.metadata.html#entry-points</span>
        <span class="k">return</span> <span class="n">importlib</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">entry_points</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="p">[])</span></div>



<div class="viewcode-block" id="load_module_from_file">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.load_module_from_file">[docs]</a>
<span class="k">def</span> <span class="nf">load_module_from_file</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">module_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads a python module from the path of the corresponding file.</span>

<span class="sd">    If the module is already in ``sys.modules`` it will be returned as</span>
<span class="sd">    is and not reloaded.</span>

<span class="sd">    Args:</span>
<span class="sd">        module_name (str): namespace where the python module will be loaded,</span>
<span class="sd">            e.g. ``foo.bar``</span>
<span class="sd">        module_path (str): path of the python file containing the module</span>

<span class="sd">    Returns:</span>
<span class="sd">        A valid module object</span>

<span class="sd">    Raises:</span>
<span class="sd">        ImportError: when the module can&#39;t be loaded</span>
<span class="sd">        FileNotFoundError: when module_path doesn&#39;t exist</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">importlib.util</span>

    <span class="k">if</span> <span class="n">module_name</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span>

    <span class="c1"># This recipe is adapted from https://stackoverflow.com/a/67692/771663</span>

    <span class="n">spec</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">spec_from_file_location</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">module_path</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">module_from_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="c1"># The module object needs to exist in sys.modules before the</span>
    <span class="c1"># loader executes the module code.</span>
    <span class="c1">#</span>
    <span class="c1"># See https://docs.python.org/3/reference/import.html#loading</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">exec_module</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">raise</span>
    <span class="k">return</span> <span class="n">module</span></div>



<div class="viewcode-block" id="uniq">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.uniq">[docs]</a>
<span class="k">def</span> <span class="nf">uniq</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove strings of duplicate elements from a list.</span>

<span class="sd">    This works like the command-line ``uniq`` tool.  It filters strings</span>
<span class="sd">    of duplicate elements in a list. Adjacent matching elements are</span>
<span class="sd">    merged into the first occurrence.</span>

<span class="sd">    For example::</span>

<span class="sd">        uniq([1, 1, 1, 1, 2, 2, 2, 3, 3]) == [1, 2, 3]</span>
<span class="sd">        uniq([1, 1, 1, 1, 2, 2, 2, 1, 1]) == [1, 2, 1]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">uniq_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">element</span> <span class="o">!=</span> <span class="n">last</span><span class="p">:</span>
            <span class="n">uniq_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">element</span>
    <span class="k">return</span> <span class="n">uniq_list</span></div>



<div class="viewcode-block" id="elide_list">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.elide_list">[docs]</a>
<span class="k">def</span> <span class="nf">elide_list</span><span class="p">(</span><span class="n">line_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">max_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Takes a long list and limits it to a smaller number of elements,</span>
<span class="sd">    replacing intervening elements with &#39;...&#39;.  For example::</span>

<span class="sd">        elide_list([&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;], 4)</span>

<span class="sd">    gives::</span>

<span class="sd">        [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;...&quot;, &quot;6&quot;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_num</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="o">*</span><span class="n">line_list</span><span class="p">[:</span> <span class="n">max_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">line_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">line_list</span></div>



<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>
    <span class="n">PatternStr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">PatternStr</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>


<div class="viewcode-block" id="fnmatch_translate_multiple">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.fnmatch_translate_multiple">[docs]</a>
<span class="k">def</span> <span class="nf">fnmatch_translate_multiple</span><span class="p">(</span><span class="n">named_patterns</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Similar to ``fnmatch.translate``, but takes an ordered dictionary where keys are pattern</span>
<span class="sd">    names, and values are filename patterns. The output is a regex that matches any of the</span>
<span class="sd">    patterns in order, and named capture groups are used to identify which pattern matched.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(?P&lt;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">{</span><span class="n">fnmatch</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">named_patterns</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>



<div class="viewcode-block" id="nullcontext">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.nullcontext">[docs]</a>
<span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">nullcontext</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Empty context manager.</span>
<span class="sd">    TODO: replace with contextlib.nullcontext() if we ever require python 3.7.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">yield</span></div>



<div class="viewcode-block" id="UnhashableArguments">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.UnhashableArguments">[docs]</a>
<span class="k">class</span> <span class="nc">UnhashableArguments</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raise when an @memoized function receives unhashable arg or kwarg values.&quot;&quot;&quot;</span></div>



<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="stable_partition">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.stable_partition">[docs]</a>
<span class="k">def</span> <span class="nf">stable_partition</span><span class="p">(</span>
    <span class="n">input_iterable</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">predicate_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">T</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Partition the input iterable according to a custom predicate.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_iterable: input iterable to be partitioned.</span>
<span class="sd">        predicate_fn: predicate function accepting an iterable item</span>
<span class="sd">            as argument.</span>

<span class="sd">    Return:</span>
<span class="sd">        Tuple of the list of elements evaluating to True, and</span>
<span class="sd">        list of elements evaluating to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">true_items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">false_items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">input_iterable</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">predicate_fn</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="n">true_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">false_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">true_items</span><span class="p">,</span> <span class="n">false_items</span></div>



<div class="viewcode-block" id="ensure_last">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.ensure_last">[docs]</a>
<span class="k">def</span> <span class="nf">ensure_last</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="o">*</span><span class="n">elements</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs a stable partition of lst, ensuring that ``elements``</span>
<span class="sd">    occur at the end of ``lst`` in specified order. Mutates ``lst``.</span>
<span class="sd">    Raises ``ValueError`` if any ``elements`` are not already in ``lst``.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
        <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lst</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">lst</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elt</span><span class="p">)))</span></div>



<div class="viewcode-block" id="Const">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.Const">[docs]</a>
<span class="k">class</span> <span class="nc">Const</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class level constant, raises when trying to set the attribute&quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">owner</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Const value does not support assignment [value=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="TypedMutableSequence">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.TypedMutableSequence">[docs]</a>
<span class="k">class</span> <span class="nc">TypedMutableSequence</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">MutableSequence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class that behaves like a list, just with a different type.</span>

<span class="sd">    Client code can inherit from this base class:</span>

<span class="sd">        class Foo(TypedMutableSequence):</span>
<span class="sd">            pass</span>

<span class="sd">    and later perform checks based on types:</span>

<span class="sd">        if isinstance(l, Foo):</span>
<span class="sd">            # do something</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<div class="viewcode-block" id="TypedMutableSequence.insert">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.TypedMutableSequence.insert">[docs]</a>
    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></div>



<div class="viewcode-block" id="GroupedExceptionHandler">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.GroupedExceptionHandler">[docs]</a>
<span class="k">class</span> <span class="nc">GroupedExceptionHandler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A generic mechanism to coalesce multiple exceptions and preserve tracebacks.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exceptions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether any exceptions were handled.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exceptions</span><span class="p">)</span>

<div class="viewcode-block" id="GroupedExceptionHandler.forward">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.GroupedExceptionHandler.forward">[docs]</a>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">base</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="ne">BaseException</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GroupedExceptionForwarder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a contextmanager which extracts tracebacks and prefixes a message.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GroupedExceptionForwarder</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_receive_forwarded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">tb</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">context</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">tb</span><span class="p">))</span>

<div class="viewcode-block" id="GroupedExceptionHandler.grouped_message">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.GroupedExceptionHandler.grouped_message">[docs]</a>
    <span class="k">def</span> <span class="nf">grouped_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_tracebacks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print out an error message coalescing all the forwarded errors.&quot;&quot;&quot;</span>
        <span class="n">each_exception_message</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> raised </span><span class="si">{1}</span><span class="s2">: </span><span class="si">{2}{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">context</span><span class="p">,</span>
                <span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="n">exc</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tb</span><span class="p">))</span> <span class="k">if</span> <span class="n">with_tracebacks</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">context</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">tb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exceptions</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="s2">&quot;due to the following failures:</span><span class="se">\n</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">each_exception_message</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="GroupedExceptionForwarder">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.GroupedExceptionForwarder">[docs]</a>
<span class="k">class</span> <span class="nc">GroupedExceptionForwarder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A contextmanager to capture exceptions and forward them to a</span>
<span class="sd">    GroupedExceptionHandler.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">GroupedExceptionHandler</span><span class="p">,</span> <span class="n">base</span><span class="p">:</span> <span class="nb">type</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="o">=</span> <span class="n">context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span> <span class="o">=</span> <span class="n">handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base</span> <span class="o">=</span> <span class="n">base</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exc_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span><span class="o">.</span><span class="n">_receive_forwarded</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_tb</span><span class="p">(</span><span class="n">tb</span><span class="p">))</span>

        <span class="c1"># Suppress any exception from being re-raised:</span>
        <span class="c1"># https://docs.python.org/3/reference/datamodel.html#object.__exit__.</span>
        <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="classproperty">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.classproperty">[docs]</a>
<span class="k">class</span> <span class="nc">classproperty</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Non-data descriptor to evaluate a class-level property. The function that performs</span>
<span class="sd">    the evaluation is injected at creation time and take an instance (could be None) and</span>
<span class="sd">    an owner (i.e. the class that originated the instance)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">owner</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">owner</span><span class="p">)</span></div>



<div class="viewcode-block" id="DeprecatedProperty">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.DeprecatedProperty">[docs]</a>
<span class="k">class</span> <span class="nc">DeprecatedProperty</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data descriptor to error or warn when a deprecated property is accessed.</span>

<span class="sd">    Derived classes must define a factory method to return an adaptor for the deprecated</span>
<span class="sd">    property, if the descriptor is not set to error.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

    <span class="c1">#: 0 - Nothing</span>
    <span class="c1">#: 1 - Warning</span>
    <span class="c1">#: 2 - Error</span>
    <span class="n">error_lvl</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">owner</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_lvl</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;accessing the &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; property of &#39;</span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s2">&#39;, which is deprecated&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_lvl</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot access the &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; attribute of &#39;</span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">owner</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;the deprecated property &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; of &#39;</span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s2">&#39; does not support assignment&quot;</span>
        <span class="p">)</span>

<div class="viewcode-block" id="DeprecatedProperty.factory">
<a class="viewcode-back" href="../../../llnl.util.html#llnl.util.lang.DeprecatedProperty.factory">[docs]</a>
    <span class="k">def</span> <span class="nf">factory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">owner</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;must be implemented by derived classes&quot;</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2023, Lawrence Livermore National Laboratory..
      <span class="lastupdated">Last updated on Sep 20, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>