

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Custom Build Systems &mdash; Spack 0.23.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5f00b823" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=832b3b9f"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="IntelOneapi" href="inteloneapipackage.html" />
    <link rel="prev" title="Cuda" href="cudapackage.html" /> 
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S0PQ7WV75K"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S0PQ7WV75K');
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/spack-logo-white-text.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../features.html">Feature Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic_usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../replace_conda_homebrew.html">Spack for Homebrew/Conda Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frequently_asked_questions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://spack-tutorial.readthedocs.io">Tutorial (spack-tutorial.rtfd.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://packages.spack.io">Packages (packages.spack.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cache.spack.io">Binaries (binaries.spack.io)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config_yaml.html">Spack Settings (config.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packages_yaml.html">Package Settings (packages.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_settings.html">Concretization Settings (concretizer.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../environments.html">Environments (spack.yaml, spack.lock)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../containers.html">Container Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mirrors.html">Mirrors (mirrors.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_file_support.html">Modules (modules.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../repositories.html">Package Repositories (repos.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../binary_caches.html">Build Caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bootstrapping.html">Bootstrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_index.html">Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chain.html">Chaining Spack Installations (upstreams.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extensions.html">Custom Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipelines.html">CI Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../signing.html">Spack Package Signing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu_configuration.html">Using External GPU Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../contribution_guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packaging_guide.html">Packaging Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../build_systems.html">Build Systems</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="makefilepackage.html">Makefile</a></li>
<li class="toctree-l2"><a class="reference internal" href="mavenpackage.html">Maven</a></li>
<li class="toctree-l2"><a class="reference internal" href="sconspackage.html">SCons</a></li>
<li class="toctree-l2"><a class="reference internal" href="wafpackage.html">Waf</a></li>
<li class="toctree-l2"><a class="reference internal" href="autotoolspackage.html">Autotools</a></li>
<li class="toctree-l2"><a class="reference internal" href="cmakepackage.html">CMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="cachedcmakepackage.html">CachedCMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="mesonpackage.html">Meson</a></li>
<li class="toctree-l2"><a class="reference internal" href="qmakepackage.html">QMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="sippackage.html">SIP</a></li>
<li class="toctree-l2"><a class="reference internal" href="luapackage.html">Lua</a></li>
<li class="toctree-l2"><a class="reference internal" href="octavepackage.html">Octave</a></li>
<li class="toctree-l2"><a class="reference internal" href="perlpackage.html">Perl</a></li>
<li class="toctree-l2"><a class="reference internal" href="pythonpackage.html">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="rpackage.html">R</a></li>
<li class="toctree-l2"><a class="reference internal" href="racketpackage.html">Racket</a></li>
<li class="toctree-l2"><a class="reference internal" href="rubypackage.html">Ruby</a></li>
<li class="toctree-l2"><a class="reference internal" href="bundlepackage.html">Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="cudapackage.html">Cuda</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Custom Build Systems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#base-class">Base class</a></li>
<li class="toctree-l3"><a class="reference internal" href="#phases">Phases</a></li>
<li class="toctree-l3"><a class="reference internal" href="#phase-and-phase-args-functions">Phase and phase_args functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-before-run-after">run_before/run_after</a></li>
<li class="toctree-l3"><a class="reference internal" href="#on-package-attributes">on_package_attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="inteloneapipackage.html">IntelOneapi</a></li>
<li class="toctree-l2"><a class="reference internal" href="intelpackage.html">Intel</a></li>
<li class="toctree-l2"><a class="reference internal" href="rocmpackage.html">ROCm</a></li>
<li class="toctree-l2"><a class="reference internal" href="sourceforgepackage.html">Sourceforge</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../spack.html">Spack API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../llnl.html">LLNL API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Spack</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../build_systems.html">Build Systems</a></li>
      <li class="breadcrumb-item active">Custom Build Systems</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/build_systems/custompackage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="custom-build-systems">
<span id="custompackage"></span><h1>Custom Build Systems<a class="headerlink" href="#custom-build-systems" title="Link to this heading"></a></h1>
<p>While the built-in build systems should meet your needs for the
vast majority of packages, some packages provide custom build scripts.
This guide is intended for the following use cases:</p>
<ul class="simple">
<li><p>Packaging software with its own custom build system</p></li>
<li><p>Adding support for new build systems</p></li>
</ul>
<p>If you want to add support for a new build system, a good place to
start is to look at the definitions of other build systems. This guide
focuses mostly on how Spack’s build systems work.</p>
<p>In this guide, we will be using the
<a class="reference external" href="https://github.com/spack/spack/blob/develop/var/spack/repos/builtin/packages/perl/package.py">perl</a> and
<a class="reference external" href="https://github.com/spack/spack/blob/develop/var/spack/repos/builtin/packages/cmake/package.py">cmake</a>
packages as examples. <code class="docutils literal notranslate"><span class="pre">perl</span></code>’s build system is a hand-written
<code class="docutils literal notranslate"><span class="pre">Configure</span></code> shell script, while <code class="docutils literal notranslate"><span class="pre">cmake</span></code> bootstraps itself during
installation. Both of these packages require custom build systems.</p>
<section id="base-class">
<h2>Base class<a class="headerlink" href="#base-class" title="Link to this heading"></a></h2>
<p>If your package does not belong to any of the built-in build
systems that Spack already supports, you should inherit from the
<code class="docutils literal notranslate"><span class="pre">Package</span></code> base class. <code class="docutils literal notranslate"><span class="pre">Package</span></code> is a simple base class with a
single phase: <code class="docutils literal notranslate"><span class="pre">install</span></code>. If your package is simple, you may be able
to simply write an <code class="docutils literal notranslate"><span class="pre">install</span></code> method that gets the job done. However,
if your package is more complex and installation involves multiple
steps, you should add separate phases as mentioned in the next section.</p>
<p>If you are creating a new build system base class, you should inherit
from <code class="docutils literal notranslate"><span class="pre">PackageBase</span></code>. This is the superclass for all build systems in
Spack.</p>
</section>
<section id="phases">
<h2>Phases<a class="headerlink" href="#phases" title="Link to this heading"></a></h2>
<p>The most important concept in Spack’s build system support is the idea
of phases. Each build system defines a set of phases that are necessary
to install the package. They usually follow some sort of “configure”,
“build”, “install” guideline, but any of those phases may be missing
or combined with another phase.</p>
<p>If you look at the <code class="docutils literal notranslate"><span class="pre">perl</span></code> package, you’ll see:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">phases</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;configure&quot;</span><span class="p">,</span> <span class="s2">&quot;build&quot;</span><span class="p">,</span> <span class="s2">&quot;install&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Similarly, <code class="docutils literal notranslate"><span class="pre">cmake</span></code> defines:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">phases</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;bootstrap&quot;</span><span class="p">,</span> <span class="s2">&quot;build&quot;</span><span class="p">,</span> <span class="s2">&quot;install&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>If we look at the <code class="docutils literal notranslate"><span class="pre">cmake</span></code> example, this tells Spack’s <code class="docutils literal notranslate"><span class="pre">PackageBase</span></code>
class to run the <code class="docutils literal notranslate"><span class="pre">bootstrap</span></code>, <code class="docutils literal notranslate"><span class="pre">build</span></code>, and <code class="docutils literal notranslate"><span class="pre">install</span></code> functions
in that order. It is now up to you to define these methods.</p>
</section>
<section id="phase-and-phase-args-functions">
<h2>Phase and phase_args functions<a class="headerlink" href="#phase-and-phase-args-functions" title="Link to this heading"></a></h2>
<p>If we look at <code class="docutils literal notranslate"><span class="pre">perl</span></code>, we see that it defines a <code class="docutils literal notranslate"><span class="pre">configure</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="n">configure</span> <span class="o">=</span> <span class="n">Executable</span><span class="p">(</span><span class="s2">&quot;./Configure&quot;</span><span class="p">)</span>
    <span class="n">configure</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">configure_args</span><span class="p">())</span>
</pre></div>
</div>
<p>There is also a corresponding <code class="docutils literal notranslate"><span class="pre">configure_args</span></code> function that handles
all of the arguments to pass to <code class="docutils literal notranslate"><span class="pre">Configure</span></code>, just like in
<code class="docutils literal notranslate"><span class="pre">AutotoolsPackage</span></code>. Comparatively, the <code class="docutils literal notranslate"><span class="pre">build</span></code> and <code class="docutils literal notranslate"><span class="pre">install</span></code>
phases are pretty simple:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="n">make</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="n">make</span><span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">cmake</span></code> package looks very similar, but with a <code class="docutils literal notranslate"><span class="pre">bootstrap</span></code>
function instead of <code class="docutils literal notranslate"><span class="pre">configure</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bootstrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="n">bootstrap</span> <span class="o">=</span> <span class="n">Executable</span><span class="p">(</span><span class="s2">&quot;./bootstrap&quot;</span><span class="p">)</span>
    <span class="n">bootstrap</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_args</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="n">make</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="n">make</span><span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Again, there is a <code class="docutils literal notranslate"><span class="pre">boostrap_args</span></code> function that determines the
correct bootstrap flags to use.</p>
</section>
<section id="run-before-run-after">
<h2>run_before/run_after<a class="headerlink" href="#run-before-run-after" title="Link to this heading"></a></h2>
<p>Occasionally, you may want to run extra steps either before or after
a given phase. This applies not just to custom build systems, but to
existing build systems as well. You may need to patch a file that is
generated by configure, or install extra files in addition to what
<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code> copies to the installation prefix. This is where
<code class="docutils literal notranslate"><span class="pre">&#64;run_before</span></code> and <code class="docutils literal notranslate"><span class="pre">&#64;run_after</span></code> come in.</p>
<p>These Python decorators allow you to write functions that are called
before or after a particular phase. For example, in <code class="docutils literal notranslate"><span class="pre">perl</span></code>, we see:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@run_after</span><span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">install_cpanm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span>
     <span class="n">maker</span> <span class="o">=</span> <span class="n">make</span>
     <span class="n">cpan_dir</span> <span class="o">=</span> <span class="n">join_path</span><span class="p">(</span><span class="s2">&quot;cpanm&quot;</span><span class="p">,</span> <span class="s2">&quot;cpanm&quot;</span><span class="p">)</span>
     <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
         <span class="n">maker</span> <span class="o">=</span> <span class="n">nmake</span>
         <span class="n">cpan_dir</span> <span class="o">=</span> <span class="n">join_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">source_path</span><span class="p">,</span> <span class="n">cpan_dir</span><span class="p">)</span>
         <span class="n">cpan_dir</span> <span class="o">=</span> <span class="n">windows_sfn</span><span class="p">(</span><span class="n">cpan_dir</span><span class="p">)</span>
     <span class="k">if</span> <span class="s2">&quot;+cpanm&quot;</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">:</span>
         <span class="k">with</span> <span class="n">working_dir</span><span class="p">(</span><span class="n">cpan_dir</span><span class="p">):</span>
             <span class="n">perl</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;perl&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">command</span>
             <span class="n">perl</span><span class="p">(</span><span class="s2">&quot;Makefile.PL&quot;</span><span class="p">)</span>
             <span class="n">maker</span><span class="p">()</span>
             <span class="n">maker</span><span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This extra step automatically installs <code class="docutils literal notranslate"><span class="pre">cpanm</span></code> in addition to the
base Perl installation.</p>
</section>
<section id="on-package-attributes">
<h2>on_package_attributes<a class="headerlink" href="#on-package-attributes" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">run_before</span></code>/<code class="docutils literal notranslate"><span class="pre">run_after</span></code> logic discussed above becomes
particularly powerful when combined with the <code class="docutils literal notranslate"><span class="pre">&#64;on_package_attributes</span></code>
decorator. This decorator allows you to conditionally run certain
functions depending on the attributes of that package. The most
common example is conditional testing. Many unit tests are prone to
failure, even when there is nothing wrong with the installation.
Unfortunately, non-portable unit tests and tests that are
“supposed to fail” are more common than we would like. Instead of
always running unit tests on installation, Spack lets users
conditionally run tests with the <code class="docutils literal notranslate"><span class="pre">--test=root</span></code> flag.</p>
<p>If we wanted to define a function that would conditionally run
if and only if this flag is set, we would use the following line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@on_package_attributes</span><span class="p">(</span><span class="n">run_tests</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading"></a></h2>
<p>Let’s put everything together and add unit tests to be optionally run
during the installation of our package.
In the <code class="docutils literal notranslate"><span class="pre">perl</span></code> package, we can see:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@run_after</span><span class="p">(</span><span class="s2">&quot;build&quot;</span><span class="p">)</span>
<span class="nd">@on_package_attributes</span><span class="p">(</span><span class="n">run_tests</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">build_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
         <span class="n">win32_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">source_path</span><span class="p">,</span> <span class="s2">&quot;win32&quot;</span><span class="p">)</span>
         <span class="n">win32_dir</span> <span class="o">=</span> <span class="n">windows_sfn</span><span class="p">(</span><span class="n">win32_dir</span><span class="p">)</span>
         <span class="k">with</span> <span class="n">working_dir</span><span class="p">(</span><span class="n">win32_dir</span><span class="p">):</span>
             <span class="n">nmake</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">ignore_quotes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
     <span class="k">else</span><span class="p">:</span>
         <span class="n">make</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can guess, this runs <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> <em>after</em> building the package,
if and only if testing is requested. Again, this is not specific to
custom build systems, it can be added to existing build systems as well.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The order of decorators matters. The following ordering:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@run_after</span><span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">)</span>
<span class="nd">@on_package_attributes</span><span class="p">(</span><span class="n">run_tests</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>works as expected. However, if you reverse the ordering:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@on_package_attributes</span><span class="p">(</span><span class="n">run_tests</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nd">@run_after</span><span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>the tests will always be run regardless of whether or not
<code class="docutils literal notranslate"><span class="pre">--test=root</span></code> is requested. See <a class="reference external" href="https://github.com/spack/spack/issues/3833">https://github.com/spack/spack/issues/3833</a>
for more information</p>
</div>
<p>Ideally, every package in Spack will have some sort of test to ensure
that it was built correctly. It is up to the package authors to make
sure this happens. If you are adding a package for some software and
the developers list commands to test the installation, please add these
tests to your <code class="docutils literal notranslate"><span class="pre">package.py</span></code>.</p>
<p>For more information on other forms of package testing, refer to
<a class="reference internal" href="../packaging_guide.html#checking-an-installation"><span class="std std-ref">Checking an installation</span></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cudapackage.html" class="btn btn-neutral float-left" title="Cuda" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="inteloneapipackage.html" class="btn btn-neutral float-right" title="IntelOneapi" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2023, Lawrence Livermore National Laboratory..
      <span class="lastupdated">Last updated on Sep 20, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>