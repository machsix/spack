

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Intel &mdash; Spack 0.23.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5f00b823" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=832b3b9f"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ROCm" href="rocmpackage.html" />
    <link rel="prev" title="IntelOneapi" href="inteloneapipackage.html" /> 
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S0PQ7WV75K"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S0PQ7WV75K');
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/spack-logo-white-text.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../features.html">Feature Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic_usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../replace_conda_homebrew.html">Spack for Homebrew/Conda Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frequently_asked_questions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://spack-tutorial.readthedocs.io">Tutorial (spack-tutorial.rtfd.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://packages.spack.io">Packages (packages.spack.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cache.spack.io">Binaries (binaries.spack.io)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config_yaml.html">Spack Settings (config.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packages_yaml.html">Package Settings (packages.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_settings.html">Concretization Settings (concretizer.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../environments.html">Environments (spack.yaml, spack.lock)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../containers.html">Container Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mirrors.html">Mirrors (mirrors.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_file_support.html">Modules (modules.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../repositories.html">Package Repositories (repos.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../binary_caches.html">Build Caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bootstrapping.html">Bootstrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_index.html">Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chain.html">Chaining Spack Installations (upstreams.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extensions.html">Custom Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipelines.html">CI Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../signing.html">Spack Package Signing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu_configuration.html">Using External GPU Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../contribution_guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packaging_guide.html">Packaging Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../build_systems.html">Build Systems</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="makefilepackage.html">Makefile</a></li>
<li class="toctree-l2"><a class="reference internal" href="mavenpackage.html">Maven</a></li>
<li class="toctree-l2"><a class="reference internal" href="sconspackage.html">SCons</a></li>
<li class="toctree-l2"><a class="reference internal" href="wafpackage.html">Waf</a></li>
<li class="toctree-l2"><a class="reference internal" href="autotoolspackage.html">Autotools</a></li>
<li class="toctree-l2"><a class="reference internal" href="cmakepackage.html">CMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="cachedcmakepackage.html">CachedCMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="mesonpackage.html">Meson</a></li>
<li class="toctree-l2"><a class="reference internal" href="qmakepackage.html">QMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="sippackage.html">SIP</a></li>
<li class="toctree-l2"><a class="reference internal" href="luapackage.html">Lua</a></li>
<li class="toctree-l2"><a class="reference internal" href="octavepackage.html">Octave</a></li>
<li class="toctree-l2"><a class="reference internal" href="perlpackage.html">Perl</a></li>
<li class="toctree-l2"><a class="reference internal" href="pythonpackage.html">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="rpackage.html">R</a></li>
<li class="toctree-l2"><a class="reference internal" href="racketpackage.html">Racket</a></li>
<li class="toctree-l2"><a class="reference internal" href="rubypackage.html">Ruby</a></li>
<li class="toctree-l2"><a class="reference internal" href="bundlepackage.html">Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="cudapackage.html">Cuda</a></li>
<li class="toctree-l2"><a class="reference internal" href="custompackage.html">Custom Build Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="inteloneapipackage.html">IntelOneapi</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Intel</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#intel-packages-in-spack">Intel packages in Spack</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#packages-under-no-cost-license">Packages under no-cost license</a></li>
<li class="toctree-l4"><a class="reference internal" href="#licensed-packages">Licensed packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unrelated-packages">Unrelated packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-spack-to-use-intel-licenses">Configuring Spack to use Intel licenses</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#integration-of-intel-tools-installed-external-to-spack">Integration of Intel tools installed <em>external</em> to Spack</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#integrating-external-compilers">Integrating external compilers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#integrating-external-libraries">Integrating external libraries</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#installing-intel-tools-within-spack">Installing Intel tools <em>within</em> Spack</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install-steps-for-packages-with-compilers-and-libraries">Install steps for packages with compilers and libraries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-steps-for-library-only-packages">Install steps for library-only packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debug-notes">Debug notes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#using-intel-tools-in-spack-to-install-client-packages">Using Intel tools in Spack to install client packages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#selecting-intel-compilers">Selecting Intel compilers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#selecting-libraries-to-satisfy-virtual-packages">Selecting libraries to satisfy virtual packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-intel-tools-as-explicit-dependency">Using Intel tools as explicit dependency</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tips-for-configuring-client-packages-to-use-mkl">Tips for configuring client packages to use MKL</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#footnotes">Footnotes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rocmpackage.html">ROCm</a></li>
<li class="toctree-l2"><a class="reference internal" href="sourceforgepackage.html">Sourceforge</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../spack.html">Spack API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../llnl.html">LLNL API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Spack</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../build_systems.html">Build Systems</a></li>
      <li class="breadcrumb-item active">Intel</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/build_systems/intelpackage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="intel">
<span id="intelpackage"></span><h1><a class="toc-backref" href="#id12" role="doc-backlink">Intel</a><a class="headerlink" href="#intel" title="Link to this heading"></a></h1>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#intel" id="id12">Intel</a></p>
<ul>
<li><p><a class="reference internal" href="#intel-packages-in-spack" id="id13">Intel packages in Spack</a></p>
<ul>
<li><p><a class="reference internal" href="#packages-under-no-cost-license" id="id14">Packages under no-cost license</a></p></li>
<li><p><a class="reference internal" href="#licensed-packages" id="id15">Licensed packages</a></p></li>
<li><p><a class="reference internal" href="#unrelated-packages" id="id16">Unrelated packages</a></p></li>
<li><p><a class="reference internal" href="#configuring-spack-to-use-intel-licenses" id="id17">Configuring Spack to use Intel licenses</a></p>
<ul>
<li><p><a class="reference internal" href="#pointing-to-an-existing-license-server" id="id18">Pointing to an existing license server</a></p></li>
<li><p><a class="reference internal" href="#installing-a-standalone-license-file" id="id19">Installing a standalone license file</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#integration-of-intel-tools-installed-external-to-spack" id="id20">Integration of Intel tools installed <em>external</em> to Spack</a></p>
<ul>
<li><p><a class="reference internal" href="#integrating-external-compilers" id="id21">Integrating external compilers</a></p></li>
<li><p><a class="reference internal" href="#integrating-external-libraries" id="id22">Integrating external libraries</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#installing-intel-tools-within-spack" id="id23">Installing Intel tools <em>within</em> Spack</a></p>
<ul>
<li><p><a class="reference internal" href="#install-steps-for-packages-with-compilers-and-libraries" id="id24">Install steps for packages with compilers and libraries</a></p></li>
<li><p><a class="reference internal" href="#install-steps-for-library-only-packages" id="id25">Install steps for library-only packages</a></p></li>
<li><p><a class="reference internal" href="#debug-notes" id="id26">Debug notes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-intel-tools-in-spack-to-install-client-packages" id="id27">Using Intel tools in Spack to install client packages</a></p>
<ul>
<li><p><a class="reference internal" href="#selecting-intel-compilers" id="id28">Selecting Intel compilers</a></p></li>
<li><p><a class="reference internal" href="#selecting-libraries-to-satisfy-virtual-packages" id="id29">Selecting libraries to satisfy virtual packages</a></p></li>
<li><p><a class="reference internal" href="#using-intel-tools-as-explicit-dependency" id="id30">Using Intel tools as explicit dependency</a></p></li>
<li><p><a class="reference internal" href="#tips-for-configuring-client-packages-to-use-mkl" id="id31">Tips for configuring client packages to use MKL</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#footnotes" id="id32">Footnotes</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="intel-packages-in-spack">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Intel packages in Spack</a><a class="headerlink" href="#intel-packages-in-spack" title="Link to this heading"></a></h2>
<p>This is an earlier version of Intel software development tools and has
now been replaced by Intel oneAPI Toolkits.</p>
<p>Spack can install and use several software development products offered by Intel.
Some of these are available under no-cost terms, others require a paid license.
All share the same basic steps for configuration, installation, and, where
applicable, license management. The Spack Python class <code class="docutils literal notranslate"><span class="pre">IntelPackage</span></code> implements
these steps.</p>
<p>Spack interacts with Intel tools in several routes, like it does for any
other package:</p>
<ol class="arabic simple" id="route-1">
<li><p>Accept system-provided tools after you declare them to Spack as <em>external packages</em>.</p></li>
</ol>
<ol class="arabic simple" id="route-2" start="2">
<li><p>Install the products for you as <em>internal packages</em> in Spack.</p></li>
</ol>
<ol class="arabic simple" id="route-3" start="3">
<li><p><em>Use</em> the packages, regardless of installation route, to install what we’ll
call <em>client packages</em> for you, this being Spack’s primary purpose.</p></li>
</ol>
<p>An auxiliary route follows from route 2, as it would for most Spack
packages, namely:</p>
<ol class="arabic simple" id="route-4" start="4">
<li><p>Make Spack-installed Intel tools available outside of Spack for ad-hoc use,
typically through Spack-managed modulefiles.</p></li>
</ol>
<p>This document covers routes 1 through 3.</p>
<section id="packages-under-no-cost-license">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Packages under no-cost license</a><a class="headerlink" href="#packages-under-no-cost-license" title="Link to this heading"></a></h3>
<p>Intel’s standalone performance library products, notably MKL and MPI, are
available for use under a <a class="reference external" href="https://software.intel.com/en-us/license/intel-simplified-software-license">simplified license</a>
since 2017 <a class="reference internal" href="#fn1" id="id1"><span>[fn1]</span></a>. They are packaged in Spack as:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">intel-mkl</span></code> – Math Kernel Library (linear algebra and FFT),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intel-mpi</span></code> – The Intel-MPI implementation (derived from MPICH),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intel-ipp</span></code> – Primitives for image-, signal-, and data-processing,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intel-daal</span></code> – Machine learning and data analytics.</p></li>
</ul>
<p>Some earlier versions of these libraries were released under a paid license.
For these older versions, the license must be available at installation time of
the products and during compilation of client packages.</p>
<p>The library packages work well with the Intel compilers but do not require them
– those packages can just as well be used with other compilers.  The Intel
compiler invocation commands offer custom options to simplify linking Intel
libraries (sometimes considerably), but Spack always uses fairly explicit
linkage anyway.</p>
</section>
<section id="licensed-packages">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Licensed packages</a><a class="headerlink" href="#licensed-packages" title="Link to this heading"></a></h3>
<p>Intel’s core software development products that provide compilers, analyzers,
and optimizers do require a paid license.  In Spack, they are packaged as:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span></code> – the entire suite of compilers and libraries,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intel</span></code> – a subset containing just the compilers and the Intel-MPI runtime <a class="reference internal" href="#fn2" id="id2"><span>[fn2]</span></a>.</p></li>
</ul>
<p>The license is needed at installation time and to compile client packages, but
never to merely run any resulting binaries. The license status for a given
Spack package is normally specified in the <em>package code</em> through directives like
<cite>license_required</cite> (see <a class="reference internal" href="../packaging_guide.html#license"><span class="std std-ref">Licensed software</span></a>).
For the Intel packages, however, the <em>class code</em> provides these directives (in
exchange of forfeiting a measure of OOP purity) and takes care of idiosyncasies
like historic version dependence.</p>
<p>The libraries that are provided in the standalone packages are also included in the
all-encompassing <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span></code>. To complicate matters a bit, that
package is sold in 3 “editions”, of which only the upper-tier <code class="docutils literal notranslate"><span class="pre">cluster</span></code>
edition supports <em>compiling</em> MPI applications, and hence only that edition can
provide the <code class="docutils literal notranslate"><span class="pre">mpi</span></code> virtual package.  (As mentioned <a class="reference internal" href="#fn2" id="id3"><span>[fn2]</span></a>, all editions
provide support for <em>running</em> MPI applications.)</p>
<p>The edition forms the leading part of the version number for Spack’s
<code class="docutils literal notranslate"><span class="pre">intel*</span></code> packages discussed here. This differs from the primarily numeric
version numbers seen with most other Spack packages. For example, we have:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>info<span class="w"> </span>intel-parallel-studio
<span class="go">...</span>
<span class="go">Preferred version:</span>
<span class="go">    professional.2018.3    http:...</span>

<span class="go">Safe versions:</span>
<span class="go">    professional.2018.3    http:...</span>
<span class="go">    ...</span>
<span class="go">    composer.2018.3        http:...</span>
<span class="go">    ...</span>
<span class="go">    cluster.2018.3         http:...</span>
<span class="go">    ...</span>
<span class="go">...</span>
</pre></div>
</div>
<p>The full studio suite, capable of compiling MPI applications, currently
requires about 12 GB of disk space when installed (see section <a class="reference internal" href="#install-steps-for-packages-with-compilers-and-libraries">Install steps
for packages with compilers and libraries</a> for detailed instructions).
If you need to save disk space or installation time, you could install the
<code class="docutils literal notranslate"><span class="pre">intel</span></code> compilers-only subset (0.6 GB) and just the library packages you
need, for example <code class="docutils literal notranslate"><span class="pre">intel-mpi</span></code> (0.5 GB) and <code class="docutils literal notranslate"><span class="pre">intel-mkl</span></code> (2.5 GB).</p>
</section>
<section id="unrelated-packages">
<span id="intel-unrelated-packages"></span><h3><a class="toc-backref" href="#id16" role="doc-backlink">Unrelated packages</a><a class="headerlink" href="#unrelated-packages" title="Link to this heading"></a></h3>
<p>The following packages do not use the Intel installer and are not in class <code class="docutils literal notranslate"><span class="pre">IntelPackage</span></code>
that is discussed here:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">intel-gpu-tools</span></code> – Test suite and low-level tools for the Linux <a class="reference external" href="https://en.wikipedia.org/wiki/Direct_Rendering_Manager">Direct
Rendering Manager</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intel-mkl-dnn</span></code> – Math Kernel Library for Deep Neural Networks (<code class="docutils literal notranslate"><span class="pre">CMakePackage</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intel-xed</span></code> – X86 machine instructions encoder/decoder</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intel-tbb</span></code> – Standalone version of Intel Threading Building Blocks. Note that
a TBB runtime version is included with <code class="docutils literal notranslate"><span class="pre">intel-mkl</span></code>, and development
versions are provided by the packages <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span></code> (all
editions) and its <code class="docutils literal notranslate"><span class="pre">intel</span></code> subset.</p></li>
</ul>
</section>
<section id="configuring-spack-to-use-intel-licenses">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Configuring Spack to use Intel licenses</a><a class="headerlink" href="#configuring-spack-to-use-intel-licenses" title="Link to this heading"></a></h3>
<p>If you wish to integrate licensed Intel products into Spack as external packages
(<a class="reference internal" href="#route-1">route 1</a> above) we assume that their license configuration is in place and
is working <a class="reference internal" href="#fn3" id="id4"><span>[fn3]</span></a>. In this case, skip to section <a class="reference internal" href="#integration-of-intel-tools-installed-external-to-spack">Integration of Intel tools
installed external to Spack</a>.</p>
<p>If you plan to have Spack install licensed products for you (<a class="reference internal" href="#route-2">route 2</a> above),
the Intel product installer that Spack will run underneath must have access to
a license that is either provided by a <em>license server</em> or as a <em>license file</em>.
The installer may be able to locate a license that is already configured on
your system.  If it cannot, you must configure Spack to provide either the
server location or the license file.</p>
<p>For authoritative information on Intel licensing, see:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://software.intel.com/en-us/faq/licensing">https://software.intel.com/en-us/faq/licensing</a></p></li>
<li><p><a class="reference external" href="https://software.intel.com/en-us/articles/how-do-i-manage-my-licenses">https://software.intel.com/en-us/articles/how-do-i-manage-my-licenses</a></p></li>
</ul>
<section id="pointing-to-an-existing-license-server">
<h4><a class="toc-backref" href="#id18" role="doc-backlink">Pointing to an existing license server</a><a class="headerlink" href="#pointing-to-an-existing-license-server" title="Link to this heading"></a></h4>
<p>Installing and configuring a license server is outside the scope of Spack. We
assume that:</p>
<ul class="simple">
<li><p>Your system administrator has a license server running.</p></li>
<li><p>The license server offers valid licenses for the Intel packages of interest.</p></li>
<li><p>You can access these licenses under the user id running Spack.</p></li>
</ul>
<p>Be aware of the difference between (a) installing and configuring a license
server, and (b) configuring client software to <em>use</em> a server’s
so-called floating licenses.  We are concerned here with (b) only. The
process of obtaining a license from a server for temporary use is called
“checking out a license”.  For that, a client application such as the Intel
package installer or a compiler needs to know the host name and port number of
one or more license servers that it may query <a class="reference internal" href="#fn4" id="id5"><span>[fn4]</span></a>.</p>
<p>Follow one of three methods to <a class="reference external" href="https://software.intel.com/en-us/articles/licensing-setting-up-the-client-floating-license">point client software to a floating license server</a>.
Ideally, your license administrator will already have implemented one that can
be used unchanged in Spack: Look for the environment variable
<code class="docutils literal notranslate"><span class="pre">INTEL_LICENSE_FILE</span></code> or for files
<code class="docutils literal notranslate"><span class="pre">/opt/intel/licenses/*.lic</span></code> that contain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SERVER</span>  <span class="n">hostname</span>  <span class="n">hostid_or_ANY</span>  <span class="n">portnum</span>
<span class="n">USE_SERVER</span>
</pre></div>
</div>
<p>The relevant tokens, among possibly others, are the <code class="docutils literal notranslate"><span class="pre">USE_SERVER</span></code> line,
intended specifically for clients, and one or more <code class="docutils literal notranslate"><span class="pre">SERVER</span></code> lines above it
which give the network address.</p>
<p>If you cannot find pre-existing <code class="docutils literal notranslate"><span class="pre">/opt/intel/licenses/*.lic</span></code> files and the
<code class="docutils literal notranslate"><span class="pre">INTEL_LICENSE_FILE</span></code> environment variable is not set (even after you loaded
any relevant modulefiles), ask your license administrator for the server
address(es) and place them in a “global” license file within your Spack
directory tree <a class="reference internal" href="#spack-managed-file">as shown below</a>).</p>
</section>
<section id="installing-a-standalone-license-file">
<h4><a class="toc-backref" href="#id19" role="doc-backlink">Installing a standalone license file</a><a class="headerlink" href="#installing-a-standalone-license-file" title="Link to this heading"></a></h4>
<p>If you purchased a user-specific license, follow <a class="reference external" href="https://software.intel.com/en-us/faq/licensing#license-management">Intel’s instructions</a>
to “activate” it for your serial number, then download the resulting license file.
If needed, <a class="reference external" href="https://software.intel.com/en-us/articles/resend-license-file">request to have the file re-sent</a> to you.</p>
<p>Intel’s license files are text files that contain tokens in the proprietary
“FLEXlm” format and whose name ends in <code class="docutils literal notranslate"><span class="pre">.lic</span></code>.
Intel installers and compilers look for license files in several locations when they run.
Place your license by one of the following means, in order of decreasing preference:</p>
<ul>
<li><p>Default directory</p>
<p>Install your license file in the directory <code class="docutils literal notranslate"><span class="pre">/opt/intel/licenses/</span></code> if you
have write permission to it. This directory is inspected by all Intel tools
and is therefore preferred, as no further configuration will be needed.
Create the directory if it does not yet exist.  For the file name, either
keep the downloaded name or use another suitably plain yet descriptive
name that ends in <code class="docutils literal notranslate"><span class="pre">.lic</span></code>. Adjust file permissions for access by licensed
users.</p>
</li>
<li><p>Directory given in environment variable</p>
<p>If you cannot use the default directory, but your system already has set the
environment variable <code class="docutils literal notranslate"><span class="pre">INTEL_LICENSE_FILE</span></code> independent from Spack <a class="reference internal" href="#fn5" id="id6"><span>[fn5]</span></a>,
then, if you have the necessary write permissions, place your license file in
one of the directories mentioned in this environment variable.  Adjust file
permissions to match licensed users.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If your system has not yet set and used the environment variable
<code class="docutils literal notranslate"><span class="pre">INTEL_LICENSE_FILE</span></code>, you could start using it with the <code class="docutils literal notranslate"><span class="pre">spack</span>
<span class="pre">install</span></code> stage of licensed tools and subsequent client packages. You
would, however, be in a bind to always set that variable in the same
manner, across updates and re-installations, and perhaps accommodate
additions to it. As this may be difficult in the long run, we recommend
that you do <em>not</em> attempt to start using the variable solely for Spack.</p>
</div>
</li>
</ul>
<ul id="spack-managed-file">
<li><p>Spack-managed file</p>
<p>The first time Spack encounters an Intel package that requires a license, it
will initialize a Spack-global Intel-specific license file for you, as a
template with instructional comments, and bring up an editor <a class="reference internal" href="#fn6" id="id7"><span>[fn6]</span></a>.  Spack
will do this <em>even if you have a working license elsewhere</em> on the system.</p>
<ul class="simple">
<li><p>To proceed with an externally configured license, leave the newly templated
file as is (containing comments only) and close the editor. You do not need
to touch the file again.</p></li>
<li><p>To configure your own standalone license, copy the contents of your
downloaded license file into the opened file, save it, and close the editor.</p></li>
<li><p>To use a license server (i.e., a floating network license) that is not
already configured elsewhere on the system, supply your license server
address(es) in the form of <code class="docutils literal notranslate"><span class="pre">SERVER</span></code> and <code class="docutils literal notranslate"><span class="pre">USE_SERVER</span></code> lines at the
<em>beginning of the file</em> <a class="reference internal" href="#fn7" id="id8"><span>[fn7]</span></a>, in the format shown in section <a class="reference internal" href="#pointing-to-an-existing-license-server">Pointing to
an existing license server</a>. Save the file and close the editor.</p></li>
</ul>
<p>To revisit and manually edit this file, such as prior to a subsequent
installation attempt, find it at
<code class="docutils literal notranslate"><span class="pre">$SPACK_ROOT/etc/spack/licenses/intel/intel.lic</span></code> .</p>
<p>Spack will place symbolic links to this file in each directory where licensed
Intel binaries were installed.  If you kept the template unchanged, Intel tools
will simply ignore it.</p>
</li>
</ul>
</section>
</section>
</section>
<section id="integration-of-intel-tools-installed-external-to-spack">
<span id="integrate-external-intel"></span><h2><a class="toc-backref" href="#id20" role="doc-backlink">Integration of Intel tools installed <em>external</em> to Spack</a><a class="headerlink" href="#integration-of-intel-tools-installed-external-to-spack" title="Link to this heading"></a></h2>
<p>This section discusses <a class="reference internal" href="#route-1">route 1</a> from the introduction.</p>
<p>A site that already uses Intel tools, especially licensed ones, will likely
have some versions already installed on the system, especially at a time when
Spack is just being introduced. It will be useful to make such previously
installed tools available for use by Spack as they are. How to do this varies
depending on the type of the tools:</p>
<section id="integrating-external-compilers">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Integrating external compilers</a><a class="headerlink" href="#integrating-external-compilers" title="Link to this heading"></a></h3>
<p>For Spack to use external Intel compilers, you must tell it both <em>where</em> to
find them and <em>when</em> to use them.  The present section documents the “where”
aspect, involving <code class="docutils literal notranslate"><span class="pre">compilers.yaml</span></code> and, in most cases, long absolute paths.
The “when” aspect actually relates to <a class="reference internal" href="#route-3">route 3</a> and requires explicitly
stating the compiler as a spec component (in the form <code class="docutils literal notranslate"><span class="pre">foo</span> <span class="pre">%intel</span></code> or <code class="docutils literal notranslate"><span class="pre">foo</span>
<span class="pre">%intel&#64;compilerversion</span></code>) when installing client packages or altering Spack’s
compiler default in <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code>.
See section <a class="reference internal" href="#selecting-intel-compilers">Selecting Intel compilers</a> for details.</p>
<p>To integrate a new set of externally installed Intel compilers into Spack
follow section
<a class="reference internal" href="../getting_started.html#compiler-config"><span class="std std-ref">Compiler configuration</span></a>.
Briefly, prepare your shell environment like you would if you were to use these
compilers normally, i.e., typically by a <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">...</span></code> or a shell
<code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">...</span></code> command, then use <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">compiler</span> <span class="pre">find</span></code> to make Spack aware of
these compilers.  This will create a new entry in a suitably scoped and possibly new
<code class="docutils literal notranslate"><span class="pre">compilers.yaml</span></code> file. You could certainly create such a compiler entry
manually, but this is error-prone due to the indentation and different data
types involved.</p>
<p>The Intel compilers need and use the system’s native GCC compiler (<code class="docutils literal notranslate"><span class="pre">gcc</span></code> on
most systems, <code class="docutils literal notranslate"><span class="pre">clang</span></code> on macOS) to provide certain functionality, notably to
support C++. To provide a different GCC compiler for the Intel tools, or more
generally set persistent flags for all invocations of the Intel compilers, locate
the <code class="docutils literal notranslate"><span class="pre">compilers.yaml</span></code> entry that defines your Intel compiler, and, using a
text editor, change one or both of the following:</p>
<ol class="arabic simple">
<li><p>At the <code class="docutils literal notranslate"><span class="pre">modules:</span></code> tag, add a <code class="docutils literal notranslate"><span class="pre">gcc</span></code> module to the list.</p></li>
<li><p>At the <code class="docutils literal notranslate"><span class="pre">flags:</span></code> tag, add <code class="docutils literal notranslate"><span class="pre">cflags:</span></code>, <code class="docutils literal notranslate"><span class="pre">cxxflags:</span></code>, and <code class="docutils literal notranslate"><span class="pre">fflags:</span></code> key-value entries.</p></li>
</ol>
<p>Consult the examples under
<a class="reference internal" href="../getting_started.html#compiler-config"><span class="std std-ref">Compiler configuration</span></a>
and
<a class="reference internal" href="../getting_started.html#vendor-specific-compiler-configuration"><span class="std std-ref">Vendor-Specific Compiler Configuration</span></a>
in the Spack documentation.
When done, validate your compiler definition by running
<code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">compiler</span> <span class="pre">info</span> <span class="pre">intel&#64;compilerversion</span></code> (replacing <code class="docutils literal notranslate"><span class="pre">compilerversion</span></code> by
the version that you defined).</p>
<p>Be aware that both the GCC integration and persistent compiler flags can also be
affected by an advanced third method:</p>
<ol class="arabic simple" start="3">
<li><p>A modulefile that provides the Intel compilers for you
could, for the benefit of users outside of Spack, implicitly
integrate a specific <code class="docutils literal notranslate"><span class="pre">gcc</span></code> version via compiler flag environment variables
or (hopefully not) via a sneaky extra <code class="docutils literal notranslate"><span class="pre">PATH</span></code> addition.</p></li>
</ol>
<p>Next, visit section <a class="reference internal" href="#selecting-intel-compilers">Selecting Intel Compilers</a> to learn how to tell
Spack to use the newly configured compilers.</p>
</section>
<section id="integrating-external-libraries">
<span id="intel-integrating-external-libraries"></span><h3><a class="toc-backref" href="#id22" role="doc-backlink">Integrating external libraries</a><a class="headerlink" href="#integrating-external-libraries" title="Link to this heading"></a></h3>
<p>Configure external library-type packages (as opposed to compilers)
in the files <code class="docutils literal notranslate"><span class="pre">$SPACK_ROOT/etc/spack/packages.yaml</span></code> or
<code class="docutils literal notranslate"><span class="pre">~/.spack/packages.yaml</span></code>, following the Spack documentation under
<a class="reference internal" href="../packages_yaml.html#sec-external-packages"><span class="std std-ref">External Packages</span></a>.</p>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">compilers.yaml</span></code>, the <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> files define a package
external to Spack in terms of a Spack spec and resolve each such spec via
either the <code class="docutils literal notranslate"><span class="pre">paths</span></code> or <code class="docutils literal notranslate"><span class="pre">modules</span></code> tokens to a specific pre-installed package
version on the system.  Since Intel tools generally need environment variables
to interoperate, which cannot be conveyed in a mere <code class="docutils literal notranslate"><span class="pre">paths</span></code> specification,
the <code class="docutils literal notranslate"><span class="pre">modules</span></code> token will be more sensible to use. It resolves the Spack-side
spec to a modulefile generated and managed outside of Spack’s purview,
which Spack will load internally and transiently when the corresponding spec is
called upon to compile client packages.</p>
<p>Unlike for compilers, where <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">find</span> <span class="pre">compilers</span> <span class="pre">[spec]</span></code> generates an entry
in an existing or new <code class="docutils literal notranslate"><span class="pre">compilers.yaml</span></code> file, Spack does not offer a command
to generate an entirely new <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> entry.  You must create
new entries yourself in a text editor, though the command <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">config</span>
<span class="pre">[--scope=...]</span> <span class="pre">edit</span> <span class="pre">packages</span></code> can help with selecting the proper file.
See section
<a class="reference internal" href="../configuration.html#configuration-scopes"><span class="std std-ref">Configuration Scopes</span></a>
for an explanation about the different files
and section
<a class="reference internal" href="../packages_yaml.html#packages-config"><span class="std std-ref">Build customization</span></a>
for specifics and examples for <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> files.</p>
<p>The following example integrates packages embodied by hypothetical
external modulefiles <code class="docutils literal notranslate"><span class="pre">intel-mkl/18/...</span></code> into
Spack as packages <code class="docutils literal notranslate"><span class="pre">intel-mkl&#64;...</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>config<span class="w"> </span>edit<span class="w"> </span>packages
</pre></div>
</div>
<p>Make sure the file begins with:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
</pre></div>
</div>
<p>Adapt the following example. Be sure to maintain the indentation:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># other content ...</span>

<span class="w">  </span><span class="nt">intel-mkl</span><span class="p">:</span>
<span class="w">    </span><span class="nt">externals</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;intel-mkl@2018.2.199</span><span class="nv">  </span><span class="s">arch=linux-centos6-x86_64&quot;</span>
<span class="w">      </span><span class="nt">modules</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">intel-mkl/18/18.0.2</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;intel-mkl@2018.3.222</span><span class="nv">  </span><span class="s">arch=linux-centos6-x86_64&quot;</span>
<span class="w">      </span><span class="nt">modules</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">intel-mkl/18/18.0.3</span>
</pre></div>
</div>
<p>The version numbers for the <code class="docutils literal notranslate"><span class="pre">intel-mkl</span></code> specs defined here correspond to file
and directory names that Intel uses for its products because they were adopted
and declared as such within Spack’s package repository. You can inspect the
versions known to your current Spack installation by:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>info<span class="w"> </span>intel-mkl
</pre></div>
</div>
<p>Using the same version numbers for external packages as for packages known
internally is useful for clarity, but not strictly necessary.  Moreover, with a
<code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> entry, you can go beyond internally known versions.</p>
<p id="compiler-neutral-package">Note that the Spack spec in the example does not contain a compiler
specification. This is intentional, as the Intel library packages can be used
unmodified with different compilers.</p>
<p>A slightly more advanced example illustrates how to provide
<a class="reference internal" href="../basic_usage.html#basic-variants"><span class="std std-ref">variants</span></a>
and how to use the <code class="docutils literal notranslate"><span class="pre">buildable:</span> <span class="pre">False</span></code> directive to prevent Spack from installing
other versions or variants of the named package through its normal internal
mechanism.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">intel-parallel-studio</span><span class="p">:</span>
<span class="w">    </span><span class="nt">externals</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;intel-parallel-studio@cluster.2018.2.199</span><span class="nv"> </span><span class="s">+mkl+mpi+ipp+tbb+daal</span><span class="nv">  </span><span class="s">arch=linux-centos6-x86_64&quot;</span>
<span class="w">      </span><span class="nt">modules</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">intel/18/18.0.2</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;intel-parallel-studio@cluster.2018.3.222</span><span class="nv"> </span><span class="s">+mkl+mpi+ipp+tbb+daal</span><span class="nv">  </span><span class="s">arch=linux-centos6-x86_64&quot;</span>
<span class="w">      </span><span class="nt">modules</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">intel/18/18.0.3</span>
<span class="w">    </span><span class="nt">buildable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</pre></div>
</div>
<p>One additional example illustrates the use of <code class="docutils literal notranslate"><span class="pre">prefix:</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">modules:</span></code>, useful when external modulefiles are not available or not
suitable:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">intel-parallel-studio</span><span class="p">:</span>
<span class="w">    </span><span class="nt">externals</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;intel-parallel-studio@cluster.2018.2.199</span><span class="nv"> </span><span class="s">+mkl+mpi+ipp+tbb+daal&quot;</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/intel</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;intel-parallel-studio@cluster.2018.3.222</span><span class="nv"> </span><span class="s">+mkl+mpi+ipp+tbb+daal&quot;</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/intel</span>
<span class="w">    </span><span class="nt">buildable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</pre></div>
</div>
<p>Note that for the Intel packages discussed here, the directory values in the
<code class="docutils literal notranslate"><span class="pre">prefix:</span></code> entries must be the high-level and typically version-less
“installation directory” that has been used by Intel’s product installer.
Such a directory will typically accumulate various product versions.  Amongst
them, Spack will select the correct version-specific product directory based on
the <code class="docutils literal notranslate"><span class="pre">&#64;version</span></code> spec component that each path is being defined for.</p>
<p>For further background and details, see
<a class="reference internal" href="../packages_yaml.html#sec-external-packages"><span class="std std-ref">External Packages</span></a>.</p>
</section>
</section>
<section id="installing-intel-tools-within-spack">
<h2><a class="toc-backref" href="#id23" role="doc-backlink">Installing Intel tools <em>within</em> Spack</a><a class="headerlink" href="#installing-intel-tools-within-spack" title="Link to this heading"></a></h2>
<p>This section discusses <a class="reference internal" href="#route-2">route 2</a> from the introduction.</p>
<p>When a system does not yet have Intel tools installed already, or the installed
versions are undesirable, Spack can install these tools like any regular Spack
package for you and, with appropriate pre- and post-install configuration, use its
compilers and/or libraries to install client packages.</p>
<section id="install-steps-for-packages-with-compilers-and-libraries">
<span id="intel-install-studio"></span><h3><a class="toc-backref" href="#id24" role="doc-backlink">Install steps for packages with compilers and libraries</a><a class="headerlink" href="#install-steps-for-packages-with-compilers-and-libraries" title="Link to this heading"></a></h3>
<p>The packages <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span></code> and <code class="docutils literal notranslate"><span class="pre">intel</span></code> (which is a subset of the
former) are many-in-one products that contain both compilers and a set of
library packages whose scope depends on the edition.
Because they are general products geared towards shell environments,
it can be somewhat involved to integrate these packages at their full extent
into Spack.</p>
<p>Note: To install library-only packages like <code class="docutils literal notranslate"><span class="pre">intel-mkl</span></code>, <code class="docutils literal notranslate"><span class="pre">intel-mpi</span></code>, and <code class="docutils literal notranslate"><span class="pre">intel-daal</span></code>
follow <a class="reference internal" href="#intel-install-libs">the next section</a> instead.</p>
<ol class="arabic simple">
<li><p>Review the section <a class="reference internal" href="#configuring-spack-to-use-intel-licenses">Configuring spack to use intel licenses</a>.</p></li>
</ol>
<ol class="arabic" id="intel-compiler-anticipation" start="2">
<li><p>To install a version of <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span></code> that provides Intel
compilers at a version that you have <em>not yet declared in Spack</em>,
the following preparatory steps are recommended:</p>
<ol class="upperalpha">
<li><p>Determine the compiler spec that the new <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span></code> package
will provide, as follows: From the package version, combine the last two
digits of the version year, a literal “0” (zero), and the version component
that immediately follows the year.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Package version</p></td>
<td><p>Compiler spec provided</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">intel-parallel-studio&#64;edition.YYyy.u</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">intel&#64;yy.0.u</span></code></p></td>
</tr>
</tbody>
</table>
<p>Example: The package <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio&#64;cluster.2018.3</span></code> will provide
the compiler with spec <code class="docutils literal notranslate"><span class="pre">intel&#64;18.0.3</span></code>.</p>
</li>
</ol>
<ol class="upperalpha" id="config-compiler-anticipated" start="2">
<li><p>Add a new compiler section with the newly anticipated version at the
end of a <code class="docutils literal notranslate"><span class="pre">compilers.yaml</span></code> file in a suitable scope.  For example, run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>config<span class="w"> </span>--scope<span class="o">=</span>user/linux<span class="w"> </span>edit<span class="w"> </span>compilers
</pre></div>
</div>
<p>and append a stub entry:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">compiler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">target</span><span class="p">:</span><span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">x86_64</span>
<span class="w">    </span><span class="nt">operating_system</span><span class="p">:</span><span class="w">   </span><span class="l l-Scalar l-Scalar-Plain">centos6</span>
<span class="w">    </span><span class="nt">modules</span><span class="p">:</span><span class="w">    </span><span class="p p-Indicator">[]</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">       </span><span class="l l-Scalar l-Scalar-Plain">intel@18.0.3</span>
<span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">      </span><span class="nt">cc</span><span class="p">:</span><span class="w">       </span><span class="l l-Scalar l-Scalar-Plain">/usr/bin/true</span>
<span class="w">      </span><span class="nt">cxx</span><span class="p">:</span><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">/usr/bin/true</span>
<span class="w">      </span><span class="nt">f77</span><span class="p">:</span><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">/usr/bin/true</span>
<span class="w">      </span><span class="nt">fc</span><span class="p">:</span><span class="w">       </span><span class="l l-Scalar l-Scalar-Plain">/usr/bin/true</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">18.0.3</span></code> with the version that you determined in the preceding
step. The exact contents under <code class="docutils literal notranslate"><span class="pre">paths:</span></code> do not matter yet, but the paths must exist.</p>
</li>
</ol>
<p>This temporary stub is required such that the <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span></code> package
can be installed for the <code class="docutils literal notranslate"><span class="pre">intel</span></code> compiler (which the package itself is going
to provide after the installation) rather than an arbitrary system compiler.
The paths given in <code class="docutils literal notranslate"><span class="pre">cc</span></code>, <code class="docutils literal notranslate"><span class="pre">cxx</span></code>, <code class="docutils literal notranslate"><span class="pre">f77</span></code>, <code class="docutils literal notranslate"><span class="pre">fc</span></code> must exist, but will
never be used to build anything during the installation of <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span></code>.</p>
<p>The reason for this stub is that <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span></code> also provides the
<code class="docutils literal notranslate"><span class="pre">mpi</span></code> and <code class="docutils literal notranslate"><span class="pre">mkl</span></code> packages and when concretizing a spec, Spack ensures
strong consistency of the used compiler across all dependencies:  <a class="reference internal" href="#fn8" id="id9"><span>[fn8]</span></a>.
Installing a package <code class="docutils literal notranslate"><span class="pre">foo</span> <span class="pre">+mkl</span> <span class="pre">%intel</span></code> will make Spack look for a package
<code class="docutils literal notranslate"><span class="pre">mkl</span> <span class="pre">%intel</span></code>, which can be provided by <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio+mkl</span> <span class="pre">%intel</span></code>,
but not by <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio+mkl</span> <span class="pre">%gcc</span></code>.</p>
<p>Failure to do so may result in additional installations of <code class="docutils literal notranslate"><span class="pre">mkl</span></code>, <code class="docutils literal notranslate"><span class="pre">intel-mpi</span></code> or
even <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span></code> as dependencies for other packages.</p>
</li>
<li id="verify-compiler-anticipated"><p>Verify that the compiler version provided by the new <code class="docutils literal notranslate"><span class="pre">studio</span></code> version
would be used as expected if you were to compile a client package:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>spec<span class="w"> </span>zlib<span class="w"> </span>%intel
</pre></div>
</div>
<p>If the version does not match, explicitly state the anticipated compiler version, e.g.:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>spec<span class="w"> </span>zlib<span class="w"> </span>%intel@18.0.3
</pre></div>
</div>
<p>if there are problems, review and correct the compiler’s <code class="docutils literal notranslate"><span class="pre">compilers.yaml</span></code>
entry, be it still in stub form or already complete (as it would be for a
re-installation).</p>
</li>
<li><p>Install the new <code class="docutils literal notranslate"><span class="pre">studio</span></code> package using Spack’s regular <code class="docutils literal notranslate"><span class="pre">install</span></code>
command.
It may be wise to provide the anticipated compiler (<a class="reference internal" href="#verify-compiler-anticipated">see above</a>) as an explicit concretization
element:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>install<span class="w"> </span>intel-parallel-studio@cluster.2018.3<span class="w">  </span>%intel@18.0.3
</pre></div>
</div>
</li>
<li><p>Follow the same steps as under <a class="reference internal" href="#integrating-external-compilers">Integrating external compilers</a> to tell
Spack the minutiae for actually using those compilers with client packages.
If you placed a stub entry in a <code class="docutils literal notranslate"><span class="pre">compilers.yaml</span></code> file, now is the time to
edit it and fill in the particulars.</p>
<ul>
<li><p>Under <code class="docutils literal notranslate"><span class="pre">paths:</span></code>, give the full paths to the actual compiler binaries (<code class="docutils literal notranslate"><span class="pre">icc</span></code>,
<code class="docutils literal notranslate"><span class="pre">ifort</span></code>, etc.) located within the Spack installation tree, in all their
unsightly length <a class="reference internal" href="#fn9" id="id10"><span>[fn9]</span></a>.</p>
<p>To determine the full path to the C compiler, adapt and run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>find<span class="w"> </span><span class="sb">`</span>spack<span class="w"> </span>location<span class="w"> </span>-i<span class="w"> </span>intel-parallel-studio@cluster.2018.3<span class="sb">`</span><span class="w"> </span><span class="se">\</span>
<span class="w">       </span>-name<span class="w"> </span>icc<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-ls
</pre></div>
</div>
<p>If you get hits for both <code class="docutils literal notranslate"><span class="pre">intel64</span></code> and <code class="docutils literal notranslate"><span class="pre">ia32</span></code>, you almost certainly will
want to use the <code class="docutils literal notranslate"><span class="pre">intel64</span></code> variant.  The <code class="docutils literal notranslate"><span class="pre">icpc</span></code> and <code class="docutils literal notranslate"><span class="pre">ifort</span></code> compilers
will be located in the same directory as <code class="docutils literal notranslate"><span class="pre">icc</span></code>.</p>
</li>
<li><p>Make sure to specify <code class="docutils literal notranslate"><span class="pre">modules:</span> <span class="pre">['intel-parallel-studio-cluster2018.3-intel-18.0.3-HASH']</span></code>
(with <code class="docutils literal notranslate"><span class="pre">HASH</span></code> being the short hash as displayed when running
<code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">find</span> <span class="pre">-l</span> <span class="pre">intel-parallel-studio&#64;cluster.2018.3</span></code> and the versions adapted accordingly)
to ensure that the correct and complete environment for the Intel compilers gets
loaded when running them. With modern versions of the Intel compiler you may otherwise see
issues about missing libraries. Please also note that module name must exactly match
the name as returned by <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">avail</span></code> (and shown in the example above).</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">modules:</span></code> and/or <code class="docutils literal notranslate"><span class="pre">cflags:</span></code> tokens to further specify a suitable accompanying
<code class="docutils literal notranslate"><span class="pre">gcc</span></code> version to help pacify picky client packages that ask for C++
standards more recent than supported by your system-provided <code class="docutils literal notranslate"><span class="pre">gcc</span></code> and its
<code class="docutils literal notranslate"><span class="pre">libstdc++.so</span></code>.</p></li>
<li><p>If you specified a custom variant (for example <code class="docutils literal notranslate"><span class="pre">+vtune</span></code>) you may want to add this as your
preferred variant in the packages configuration for the <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span></code> package
as described in <a class="reference internal" href="../packages_yaml.html#package-preferences"><span class="std std-ref">Package Preferences</span></a>. Otherwise you will have to specify
the variant every time <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span></code> is being used as <code class="docutils literal notranslate"><span class="pre">mkl</span></code>, <code class="docutils literal notranslate"><span class="pre">fftw</span></code> or <code class="docutils literal notranslate"><span class="pre">mpi</span></code>
implementation to avoid pulling in a different variant.</p></li>
<li><p>To set the Intel compilers for default use in Spack, instead of the usual <code class="docutils literal notranslate"><span class="pre">%gcc</span></code>,
follow section <a class="reference internal" href="#selecting-intel-compilers">Selecting Intel compilers</a>.</p></li>
</ul>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Compiler packages like <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span></code> can easily be above 10 GB
in size, which can tax the disk space available for temporary files on
small, busy, or restricted systems (like virtual machines). The Intel
installer will stop and report insufficient space as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">==&gt;</span> <span class="s1">&#39;./install.sh&#39;</span> <span class="s1">&#39;--silent&#39;</span> <span class="s1">&#39;silent.cfg&#39;</span>
<span class="o">...</span>
<span class="n">Missing</span> <span class="n">critical</span> <span class="n">prerequisite</span>
<span class="o">--</span> <span class="n">Not</span> <span class="n">enough</span> <span class="n">disk</span> <span class="n">space</span>
</pre></div>
</div>
<p>As first remedy, clean Spack’s existing staging area:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>clean<span class="w"> </span>--stage
</pre></div>
</div>
<p>then retry installing the large package. Spack normally cleans staging
directories but certain failures may prevent it from doing so.</p>
<p>If the error persists, tell Spack to use an alternative location for
temporary files:</p>
<ol class="arabic">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">df</span> <span class="pre">-h</span></code> to identify an alternative location on your system.</p></li>
<li><p>Tell Spack to use that location for staging. Do <strong>one</strong> of the following:</p>
<ul>
<li><p>Run Spack with the environment variable <code class="docutils literal notranslate"><span class="pre">TMPDIR</span></code> altered for just a
single command. For example, to use your <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nv">TMPDIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/spack-stage&quot;</span><span class="w">  </span>spack<span class="w"> </span>install<span class="w"> </span>....
</pre></div>
</div>
<p>This example uses Bourne shell syntax. Adapt for other shells as needed.</p>
</li>
<li><p>Alternatively, customize
Spack’s <code class="docutils literal notranslate"><span class="pre">build_stage</span></code> <a class="reference internal" href="../configuration.html#config-overrides"><span class="std std-ref">configuration setting</span></a>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>config<span class="w"> </span>edit<span class="w"> </span>config
</pre></div>
</div>
<p>Append:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">config</span><span class="p">:</span>
<span class="w">  </span><span class="nt">build_stage</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/$user/spack-stage</span>
</pre></div>
</div>
<p>Do not duplicate the <code class="docutils literal notranslate"><span class="pre">config:</span></code> line if it already is present.
Adapt the location, which here is the same as in the preceding example.</p>
</li>
</ul>
</li>
<li><p>Retry installing the large package.</p></li>
</ol>
</div>
</section>
<section id="install-steps-for-library-only-packages">
<span id="intel-install-libs"></span><h3><a class="toc-backref" href="#id25" role="doc-backlink">Install steps for library-only packages</a><a class="headerlink" href="#install-steps-for-library-only-packages" title="Link to this heading"></a></h3>
<p>To install library-only packages like <code class="docutils literal notranslate"><span class="pre">intel-mkl</span></code>, <code class="docutils literal notranslate"><span class="pre">intel-mpi</span></code>, and <code class="docutils literal notranslate"><span class="pre">intel-daal</span></code>
follow the steps given here.
For packages that contain a compiler, follow <a class="reference internal" href="#intel-install-studio">the previous section</a> instead.</p>
<ol class="arabic">
<li><p>For pre-2017 product releases, review the section <a class="reference internal" href="#configuring-spack-to-use-intel-licenses">Configuring Spack to use Intel licenses</a>.</p></li>
<li><p>Inspect the package spec. Specify an explicit compiler if necessary, e.g.:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>spec<span class="w"> </span>intel-mpi@2018.3.199
<span class="gp">$ </span>spack<span class="w"> </span>spec<span class="w"> </span>intel-mpi@2018.3.199<span class="w">  </span>%intel
</pre></div>
</div>
<p>Check that the package will use the compiler flavor and version that you expect.</p>
</li>
<li><p>Install the package normally within Spack. Use the same spec as in the
previous command, i.e., as general or as specific as needed:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>install<span class="w"> </span>intel-mpi@2018.3.199
<span class="gp">$ </span>spack<span class="w"> </span>install<span class="w"> </span>intel-mpi@2018.3.199<span class="w">  </span>%intel@18
</pre></div>
</div>
</li>
<li><p>To prepare the new packages for use with client packages,
follow <a class="reference internal" href="#selecting-libraries-to-satisfy-virtual-packages">Selecting libraries to satisfy virtual packages</a>.</p></li>
</ol>
</section>
<section id="debug-notes">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">Debug notes</a><a class="headerlink" href="#debug-notes" title="Link to this heading"></a></h3>
<ul>
<li><p>You can trigger a wall of additional diagnostics using Spack options, e.g.:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>--debug<span class="w"> </span>-v<span class="w"> </span>install<span class="w"> </span>intel-mpi
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--debug</span></code> option can also be useful while installing client
packages <a class="reference internal" href="#using-intel-tools-in-spack-to-install-client-packages">(see below)</a> to confirm the integration of the Intel tools in Spack, notably
MKL and MPI.</p>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">.spack/</span></code> subdirectory of an installed <code class="docutils literal notranslate"><span class="pre">IntelPackage</span></code> will contain,
besides Spack’s usual archival items, a copy of the <code class="docutils literal notranslate"><span class="pre">silent.cfg</span></code> file that
was passed to the Intel installer:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>grep<span class="w"> </span>COMPONENTS<span class="w"> </span>...intel-mpi...&lt;hash&gt;/.spack/silent.cfg
<span class="go">COMPONENTS=ALL</span>
</pre></div>
</div>
</li>
<li><p>If an installation error occurs, Spack will normally clean up and remove a
partially installed target directory. You can direct Spack to keep it using
<code class="docutils literal notranslate"><span class="pre">--keep-prefix</span></code>, e.g.:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>install<span class="w"> </span>--keep-prefix<span class="w">  </span>intel-mpi
</pre></div>
</div>
<p>You must, however, <em>remove such partial installations</em> prior to subsequent
installation attempts. Otherwise, the Intel installer will behave
incorrectly.</p>
</li>
</ul>
</section>
</section>
<section id="using-intel-tools-in-spack-to-install-client-packages">
<h2><a class="toc-backref" href="#id27" role="doc-backlink">Using Intel tools in Spack to install client packages</a><a class="headerlink" href="#using-intel-tools-in-spack-to-install-client-packages" title="Link to this heading"></a></h2>
<p>Finally, this section pertains to <a class="reference internal" href="#route-3">route 3</a> from the introduction.</p>
<p>Once Intel tools are installed within Spack as external or internal packages
they can be used as intended for installing client packages.</p>
<section id="selecting-intel-compilers">
<span id="select-intel-compilers"></span><h3><a class="toc-backref" href="#id28" role="doc-backlink">Selecting Intel compilers</a><a class="headerlink" href="#selecting-intel-compilers" title="Link to this heading"></a></h3>
<p>Select Intel compilers to compile client packages, like any compiler in Spack,
by one of the following means:</p>
<ul>
<li><p>Request the Intel compilers explicitly in the client spec, e.g.:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>install<span class="w"> </span>libxc@3.0.0%intel
</pre></div>
</div>
</li>
<li><p>Alternatively, request Intel compilers implicitly by package preferences.
Configure the order of compilers in the appropriate <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> file,
under either an <code class="docutils literal notranslate"><span class="pre">all:</span></code> or client-package-specific entry, in a
<code class="docutils literal notranslate"><span class="pre">compiler:</span></code> list. Consult the Spack documentation for
<a class="reference external" href="https://spack-tutorial.readthedocs.io/en/latest/tutorial_configuration.html#configuring-package-preferences">Configuring Package Preferences</a>
and
<a class="reference internal" href="../packages_yaml.html#package-preferences"><span class="std std-ref">Package Preferences</span></a>.</p></li>
</ul>
<p>Example: <code class="docutils literal notranslate"><span class="pre">etc/spack/packages.yaml</span></code> might simply contain:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">all</span><span class="p">:</span>
<span class="w">    </span><span class="nt">compiler</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">intel</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">gcc</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>To be more specific, you can state partial or full compiler version numbers,
for example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">all</span><span class="p">:</span>
<span class="w">    </span><span class="nt">compiler</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">intel@18</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">intel@17</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">gcc@4.4.7</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">gcc@4.9.3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">gcc@7.3.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</section>
<section id="selecting-libraries-to-satisfy-virtual-packages">
<span id="intel-virtual-packages"></span><h3><a class="toc-backref" href="#id29" role="doc-backlink">Selecting libraries to satisfy virtual packages</a><a class="headerlink" href="#selecting-libraries-to-satisfy-virtual-packages" title="Link to this heading"></a></h3>
<p>Intel packages, whether integrated into Spack as external packages or
installed within Spack, can be called upon to satisfy the requirement of a
client package for a library that is available from different providers.
The relevant virtual packages for Intel are <code class="docutils literal notranslate"><span class="pre">blas</span></code>, <code class="docutils literal notranslate"><span class="pre">lapack</span></code>,
<code class="docutils literal notranslate"><span class="pre">scalapack</span></code>, and <code class="docutils literal notranslate"><span class="pre">mpi</span></code>.</p>
<p>In both integration routes, Intel packages can have optional
<a class="reference internal" href="../basic_usage.html#basic-variants"><span class="std std-ref">variants</span></a>
which alter the list of virtual packages they can satisfy.  For Spack-external
packages, the active variants are a combination of the defaults declared in
Spack’s package repository and the spec it is declared as in <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code>.
Needless to say, those should match the components that are actually present in
the external product installation. Likewise, for Spack-internal packages, the
active variants are determined, persistently at installation time, from the
defaults in the repository and the spec selected to be installed.</p>
<p>To have Intel packages satisfy virtual package requests for all or selected
client packages, edit the <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> file.  Customize, either in the
<code class="docutils literal notranslate"><span class="pre">all:</span></code> or a more specific entry, a <code class="docutils literal notranslate"><span class="pre">providers:</span></code> dictionary whose keys are
the virtual packages and whose values are the Spack specs that satisfy the
virtual package, in order of decreasing preference.  To learn more about the
<code class="docutils literal notranslate"><span class="pre">providers:</span></code> settings, see the Spack tutorial for
<a class="reference external" href="https://spack-tutorial.readthedocs.io/en/latest/tutorial_configuration.html#configuring-package-preferences">Configuring Package Preferences</a>
and the section
<a class="reference internal" href="../packages_yaml.html#package-preferences"><span class="std std-ref">Package Preferences</span></a>.</p>
<p>Example: The following fairly minimal example for <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> shows how
to exclusively use the standalone <code class="docutils literal notranslate"><span class="pre">intel-mkl</span></code> package for all the linear
algebra virtual packages in Spack, and <code class="docutils literal notranslate"><span class="pre">intel-mpi</span></code> as the preferred MPI
implementation. Other providers can still be chosen on a per-package basis.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="nt">all</span><span class="p">:</span>
<span class="w">    </span><span class="nt">providers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">mpi</span><span class="p">:</span><span class="w">       </span><span class="p p-Indicator">[</span><span class="nv">intel-mpi</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">blas</span><span class="p">:</span><span class="w">      </span><span class="p p-Indicator">[</span><span class="nv">intel-mkl</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">lapack</span><span class="p">:</span><span class="w">    </span><span class="p p-Indicator">[</span><span class="nv">intel-mkl</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">scalapack</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">intel-mkl</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>If you have access to the <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio&#64;cluster</span></code> edition, you can
use instead:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">all</span><span class="p">:</span>
<span class="w">  </span><span class="nt">providers</span><span class="p">:</span>
<span class="w">    </span><span class="nt">mpi</span><span class="p">:</span><span class="w">       </span><span class="p p-Indicator">[</span><span class="nv">intel-parallel-studio+mpi</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="c1"># Note: +mpi vs. +mkl</span>
<span class="w">    </span><span class="nt">blas</span><span class="p">:</span><span class="w">      </span><span class="p p-Indicator">[</span><span class="nv">intel-parallel-studio+mkl</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">lapack</span><span class="p">:</span><span class="w">    </span><span class="p p-Indicator">[</span><span class="nv">intel-parallel-studio+mkl</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">scalapack</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">intel-parallel-studio+mkl</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>If you installed <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span></code> within Spack (”<a class="reference internal" href="#route-2">route 2</a>”), make
sure you followed the <a class="reference internal" href="#intel-compiler-anticipation">special installation step</a> to ensure that its virtual packages match the
compilers it provides.</p>
</section>
<section id="using-intel-tools-as-explicit-dependency">
<h3><a class="toc-backref" href="#id30" role="doc-backlink">Using Intel tools as explicit dependency</a><a class="headerlink" href="#using-intel-tools-as-explicit-dependency" title="Link to this heading"></a></h3>
<p>With the proper installation as detailed above, no special steps should be
required when a client package specifically (and thus deliberately) requests an
Intel package as dependency, this being one of the target use cases for Spack.</p>
</section>
<section id="tips-for-configuring-client-packages-to-use-mkl">
<span id="using-mkl-tips"></span><h3><a class="toc-backref" href="#id31" role="doc-backlink">Tips for configuring client packages to use MKL</a><a class="headerlink" href="#tips-for-configuring-client-packages-to-use-mkl" title="Link to this heading"></a></h3>
<p>The Math Kernel Library (MKL) is provided by several Intel packages, currently
<code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span></code> when variant <code class="docutils literal notranslate"><span class="pre">+mkl</span></code> is active (it is by default)
and the standalone <code class="docutils literal notranslate"><span class="pre">intel-mkl</span></code>. Because of these different provider packages,
a <em>virtual</em> <code class="docutils literal notranslate"><span class="pre">mkl</span></code> package is declared in Spack.</p>
<ul>
<li><p>To use MKL-specific APIs in a client package:</p>
<p>Declare a dependency on <code class="docutils literal notranslate"><span class="pre">mkl</span></code>, rather than a specific provider like
<code class="docutils literal notranslate"><span class="pre">intel-mkl</span></code>.  Declare the dependency either absolutely or conditionally
based on variants that your package might have declared:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Examples for absolute and conditional dependencies:</span>
<span class="n">depends_on</span><span class="p">(</span><span class="s2">&quot;mkl&quot;</span><span class="p">)</span>
<span class="n">depends_on</span><span class="p">(</span><span class="s2">&quot;mkl&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="s2">&quot;+mkl&quot;</span><span class="p">)</span>
<span class="n">depends_on</span><span class="p">(</span><span class="s2">&quot;mkl&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="s2">&quot;fftw=mkl&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">MKLROOT</span></code> environment variable (part of the documented API) will be set
during all stages of client package installation, and is available to both
the Spack packaging code and the client code.</p>
</li>
<li><p>To use MKL as provider for BLAS, LAPACK, or ScaLAPACK:</p>
<p>The packages that provide <code class="docutils literal notranslate"><span class="pre">mkl</span></code> also provide the narrower
virtual <code class="docutils literal notranslate"><span class="pre">blas</span></code>, <code class="docutils literal notranslate"><span class="pre">lapack</span></code>, and <code class="docutils literal notranslate"><span class="pre">scalapack</span></code> packages.
See the relevant <a class="reference internal" href="../packaging_guide.html#blas-lapack-scalapack"><span class="std std-ref">Packaging Guide section</span></a>
for an introduction.
To portably use these virtual packages, construct preprocessor and linker
option strings in your package configuration code using the package functions
<code class="docutils literal notranslate"><span class="pre">.headers</span></code> and <code class="docutils literal notranslate"><span class="pre">.libs</span></code> in conjunction with utility functions from the
following classes:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../llnl.util.html#llnl.util.filesystem.FileList" title="llnl.util.filesystem.FileList"><code class="xref py py-class docutils literal notranslate"><span class="pre">llnl.util.filesystem.FileList</span></code></a>,</p></li>
<li><p><a class="reference internal" href="../llnl.util.html#llnl.util.filesystem.HeaderList" title="llnl.util.filesystem.HeaderList"><code class="xref py py-class docutils literal notranslate"><span class="pre">llnl.util.filesystem.HeaderList</span></code></a>,</p></li>
<li><p><a class="reference internal" href="../llnl.util.html#llnl.util.filesystem.LibraryList" title="llnl.util.filesystem.LibraryList"><code class="xref py py-class docutils literal notranslate"><span class="pre">llnl.util.filesystem.LibraryList</span></code></a>.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><em>Do not</em> use constructs like <code class="docutils literal notranslate"><span class="pre">.prefix.include</span></code> or <code class="docutils literal notranslate"><span class="pre">.prefix.lib</span></code>, with
Intel or any other implementation of <code class="docutils literal notranslate"><span class="pre">blas</span></code>, <code class="docutils literal notranslate"><span class="pre">lapack</span></code>, and
<code class="docutils literal notranslate"><span class="pre">scalapack</span></code>.</p>
</div>
<p>For example, for an
<a class="reference internal" href="autotoolspackage.html#autotoolspackage"><span class="std std-ref">AutotoolsPackage</span></a>
use <code class="docutils literal notranslate"><span class="pre">.libs.ld_flags</span></code> to transform the library file list into linker options
passed to <code class="docutils literal notranslate"><span class="pre">./configure</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">configure_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="o">...</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;--with-blas=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;blas&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">libs</span><span class="o">.</span><span class="n">ld_flags</span><span class="p">)</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;--with-lapack=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;lapack&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">libs</span><span class="o">.</span><span class="n">ld_flags</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Even though <code class="docutils literal notranslate"><span class="pre">.ld_flags</span></code> will return a string of multiple words, <em>do not</em>
use quotes for options like <code class="docutils literal notranslate"><span class="pre">--with-blas=...</span></code> because Spack passes them
to <code class="docutils literal notranslate"><span class="pre">./configure</span></code> without invoking a shell.</p>
</div>
<p>Likewise, in a
<a class="reference internal" href="makefilepackage.html#makefilepackage"><span class="std std-ref">MakefilePackage</span></a>
or similar package that does not use AutoTools you may need to provide include
and link options for use on command lines or in environment variables.
For example, to generate an option string of the form <code class="docutils literal notranslate"><span class="pre">-I&lt;dir&gt;</span></code>, use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;blas&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">include_flags</span>
</pre></div>
</div>
<p>and to generate linker options (<code class="docutils literal notranslate"><span class="pre">-L&lt;dir&gt;</span> <span class="pre">-llibname</span> <span class="pre">...</span></code>), use the same as above,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;blas&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">libs</span><span class="o">.</span><span class="n">ld_flags</span>
</pre></div>
</div>
<p>See
<a class="reference internal" href="makefilepackage.html#makefilepackage"><span class="std std-ref">MakefilePackage</span></a>
and more generally the
<a class="reference internal" href="../packaging_guide.html#blas-lapack-scalapack"><span class="std std-ref">Packaging Guide</span></a>
for background and further examples.</p>
</li>
</ul>
</section>
</section>
<section id="footnotes">
<h2><a class="toc-backref" href="#id32" role="doc-backlink">Footnotes</a><a class="headerlink" href="#footnotes" title="Link to this heading"></a></h2>
<div role="list" class="citation-list">
<div class="citation" id="fn1" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">fn1</a><span class="fn-bracket">]</span></span>
<p>Strictly speaking, versions from <code class="docutils literal notranslate"><span class="pre">2017.2</span></code> onward.</p>
</div>
<div class="citation" id="fn2" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span>fn2<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id2">1</a>,<a role="doc-backlink" href="#id3">2</a>)</span>
<p>The package <code class="docutils literal notranslate"><span class="pre">intel</span></code> intentionally does not have a <code class="docutils literal notranslate"><span class="pre">+mpi</span></code> variant since
it is meant to be small. The native installer will always add MPI <em>runtime</em>
components because it follows defaults defined in the download package, even
when <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span> <span class="pre">~mpi</span></code> has been requested.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span> <span class="pre">+mpi</span></code>, the class function
:py:func:<code class="docutils literal notranslate"><span class="pre">.IntelPackage.pset_components</span></code>
will include <code class="docutils literal notranslate"><span class="pre">&quot;intel-mpi</span> <span class="pre">intel-imb&quot;</span></code> in a list of component patterns passed
to the Intel installer. The installer will extend each pattern word with an
implied glob-like <code class="docutils literal notranslate"><span class="pre">*</span></code> to resolve it to package names that are
<em>actually present in the product BOM</em>.
As a side effect, this pattern approach accommodates occasional package name
changes, e.g., capturing both <code class="docutils literal notranslate"><span class="pre">intel-mpirt</span></code> and <code class="docutils literal notranslate"><span class="pre">intel-mpi-rt</span></code> .</p>
</div>
<div class="citation" id="fn3" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">fn3</a><span class="fn-bracket">]</span></span>
<p>How could the external installation have succeeded otherwise?</p>
</div>
<div class="citation" id="fn4" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">fn4</a><span class="fn-bracket">]</span></span>
<p>According to Intel’s documentation, there is supposedly a way to install a
product using a network license even <a class="reference external" href="https://software.intel.com/en-us/articles/licensing-setting-up-the-client-floating-license">when a FLEXlm server is not running</a>:
Specify the license in the form <code class="docutils literal notranslate"><span class="pre">port&#64;serverhost</span></code> in the
<code class="docutils literal notranslate"><span class="pre">INTEL_LICENSE_FILE</span></code> environment variable. All other means of specifying a
network license require that the license server be up.</p>
</div>
<div class="citation" id="fn5" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">fn5</a><span class="fn-bracket">]</span></span>
<p>Despite the name, <code class="docutils literal notranslate"><span class="pre">INTEL_LICENSE_FILE</span></code> can hold several and diverse entries.
They  can be either directories (presumed to contain <code class="docutils literal notranslate"><span class="pre">*.lic</span></code> files), file
names, or network locations in the form <code class="docutils literal notranslate"><span class="pre">port&#64;host</span></code> (on Linux and Mac),
with all items separated by “:” (on Linux and Mac).</p>
</div>
<div class="citation" id="fn6" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">fn6</a><span class="fn-bracket">]</span></span>
<p>Should said editor turn out to be <code class="docutils literal notranslate"><span class="pre">vi</span></code>, you better be in a position
to know how to use it.</p>
</div>
<div class="citation" id="fn7" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">fn7</a><span class="fn-bracket">]</span></span>
<p>Comment lines in FLEXlm files, indicated by <code class="docutils literal notranslate"><span class="pre">#</span></code> as the first
non-whitespace character on the line, are generally allowed anywhere in the file.
There <a class="reference external" href="https://github.com/spack/spack/issues/6534">have been reports</a>,
however, that as of 2018, <code class="docutils literal notranslate"><span class="pre">SERVER</span></code> and <code class="docutils literal notranslate"><span class="pre">USE_SERVER</span></code> lines must precede
any comment lines.</p>
</div>
</div>
<div role="list" class="citation-list">
<div class="citation" id="fn8" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">fn8</a><span class="fn-bracket">]</span></span>
<p>Spack’s close coupling of installed packages to compilers, which both
necessitates the detour for installing <code class="docutils literal notranslate"><span class="pre">intel-parallel-studio</span></code>, and
largely limits any of its provided virtual packages to a single compiler, heavily
favors <a class="reference internal" href="#integrate-external-intel">recommending to install Intel Parallel Studio outside of Spack</a> and declare it for Spack in <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code>
by a <a class="reference internal" href="#compiler-neutral-package">compiler-less spec</a>.</p>
</div>
<div class="citation" id="fn9" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">fn9</a><span class="fn-bracket">]</span></span>
<p>With some effort, you can convince Spack to use shorter paths.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Altering the naming scheme means that Spack will lose track of
all packages it has installed for you so far.
That said, the time is right for this kind of customization
when you are defining a new set of compilers.</p>
</div>
<p>The relevant tunables are:</p>
<ol class="arabic simple">
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">install_tree</span></code> location in <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>
(<a class="reference internal" href="../config_yaml.html#config-yaml"><span class="std std-ref">see doc</span></a>).</p></li>
<li><p>Set the hash length in <code class="docutils literal notranslate"><span class="pre">install-path-scheme</span></code>, also in <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>
(<a class="reference internal" href="../config_yaml.html#config-yaml"><span class="std std-ref">q.v.</span></a>).</p></li>
<li><p>You will want to set the <em>same</em> hash length for
<a class="reference internal" href="../module_file_support.html#modules-projections"><span class="std std-ref">module files</span></a>
if you have Spack produce them for you, under <code class="docutils literal notranslate"><span class="pre">projections</span></code> in
<code class="docutils literal notranslate"><span class="pre">modules.yaml</span></code>.</p></li>
</ol>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="inteloneapipackage.html" class="btn btn-neutral float-left" title="IntelOneapi" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="rocmpackage.html" class="btn btn-neutral float-right" title="ROCm" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2023, Lawrence Livermore National Laboratory..
      <span class="lastupdated">Last updated on Sep 20, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>