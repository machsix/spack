

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Python &mdash; Spack 0.23.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5f00b823" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=832b3b9f"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="R" href="rpackage.html" />
    <link rel="prev" title="Perl" href="perlpackage.html" /> 
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S0PQ7WV75K"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S0PQ7WV75K');
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/spack-logo-white-text.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../features.html">Feature Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic_usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../replace_conda_homebrew.html">Spack for Homebrew/Conda Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frequently_asked_questions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://spack-tutorial.readthedocs.io">Tutorial (spack-tutorial.rtfd.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://packages.spack.io">Packages (packages.spack.io)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cache.spack.io">Binaries (binaries.spack.io)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config_yaml.html">Spack Settings (config.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packages_yaml.html">Package Settings (packages.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_settings.html">Concretization Settings (concretizer.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../environments.html">Environments (spack.yaml, spack.lock)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../containers.html">Container Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mirrors.html">Mirrors (mirrors.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_file_support.html">Modules (modules.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../repositories.html">Package Repositories (repos.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../binary_caches.html">Build Caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bootstrapping.html">Bootstrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_index.html">Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chain.html">Chaining Spack Installations (upstreams.yaml)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extensions.html">Custom Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipelines.html">CI Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../signing.html">Spack Package Signing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu_configuration.html">Using External GPU Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../contribution_guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packaging_guide.html">Packaging Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../build_systems.html">Build Systems</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="makefilepackage.html">Makefile</a></li>
<li class="toctree-l2"><a class="reference internal" href="mavenpackage.html">Maven</a></li>
<li class="toctree-l2"><a class="reference internal" href="sconspackage.html">SCons</a></li>
<li class="toctree-l2"><a class="reference internal" href="wafpackage.html">Waf</a></li>
<li class="toctree-l2"><a class="reference internal" href="autotoolspackage.html">Autotools</a></li>
<li class="toctree-l2"><a class="reference internal" href="cmakepackage.html">CMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="cachedcmakepackage.html">CachedCMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="mesonpackage.html">Meson</a></li>
<li class="toctree-l2"><a class="reference internal" href="qmakepackage.html">QMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="sippackage.html">SIP</a></li>
<li class="toctree-l2"><a class="reference internal" href="luapackage.html">Lua</a></li>
<li class="toctree-l2"><a class="reference internal" href="octavepackage.html">Octave</a></li>
<li class="toctree-l2"><a class="reference internal" href="perlpackage.html">Perl</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Python</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#terminology">Terminology</a></li>
<li class="toctree-l3"><a class="reference internal" href="#downloading">Downloading</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pypi-vs-github">PyPI vs. GitHub</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id2">PyPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dependencies">Dependencies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#distutils">distutils</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setuptools">setuptools</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">flit</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">poetry</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">hatchling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">meson</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">pdm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wheels">wheels</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#passing-arguments-to-setup-py">Passing arguments to setup.py</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#config-settings">Config settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#global-options">Global options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-options">Install options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#testing">Testing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#import-tests">Import tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unit-tests">Unit tests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#setup-file-in-a-sub-directory">Setup file in a sub-directory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pythonpackage-vs-packages-that-use-python">PythonPackage vs. packages that use Python</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#choosing-a-build-system">Choosing a build system</a></li>
<li class="toctree-l4"><a class="reference internal" href="#choosing-a-package-name">Choosing a package name</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extends-vs-depends-on"><code class="docutils literal notranslate"><span class="pre">extends</span></code> vs. <code class="docutils literal notranslate"><span class="pre">depends_on</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#executing-python-during-the-build">Executing <code class="docutils literal notranslate"><span class="pre">python</span></code> during the build</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#alternatives-to-spack">Alternatives to Spack</a></li>
<li class="toctree-l3"><a class="reference internal" href="#external-documentation">External documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rpackage.html">R</a></li>
<li class="toctree-l2"><a class="reference internal" href="racketpackage.html">Racket</a></li>
<li class="toctree-l2"><a class="reference internal" href="rubypackage.html">Ruby</a></li>
<li class="toctree-l2"><a class="reference internal" href="bundlepackage.html">Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="cudapackage.html">Cuda</a></li>
<li class="toctree-l2"><a class="reference internal" href="custompackage.html">Custom Build Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="inteloneapipackage.html">IntelOneapi</a></li>
<li class="toctree-l2"><a class="reference internal" href="intelpackage.html">Intel</a></li>
<li class="toctree-l2"><a class="reference internal" href="rocmpackage.html">ROCm</a></li>
<li class="toctree-l2"><a class="reference internal" href="sourceforgepackage.html">Sourceforge</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../spack.html">Spack API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../llnl.html">LLNL API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Spack</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../build_systems.html">Build Systems</a></li>
      <li class="breadcrumb-item active">Python</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/build_systems/pythonpackage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="python">
<span id="pythonpackage"></span><h1>Python<a class="headerlink" href="#python" title="Link to this heading"></a></h1>
<p>Python packages and modules have their own special build system. This
documentation covers everything you’ll need to know in order to write
a Spack build recipe for a Python library.</p>
<section id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Link to this heading"></a></h2>
<p>In the Python ecosystem, there are a number of terms that are
important to understand.</p>
<dl class="simple">
<dt><strong>PyPI</strong></dt><dd><p>The <a class="reference external" href="https://pypi.org/">Python Package Index</a>, where most Python
libraries are hosted.</p>
</dd>
<dt><strong>sdist</strong></dt><dd><p>Source distributions, distributed as tarballs (.tar.gz) and zip
files (.zip). Contain the source code of the package.</p>
</dd>
<dt><strong>bdist</strong></dt><dd><p>Built distributions, distributed as wheels (.whl). Contain the
pre-built library.</p>
</dd>
<dt><strong>wheel</strong></dt><dd><p>A binary distribution format common in the Python ecosystem. This
file is actually just a zip file containing specific metadata and
code. See the
<a class="reference external" href="https://packaging.python.org/en/latest/specifications/binary-distribution-format/">documentation</a>
for more details.</p>
</dd>
<dt><strong>build frontend</strong></dt><dd><p>Command-line tools used to build and install wheels. Examples
include <a class="reference external" href="https://pip.pypa.io/">pip</a>,
<a class="reference external" href="https://pypa-build.readthedocs.io/">build</a>, and
<a class="reference external" href="https://installer.readthedocs.io/">installer</a>.</p>
</dd>
<dt><strong>build backend</strong></dt><dd><p>Libraries used to define how to build a wheel. Examples
include <a class="reference external" href="https://setuptools.pypa.io/">setuptools</a>,
<a class="reference external" href="https://flit.pypa.io/">flit</a>,
<a class="reference external" href="https://python-poetry.org/">poetry</a>,
<a class="reference external" href="https://hatch.pypa.io/latest/">hatchling</a>,
<a class="reference external" href="https://meson-python.readthedocs.io/">meson</a>, and
<a class="reference external" href="https://pdm.fming.dev/latest/">pdm</a>.</p>
</dd>
</dl>
</section>
<section id="downloading">
<h2>Downloading<a class="headerlink" href="#downloading" title="Link to this heading"></a></h2>
<p>The first step in packaging a Python library is to figure out where
to download it from. The vast majority of Python packages are hosted
on <a class="reference external" href="https://pypi.org/">PyPI</a>, which is
<a class="reference internal" href="#pypi-vs-github"><span class="std std-ref">preferred over GitHub</span></a> for downloading
packages. Search for the package name on PyPI to find the project
page. The project page is usually located at:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pypi</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">project</span><span class="o">/&lt;</span><span class="n">package</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>On the project page, there is a “Download files” tab containing
download URLs. Whenever possible, we prefer to build Spack packages
from source. If PyPI only has wheels, check to see if the project is
hosted on GitHub and see if GitHub has source distributions. The
project page usually has a “Homepage” and/or “Source code” link for
this. If the project is closed-source, it may only have wheels
available. For example, <code class="docutils literal notranslate"><span class="pre">py-azureml-sdk</span></code> is closed-source and can
be downloaded from:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pypi</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">py3</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="n">azureml_sdk</span><span class="o">/</span><span class="n">azureml_sdk</span><span class="o">-</span><span class="mf">1.11.0</span><span class="o">-</span><span class="n">py3</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="nb">any</span><span class="o">.</span><span class="n">whl</span>
</pre></div>
</div>
<p>Once you’ve found a URL to download the package from, run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack<span class="w"> </span>create<span class="w"> </span>&lt;url&gt;
</pre></div>
</div>
<p>to create a new package template.</p>
<section id="pypi-vs-github">
<span id="id1"></span><h3>PyPI vs. GitHub<a class="headerlink" href="#pypi-vs-github" title="Link to this heading"></a></h3>
<p>Many packages are hosted on PyPI, but are developed on GitHub or
another version control system hosting service. The source code can
be downloaded from either location, but PyPI is preferred for the
following reasons:</p>
<ol class="arabic">
<li><p>PyPI contains the bare minimum number of files needed to install
the package.</p>
<p>You may notice that the tarball you download from PyPI does not
have the same checksum as the tarball you download from GitHub.
When a developer uploads a new release to PyPI, it doesn’t contain
every file in the repository, only the files necessary to install
the package. PyPI tarballs are therefore smaller.</p>
</li>
<li><p>PyPI is the official source for package managers like <code class="docutils literal notranslate"><span class="pre">pip</span></code>.</p>
<p>Let’s be honest, <code class="docutils literal notranslate"><span class="pre">pip</span></code> is much more popular than Spack. If the
GitHub tarball contains a file not present in the PyPI tarball that
causes a bug, the developers may not realize this for quite some
time. If the bug was in a file contained in the PyPI tarball, users
would notice the bug much more quickly.</p>
</li>
<li><p>GitHub release may be a beta version.</p>
<p>When a developer releases a new version of a package on GitHub,
it may not be intended for most users. Until that release also
makes its way to PyPI, it should be assumed that the release is
not yet ready for general use.</p>
</li>
<li><p>The checksum for a GitHub release may change.</p>
<p>Unfortunately, some developers have a habit of patching releases
without incrementing the version number. This results in a change
in tarball checksum. Package managers like Spack that use checksums
to verify the integrity of a download tarball grind to a halt when
the checksum for a known version changes. Most of the time, the
change is intentional, and contains a needed bug fix. However,
sometimes the change indicates a download source that has been
compromised, and a tarball that contains a virus. If this happens,
you must contact the developers to determine which is the case.
PyPI is nice because it makes it physically impossible to
re-release the same version of a package with a different checksum.</p>
</li>
</ol>
<p>The only reason to use GitHub instead of PyPI is if PyPI only has
wheels or if the PyPI sdist is missing a file needed to build the
package. If this is the case, please add a comment above the <code class="docutils literal notranslate"><span class="pre">url</span></code>
explaining this.</p>
</section>
</section>
<section id="id2">
<h2>PyPI<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<p>Since PyPI is so commonly used to host Python libraries, the
<code class="docutils literal notranslate"><span class="pre">PythonPackage</span></code> base class has a <code class="docutils literal notranslate"><span class="pre">pypi</span></code> attribute that can be
set. Once set, <code class="docutils literal notranslate"><span class="pre">pypi</span></code> will be used to define the <code class="docutils literal notranslate"><span class="pre">homepage</span></code>,
<code class="docutils literal notranslate"><span class="pre">url</span></code>, and <code class="docutils literal notranslate"><span class="pre">list_url</span></code>. For example, the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">homepage</span> <span class="o">=</span> <span class="s2">&quot;https://pypi.org/project/setuptools/&quot;</span>
<span class="n">url</span>      <span class="o">=</span> <span class="s2">&quot;https://pypi.org/packages/source/s/setuptools/setuptools-49.2.0.zip&quot;</span>
<span class="n">list_url</span> <span class="o">=</span> <span class="s2">&quot;https://pypi.org/simple/setuptools/&quot;</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pypi</span> <span class="o">=</span> <span class="s2">&quot;setuptools/setuptools-49.2.0.zip&quot;</span>
</pre></div>
</div>
<p>If a package has a different homepage listed on PyPI, you can
override it by setting your own <code class="docutils literal notranslate"><span class="pre">homepage</span></code>.</p>
</section>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Link to this heading"></a></h2>
<p>The top of the PyPI project page contains a short description of the
package. The “Project description” tab may also contain a longer
description of the package. Either of these can be used to populate
the package docstring.</p>
</section>
<section id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Link to this heading"></a></h2>
<p>Once you’ve determined the basic metadata for a package, the next
step is to determine the build backend. <code class="docutils literal notranslate"><span class="pre">PythonPackage</span></code> uses
<a class="reference external" href="https://pip.pypa.io/">pip</a> to install the package, but pip
requires a backend to actually build the package.</p>
<p>To determine the build backend, look for a <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file.
If there is no <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file and only a <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> or
<code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> file, you can assume that the project uses
<a class="reference internal" href="#setuptools"><span class="std std-ref">setuptools</span></a>. If there is a <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file, see if it
contains a <code class="docutils literal notranslate"><span class="pre">[build-system]</span></code> section. For example:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[build-system]</span>
<span class="n">requires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;setuptools&gt;=42&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;wheel&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">build-backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;setuptools.build_meta&quot;</span>
</pre></div>
</div>
<p>This section does two things: the <code class="docutils literal notranslate"><span class="pre">requires</span></code> key lists build
dependencies of the project, and the <code class="docutils literal notranslate"><span class="pre">build-backend</span></code> key defines
the build backend. All of these build dependencies should be added as
dependencies to your package:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">depends_on</span><span class="p">(</span><span class="s2">&quot;py-setuptools@42:&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;build&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">py-wheel</span></code> is already listed as a build dependency in the
<code class="docutils literal notranslate"><span class="pre">PythonPackage</span></code> base class, so you don’t need to add it unless you
need to specify a specific version requirement or change the
dependency type.</p>
<p>See <a class="reference external" href="https://www.python.org/dev/peps/pep-0517/">PEP 517</a> and
<a class="reference external" href="https://www.python.org/dev/peps/pep-0518/">PEP 518</a> for more
information on the design of <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>.</p>
<p>Depending on which build backend a project uses, there are various
places that run-time dependencies can be listed. Most modern build
backends support listing dependencies directly in <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>.
Look for dependencies under the following keys:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">requires-python</span></code> under <code class="docutils literal notranslate"><span class="pre">[project]</span></code></p>
<p>This specifies the version of Python that is required</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">dependencies</span></code> under <code class="docutils literal notranslate"><span class="pre">[project]</span></code></p>
<p>These packages are required for building and installation. You can
add them with <code class="docutils literal notranslate"><span class="pre">type=(&quot;build&quot;,</span> <span class="pre">&quot;run&quot;)</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">[project.optional-dependencies]</span></code></p>
<p>This section includes keys with lists of optional dependencies
needed to enable those features. You should add a variant that
optionally adds these dependencies. This variant should be <code class="docutils literal notranslate"><span class="pre">False</span></code>
by default.</p>
</li>
</ul>
<p>Some build backends may have additional locations where dependencies
can be found.</p>
<section id="distutils">
<h3>distutils<a class="headerlink" href="#distutils" title="Link to this heading"></a></h3>
<p>Before the introduction of setuptools and other build backends,
Python packages had to rely on the built-in distutils library.
Distutils is missing many of the features that setuptools and other
build backends offer, and users are encouraged to use setuptools
instead. In fact, distutils was deprecated in Python 3.10 and will be
removed in Python 3.12. Because of this, pip actually replaces all
imports of distutils with setuptools. If a package uses distutils,
you should instead add a build dependency on setuptools. Check for a
<code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file that may list dependencies of the project.</p>
</section>
<section id="setuptools">
<span id="id4"></span><h3>setuptools<a class="headerlink" href="#setuptools" title="Link to this heading"></a></h3>
<p>If the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> lists <code class="docutils literal notranslate"><span class="pre">setuptools.build_meta</span></code> as a
<code class="docutils literal notranslate"><span class="pre">build-backend</span></code>, or if the package has a <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> that imports
<code class="docutils literal notranslate"><span class="pre">setuptools</span></code>, or if the package has a <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> file, then it
uses setuptools to build. Setuptools is a replacement for the
distutils library, and has almost the exact same API. In addition to
<code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>, dependencies can be listed in the <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> or
<code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> file. Look for the following arguments:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">python_requires</span></code></p>
<p>This specifies the version of Python that is required.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">setup_requires</span></code></p>
<p>These packages are usually only needed at build-time, so you can
add them with <code class="docutils literal notranslate"><span class="pre">type=&quot;build&quot;</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">install_requires</span></code></p>
<p>These packages are required for building and installation. You can
add them with <code class="docutils literal notranslate"><span class="pre">type=(&quot;build&quot;,</span> <span class="pre">&quot;run&quot;)</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">extras_require</span></code></p>
<p>These packages are optional dependencies that enable additional
functionality. You should add a variant that optionally adds these
dependencies. This variant should be False by default.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests_require</span></code></p>
<p>These are packages that are required to run the unit tests for the
package. These dependencies can be specified using the
<code class="docutils literal notranslate"><span class="pre">type=&quot;test&quot;</span></code> dependency type. However, the PyPI tarballs rarely
contain unit tests, so there is usually no reason to add these.</p>
</li>
</ul>
<p>See <a class="reference external" href="https://setuptools.pypa.io/en/latest/userguide/dependency_management.html">https://setuptools.pypa.io/en/latest/userguide/dependency_management.html</a>
for more information on how setuptools handles dependency management.
See <a class="reference external" href="https://www.python.org/dev/peps/pep-0440/#version-specifiers">PEP 440</a>
for documentation on version specifiers in setuptools.</p>
</section>
<section id="id5">
<h3>flit<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<p>There are actually two possible <code class="docutils literal notranslate"><span class="pre">build-backend</span></code> for flit, <code class="docutils literal notranslate"><span class="pre">flit</span></code>
and <code class="docutils literal notranslate"><span class="pre">flit_core</span></code>. If you see these in the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>, add a
build dependency to your package. With flit, all dependencies are
listed directly in the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file. Older versions of
flit used to store this info in a <code class="docutils literal notranslate"><span class="pre">flit.ini</span></code> file, so check for
this too.</p>
<p>In addition to the default <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> keys listed above,
older versions of flit may use the following keys:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">requires</span></code> under <code class="docutils literal notranslate"><span class="pre">[tool.flit.metadata]</span></code></p>
<p>These packages are required for building and installation. You can
add them with <code class="docutils literal notranslate"><span class="pre">type=(&quot;build&quot;,</span> <span class="pre">&quot;run&quot;)</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">[tool.flit.metadata.requires-extra]</span></code></p>
<p>This section includes keys with lists of optional dependencies
needed to enable those features. You should add a variant that
optionally adds these dependencies. This variant should be False
by default.</p>
</li>
</ul>
<p>See <a class="reference external" href="https://flit.pypa.io/en/latest/pyproject_toml.html">https://flit.pypa.io/en/latest/pyproject_toml.html</a> for
more information.</p>
</section>
<section id="id6">
<h3>poetry<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<p>Like flit, poetry also has two possible <code class="docutils literal notranslate"><span class="pre">build-backend</span></code>, <code class="docutils literal notranslate"><span class="pre">poetry</span></code>
and <code class="docutils literal notranslate"><span class="pre">poetry_core</span></code>. If you see these in the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>, add
a build dependency to your package. With poetry, all dependencies are
listed directly in the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file. Dependencies are
listed in a <code class="docutils literal notranslate"><span class="pre">[tool.poetry.dependencies]</span></code> section, and use a
<a class="reference external" href="https://python-poetry.org/docs/dependency-specification/#version-constraints">custom syntax</a>
for specifying the version requirements. Note that <code class="docutils literal notranslate"><span class="pre">~=</span></code> works
differently in poetry than in setuptools and flit for versions that
start with a zero.</p>
</section>
<section id="id7">
<h3>hatchling<a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<p>If the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> lists <code class="docutils literal notranslate"><span class="pre">hatchling.build</span></code> as the
<code class="docutils literal notranslate"><span class="pre">build-backend</span></code>, it uses the hatchling build system. Hatchling
uses the default <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> keys to list dependencies.</p>
<p>See <a class="reference external" href="https://hatch.pypa.io/latest/config/dependency/">https://hatch.pypa.io/latest/config/dependency/</a> for more
information.</p>
</section>
<section id="id8">
<h3>meson<a class="headerlink" href="#id8" title="Link to this heading"></a></h3>
<p>If the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> lists <code class="docutils literal notranslate"><span class="pre">mesonpy</span></code> as the <code class="docutils literal notranslate"><span class="pre">build-backend</span></code>,
it uses the meson build system. Meson uses the default
<code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> keys to list dependencies.</p>
<p>See <a class="reference external" href="https://meson-python.readthedocs.io/en/latest/tutorials/introduction.html">https://meson-python.readthedocs.io/en/latest/tutorials/introduction.html</a>
for more information.</p>
</section>
<section id="id9">
<h3>pdm<a class="headerlink" href="#id9" title="Link to this heading"></a></h3>
<p>If the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> lists <code class="docutils literal notranslate"><span class="pre">pdm.pep517.api</span></code> as the <code class="docutils literal notranslate"><span class="pre">build-backend</span></code>,
it uses the PDM build system. PDM uses the default <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>
keys to list dependencies.</p>
<p>See <a class="reference external" href="https://pdm.fming.dev/latest/">https://pdm.fming.dev/latest/</a> for more information.</p>
</section>
<section id="wheels">
<h3>wheels<a class="headerlink" href="#wheels" title="Link to this heading"></a></h3>
<p>Some Python packages are closed-source and are distributed as Python
wheels. For example, <code class="docutils literal notranslate"><span class="pre">py-azureml-sdk</span></code> downloads a <code class="docutils literal notranslate"><span class="pre">.whl</span></code> file. This
file is simply a zip file, and can be extracted using:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>unzip<span class="w"> </span>*.whl
</pre></div>
</div>
<p>The zip file will not contain a <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>, but it will contain a
<code class="docutils literal notranslate"><span class="pre">METADATA</span></code> file which contains all the information you need to
write a <code class="docutils literal notranslate"><span class="pre">package.py</span></code> build recipe. Check for lines like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Requires</span><span class="o">-</span><span class="n">Python</span><span class="p">:</span> <span class="o">&gt;=</span><span class="mf">3.5</span><span class="p">,</span><span class="o">&lt;</span><span class="mi">4</span>
<span class="n">Requires</span><span class="o">-</span><span class="n">Dist</span><span class="p">:</span> <span class="n">azureml</span><span class="o">-</span><span class="n">core</span> <span class="p">(</span><span class="o">~=</span><span class="mf">1.11.0</span><span class="p">)</span>
<span class="n">Requires</span><span class="o">-</span><span class="n">Dist</span><span class="p">:</span> <span class="n">azureml</span><span class="o">-</span><span class="n">dataset</span><span class="o">-</span><span class="n">runtime</span><span class="p">[</span><span class="n">fuse</span><span class="p">]</span> <span class="p">(</span><span class="o">~=</span><span class="mf">1.11.0</span><span class="p">)</span>
<span class="n">Requires</span><span class="o">-</span><span class="n">Dist</span><span class="p">:</span> <span class="n">azureml</span><span class="o">-</span><span class="n">train</span> <span class="p">(</span><span class="o">~=</span><span class="mf">1.11.0</span><span class="p">)</span>
<span class="n">Requires</span><span class="o">-</span><span class="n">Dist</span><span class="p">:</span> <span class="n">azureml</span><span class="o">-</span><span class="n">train</span><span class="o">-</span><span class="n">automl</span><span class="o">-</span><span class="n">client</span> <span class="p">(</span><span class="o">~=</span><span class="mf">1.11.0</span><span class="p">)</span>
<span class="n">Requires</span><span class="o">-</span><span class="n">Dist</span><span class="p">:</span> <span class="n">azureml</span><span class="o">-</span><span class="n">pipeline</span> <span class="p">(</span><span class="o">~=</span><span class="mf">1.11.0</span><span class="p">)</span>
<span class="n">Provides</span><span class="o">-</span><span class="n">Extra</span><span class="p">:</span> <span class="n">accel</span><span class="o">-</span><span class="n">models</span>
<span class="n">Requires</span><span class="o">-</span><span class="n">Dist</span><span class="p">:</span> <span class="n">azureml</span><span class="o">-</span><span class="n">accel</span><span class="o">-</span><span class="n">models</span> <span class="p">(</span><span class="o">~=</span><span class="mf">1.11.0</span><span class="p">);</span> <span class="n">extra</span> <span class="o">==</span> <span class="s1">&#39;accel-models&#39;</span>
<span class="n">Provides</span><span class="o">-</span><span class="n">Extra</span><span class="p">:</span> <span class="n">automl</span>
<span class="n">Requires</span><span class="o">-</span><span class="n">Dist</span><span class="p">:</span> <span class="n">azureml</span><span class="o">-</span><span class="n">train</span><span class="o">-</span><span class="n">automl</span> <span class="p">(</span><span class="o">~=</span><span class="mf">1.11.0</span><span class="p">);</span> <span class="n">extra</span> <span class="o">==</span> <span class="s1">&#39;automl&#39;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Requires-Python</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">python_requires</span></code> and
<code class="docutils literal notranslate"><span class="pre">Requires-Dist</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">install_requires</span></code>.
<code class="docutils literal notranslate"><span class="pre">Provides-Extra</span></code> is used to name optional features (variants) and
a <code class="docutils literal notranslate"><span class="pre">Requires-Dist</span></code> with <code class="docutils literal notranslate"><span class="pre">extra</span> <span class="pre">==</span> <span class="pre">'foo'</span></code> will list any
dependencies needed for that feature.</p>
</section>
</section>
<section id="passing-arguments-to-setup-py">
<h2>Passing arguments to setup.py<a class="headerlink" href="#passing-arguments-to-setup-py" title="Link to this heading"></a></h2>
<p>The default install phase should be sufficient to install most
packages. However, the installation instructions for a package may
suggest passing certain flags to the <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> call. The
<code class="docutils literal notranslate"><span class="pre">PythonPackage</span></code> class has two techniques for doing this.</p>
<section id="config-settings">
<h3>Config settings<a class="headerlink" href="#config-settings" title="Link to this heading"></a></h3>
<p>These settings are passed to
<a class="reference external" href="https://peps.python.org/pep-0517/">PEP 517</a> build backends.
For example, <code class="docutils literal notranslate"><span class="pre">py-scipy</span></code> package allows you to specify the name of
the BLAS/LAPACK library you want pkg-config to search for:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">depends_on</span><span class="p">(</span><span class="s2">&quot;py-pip@22.1:&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;build&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">config_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;blas&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;blas&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">libs</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;lapack&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;lapack&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">libs</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This flag only works for packages that define a <code class="docutils literal notranslate"><span class="pre">build-backend</span></code>
in <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>. Also, it is only supported by pip 22.1+,
which requires Python 3.7+. For packages that still support Python
3.6 and older, <code class="docutils literal notranslate"><span class="pre">install_options</span></code> should be used instead.</p>
</div>
</section>
<section id="global-options">
<h3>Global options<a class="headerlink" href="#global-options" title="Link to this heading"></a></h3>
<p>These flags are added directly after <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> when pip runs
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></code>. For example, the <code class="docutils literal notranslate"><span class="pre">py-pyyaml</span></code> package
has an optional dependency on <code class="docutils literal notranslate"><span class="pre">libyaml</span></code> that can be enabled like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">global_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="s2">&quot;+libyaml&quot;</span><span class="p">):</span>
        <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;--with-libyaml&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;--without-libyaml&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">options</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Direct invocation of <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> is
<a class="reference external" href="https://blog.ganssle.io/articles/2021/10/setup-py-deprecated.html">deprecated</a>.
This flag forces pip to use a deprecated installation procedure.
It should only be used in packages that don’t define a
<code class="docutils literal notranslate"><span class="pre">build-backend</span></code> in <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> or packages that still
support Python 3.6 and older.</p>
</div>
</section>
<section id="install-options">
<h3>Install options<a class="headerlink" href="#install-options" title="Link to this heading"></a></h3>
<p>These flags are added directly after <code class="docutils literal notranslate"><span class="pre">install</span></code> when pip runs
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></code>. For example, the <code class="docutils literal notranslate"><span class="pre">py-pyyaml</span></code> package
allows you to specify the directories to search for <code class="docutils literal notranslate"><span class="pre">libyaml</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">install_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="s2">&quot;+libyaml&quot;</span><span class="p">):</span>
        <span class="n">options</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
            <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;libyaml&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">libs</span><span class="o">.</span><span class="n">search_flags</span><span class="p">,</span>
            <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;libyaml&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">include_flags</span><span class="p">,</span>
        <span class="p">])</span>
    <span class="k">return</span> <span class="n">options</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Direct invocation of <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> is
<a class="reference external" href="https://blog.ganssle.io/articles/2021/10/setup-py-deprecated.html">deprecated</a>.
This flag forces pip to use a deprecated installation procedure.
It should only be used in packages that don’t define a
<code class="docutils literal notranslate"><span class="pre">build-backend</span></code> in <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> or packages that still
support Python 3.6 and older.</p>
</div>
</section>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">PythonPackage</span></code> provides a couple of options for testing packages
both during and after the installation process.</p>
<section id="import-tests">
<h3>Import tests<a class="headerlink" href="#import-tests" title="Link to this heading"></a></h3>
<p>Just because a package successfully built does not mean that it built
correctly. The most reliable test of whether or not the package was
correctly installed is to attempt to import all of the modules that
get installed. To get a list of modules, run the following command
in the source directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python
<span class="go">&gt;&gt;&gt; import setuptools</span>
<span class="go">&gt;&gt;&gt; setuptools.find_packages()</span>
<span class="go">[&#39;numpy&#39;, &#39;numpy._build_utils&#39;, &#39;numpy.compat&#39;, &#39;numpy.core&#39;, &#39;numpy.distutils&#39;, &#39;numpy.doc&#39;, &#39;numpy.f2py&#39;, &#39;numpy.fft&#39;, &#39;numpy.lib&#39;, &#39;numpy.linalg&#39;, &#39;numpy.ma&#39;, &#39;numpy.matrixlib&#39;, &#39;numpy.polynomial&#39;, &#39;numpy.random&#39;, &#39;numpy.testing&#39;, &#39;numpy.core.code_generators&#39;, &#39;numpy.distutils.command&#39;, &#39;numpy.distutils.fcompiler&#39;]</span>
</pre></div>
</div>
<p>Large, complex packages like <code class="docutils literal notranslate"><span class="pre">numpy</span></code> will return a long list of
packages, while other packages like <code class="docutils literal notranslate"><span class="pre">six</span></code> will return an empty list.
<code class="docutils literal notranslate"><span class="pre">py-six</span></code> installs a single <code class="docutils literal notranslate"><span class="pre">six.py</span></code> file. In Python packaging lingo,
a “package” is a directory containing files like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>foo/__init__.py
foo/bar.py
foo/baz.py
</pre></div>
</div>
<p>whereas a “module” is a single Python file.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">PythonPackage</span></code> base class automatically detects these package
and module names for you. If, for whatever reason, the module names
detected are wrong, you can provide the names yourself by overriding
<code class="docutils literal notranslate"><span class="pre">import_modules</span></code> like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">import_modules</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;six&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Sometimes the list of module names to import depends on how the
package was built. For example, the <code class="docutils literal notranslate"><span class="pre">py-pyyaml</span></code> package has a
<code class="docutils literal notranslate"><span class="pre">+libyaml</span></code> variant that enables the build of a faster optimized
version of the library. If the user chooses <code class="docutils literal notranslate"><span class="pre">~libyaml</span></code>, only the
<code class="docutils literal notranslate"><span class="pre">yaml</span></code> library will be importable. If the user chooses <code class="docutils literal notranslate"><span class="pre">+libyaml</span></code>,
both the <code class="docutils literal notranslate"><span class="pre">yaml</span></code> and <code class="docutils literal notranslate"><span class="pre">yaml.cyaml</span></code> libraries will be available.
This can be expressed like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">import_modules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">modules</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;yaml&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="s2">&quot;+libyaml&quot;</span><span class="p">):</span>
        <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;yaml.cyaml&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">modules</span>
</pre></div>
</div>
<p>These tests often catch missing dependencies and non-RPATHed
libraries. Make sure not to add modules/packages containing the word
“test”, as these likely won’t end up in the installation directory,
or may require test dependencies like pytest to be installed.</p>
<p>Instead of defining the <code class="docutils literal notranslate"><span class="pre">import_modules</span></code> explicitly, only the subset
of module names to be skipped can be defined by using <code class="docutils literal notranslate"><span class="pre">skip_modules</span></code>.
If a defined module has submodules, they are skipped as well, e.g.,
in case the <code class="docutils literal notranslate"><span class="pre">plotting</span></code> modules should be excluded from the
automatically detected <code class="docutils literal notranslate"><span class="pre">import_modules</span></code> <code class="docutils literal notranslate"><span class="pre">[&quot;nilearn&quot;,</span> <span class="pre">&quot;nilearn.surface&quot;,</span>
<span class="pre">&quot;nilearn.plotting&quot;,</span> <span class="pre">&quot;nilearn.plotting.data&quot;]</span></code> set:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">skip_modules</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nilearn.plotting&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>This will set <code class="docutils literal notranslate"><span class="pre">import_modules</span></code> to <code class="docutils literal notranslate"><span class="pre">[&quot;nilearn&quot;,</span> <span class="pre">&quot;nilearn.surface&quot;]</span></code></p>
<p>Import tests can be run during the installation using <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">install</span>
<span class="pre">--test=root</span></code> or at any time after the installation using
<code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">test</span> <span class="pre">run</span></code>.</p>
</section>
<section id="unit-tests">
<h3>Unit tests<a class="headerlink" href="#unit-tests" title="Link to this heading"></a></h3>
<p>The package may have its own unit or regression tests. Spack can
run these tests during the installation by adding test methods after
installation.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">py-numpy</span></code> adds the following as a check to run
after the <code class="docutils literal notranslate"><span class="pre">install</span></code> phase:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@run_after</span><span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">)</span>
<span class="nd">@on_package_attributes</span><span class="p">(</span><span class="n">run_tests</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">install_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">working_dir</span><span class="p">(</span><span class="s2">&quot;spack-test&quot;</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">python</span><span class="p">(</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;import numpy; numpy.test(&#39;full&#39;, verbose=2)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>when testing is enabled during the installation (i.e., <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">install</span>
<span class="pre">--test=root</span></code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Additional information is available on <a class="reference internal" href="../packaging_guide.html#install-phase-tests"><span class="std std-ref">install phase tests</span></a>.</p>
</div>
</section>
</section>
<section id="setup-file-in-a-sub-directory">
<h2>Setup file in a sub-directory<a class="headerlink" href="#setup-file-in-a-sub-directory" title="Link to this heading"></a></h2>
<p>Many C/C++ libraries provide optional Python bindings in a
subdirectory. To tell pip which directory to build from, you can
override the <code class="docutils literal notranslate"><span class="pre">build_directory</span></code> attribute. For example, if a package
provides Python bindings in a <code class="docutils literal notranslate"><span class="pre">python</span></code> directory, you can use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">build_directory</span> <span class="o">=</span> <span class="s2">&quot;python&quot;</span>
</pre></div>
</div>
</section>
<section id="pythonpackage-vs-packages-that-use-python">
<h2>PythonPackage vs. packages that use Python<a class="headerlink" href="#pythonpackage-vs-packages-that-use-python" title="Link to this heading"></a></h2>
<p>There are many packages that make use of Python, but packages that depend
on Python are not necessarily <code class="docutils literal notranslate"><span class="pre">PythonPackage</span></code>’s.</p>
<section id="choosing-a-build-system">
<h3>Choosing a build system<a class="headerlink" href="#choosing-a-build-system" title="Link to this heading"></a></h3>
<p>First of all, you need to select a build system. <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">create</span></code>
usually does this for you, but if for whatever reason you need to do
this manually, choose <code class="docutils literal notranslate"><span class="pre">PythonPackage</span></code> if and only if the package
contains one of the following files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setup.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code></p></li>
</ul>
</section>
<section id="choosing-a-package-name">
<h3>Choosing a package name<a class="headerlink" href="#choosing-a-package-name" title="Link to this heading"></a></h3>
<p>Selecting the appropriate package name is a little more complicated
than choosing the build system. By default, <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">create</span></code> will
prepend <code class="docutils literal notranslate"><span class="pre">py-</span></code> to the beginning of the package name if it detects
that the package uses the <code class="docutils literal notranslate"><span class="pre">PythonPackage</span></code> build system. However, there
are occasionally packages that use <code class="docutils literal notranslate"><span class="pre">PythonPackage</span></code> that shouldn’t
start with <code class="docutils literal notranslate"><span class="pre">py-</span></code>. For example:</p>
<ul class="simple">
<li><p>awscli</p></li>
<li><p>aws-parallelcluster</p></li>
<li><p>busco</p></li>
<li><p>easybuild</p></li>
<li><p>httpie</p></li>
<li><p>mercurial</p></li>
<li><p>scons</p></li>
<li><p>snakemake</p></li>
</ul>
<p>The thing these packages have in common is that they are command-line
tools that just so happen to be written in Python. Someone who wants
to install <code class="docutils literal notranslate"><span class="pre">mercurial</span></code> with Spack isn’t going to realize that it is
written in Python, and they certainly aren’t going to assume the package
is called <code class="docutils literal notranslate"><span class="pre">py-mercurial</span></code>. For this reason, we manually renamed the
package to <code class="docutils literal notranslate"><span class="pre">mercurial</span></code>.</p>
<p>Likewise, there are occasionally packages that don’t use the
<code class="docutils literal notranslate"><span class="pre">PythonPackage</span></code> build system but should still be prepended with <code class="docutils literal notranslate"><span class="pre">py-</span></code>.
For example:</p>
<ul class="simple">
<li><p>py-genders</p></li>
<li><p>py-py2cairo</p></li>
<li><p>py-pygobject</p></li>
<li><p>py-pygtk</p></li>
<li><p>py-pyqt</p></li>
<li><p>py-pyserial</p></li>
<li><p>py-sip</p></li>
<li><p>py-xpyb</p></li>
</ul>
<p>These packages are primarily used as Python libraries, not as
command-line tools. You may see C/C++ packages that have optional
Python language-bindings, such as:</p>
<ul class="simple">
<li><p>antlr</p></li>
<li><p>cantera</p></li>
<li><p>conduit</p></li>
<li><p>pagmo</p></li>
<li><p>vtk</p></li>
</ul>
<p>Don’t prepend these kind of packages with <code class="docutils literal notranslate"><span class="pre">py-</span></code>. When in doubt,
think about how this package will be used. Is it primarily a Python
library that will be imported in other Python scripts? Or is it a
command-line tool, or C/C++/Fortran program with optional Python
modules? The former should be prepended with <code class="docutils literal notranslate"><span class="pre">py-</span></code>, while the
latter should not.</p>
</section>
<section id="extends-vs-depends-on">
<h3><code class="docutils literal notranslate"><span class="pre">extends</span></code> vs. <code class="docutils literal notranslate"><span class="pre">depends_on</span></code><a class="headerlink" href="#extends-vs-depends-on" title="Link to this heading"></a></h3>
<p>As mentioned in the <a class="reference internal" href="../packaging_guide.html#packaging-extensions"><span class="std std-ref">Packaging Guide</span></a>,
<code class="docutils literal notranslate"><span class="pre">extends</span></code> and <code class="docutils literal notranslate"><span class="pre">depends_on</span></code> are very similar, but <code class="docutils literal notranslate"><span class="pre">extends</span></code> ensures
that the extension and extendee share the same prefix in views.
This allows the user to import a Python module without
having to add that module to <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>.</p>
<p>Additionally, <code class="docutils literal notranslate"><span class="pre">extends(&quot;python&quot;)</span></code> adds a dependency on the package
<code class="docutils literal notranslate"><span class="pre">python-venv</span></code>. This improves isolation from the system, whether
it’s during the build or at runtime: user and system site packages
cannot accidentally be used by any package that <code class="docutils literal notranslate"><span class="pre">extends(&quot;python&quot;)</span></code>.</p>
<p>As a rule of thumb: if a package does not install any Python modules
of its own, and merely puts a Python script in the <code class="docutils literal notranslate"><span class="pre">bin</span></code> directory,
then there is no need for <code class="docutils literal notranslate"><span class="pre">extends</span></code>. If the package installs modules
in the <code class="docutils literal notranslate"><span class="pre">site-packages</span></code> directory, it requires <code class="docutils literal notranslate"><span class="pre">extends</span></code>.</p>
</section>
<section id="executing-python-during-the-build">
<h3>Executing <code class="docutils literal notranslate"><span class="pre">python</span></code> during the build<a class="headerlink" href="#executing-python-during-the-build" title="Link to this heading"></a></h3>
<p>Whenever you need to execute a Python command or pass the path of the
Python interpreter to the build system, it is best to use the global
variable <code class="docutils literal notranslate"><span class="pre">python</span></code> directly. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@run_before</span><span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">recythonize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">python</span><span class="p">(</span><span class="s2">&quot;setup.py&quot;</span><span class="p">,</span> <span class="s2">&quot;clean&quot;</span><span class="p">)</span>  <span class="c1"># use the `python` global</span>
</pre></div>
</div>
<p>As mentioned in the previous section, <code class="docutils literal notranslate"><span class="pre">extends(&quot;python&quot;)</span></code> adds an
automatic dependency on <code class="docutils literal notranslate"><span class="pre">python-venv</span></code>, which is a virtual environment
that guarantees build isolation. The <code class="docutils literal notranslate"><span class="pre">python</span></code> global always refers to
the correct Python interpreter, whether the package uses <code class="docutils literal notranslate"><span class="pre">extends(&quot;python&quot;)</span></code>
or <code class="docutils literal notranslate"><span class="pre">depends_on(&quot;python&quot;)</span></code>.</p>
</section>
</section>
<section id="alternatives-to-spack">
<h2>Alternatives to Spack<a class="headerlink" href="#alternatives-to-spack" title="Link to this heading"></a></h2>
<p>PyPI has hundreds of thousands of packages that are not yet in Spack,
and <code class="docutils literal notranslate"><span class="pre">pip</span></code> may be a perfectly valid alternative to using Spack. The
main advantage of Spack over <code class="docutils literal notranslate"><span class="pre">pip</span></code> is its ability to compile
non-Python dependencies. It can also build cythonized versions of a
package or link to an optimized BLAS/LAPACK library like MKL,
resulting in calculations that run orders of magnitudes faster.
Spack does not offer a significant advantage over other python-management
systems for installing and using tools like flake8 and sphinx.
But if you need packages with non-Python dependencies like
numpy and scipy, Spack will be very valuable to you.</p>
<p>Anaconda is another great alternative to Spack, and comes with its own
<code class="docutils literal notranslate"><span class="pre">conda</span></code> package manager. Like Spack, Anaconda is capable of compiling
non-Python dependencies. Anaconda contains many Python packages that
are not yet in Spack, and Spack contains many Python packages that are
not yet in Anaconda. The main advantage of Spack over Anaconda is its
ability to choose a specific compiler and BLAS/LAPACK or MPI library.
Spack also has better platform support for supercomputers, and can build
optimized binaries for your specific microarchitecture.</p>
</section>
<section id="external-documentation">
<h2>External documentation<a class="headerlink" href="#external-documentation" title="Link to this heading"></a></h2>
<p>For more information on Python packaging, see:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://packaging.python.org/">https://packaging.python.org/</a></p></li>
</ul>
<p>For more information on build and installation frontend tools, see:</p>
<ul class="simple">
<li><p>pip: <a class="reference external" href="https://pip.pypa.io/">https://pip.pypa.io/</a></p></li>
<li><p>build: <a class="reference external" href="https://pypa-build.readthedocs.io/">https://pypa-build.readthedocs.io/</a></p></li>
<li><p>installer: <a class="reference external" href="https://installer.readthedocs.io/">https://installer.readthedocs.io/</a></p></li>
</ul>
<p>For more information on build backend tools, see:</p>
<ul class="simple">
<li><p>setuptools: <a class="reference external" href="https://setuptools.pypa.io/">https://setuptools.pypa.io/</a></p></li>
<li><p>flit: <a class="reference external" href="https://flit.pypa.io/">https://flit.pypa.io/</a></p></li>
<li><p>poetry: <a class="reference external" href="https://python-poetry.org/">https://python-poetry.org/</a></p></li>
<li><p>hatchling: <a class="reference external" href="https://hatch.pypa.io/latest/">https://hatch.pypa.io/latest/</a></p></li>
<li><p>meson: <a class="reference external" href="https://meson-python.readthedocs.io/">https://meson-python.readthedocs.io/</a></p></li>
<li><p>pdm: <a class="reference external" href="https://pdm.fming.dev/latest/">https://pdm.fming.dev/latest/</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="perlpackage.html" class="btn btn-neutral float-left" title="Perl" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="rpackage.html" class="btn btn-neutral float-right" title="R" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2023, Lawrence Livermore National Laboratory..
      <span class="lastupdated">Last updated on Sep 20, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>